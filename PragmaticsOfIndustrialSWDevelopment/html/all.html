<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Pragmatics of Industrial Software Development</title>
<!-- metadata -->
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="generator" content="S5" />
<meta name="version" content="S5 1.1" />
<meta name="date" content="August 5, 2010" />
<meta name="author" content="Dean Wampler, Ph.D." />
<meta name="company" content="Department of Computer Science,<br/>Loyola University Chicago" />
<meta name="copyright" content="2010 Dean Wampler, All Rights Reserved" />
<!-- configuration parameters -->
<meta name="defaultView" content="slideshow" />
<meta name="controlVis" content="hidden" />
<!-- style sheet links -->
<link rel="stylesheet" href="../ui/default/slides.css" type="text/css" media="projection" id="slideProj" />
<link rel="stylesheet" href="../ui/default/outline.css" type="text/css" media="screen" id="outlineStyle" />
<link rel="stylesheet" href="../lib/stylesheets/print.css" type="text/css" media="print" id="slidePrint" />
<link rel="stylesheet" href="../ui/default/opera.css" type="text/css" media="projection" id="operaFix" />

<link rel="stylesheet" href="../lib/stylesheets/pressie.css" type="text/css" />

<!-- S5 JS -->
<script src="../ui/default/slides.js" type="text/javascript"></script>

<!-- Syntax Highlighter -->
<!-- <link rel="stylesheet"  href="../lib/stylesheets/SyntaxHighlighter.css"></link> -->
<link type="text/css" rel="stylesheet" href="../lib/stylesheets/shCore.css"/>
<link type="text/css" rel="stylesheet" href="../lib/stylesheets/shThemeDefault.css"/>


</head>
<body>

<div class="layout">
<div id="controls"><!-- DO NOT EDIT --></div>
<div id="currentSlide"><!-- DO NOT EDIT --></div>
<div id="header"></div>
<div id="footer">
<h2>Copyright &copy; 2010 Dean Wampler, All Rights Reserved</h2>
<h2>August 5, 2010</h2>
</div>

</div>


<div class="presentation">
<div class="slide">
<h1>Pragmatics of Industrial Software Development</h1>
<blockquote>
<p><span class="caps">COMP</span> 388-003, 488-007</p>
</blockquote>
<blockquote>
<p>Dean Wampler, Ph.D.<br />
<a href="mailto:kwampler@luc.edu">kwampler@luc.edu</a><br />
<a href="mailto:dean@deanwampler.com">dean@deanwampler.com</a><br />
<a href="http://twitter.com/@deanwampler">@deanwampler</a><br />
Department of Computer Science,<br/>Loyola University Chicago</p>
</blockquote>
</div>
<div class="slide">
<h1>Contents</h1>
<div style="font-size: 50%">
<ul>
	<li>Lecture 1: Course Introduction and Scaling Computation, Part I</li>
</ul>
<ul>
	<li>Lecture 2: Scaling Computation, Part II, and Course Project Rebooted</li>
</ul>
<ul>
	<li>Lecture 3: Scaling Systems, Part I</li>
</ul>
<ul>
	<li>Lecture 4: Scaling Data, Part I</li>
</ul>
<ul>
	<li>Lecture 5: Scaling Data, Part II</li>
</ul>
<ul>
	<li>Lecture 6: Scaling Data, Part <span class="caps">III</span></li>
</ul>
<ul>
	<li>Lecture 7: Midterm and Scaling Systems, Part II</li>
</ul>
<ul>
	<li>Lecture 8: Effective Object-Oriented Programming (<span class="caps">OOP</span>), Part I</li>
</ul>
<ul>
	<li>Lecture 9: Effective Object-Oriented Programming (<span class="caps">OOP</span>), Part II</li>
</ul>
<ul>
	<li>Lecture 10: Functional Programming (FP): Into the Real World</li>
</ul>
<ul>
	<li>Lecture 11: <span class="caps">OOP</span> vs. FP: a Critique of Pure Programming</li>
</ul>
<ul>
	<li>Lecture 12: Complexity vs. Simplicity Part I: Effective Software Development Processes, Scrum, XP, and Lean</li>
</ul>
<ul>
	<li>Lecture 13: Complexity vs. Simplicity Part <span class="caps">III</span>: Simple Systems</li>
</ul>
<ul>
	<li>Lecture 14: Student Presentations on the Code Project and Course Review</li>
</ul>
<ul>
	<li>References</li>
</ul>
<ul>
	<li>Appendix: Final Project Ideas</li>
</ul>
</div>
</div>
<div class="title slide">
<h1>Lecture 1: Course Introduction and Scaling Computation, Part I</h1>
</div>
<div class="slide">
<h1>Course Introduction</h1>
<p>You have learned about many aspects of software development in your studies. This course looks at how different ideas actually succeed or fail when applied in modern &#8220;industrial&#8221; (i.e., professional) settings.</p>
<p>It reflects my 20+ years of industry experience and my interest in the efficacy of academic Computer Science.</p>
</div>
<div class="slide">
<h1>Course Learning Objectives</h1>
<p>(See the course syllabus on <a href="http://blackboard.luc.edu/">Blackboard</a> for details.)</p>
<ol>
	<li>Understand why some ideas succeed, some fail, and others grow and decline in popularity as circumstances change.</li>
	<li>Recognize key traits of successful systems, methods, and tools.
	<ul>
		<li>For example, the importance of <em>simplicity</em>.</li>
	</ul></li>
	<li>Gain hands-on experience with trending technologies.</li>
</ol>
</div>
<div class="slide">
<h1>General Principles Covered</h1>
<ul>
	<li>Scaling through concurrency &#8211; effective approaches.</li>
	<li>Scaling data &#8211; new models of persistence and data analysis.</li>
	<li>Object-oriented and functional programming &#8211; an assessment.</li>
	<li>Simplicity in software design &#8211; why it’s important and how to achieve it.</li>
	<li>Software development processes &#8211; what works and why.</li>
</ul>
</div>
<div class="slide">
<h1>Topics that Apply these Principles</h1>
<ul>
	<li>Models of fine-grained, concurrent software for robust, horizontal scalability.</li>
	<li>Distributed systems for large-scale, course-grained scalability.</li>
	<li><span class="caps">SQL</span> and “NoSQL” databases &#8211; finding the right persistence model.</li>
	<li>Internet-scale data processing and analytics.</li>
	<li><em>Agile Methodologies</em> for software development.</li>
</ul>
</div>
<div class="slide">
<h1>Course <em>Administrivia</em></h1>
<table>
	<tr>
		<td> email: </td>
		<td> <a href="mailto:kwampler@luc.edu">kwampler@luc.edu</a>  <br/> <a href="dean@deanwampler.com">dean@deanwampler.com</a> </td>
	</tr>
	<tr>
		<td> twitter: </td>
		<td> <a href="http://twitter.com/deanwampler">@deanwampler</a> </td>
	</tr>
	<tr>
		<td> office hours: </td>
		<td> Tuesday, 6:45 &#8211; ? and by appointment </td>
	</tr>
</table>
</div>
<div class="slide">
<h1>Schedule</h1>
<p>(Revised 10/26)<br />
|  8/31 | Course Intro and Scaling Computation, Part I (Multithreaded Programming, Actor Concurrency) |<br />
|  9/07 | Scaling Computation, Part II (Agents, Software Transactional Memory, Memory is the New Disk) |<br />
|  9/14 | Scaling Systems, Part I (Vertical vs. Horizontal Scaling, Distributed Systems like <span class="caps">HTTP</span>, etc.) <em>Last day to withdraw without a W grade.</em> |<br />
|  9/21 | Scaling Data, Part I (<span class="caps">SQL</span> vs. NoSQL databases) |<br />
|  9/28 | Scaling Data, Part II (Example NoSQL databases) |</p>
</div>
<div class="slide">
<h1>Schedule (cont.)</h1>
<table>
	<tr>
		<td> 10/05 </td>
		<td> Scaling Data, Part <span class="caps">III</span> (Example NoSQL databases) </td>
	</tr>
	<tr>
		<td> 10/12 </td>
		<td> Midterm break </td>
	</tr>
	<tr>
		<td> 10/19 </td>
		<td> Midterm, Scaling Systems, Part II (MapReduce) </td>
	</tr>
	<tr>
		<td> 10/26 </td>
		<td> Effective Object-Oriented Programming, Part I </td>
	</tr>
	<tr>
		<td> 11/02 </td>
		<td> Effective Object-Oriented Programming, Part II </td>
	</tr>
	<tr>
		<td> 11/09 </td>
		<td> Functional Programming: Into the Real World </td>
	</tr>
	<tr>
		<td> 11/16 </td>
		<td> Object-Oriented Programming vs. Functional Programming: a Critique of Pure Programming </td>
	</tr>
</table>
</div>
<div class="slide">
<h1>Schedule (cont.)</h1>
<table>
	<tr>
		<td> 11/23 </td>
		<td> Complexity vs. Simplicity Part I: Effective Software Development Processes, including Scrum, XP, and Lean </td>
	</tr>
	<tr>
		<td> 11/30 </td>
		<td> Complexity vs. Simplicity Part <span class="caps">III</span>: Simple Systems </td>
	</tr>
	<tr>
		<td> 12/07 </td>
		<td> Student Presentations on the Code Project, Course Review </td>
	</tr>
	<tr>
		<td> 12/14 </td>
		<td> Final Exam (regular class time) </td>
	</tr>
</table>
</div>
<div class="slide">
<h1>Readings</h1>
<p>Due to the broad scope and topical nature of this course, there is no assigned textbook. A list of books and papers will be recommended for further reference. Specific reading assignments of on-line or library materials will be given as homework.</p>
<p>See the <a href="references.html">References</a>.</p>
</div>
<div class="slide">
<h1>Course Components: Grading</h1>
<table>
  <tr><td colspan='2'>Midterm</td><td>30%</td></tr>
  <tr><td colspan='2'>Final Exam</td><td>30%</td></tr>
  <tr><td colspan='2'>Project</td><td>40%</td></tr>
  <tr><td>20%</td><td>Code quality, correctness</td><td>&nbsp;</td></tr>
  <tr><td>15%</td><td>Individual contributions</td><td>&nbsp;</td></tr>
  <tr><td>5%</td><td>Final oral presentation</td><td>&nbsp;</td></tr>
  <tr><td colspan='2'>&nbsp;</td><td>100%</td></tr>
</table>
</div>
<div class="slide">
<h1>Course Components: Readings and Lecture</h1>
<ul>
	<li><strong>Readings:</strong>  Expand on the current week&#8217;s topics and preview next week&#8217;s topics. Please read them before coming to class.</li>
	<li><strong>Lecture:</strong>  Summarize and expand upon the readings, discuss the current project assignment. There will also be group discussions. The lecture notes will be posted to blackboard and <a href="http://github.com/deanwampler/Presentations/tree/master/PragmaticsOfIndustrialSWDevelopment/">GitHub.com</a> before each class.</li>
</ul>
</div>
<div class="slide">
<h1>Course Components: Project Exercises</h1>
<ul>
	<li>Start with a &#8220;running&#8221; 3-tier Scala application</li>
	<li>Hosted on <a href="http://github.com">GitHub.com</a> at <a href="http://github.com/deanwampler/AkkaWebSampleExercise">github.com/deanwampler/AkkaWebSampleExercise</a>.</li>
	<li>Uses <em>actors</em> to scale computation over a <span class="caps">NYSE</span> data set.</li>
	<li>Add features during the semester.</li>
	<li><em>Refactor</em> the code to improve it and accommodate new features.</li>
</ul>
</div>
<div class="slide">
<h1>Course Components: Project Exercises (cont.)</h1>
<ul>
	<li><em>You are encouraged to work together.</em></li>
	<li>Like you would in an industrial setting&#8230;</li>
	<li>I expect the solutions to look &#8220;similar&#8221;.</li>
</ul>
</div>
<div class="slide">
<h1>Course Components: Project Exercises (cont.)</h1>
<p>&#8230; but</p>
<ul>
	<li>1/2 the grade differences will be based on GitHub checkin logs and the quality of those checkins.</li>
	<li><strong>If you <em>pair program</em>, include <em>both</em> names in the commit comments!</strong></li>
</ul>
h1. Course Components: Project Exercises (cont.)
<ul>
	<li>5% will be based on an <strong>oral presentation</strong> on 12/7.</li>
	<li>15 minutes or so, with time for questions and discussion.</li>
	<li>Topics to be worked out with me.</li>
</ul>
</div>
<div class="slide">
<h1>Midterm and Final Exam</h1>
<ul>
	<li>Will cover the reading, lecture material, and concepts learned in the exercises.</li>
	<li>Final exam content weighted:</li>
	<li>2/3 of the material since the midterm</li>
	<li>1/3 material before the midterm.</li>
	<li>Midterm: 10/19 (first half of that evening&#8217;s session).</li>
	<li>Final exam: 12/14 (usual class time).</li>
</ul>
</div>
<div class="slide">
<h1>Miscellaneous</h1>
<ul>
	<li>Academic Integrity Policy</li>
	<li>Students with Disabilities</li>
	<li>Attendance Policy</li>
	<li>Use of Blackboard</li>
	<li>Turning in Homework</li>
</ul>
</div>
<div class="slide">
<h1>Scaling Computation, Part I</h1>
<ul>
	<li>Two models of concurrency compared:</li>
	<li>Multithreaded Programming.</li>
	<li>The Actor Model of concurrency.</li>
</ul>
</div>
<div class="slide">
<h1>Multithreaded Programming</h1>
<ul>
	<li>Synchronized, shared access to <em>mutable</em> state.</li>
	<li><em>Lock-based Concurrency</em></li>
</ul>
</div>
<div class="slide">
<h1>Multithreaded Programming</h1>
<ul>
	<li><strong>Very</strong> hard to get write.</li>
	<li>Even experts stumble&#8230;</li>
</ul>
</div>
<div class="slide">
<h1>&#8220;Java Concurrency in Practice&#8221;</h1>
<p>Brian Goetz, et al.</p>
<p><img src="images/javaconcurrencyinpracticebook.jpg"><img></div>
<div class="slide">
<h1>Is This Safe?</h1>
<div class="code-normal">
<pre name="code" id="code" class="brush: scala;">@NotThreadSafe
public class UnsafeSequence {
  private int value;
  
  /** Returns a unique value. */
  public int getNext() {
    return value++;
  }
}</pre><p></div><div class="codeurl"><a href="txmt://open?url=file:///Users/deanwampler/projects/Loyola/COMP388-488/Presentations/PragmaticsOfIndustrialSWDevelopment/code/UnsafeSequence.java">code/UnsafeSequence.java</a></div></p>
<p>(credit: all Multithreading examples adapted from &#8220;Java Concurrency in Practice&#8221;)</p>
</div>
<div class="slide">
<h1>This Is Safe</h1>
<div class="code-normal">
<pre name="code" id="code" class="brush: scala;">@ThreadSafe
public class Sequence {
  @GuardedBy("this") private int value;
  
  /** Returns a unique value. */
  public synchronized int getNext() {
    return value++;
  }
}</pre><p></div><div class="codeurl"><a href="txmt://open?url=file:///Users/deanwampler/projects/Loyola/COMP388-488/Presentations/PragmaticsOfIndustrialSWDevelopment/code/SafeSequence.java">code/SafeSequence.java</a></div></p>
</div>
<div class="slide">
<h1>Things Can Go Wrong</h1>
<ul>
	<li><strong>Safety</strong> &#8211; Nothing Bad Should Happen</li>
	<li><strong>Liveness</strong> &#8211; Something Good Should Eventually Happen</li>
</ul>
</div>
<div class="slide">
<h1>Ways to Lose Liveness</h1>
<ul>
	<li><strong>Deadlock</strong></li>
</ul>
<p><em>You have a lock I want and I have a lock you want.</em></p>
</div>
<div class="slide">
<h1>Deadlock Example</h1>
<div class="code-normal">
<pre name="code" id="code" class="brush: scala;">@NotThreadSafe
public class LeftRightDeadlock {
  private final Object left  = new Object();
  private final Object right = new Object();
  
  public void leftRight() {
    synchronized (left) {
      synchronized (right) { doSomething(); }
  }
  public void rightLeft() {
    synchronized (right) {
      synchronized (left) { doSomethingElse(); }
  }
}</pre><p></div><div class="codeurl"><a href="txmt://open?url=file:///Users/deanwampler/projects/Loyola/COMP388-488/Presentations/PragmaticsOfIndustrialSWDevelopment/code/LeftRightDeadlock.java">code/LeftRightDeadlock.java</a></div></p>
</div>
<div class="slide">
<h1>Other Deadlock Hazards</h1>
<ul>
	<li>Don&#8217;t call an external resource from a synchronized method, as it might try to acquire a lock&#8230; Make only <em>open calls.</em></li>
	<li>Similarly, avoid resource acquisition during locks.</li>
	<li>Don&#8217;t lock on a mutable object from different locations. Localize the locking to one place, where it&#8217;s easier to manage the policy for that object.</li>
</ul>
</div>
<div class="slide">
<h1>Starvation</h1>
<p>One thread can never get the resources it needs because other threads, often with inverted priorities, get too much access.</p>
<ul>
	<li>Avoid setting thread priorities. Operating Systems are already very good at this.</li>
</ul>
</div>
<div class="slide">
<h1>Livelock</h1>
<p>A thread is not blocked, but it can&#8217;t complete work because of trying operations always fails.</p>
<ul>
	<li>A common example is repeated execution of a transaction that never succeeds.</li>
	<li>One scenario is two contenders with identical strategies for trying again, often colliding in the same way. If one is <em>greedy</em>, both may succeed.</li>
</ul>
</div>
<div class="slide">
<h1>The Importance of Immutability</h1>
<p>What about access to <em>immutable</em> state? All the synchronization issues go away. Immutable objects have these virtues:</p>
<ul>
	<li>No synchronized access is required.</li>
	<li>They are automatically thread safe.</li>
</ul>
</div>
<div class="slide">
<h1>The Actor Model of Concurrency</h1>
<p>Autonomous &#8220;actors&#8221; receive messages, performing <em>local</em> computations, and sending new messages.</p>
<ul>
	<li>Coordinates and localizes state transitions.</li>
	<li>A higher-level abstraction than lock-based concurrency.</li>
	<li>Successful practical implementations in Erlang, Scala, and other languages.</li>
	<li>Mathematical model of concurrency going back to 1973.</li>
</ul>
</div>
<div class="slide">
<h1>Actors in Scala (Akka)</h1>
<div class="code-normal">
<pre name="code" id="code" class="brush: scala;">package management
import se.scalablesolutions.akka.actor._

class Manager {
  private var managedActors: List[ActorRef] = Nil
  
  def receive = {
    case Register(actor: ActorRef) =&gt; 
      managedActors ::= actor
    case Unregister(actor: ActorRef) =&gt; 
      managedActors -= actor
    case Stop  =&gt; managedActors foreach (_ ! Stop)
    case Start =&gt; managedActors foreach (_ ! Start)
  }
}
</pre><p></div><div class="codeurl"><a href="txmt://open?url=file:///Users/deanwampler/projects/Loyola/COMP388-488/Presentations/PragmaticsOfIndustrialSWDevelopment/code/manager-actor.scala">code/manager-actor.scala</a></div></p>
</div>
<div class="slide">
<h1>Actors in Scala (Akka)</h1>
<ul>
	<li>This is an example using the Akka Framework (<a href="http://akkasource.org">akkasource.org</a>) (used in the project).</li>
	<li>Scala also comes with its own Actor library.</li>
</ul>
</div>
<div class="slide">
<h1>Actors in Scala (Akka)</h1>
<ul>
	<li>Our example was contrived; Akka has a rich <code>Supervisor</code> mechanism.</li>
	<li>Inspired by Erlang&#8217;s <span class="caps">OTP</span> (<em>Open Telecom Platform</em>).</li>
	<li>A supervisor manages the lifecycle of N actors.</li>
</ul>
</div>
<div class="slide">
<h1>Supervisors and Lifecycle Management</h1>
<p>The Supervisor can</p>
<ul>
	<li>restart a failed actor (<em>One for One</em>).</li>
	<li>restart a group of coordinated actors, if one fails (<em>All for One</em>).</li>
	<li>itself be supervised (hierarchy)</li>
</ul>
</div>
<div class="slide">
<h1>&#8220;Let It Crash&#8221;</h1>
<p>For many systems, which is better?</p>
<ul>
	<li>A few, large processes that attempt error recovery, or</li>
	<li>Many, small processes where if one has an error, it can just die and be restarted?</li>
</ul>
<p>Complex processes require complex error handling and recovery. The actor model makes <em>modules</em> simpler and more robust, so the system is more robust.</p>
</div>
<div class="slide">
<h1>Starting an Akka Actor</h1>
<div class="code-normal">
<pre name="code" id="code" class="brush: scala;">class Manager {
  private var managedActors: List[ActorRef] = Nil
  
  def receive = { ... }
  }
}

...
import se.scalablesolutions.akka.actor.Actor_
// Creating an actor (one way...) and starting
val manager = Actor.actorOf[Manager]
manager.start</pre><p></div><div class="codeurl"><a href="txmt://open?url=file:///Users/deanwampler/projects/Loyola/COMP388-488/Presentations/PragmaticsOfIndustrialSWDevelopment/code/manager-actor2.scala">code/manager-actor2.scala</a></div></p>
</div>
<div class="slide">
<h1>Actor vs. ActorRef</h1>
<p>The <code>ActorRef</code> returned by <code>actorOf</code> is a <em>handle</em> that separates clients from the actual Actor <em>body</em>.</p>
<p>This allows the supervisor to restart the <em>body</em> without disrupting client connections!</p>
</div>
<div class="slide">
<h1>Sending a Message to an Akka Actor</h1>
<p>First, define a <em>sealed</em> collection of messages.</p>
<div class="code-normal">
<pre name="code" id="code" class="brush: scala;">package management
import se.scalablesolutions.akka.actor._

sealed trait ManagementMessage

case class  Register(actor: ActorRef)
case class  Unregister(actor: ActorRef)
case object Stop
case object Start
</pre><p></div><div class="codeurl"><a href="txmt://open?url=file:///Users/deanwampler/projects/Loyola/COMP388-488/Presentations/PragmaticsOfIndustrialSWDevelopment/code/actor-messages.scala">code/actor-messages.scala</a></div></p>
</div>
<div class="slide">
<h1>An Asynchronous (Fire and Forget) Message</h1>
<div class="code-normal">
<pre name="code" id="code" class="brush: scala;">class Manager {
  ...  
  def receive = {
    ...
    case Stop  =&gt; managedActors foreach (_ ! Stop)
    case Start =&gt; managedActors foreach (_ ! Start)
  }
}
</pre><p></div><div class="codeurl"><a href="txmt://open?url=file:///Users/deanwampler/projects/Loyola/COMP388-488/Presentations/PragmaticsOfIndustrialSWDevelopment/code/actor-asynch-message.scala">code/actor-asynch-message.scala</a></div></p>
<p>If a response is required, the receiver can send a message to the sender.</p>
</div>
<div class="slide">
<h1>An Synchronous (Wait) Message</h1>
<div class="code-normal">
<pre name="code" id="code" class="brush: scala;">class Manager {
  ...  
  def receive = {
    ...
    case Stop  =&gt; managedActors foreach (_ ! Stop)
    case Start =&gt; managedActors foreach (_ ! Start)
    case Ping  =&gt; managedActors map { _ =&gt;
      (_ !! Ping).getOrElse(error(...))
    }
  }
}
</pre><p></div><div class="codeurl"><a href="txmt://open?url=file:///Users/deanwampler/projects/Loyola/COMP388-488/Presentations/PragmaticsOfIndustrialSWDevelopment/code/actor-synch-message.scala">code/actor-synch-message.scala</a></div></p>
</div>
<div class="slide">
<h1>An Synchronous (Wait) Message (cont.)</h1>
<p>Has the disadvantage of blocking!</p>
</div>
<div class="slide">
<h1>An Asynchronous with a Future Message</h1>
<div class="code-normal">
<pre name="code" id="code" class="brush: scala;">def receive = {
  ...
  case Stop  =&gt; managedActors foreach (_ ! Stop)
  case Start =&gt; managedActors foreach (_ ! Start)
  case Ping =&gt; 
    val futures = managedActors map {actor =&gt;
      actor !!! Ping
    }
    Futures.awaitAll(futures)
    futures map { _.result match 
      case Some(x) =&gt; x
      case None =&gt; "Error!"
    }
}
</pre><p></div><div class="codeurl"><a href="txmt://open?url=file:///Users/deanwampler/projects/Loyola/COMP388-488/Presentations/PragmaticsOfIndustrialSWDevelopment/code/actor-future-message.scala">code/actor-future-message.scala</a></div></p>
</div>
<div class="slide">
<h1>An Asynchronous with a Future Message (cont.)</h1>
<p>Actor can keep doing work (like firing off simultaneous pings).</p>
<p>Eventually, it waits for the <code>Futures</code> to complete and then proceeds. (It could also do work as each one finishes.)</p>
</div>
<div class="slide">
<h1>Another Way to Write the Last Example</h1>
<div class="code-normal">
<pre name="code" id="code" class="brush: scala;">def receive = {
  ...
  case Stop  =&gt; managedActors foreach (_ ! Stop)
  case Start =&gt; managedActors foreach (_ ! Start)
  case Ping =&gt; 
    val futures = for {     // alternative syntax
      actor &lt;- managedActors
    } yield(actor !!! Ping)
    Futures.awaitAll(futures)
    futures map { _.result match 
      case Some(x) =&gt; x
      case None =&gt; "Error!"
    }
}
</pre><p></div><div class="codeurl"><a href="txmt://open?url=file:///Users/deanwampler/projects/Loyola/COMP388-488/Presentations/PragmaticsOfIndustrialSWDevelopment/code/actor-future-message2.scala">code/actor-future-message2.scala</a></div></p>
</div>
<div class="slide">
<h1>Achieving Immutability</h1>
<ul>
	<li><em>Functional languages</em> emphasize immutability.</li>
	<li>Scala encourages immutability, but also allows mutability, when needed.</li>
	<li>Declare variables as constants when possible (<code>val</code> in Scala, <code>const</code> in C/C++/C#, <code>final</code> in Java, etc.)</li>
</ul>
</div>
<div class="slide">
<h1>Introduction to the semester project</h1>
<ul>
	<li>Installing, building, and running the project skeleton.</li>
	<li>Walkthrough of major components and features.</li>
</ul>
</div>
<div class="slide">
<h1>This Week&#8217;s Assignment: Reading</h1>
<ul>
	<li>Brian Goetz, et al., Chapters 1 and 10 in &#8220;Java Concurrency in Practice&#8221; (see references &#8211; available through <a href="http://proquestcombo.safaribooksonline.com.flagship.luc.edu/">Loyola&#8217;s access to Safari Online Books</a>).</li>
	<li><em>Actor Model</em> on Wikipedia <a href="http://en.wikipedia.org/wiki/Actor_model">wikipedia.org/wiki/Actor_model</a></li>
	<li>Browse the Scala resources listed in the <a href="references.html">References</a> to learn more about Scala.</li>
	<li>Browse the Akka framework documentation at <a href="http://docs.akkasource.org">docs.akkasource.org</a>, to learn more about Akka, which is the foundation for the project code.</li>
</ul>
</div>
<div class="slide">
<h1>This Week&#8217;s Assignment: Reading (cont.)</h1>
<p>For Next Week&#8217;s Lecture:</p>
<ul>
	<li>Simon Peyton Jones, &#8220;Beautiful Concurrency&#8221;, Chapter 24 in <em>Beautiful Code</em>, pgs. 385-406. Online:  <a href="http://research.microsoft.com/en-us/um/people/simonpj/papers/stm/#beautiful">http://research.microsoft.com/en-us/um/people/simonpj/papers/stm/#beautiful</a></li>
	<li><em>Software Transactional Memory</em> (<span class="caps">STM</span>) on Wikipedia <a href="http://en.wikipedia.org/wiki/Software_transactional_memory">wikipedia.org/wiki/Software_transactional_memory</a>.</li>
</ul>
</div>
<div class="slide">
<h1>This Week&#8217;s Assignment: Project</h1>
<p>The main goal is to get the project code from GitHub, get it running, and begin to understand how it works. It&#8217;s not a trivial project to understand, especially if you&#8217;re new to Scala, but don&#8217;t be intimidated.</p>
<p>Although you won&#8217;t be asked to turn anything in next week, you should still go through the steps as far as you can, even if you don&#8217;t finish, as they will set the stage for subsequent work.</p>
</div>
<div class="slide">
<h1>Get the Project Code</h1>
<ul>
	<li>Create a personal <a href="http://github.com">GitHub</a> account, if you don&#8217;t already have one.</li>
	<li>&#8220;Fork&#8221; the project code at <a href="http://github.com/deanwampler/AkkaWebSampleExercise">github.com/deanwampler/AkkaWebSampleExercise</a></li>
	<li>Follow the instructions provided by GitHub to &#8220;clone&#8221; the code locally on your computer. For example, at your local terminal prompt, you might be asked to run the following command (in a suitable directory of your choosing):</li>
</ul>
<p><code>git clone git@github.com:myAwesomeUserName/AkkaWebSampleExercise.git</code></p>
</div>
<div class="slide">
<h1>Get the Project Code (cont.)</h1>
<ul>
	<li>We will actually do our work on &#8220;branch&#8221; called <code>COMP-388-488</code>, not the <code>master</code> branch:</li>
</ul>
<p><code>git checkout COMP-388-488</code></p>
<ul>
	<li>Type the following command to confirm you are on the correct branch:</li>
</ul>
<p><code>git branch</code></p>
<ul>
	<li>It should show the following:</li>
</ul>
<pre>
* COMP-388-488
  master
</pre>
<ul>
	<li>The <code>*</code> shows the current branch.</li>
</ul>
</div>
<div class="slide">
<h1>(Update) These steps were added after Lecture 2</h1>
<ul>
	<li>Add the following 3 lines to the end of the project&#8217;s <code>.git/config</code> file.</li>
</ul>
<div class="code-tiny">
<pre name="code" id="code" class="brush: scala,;">

[branch "COMP-388-488"]
        remote = origin
        merge = refs/heads/COMP-388-488
</pre></div>
<ul>
	<li>Run this command</li>
</ul>
<p><code>git checkout origin COMP-388-488</code></p>
</div>
<div class="slide">
<h1>(Get the Lecture Notes!)</h1>
<p>I&#8217;m also keeping the lecture notes on GitHub. Unless you want to contribute patches ;) there&#8217;s no need to fork this project.</p>
<ul>
	<li>Clone <a href="http://github.com/deanwampler/Presentations">github.com/deanwampler/Presentations</a></li>
</ul>
<p><code>git clone http://github.com/deanwampler/Presentations</code></p>
<p>You&#8217;ll see two directories:</p>
<ul>
	<li><code>akka-intro</code>: an introduction to the Akka Framework, which you might find useful since we&#8217;re using Akka for the project.</li>
	<li><code>PragmaticsOfIndustrialSWDevelopment</code>: The class notes.</li>
</ul>
</div>
<div class="slide">
<h1>(Get the Lecture Notes! &#8211; cont)</h1>
<ul>
	<li>I will update the notes in the <code>PragmaticsOfIndustrialSWDevelopment</code> directory before each class, and also upload the latest version to blackboard.</li>
	<li>See the <code>README</code> for instructions on building the presentation, or just</li>
	<li>Open <code>html/all.html</code> in your browser.</li>
</ul>
</div>
<div class="slide">
<h1>Build the Project</h1>
<ul>
	<li>Open the <code>README.md</code> file.</li>
	<li>Follow its instructions for installing MongoDB and running the project tests.</li>
	<li>Browse the code base and try to recall our discussion of it in class.</li>
</ul>
</div>
<div class="slide">
<h1>Add New Functionality</h1>
<p><strong>The instructions after this point are repeated with modifications as the homework exercise for Lecture 2, since we deferred the assignment until then. So, please go to the Lecture 2 notes, &#8220;This Week&#8217;s Assignment: Project&#8221; and proceed from there.</strong></p>
</div>
<div class="slide">
<h1>Add New Functionality</h1>
<ul>
	<li>In an editor, open the file <code>test/scala/server/finance/InstrumentAnalysisServerTest.scala</code>.</li>
	<li>Find the two <code>TODO</code> comments, one each before a <code>test</code>.</li>
	<li>In the <em>first</em> of those tests, comment out the line <code>pending</code> (like Java, you can put a <code>//</code> before the word <code>pending</code>).</li>
</ul>
</div>
<div class="slide">
<h1>Add New Functionality (cont.)</h1>
<ul>
	<li>Run the <code>test</code> action in sbt. The two tests should now fail. You should see the following near the end of the output.</li>
</ul>
<p><code>[error] Failed: : Total 96, Failed 1, Errors 0, Passed 91, Skipped 4</code></p>
<p>Try to understand the error messages:</p>
<ul>
	<li>Look for the stack trace.</li>
	<li>Ignore the verbose server messages (hint: most of those contain the words <code>akka</code> and <code>thread</code>), but notice the <code>org.scalatest.TestFailedException</code> messages.</li>
</ul>
</div>
<div class="slide">
<h1>Add New Functionality (cont.)</h1>
<p>Looking at the stack trace:</p>
<ul>
	<li>On what line <em>in the test file</em> did the failure occur? (That is, not a line in the <em>ScalaTest</em> <span class="caps">API</span>.)</li>
	<li>What did the server return and what was the expected value in those two cases? (hint: it&#8217;s a <span class="caps">JSON</span> string&#8230;)</li>
</ul>
</div>
<div class="slide">
<h1>Add New Functionality (cont.)</h1>
<ul>
	<li>In your editor, open the file <code>main/scala/server/finance/InstrumentAnalysisServer.scala</code> (the file being tested&#8230;)</li>
	<li>Find the <code>TODO</code> before the method named <code>fetchPrices</code>.</li>
	<li>This method already has the &#8220;instruments&#8221; (i.e., stocks) and statistics information.</li>
	<li>The line <code>Some(x) =&gt; filter(instruments, statistics, x)</code> takes the result from the <code>DataStorageServer</code> and passes it to a final <code>filter</code> method. Note that <code>filter</code> simply returns the <span class="caps">JSON</span> string that was passed in to it.</li>
</ul>
</div>
<div class="slide">
<h1>Add New Functionality (cont &#8211; sort of&#8230;)</h1>
<p>How could we modify <code>filter</code> to filter by instruments? (To make it easier, assume there is only one instrument in the list, as in the test.)</p>
<p>This is not easy, as we really need to parse the <span class="caps">JSON</span> into some representation, filter out the records (which are of the form <code>{"timestamp": 1283233404995, "symbol": "A", "price", "40.0"}</code>) using the <code>symbol</code>, then convert back to a string.</p>
<p>Can you figure out how to do this with the Lift <span class="caps">JSON</span> APIs used in the application and <span class="caps">JSON</span> helper types provided, or using other 3rd-party <span class="caps">JSON</span> libraries?</p>
<p>Actually, the right way to implement this feature is to support this filtering at the database level, which we will learn how to do with MongoDB.</p>
</div>
<div class="title slide">
<h1>Lecture 2: Scaling Computation, Part II, and Course Project Rebooted</h1>
</div>
<div class="slide">
<h1>Software Transactional Memory (<span class="caps">STM</span>)</h1>
<ul>
	<li>A concurrency model for safely mutating values.</li>
	<li>Safer alternative to lock-based concurrency.</li>
	<li>Can complement Actor concurrency.</li>
	<li>Brings database-like transactions to memory.</li>
</ul>
</div>
<div class="slide">
<h1>History: A Few Milestones</h1>
<table>
	<tr>
		<td> 1986 </td>
		<td> Tom Knight proposes hardware-based transactional memory. </td>
	</tr>
	<tr>
		<td> 1995 </td>
		<td> Nir Shavit and Dan Touitou first propose <span class="caps">STM</span>. </td>
	</tr>
	<tr>
		<td> mid-2000&#8217;s </td>
		<td> Added to Haskell. </td>
	</tr>
	<tr>
		<td> 2008 </td>
		<td> In the first release of Clojure. </td>
	</tr>
</table>
</div>
<div class="slide">
<h1>Some Notable Implementations</h1>
<table>
	<tr>
		<td> <strong>Language</strong> </td>
		<td> <strong>Name</strong> </td>
		<td> <strong>Notes</strong> </td>
	</tr>
	<tr>
		<td> Haskell </td>
		<td> <em>N.A.</em> </td>
		<td> Built into the language. Pioneering implementation copied by others. </td>
	</tr>
	<tr>
		<td> Clojure </td>
		<td> <em>N.A.</em> </td>
		<td> Built into the language. Really driving interest in <span class="caps">STM</span> and Clojure! </td>
	</tr>
	<tr>
		<td> Java and Scala</td>
		<td> Multiverse </td>
		<td> Used by Akka. </td>
	</tr>
</table>
<p>Many others listed on the <a href="http://en.wikipedia.org/wiki/Software_transactional_memory"><span class="caps">STM</span> Wikipedia page</a>.</p>
</div>
<div class="slide">
<h1><span class="caps">ACID</span></h1>
<p>Properties of <em>database</em> transactions:</p>
<ul>
	<li><strong>A</strong>: Atomicity</li>
	<li><strong>C</strong>: Consistency</li>
	<li><strong>I</strong>: Isolation</li>
	<li><strong>D</strong>: Durability</li>
</ul>
</div>
<div class="slide">
<h1>Atomicity</h1>
<p>A transaction behaves as if it happens in one, uninterruptible, &#8220;all or nothing&#8221; step.</p>
<ul>
	<li>If any <em>internal</em> step fails, the whole transaction is rolled back to the beginning state.</li>
	<li>Prevents inconsistent state changes from persisting.</li>
	<li>Transactions can fail for many reasons: bugs, resource exhaustion, process or hardware failure, etc.</li>
</ul>
</div>
<div class="slide">
<h1>Atomicity: Example</h1>
<p><strong>Scenario:</strong> A transaction T will transfer $100 from account #1, with starting balance $1100, to account #2, with starting balance $900. If successful, both accounts must have $1000.</p>
<ul>
	<li>T deducts $100 from account #1.</li>
	<li>T fails to add $100 to account #2, because it is already in another transaction.</li>
	<li>Rollback: T restores the balance of account #1 to $1100.</li>
</ul>
<p>If the transaction didn&#8217;t roll back, Account #1 would have $1000 and Account #2 would have $900.</p>
</div>
<div class="slide">
<h1>Consistency</h1>
<p>The state is always <em>consistent</em> and any transaction takes the database from one consistent state to another (as understood by the database).</p>
<p>Example consistency rules:</p>
<ul>
	<li>Types must be respected (e.g., no strings are allowed in an integer location).</li>
	<li>References to other entities must be valid. (<em>referential integrity</em>)</li>
</ul>
<p>Doesn&#8217;t cover things the database doesn&#8217;t know about, like business rules enshrined in Java&#8230;</p>
</div>
<div class="slide">
<h1>Consistency: Example</h1>
<p><strong>Scenario:</strong> A bank customer has two savings accounts, but decides to close one of them.</p>
<p>Suppose the customer records are in one database table and the account records are in a separate table. It&#8217;s common to use a third <em>join table</em> to map the relationships between M customers and N accounts.</p>
<p>So, in this scenario, the join table must be updated to remove mappings between the customer and the closed account.</p>
</div>
<div class="slide">
<h1>Side Note: Is Data Ever Deleted?</h1>
<p>In many real-world scenarios, you cannot delete data, just make it &#8220;obsolete&#8221;. The problem is that sometimes you need to undo past actions (e.g., the customer changes her mind and wants to reopen that savings account) and sometimes you need historical data for regulatory and other reasons.</p>
<p><strong>Scenario:</strong> The customer who closed one of her savings accounts wants to print out all the statements for the year, for tax purposes.</p>
<p>If you deleted the closed account, such records would be lost.</p>
</div>
<div class="slide">
<h1>Isolation</h1>
<p>Modified data in transaction A that hasn&#8217;t been committed is invisible to other transactions.</p>
<p>Necessary to preserve data integrity and consistency.</p>
</div>
<div class="slide">
<h1>Isolation: Example</h1>
<p><strong>Scenario:</strong> Two transactions want to add money to an account.</p>
<ul>
	<li>Transaction A is adding money to an account; it increases the balance, but it has not committed the change yet.</li>
	<li>Transaction B reads the balance inside transaction A and adds more money to the <em>value of transaction A&#8217;s</em> balance.</li>
	<li>A fails and roles back the balance. (So, A leaves the data in a consistent state.)</li>
	<li>B succeeds, committing its balance value, which is too high. (So, B leaves the data in an inconsistent state.)</li>
</ul>
</div>
<div class="slide">
<h1>Isolation (continued)</h1>
<p><strong>Exception:</strong> <em>Dirty Reads</em> are sometimes allowed by databases.</p>
<p>Transactions can read &#8220;in flight&#8221; data, but not modify it. Allowed in order to improve performance of concurrent transactions and to minimize potential deadlocks.</p>
</div>
<div class="slide">
<h1>Durability</h1>
<p>Committed transactions will survive system failure.</p>
<p>Often implemented with a transaction log that can be &#8220;replayed&#8221; if recovery is required.</p>
</div>
<div class="slide">
<h1>Durability: Example</h1>
<p><strong>Scenario:</strong> Money is deposited to an account, then the hard disk holding that database record crashes.</p>
<ul>
	<li>Replace the hard drive.</li>
	<li>Replay the transaction log for all transactions with data on that drive&#8230;</li>
</ul>
<p>(I&#8217;ve assumed we weren&#8217;t using <span class="caps">RAID</span> and other redundancy measures.)</p>
<p><strong>Note:</strong> The transaction is considered completed when the log entry is written!</p>
</div>
<div class="slide">
<h1>Implementing <span class="caps">ACID</span></h1>
<ul>
	<li>Locking</li>
	<li>Multiversion Concurrency Control (<span class="caps">MCC</span> or <span class="caps">MVCC</span>)</li>
</ul>
</div>
<div class="slide">
<h1>Locking</h1>
<ul>
	<li>Used when data modified <em>in place</em> (e.g., an existing row is updated).</li>
	<li>Locking of whole table or per row (typically)</li>
	<li>Must lock for reads and writes, to ensure consistency.</li>
</ul>
</div>
<div class="slide">
<h1>Multiversion Concurrency Control</h1>
<ul>
	<li>Rather than modifying existing data, make new copies.</li>
	<li>The old data is obsolete, but&#8230;</li>
	<li>&#8230; readers may wish to access the old data to get a snapshot of state at a point in time.</li>
</ul>
<ul>
	<li>So, read locks aren&#8217;t required, because all records are write-once/read-only.</li>
</ul>
</div>
<div class="slide">
<h1>Multiversion Concurrency Control (cont.)</h1>
<ul>
	<li>Note that the values are called <strong>persistent</strong>, because they don&#8217;t go away on their own (or change).</li>
	<li>Need to periodically remove old records, to save space!</li>
	<li>Copying data can be inefficient; we&#8217;ll return to this issue&#8230;</li>
</ul>
</div>
<div class="slide">
<h1>Multiversion Concurrency Control (cont.)</h1>
<p><strong>Optimistic Locking:</strong></p>
<ul>
	<li>Don&#8217;t lock to prevent others from starting transactions on the same data.</li>
	<li>When it&#8217;s time to commit, if another transaction has committed changes already (so you&#8217;re original copy is now <em>stale</em>), then fail the transaction (and usually start again).</li>
</ul>
<ul>
	<li>Each transaction has its own copy of the data.</li>
</ul>
</div>
<div class="slide">
<h1><span class="caps">MVCC</span> Failure Example</h1>
<ul>
	<li>Transaction 1 reads data values from record R.</li>
	<li>Transaction 1 begins modifications to those values.</li>
	<li>Transaction 2 reads data values from record R.</li>
	<li>Transaction 2 begins modifications to those values.</li>
	<li>Transaction 2 commits changes.</li>
	<li>Transaction 1 attempts to commit changes. Data is stale, so transaction rolls back.</li>
	<li>Repeat Transaction 1.</li>
</ul>
</div>
<div class="slide">
<h1>Costs vs. Benefits of <span class="caps">MVCC</span></h1>
<p>- Transaction failure and retry are costly, but in most systems, they&#8217;re infrequent.<br />
- Copies are costly to make; must be cleaned periodically.</p>
<p>+ No read locks.<br />
+ Optimistic locking for writes.<br />
+ Good concurrency, hence good scalability.<br />
+ Consistent state snapshots over time.</p>
</div>
<div class="slide">
<h1>Software Transactional Memory</h1>
<p>Brings the <span class="caps">ACI</span> (no D) to Memory.</p>
<ul>
	<li>No durability, by default</li>
	<li>&#8230; but some frameworks, like Akka, let you plug in durability using a database as a backing-store.</li>
	<li>Most implementations use <span class="caps">MVCC</span>.</li>
</ul>
</div>
<div class="slide">
<h1>Symantics (Using Akka Syntax)</h1>
<ul>
	<li>Separates <em>references</em> from <em>values</em>.</li>
	<li>The <em>values</em> should be immutable.</li>
	<li><strong>atomic:</strong> Marks a block controlled by <span class="caps">STM</span> where <em>refs</em> can be associated with new <em>values</em>.</li>
</ul>
<div class="code-normal">
<pre name="code" id="code" class="brush: scala;">import se.scalablesolutions.akka.stm.local._

val ref = Ref(0)        // initialize with 0
def counter = atomic {  // demarcate "atomic" block
  ref alter (_ + 1)     // change value using a function
}
 
counter  // -&gt; 1
counter  // -&gt; 2
ref.get  // -&gt; 2 (retrieve the value explicitly)</pre><p></div><div class="codeurl"><a href="txmt://open?url=file:///Users/deanwampler/projects/Loyola/COMP388-488/Presentations/PragmaticsOfIndustrialSWDevelopment/code/akka-stm-example1.scala">code/akka-stm-example1.scala</a></div></p>
</div>
<div class="slide">
<h1>Symantics (cont.)</h1>
<ul>
	<li>More syntax for working with references.</li>
</ul>
<div class="code-normal">
<pre name="code" id="code" class="brush: scala;">import se.scalablesolutions.akka.stm.local._

val ten = 10
val ref = Ref(1) // initialize with 1 
atomic {  
  ref set 10     // set new value
}                // (actually returns old value)
ref.get          // -&gt; 10</pre><p></div><div class="codeurl"><a href="txmt://open?url=file:///Users/deanwampler/projects/Loyola/COMP388-488/Presentations/PragmaticsOfIndustrialSWDevelopment/code/akka-stm-example2.scala">code/akka-stm-example2.scala</a></div></p>
</div>
<div class="slide">
<h1>Symantics: Blocking (&#8220;Retry&#8221;)</h1>
<ul>
	<li><strong>Retry</strong>: Block on a condition and try again when the condition is met.</li>
</ul>
<div class="code-normal">
<pre name="code" id="code" class="brush: scala;">// Inside a Transactor for bank transfers:
def receive = {
  case Transfer(from, to, amount) =&gt;
    atomic {
      if (from.get &lt; amount) {
        log.info("not enough money - retrying")
        retry  // &lt;= try again "later"
      }
      log.info("transferring")
      from alter (_ - amount)
      to alter (_ + amount)
    }
}
</pre><p></div><div class="codeurl"><a href="txmt://open?url=file:///Users/deanwampler/projects/Loyola/COMP388-488/Presentations/PragmaticsOfIndustrialSWDevelopment/code/akka-stm-example3.scala">code/akka-stm-example3.scala</a></div></p>
<p>(See <strong>Blocking Transactions</strong> on the <a href="http://doc.akkasource.org/stm-scala">Akka <span class="caps">STM</span> page</a> for the full example.)</p>
</div>
<div class="slide">
<h1>Symantics: Choice (&#8220;orElse&#8221;)</h1>
<ul>
	<li><strong>Choice:</strong> When we can block on two paths, proceed when one of them becomes unblocked.</li>
</ul>
<div class="code-small">
<pre name="code" id="code" class="brush: scala;">def receive = {
  case EitherOr(left, right, action) =&gt;
    atomic {
      either {
        if (left.ok == false)
          retry
        else
          action(left)
      } orElse {
        if (right.ok == false)
          retry
        else
          action(right)        
      }
    }
}
</pre><p></div><div class="codeurl"><a href="txmt://open?url=file:///Users/deanwampler/projects/Loyola/COMP388-488/Presentations/PragmaticsOfIndustrialSWDevelopment/code/akka-stm-example4.scala">code/akka-stm-example4.scala</a></div></p>
</div>
<div class="slide">
<h1>Composability and Modularity</h1>
<p>Recall in &#8220;Beautiful Concurrency&#8221;, Simon Peyton Jones described how <span class="caps">STM</span> transactions are <strong>modular</strong> in the sense that they are black boxes that can be <strong>composed</strong> to form larger transactions. <strong>Blocking</strong> and <strong>choice</strong> make this possible.</p>
</div>
<div class="slide">
<h1>Misc. Akka Syntax</h1>
<ul>
	<li>There are more features in the <span class="caps">API</span>, including configuration of implementation behavior.</li>
	<li><code>Transactors</code> are <code>Actors</code> with <span class="caps">STM</span> behavior.</li>
</ul>
</div>
<div class="slide">
<h1>Performance?</h1>
<ul>
	<li>Managing references to &#8220;snapshots&#8221; adds overhead (vs. unprotected reads and writes).</li>
	<li>Copies can be expensive&#8230;</li>
</ul>
</div>
<div class="slide">
<h1>Minimizing Copy Overhead &#8211; Trees</h1>
<p><strong>Hint:</strong> If you have a list of 200 items and you create a new version by inserting one item in the middle, the old and new versions can <em>share</em> the sublists on either side of the changed element! You can do this in a straightforward way with tree structures.</p>
<p>Here&#8217;s an example of how Clojure&#8217;s <code>PersistentVector</code> is implemented. Most STMs use similar approaches.</p>
</div>
<div class="slide">
<h1>A Value Before an Insert</h1>
<p><img src="images/persistentvector1.png"><img><br />
<br />
(credit: <a href="http://blog.higher-order.net/2009/02/01/understanding-clojures-persistentvector-implementation/">Understanding Clojures PersistentVector Implementation</a>)</div>
<div class="slide">
<h1>A Value After an Insert</h1>
<p><img src="images/persistentvector2.png"><img><br />
<br />
(credit: <a href="http://blog.higher-order.net/2009/02/01/understanding-clojures-persistentvector-implementation/">Understanding Clojures PersistentVector Implementation</a>)</div>
<div class="slide">
<h1><span class="caps">STM</span> Recap</h1>
<p>+ A very powerful mechanism for <em>principled</em> mutation of state.<br />
+ Cleanly separates <em>values</em> from <em>references</em> to them.<br />
+ Composable, modular transactional semantics.<br />
- Imposes some unavoidable overhead.</p>
</div>
<div class="slide">
<h1>&#8220;Memory is the New Disk&#8221;</h1>
<p><strong>1980&#8217;s &#8211; <em>Page Faulting</em>:</strong></p>
<p>When total program memory exceeded physical memory, blocks (&#8220;pages&#8221;) of memory would be swapped to disk and back again, using a least-recently used algorithm. But you wanted to avoid it because of the performance penalty. It was several orders of magnitude slower than memory access.</p>
</div>
<div class="slide">
<h1>&#8220;Memory is the New Disk&#8221; (cont.)</h1>
<p><strong>2000&#8217;s &#8211; <em>Cache Misses</em>:</strong></p>
<p>Memory, like CPUs, has also grown according to Moore&#8217;s Law, <em>but more slowly</em>. Also, bus speeds aren&#8217;t as fast as <span class="caps">CPU</span> clock speeds. So today, <strong>memory access</strong> is several orders of magnitude slower than on-chip <strong>cache</strong> access.</p>
<p>So, for optimal performance, we should <em>really</em> program to minimize cache misses.</p>
</div>
<div class="slide">
<h1>Akka Code Project Setup</h1>
<p>For the 2nd half of tonight&#8217;s class, follow the instructions in the notes for Lecture 1 to setup the project. We&#8217;ll actually work through them together in this lecture. Then I&#8217;ll describe the exercise I want you to do for next week (see notes below).</p>
</div>
<div class="slide">
<h1>This Week&#8217;s Assignment: Reading</h1>
<p>More on the underpinnings of <span class="caps">STM</span>,</p>
<ul>
	<li><a href="http://en.wikipedia.org/wiki/ACID"><span class="caps">ACID</span></a> (Wikipedia).</li>
	<li><a href="http://en.wikipedia.org/wiki/Multiversion_concurrency_control">Multiversion Concurrency Control</a> (Wikipedia). Unfortunately, the text can be a little confusing.</li>
</ul>
<p>For a more detailed look at <span class="caps">STM</span>, see this <a href="http://java.ociweb.com/mark/stm/article.html">detailed paper</a> published by <span class="caps">OCI</span>. For information on Clojure&#8217;s persistent data structures, see for example <a href="http://blog.higher-order.net/2009/02/01/understanding-clojures-persistentvector-implementation/">Understanding Clojures PersistentVector Implementation</a></p>
</div>
<div class="slide">
<h1>This Week&#8217;s Assignment: Reading (cont.)</h1>
<p>If you need more information on Scala and Akka, see the following,</p>
<ul>
	<li>My <a href="http://polyglotprogramming.com/papers/SeductionsOfScala.pdf">Seductions of Scala</a> presentation. It should fill in a few Scala gaps. <strong><span class="caps">NOTE</span>:</strong> I am presenting this talk at the September 16th <a href="http://meetup.com/chicagoscala">Chicago Scala User&#8217;s Group</a> (<span class="caps">RSVP</span> required).</li>
	<li><a href="http://www.naildrivin5.com/scalatour/wiki_pages/MainPage">Another Tour of Scala</a>.</li>
	<li>This presentation on Akka: <a href="http://www.slideshare.net/jboner/akka-scala-summit-oscon-2010">slideshare.net/jboner/akka-scala-summit-oscon-2010</a>, which is also shown on the home page for the Akka Documentation: <a href="http://doc.akkasource.org">doc.akkasource.org</a>. See in particular the discussion of how actors, agents, and <span class="caps">STM</span> work in Akka.</li>
</ul>
<p>For more on Scala and Akka, see the Scala and Akka sections in the <a href="references.html">References</a>.</p>
</div>
<div class="slide">
<h1>This Week&#8217;s Assignment: Reading (cont.)</h1>
<ul>
	<li><a href="http://en.wikipedia.org/wiki/Distributed_computing">Distributed Computing</a>. Focus on the Introduction, History, Applications, and Architectures sections.</li>
</ul>
</div>
<div class="slide">
<h1>This Week&#8217;s Assignment: Project</h1>
<p>Complete the setup instructions in Lecture 1 that we went through this evening.</p>
<ul>
	<li>The <code>sbt update</code> command should be successful with no errors.</li>
	<li>MongoDB should be installed and you should know how to start and stop it.</li>
	<li>The <code>sbt test</code> command should work with no test failures.</li>
</ul>
</div>
<div class="slide">
<h1>This Week&#8217;s Assignment: Project</h1>
<p>Work the suggested exercise from last week, but with the refinements I will describe now. I have repeated that section from the notes, with the changes I want you to do, in very specific detail (since I know most of you are new to Scala, as well as new to this code). Reminder: You are welcome to work on this assignment with your class mates.</p>
<p>However, this week, I would like you to commit your changes to your cloned git repository on GitHub. I&#8217;ll tell you how at the end of the instructions.</p>
</div>
<div class="slide">
<h1>Add New Functionality</h1>
<p>(Adapted from the Lecture 1 notes.)</p>
<ul>
	<li>In an editor, open the file <code>test/scala/server/finance/InstrumentAnalysisServerTest.scala</code>.</li>
	<li>Find the two <code>TODO</code> comments, one each before a <code>test</code>.</li>
	<li>In the <em>first</em> of those tests, comment out the line <code>pending</code> (like Java, you can put a <code>//</code> before the word <code>pending</code>).</li>
</ul>
</div>
<div class="slide">
<h1>Add New Functionality (cont.)</h1>
<ul>
	<li>Run the <code>test</code> action in sbt. The two tests should now fail. You should see the following near the end of the output.</li>
</ul>
<p><code>[error] Failed: : Total 110, Failed 1, Errors 0, Passed 104, Skipped 5</code></p>
<p>Try to understand the error messages:</p>
<ul>
	<li>Look for the stack trace.</li>
	<li>Ignore the verbose server messages (hint: most of those contain the words <code>akka</code> and <code>thread</code>), but notice the <code>org.scalatest.TestFailedException</code> messages.</li>
</ul>
</div>
<div class="slide">
<h1>Add New Functionality (cont.)</h1>
<p>When you find the stack trace, <em>above</em> it is this output:</p>
<div class="code-tiny">
<pre name="code" id="code" class="brush: scala;">[error] Test Failed: calculateStatistics returns a JSON string containing all data that matches the instrument criteria
org.scalatest.TestFailedException: JObject(List(JField(criteria,JObject(List(JField(instruments,JArray(List(JString(A)))), JField(statistics,JArray(List(JString(price[$])))), JField(start,JInt(0)), JField(end,JInt(1283824964864))))), JField(results,JArray(List(JObject(List(JField(timestamp,JInt(1283824954864)), JField(symbol,JString(A)), JField(price,JDouble(0.0)))), JObject(List(JField(timestamp,JInt(1283824955864)), JField(symbol,JString(C)), JField(price,JDouble(10.0)))), JObject(List(JField(timestamp,JInt(1283824956864)), JField(symbol,JString(A)), JField(price,JDouble(20.0)))), JObject(List(JField(timestamp,JInt(1283824957864)), JField(symbol,JString(B)), JField(price,JDouble(30.0)))), JObject(List(JField(timestamp,JInt(1283824958864)), JField(symbol,JString(A)), JField(price,JDouble(40.0))))))))) did not equal JObject(List(JField(criteria,JObject(List(JField(instruments,JArray(List(JString(A)))), JField(statistics,JArray(List(JString(price[$])))), JField(start,JInt(0)), JField(end,JInt(1283824964864))))), JField(results,JArray(List(JObject(List(JField(timestamp,JInt(1283824954864)), JField(symbol,JString(A)), JField(price,JDouble(0.0)))), JObject(List(JField(timestamp,JInt(1283824958864)), JField(symbol,JString(A)), JField(price,JDouble(40.0)))), JObject(List(JField(timestamp,JInt(1283824956864)), JField(symbol,JString(A)), JField(price,JDouble(20.0)))))))))
</pre><p></div><div class="codeurl"><a href="txmt://open?url=file:///Users/deanwampler/projects/Loyola/COMP388-488/Presentations/PragmaticsOfIndustrialSWDevelopment/code/exercise1-test-failure.scala">code/exercise1-test-failure.scala</a></div></p>
<p>(Yeah!)</p>
</div>
<div class="slide">
<h1>Add New Functionality (cont.)</h1>
<p>This is <span class="caps">JSON</span> represented using the Scala <span class="caps">JSON</span> library that is part of the <a href="http://liftweb.net">Lift Web framework</a> (which the project uses). I find it easiest to copy and paste messy output like this to an editor where I can manipulate it&#8230;</p>
<p>But we don&#8217;t really need to do that now. Look for the words <code>did not equal</code>. The &#8220;<span class="caps">JSON</span>&#8221; before these words is much longer than the &#8220;<span class="caps">JSON</span>&#8221; after them. The before case is what was actually returned, while the after case is what we expected. Recall the purpose of the test, to confirm that the results are filtered for just the <code>A</code> stocks. Look for these strings: <code>JField(instruments,JArray(List(JString(A)))</code>. The <code>A</code> is the instrument (stock symbol). The expected string only has <code>A</code> &#8220;fields&#8221;, while the actual also has <code>B</code> and <code>C</code> fields, too.</p>
</div>
<div class="slide">
<h1>Add New Functionality (cont.)</h1>
<p>Now look again at the stack trace:</p>
<ul>
	<li>On what line <em>in the test file</em> did the failure occur? (That is, not a top line, which occurred in the <em>ScalaTest</em> <span class="caps">API</span>.)</li>
</ul>
<p>That line is 112 (at the time of this writing&#8230;). That line in <code>test/scala/server/finance/InstrumentAnalysisServerTest.scala</code> is</p>
<div class="code-tiny">
<pre name="code" id="code" class="brush: scala,;">

analysisServer.calculateStatistics(criteria) should equal (expected)
</pre></div>
<p>Note how this <em>test assertion</em> reads like English? The result of &#8220;calling the <code>calculateStatistics</code> method should equal the <code>expected</code> value&#8221;.</p>
</div>
<div class="slide">
<h1>Add New Functionality (cont.)</h1>
<ul>
	<li>Okay, to start adding new functionality, run this <code>sbt</code> command:</li>
</ul>
<p><code>~test-only org.chicagoscala.awse.server.finance.InstrumentAnalysisServerTest</code></p>
<ul>
	<li>Note that it will wait (no prompt is returned) and every time you save code changes, this test will run.</li>
	<li>Using the <code>~test-only</code> &#8220;action&#8221; saves time, running in a few seconds, while running all the tests takes longer.</li>
</ul>
</div>
<div class="slide">
<h1>Add New Functionality (cont.)</h1>
<ul>
	<li>Now, in your editor of choice, open the file <code>main/scala/server/finance/InstrumentAnalysisServer.scala</code> (the file being tested&#8230;)</li>
	<li>Find the <code>TODO</code> before the method named <code>fetchPrices</code>.</li>
	<li>This method already has the &#8220;instruments&#8221; (i.e., stocks) and statistics information.</li>
</ul>
</div>
<div class="slide">
<h1>Add New Functionality (cont.)</h1>
<ul>
	<li>Find this line:</li>
</ul>
<div class="code-tiny">
<pre name="code" id="code" class="brush: scala,;">

formatPriceResults(filter(result), instruments, statistics, startMillis, endMillis)
</pre></div>
<ul>
	<li>Then find the <code>filter</code> method below it. Note that it takes a <code>(json: JValue)</code> (i.e., a variable named <code>json</code> of type <code>JValue</code>) and it simply returns the passed-in value unaltered.</li>
	<li>Your task is to add filtering by instruments.</li>
</ul>
</div>
<div class="slide">
<h1>Add New Functionality (cont.)</h1>
<ul>
	<li>Note the <code>instruments</code> argument passed to <code>fetchPrices</code>; add this argument to the <code>filter</code> method.</li>
	<li>Modify the call to <code>filter</code> to pass the <code>instruments</code>.</li>
	<li>Replace the body of <code>filter</code> (everything after the <code>=</code> sign) with this body:</li>
</ul>
<div class="code-tiny">
<pre name="code" id="code" class="brush: scala,;">

{  val names = Instrument.toSymbolNames(instruments)
  // log.error ("json: "+json.toString)
  // log.error ("json.values: "+json.values.toString)
  // log.error ("symbol: "+(json \\ "symbol").toString)
  json match {
    case JArray(list) =&gt; list filter { element =&gt; 
      (element \\ "symbol") match {
        case JField("symbol", x) if (names.exists(x == JString(_))) =&gt; true
        case _ =&gt; false
      }
    }
    case _ =&gt; true
  }
}
</pre></div>
</div>
<div class="slide">
<h1>Add New Functionality (cont.)</h1>
<ul>
	<li>Now the test should be passing (showing <code>[success] Successful</code>).</li>
	<li>Hit return to exit <code>~test-only</code> and run all the tests (<code>test</code>) and confirm that they all now pass.</li>
</ul>
</div>
<div class="slide">
<h1>Add New Functionality (cont.)</h1>
<p>You may not understand what this method is doing. It&#8217;s actually quite sophisticated and relies on very specific knowledge about the underlying format of the <code>json: JValue</code>. In fact, the correct way to implement this feature is to support this filtering at the database level, which we will learn how to do with MongoDB. This approach is both more efficient (we don&#8217;t waste time returning stuff we&#8217;ll throw away), more flexible, and more robust.</p>
<p>Note that I added some <code>log.error</code> statements in comments. Try running the <code>~test-only</code> command again and uncomment those lines. Try to find them in all the noisy output. Do they help you understand what&#8217;s going on? Look at the Lift <span class="caps">JSON</span> documentation to further understand this <span class="caps">API</span>. It is here: <a href="http://main.scala-tools.org/mvnsites/liftweb-2.0/framework/scaladocs/index.html">scala-tools.org/mvnsites/liftweb-2.0/framework/scaladocs/index.html</a> (Hint: click the <code>net.liftweb.json</code> link to focus in on the <span class="caps">JSON</span> part of the <span class="caps">API</span>.)</p>
</div>
<div class="slide">
<h1>Turning in the Assignment</h1>
<p>Before class next week, 6/14, commit your code changes to GitHub, using these commands.</p>
<p>First make sure you don&#8217;t have any changes that aren&#8217;t checked in.</p>
<ul>
	<li><code>git status</code></li>
</ul>
<p>If you added any new files to the project (unlikely) and you see them listed in the section labeled <code># Untracked files:</code>, then <em>add</em> those files to git (<strong>Note: ignore the <code>logs</code> and <code>data</code> directories!</strong>):</p>
<ul>
	<li><code>git add files_to_be_added</code></li>
</ul>
<p>Where <code>files_to_be_added</code> is the list of new files to add.</p>
</div>
<div class="slide">
<h1>Turning in the Assignment (cont.)</h1>
<p>In the status output, you might see files in the section labeled <code># Changed but not updated:</code>. These are files where you&#8217;ve made local changes, but not yet checked them in. If so, checkin those files to your <em>local</em> repository now.</p>
<ul>
	<li><code>git checkin -m 'appropriate comment' files</code></li>
</ul>
<p>You can either list the <code>files</code> or omit the list, in which case <em>all</em> the files with changes will be checked in.</p>
</div>
<div class="slide">
<h1>Turning in the Assignment (cont.)</h1>
<p>Finally, <em>push</em> your local repository changes to the copy on GitHub.</p>
<ul>
	<li><code>git push</code></li>
</ul>
<p>You&#8217;ll see some output, but no error messages.</p>
<p>When finished, send me email. Also, tell me your username on GitHub, so I&#8217;ll know who owns which <em>forks</em> of the project.</p>
<p>Again, if you have any problems with these steps, let me know. We can go over them next week in class, too, if necessary.</p>
</div>
<div class="title slide">
<h1>Lecture 3: Scaling Systems, Part I</h1>
</div>
<div class="slide">
<h1>Some Terms &#8224;</h1>
<div class='medium'>
<ul>
	<li><strong>Client:</strong> A person or other <em>service</em> that uses a provided <em>service</em>.</li>
	<li><strong>Process:</strong> An operating system process.</li>
	<li><strong>Component:</strong> A &#8220;course grained&#8221; HW or SW entity. SW <em>components</em> are in the same <em>process</em>.</li>
	<li><strong>Service:</strong> One or more <em>processes</em> and <em>components</em> that provide a subset of <em>system services</em>.</li>
	<li><strong>Network Node:</strong> A discrete server that provides <em>services</em> to other <em>network nodes</em>.</li>
	<li><strong>System:</strong> The well defined collection of <em>components</em>, <em>services</em>, and <em>network nodes</em>.</li>
	<li><strong>System Point:</strong> Some logically-discrete part of an overall <em>system</em>. Depending on the context, it might be a <em>component</em>, <em>service</em>, or <em>network node</em>.</li>
</ul>
<p>&#8224; Warning, some of these terms are vague; they don&#8217;t have standard definitions!</p>
</div>
</div>
<div class="slide">
<h1>Some Ways that Systems Fail</h1>
<ul>
	<li><em>Single points of failure.</em></li>
	<li>Poor fault tolerance (resiliency).</li>
	<li>Insufficient resources.</li>
	<li>Poor security.</li>
</ul>
<p>And affecting long-term business growth&#8230;</p>
<ul>
	<li>Complexity makes evolution difficult.</li>
</ul>
</div>
<div class="slide">
<h1>Single Point of Failure (<span class="caps">SPOF</span>)</h1>
<p><em>A point in a system where a failure would cause the whole system to fail.</em></p>
<p>Examples:</p>
<ul>
	<li><span class="caps">CPU</span>, <span class="caps">RAM</span>, disk, network interface, power&#8230;</li>
	<li>Logical &#8220;tiers&#8221; and components:
	<ul>
		<li>Database</li>
		<li>Middle-tier server</li>
		<li>Other network service</li>
	</ul></li>
</ul>
</div>
<div class="slide">
<h1>Poor Fault Tolerance (Resiliency)</h1>
<p><strong>Fault Tolerance:</strong> <em>How well a system continues to provide service if part of it fails or bad data is received.</em></p>
<p>Systems can be vulnerable even if they don&#8217;t have any single points of failure.</p>
<p>Examples:</p>
<ul>
	<li>A database or other service query returns &#8220;invalid&#8221; data.</li>
	<li>A Browser with JavaScript disabled tries to display a page that relies on JavaScript.</li>
	<li>Bad user input!</li>
	<li>Software bugs!</li>
</ul>
</div>
<div class="slide">
<h1>Poor Fault Tolerance (Resiliency) cont.</h1>
<p>The system should <em>degrade gracefully</em>.</p>
<p>Note that performance might suffer, even if a fault is tolerated.</p>
<p>You&#8217;ll hear <em>stability</em> and <em>reliability</em> also used for essentially the same concept.</p>
</div>
<div class="slide">
<h1>Insufficient Resources</h1>
<p><em>The system can&#8217;t meet the demands for service.</em></p>
<p><strong>Symptom:</strong> The system can&#8217;t service all clients within an acceptable window of opportunity, usually because there are too many concurrent clients!</p>
<p>Examples <em>Bottlenecks</em>:<br />
<div class='small'></p>
<ul>
	<li>Disk or memory space.</li>
	<li>Network bandwidth.</li>
	<li>Database transaction throughput.</li>
	<li>Computation speed.</li>
	<li>Physical space! (i.e., enough room to add more &#8220;stuff&#8221;)<br />
</div></li>
</ul>
</div>
<div class="slide">
<h1>Poor Security</h1>
<p><em>Systems connected to the Internet are more vulnerable than closed systems.</em></p>
<p>&#8230; but security breaches &#8220;from the inside&#8221; are also significant.</p>
<ul>
	<li>Malicious users.</li>
	<li>Unwitting users.</li>
</ul>
</div>
<div class="slide">
<h1>Complexity Makes Evolution Difficult</h1>
<p><em>A poorly structured system is difficult to extend to support new functionality.</em></p>
<p>Example Sources of Complexity:</p>
<ul>
	<li>Source code.</li>
	<li>System <em>topology</em>.
	<ul>
		<li>How logical work is divided amongst <em>components</em>, <em>services</em>, and <em>network nodes</em>.</li>
	</ul></li>
	<li>Excessive coupling between <em>service points</em>.</li>
	<li>Too <em>little</em> distribution (i.e., single <em>service points</em> with too many responsibilities tend to be overly complex).</li>
</ul>
</div>
<div class="slide">
<h1>Large-scale System Design Concerns</h1>
<ul>
	<li>Scalability</li>
	<li>Availability</li>
	<li>Security:
	<ul>
		<li>Authentication</li>
		<li>Authorization</li>
	</ul></li>
</ul>
</div>
<div class="slide">
<h1>Scalability</h1>
<p><em>Can the system&#8217;s capacity be increased at reasonable cost?</em></p>
<p>Affects the ability to provide adequate resources to meet service expectations.</p>
<p>Consider <em>latency</em> vs. <em>throughput</em>, using a pipe analogy:</p>
<ul>
	<li><strong>Latency:</strong> The time it takes for any one computation. Imagine the pipe is <em>long</em> or <em>short</em>.</li>
	<li><strong>Throughput:</strong> The amount of computation per unit time. Imagine the pipe is <em>fat</em> or <em>thin</em>.</li>
</ul>
</div>
<div class="slide">
<h1>Scalability (cont.)</h1>
<p>Two ways to Scale:</p>
<ul>
	<li>Scale <em>vertically</em>.</li>
	<li>Scale <em>horizontally</em>.</li>
</ul>
</div>
<div class="slide">
<h1>Scaling Vertically</h1>
<p>Adding more hardware to the <em>same</em> machine.</p>
<ul>
	<li><strong>Easy:</strong> Requires no software changes, no increase in &#8220;rack&#8221; space, etc.</li>
	<li><strong>Expensive:</strong> Premium price for the top-of-the-line hardware.</li>
	<li><strong><span class="caps">SPOF</span>:</strong> The server remains a single point of failure</li>
</ul>
</div>
<div class="slide">
<h1>Scaling Horizontally</h1>
<p>Adding more hardware <em>in parallel</em>.</p>
<ul>
	<li><strong>Hard:</strong> May require significant software changes.</li>
	<li><strong>Cheap:</strong> Can use lower-cost hardware (but more power and space?).</li>
	<li><strong><span class="caps">SPOF</span> Elimination:</strong> <em>Redundancy</em> eliminates <span class="caps">SPOF</span> (in principle&#8230;)</li>
</ul>
</div>
<div class="slide">
<h1>Redundancy</h1>
<ul>
	<li>N &gt; 1 identical <em>components</em>, <em>services</em>, or <em>network nodes</em>.</li>
	<li>Enables <em>failover</em> when one element fails.</li>
</ul>
</div>
<div class="slide">
<h1>&#8220;Let It Crash&#8221;</h1>
<p>A core philosophy in Akka, Erlang, and many other Actor-based systems. Rather than create big processes that require complex error recovery (which is very hard to do well&#8230;), use lots of small &#8220;workers&#8221; that are expendable. If any one of them gets into trouble, let it crash and restart it.</p>
<p>Requires careful partitioning and supervision of work, including tolerance for small failures.</p>
</div>
<div class="slide">
<h1>Distribution of Computation and Data</h1>
<ul>
	<li>HW and SW can be tuned for specific services.
	<ul>
		<li>E.g., The database servers have different performance requirements than the servers that deliver static web content (images, videos, JavaScript, &#8230;).</li>
	</ul></li>
	<li>Data can be divided.
	<ul>
		<li>Disk <em>striping</em> (e.g., <span class="caps">RAID</span>-5 disk arrays). Gives both scalability (N disk drives) plus failure resiliency (data is effectively duplicated across the array). Disk array configurations can also parallelize writes, increasing <em>throughput</em>.</li>
		<li>Database <em>sharding</em> (e.g., all East-coast customers in the New York data center). Data is separated, not duplicated (use <em>replication</em> for that&#8230;)</li>
	</ul></li>
</ul>
</div>
<div class="slide">
<h1>Caching</h1>
<p><em>Remembering the result of an expensive operation for subsequent use.</em></p>
<ul>
	<li><strong>Data Caching:</strong>
	<ul>
		<li><em>In-memory</em> cache speeds up <em>disk</em> I/O.</li>
		<li><em><span class="caps">CPU</span></em> cache speeds up <em>memory</em> I/O.</li>
	</ul></li>
</ul>
<ul>
	<li><strong>Memoization:</strong>
	<ul>
		<li>Remembering the result of a previous <em>calculation</em>.</li>
	</ul></li>
</ul>
</div>
<div class="slide">
<h1>Availability</h1>
<p><em>Can the system provide service when clients expect it?</em></p>
<p>Subject to the <em>service level agreements</em> (SLAs) with clients about when service is required: 24&#215;7? 8-5 week days? holidays? (Performance is usually part of SLAs, too.)</p>
<p>Requires <em>fault tolerance</em>.</p>
</div>
<div class="slide">
<h1>Availability Numbers</h1>
<table class="tiny">
	<tr>
		<th>Availability&#160;% </th>
		<th>Downtime/Year  </th>
		<th>Downtime/Month </th>
		<th>Downtime/Week </th>
	</tr>
	<tr>
		<td> 90% (&#8220;one nine&#8221;)  </td>
		<td> 36.5 days  </td>
		<td> 72 hours  </td>
		<td> 16.8 hours  </td>
	</tr>
	<tr>
		<td> 95%  </td>
		<td> 18.25 days  </td>
		<td> 36 hours  </td>
		<td> 8.4 hours  </td>
	</tr>
	<tr>
		<td> 98%  </td>
		<td> 7.30 days  </td>
		<td> 14.4 hours  </td>
		<td> 3.36 hours  </td>
	</tr>
	<tr>
		<td> 99% (&#8220;two nines&#8221;)  </td>
		<td> 3.65 days  </td>
		<td> 7.20 hours  </td>
		<td> 1.68 hours  </td>
	</tr>
	<tr>
		<td> 99.5%  </td>
		<td> 1.83 days  </td>
		<td> 3.60 hours  </td>
		<td> 50.4 minutes  </td>
	</tr>
	<tr>
		<td> 99.8%  </td>
		<td> 17.52 hours  </td>
		<td> 86.23 minutes  </td>
		<td> 20.16 minutes  </td>
	</tr>
	<tr>
		<td> 99.9% (&#8220;three nines&#8221;)  </td>
		<td> 8.76 hours  </td>
		<td> 43.2 minutes  </td>
		<td> 10.1 minutes  </td>
	</tr>
	<tr>
		<td> 99.95%  </td>
		<td> 4.38 hours  </td>
		<td> 21.56 minutes  </td>
		<td> 5.04 minutes  </td>
	</tr>
	<tr>
		<td> 99.99% (&#8220;four nines&#8221;)  </td>
		<td> 52.56 minutes  </td>
		<td> 4.32 minutes  </td>
		<td> 1.01 minutes  </td>
	</tr>
	<tr>
		<td> 99.999% (&#8220;five nines&#8221;)  </td>
		<td> 5.26 minutes  </td>
		<td> 25.9 seconds  </td>
		<td> 6.05 seconds  </td>
	</tr>
	<tr>
		<td> 99.9999% (&#8220;six nines&#8221;)  </td>
		<td> 31.5 seconds  </td>
		<td> 2.59 seconds  </td>
		<td> 0.605 seconds  </td>
	</tr>
	<tr>
		<td> 99.999999% (&#8220;nine nines&#8221;)  </td>
		<td> 31.5 microseconds  </td>
		<td> 2.59 microseconds  </td>
		<td> 0.605 microseconds  </td>
	</tr>
</table>
<p>(adapted from http://en.wikipedia.org/wiki/High_availability)</p>
</div>
<div class="slide">
<h1>Achieving High Availability</h1>
<ul>
	<li><strong>Redundancy:</strong> Improves fault tolerance (e.g., <span class="caps">SPOF</span> elimination).</li>
	<li><strong>Resource Planning:</strong> Estimating <em>and measuring</em> resource utilization. Avoidance of high % utilization.</li>
	<li><strong>Other Fault Tolerance Design Concerns:</strong>
	<ul>
		<li>Clock Synchronization</li>
		<li>Consensus</li>
		<li>Self Stabilization</li>
	</ul></li>
</ul>
</div>
<div class="slide">
<h1>Clock Synchronization</h1>
<p><em>When the <strong>timing of events</strong> matters across different systems, how do you ensure that those systems have synchronized clocks?</em></p>
<p>Examples:</p>
<ul>
	<li>Message queues.</li>
	<li>Log monitoring.</li>
</ul>
</div>
<div class="slide">
<h1>Consensus</h1>
<p><em>How do you decide which systems are correct if answers that should be the same are different?</em></p>
<p>There are four, redundant flight-control computers on the space shuttle:<br />
<br/></p>
<blockquote>
<p>The four general-purpose computers operate essentially in lockstep, checking each other. If one computer fails, the three functioning computers &#8220;vote&#8221; it out of the system. This isolates it from vehicle control. If a second computer of the three remaining fails, the two functioning computers vote it out. In the rare case of two out of four computers simultaneously failing (a two-two split), one group is picked at random.<br />
(from the <a href="http://en.wikipedia.org/wiki/Space_Shuttle">Space Shuttle Wikipedia page</a>)</p>
</blockquote>
</div>
<div class="slide">
<h1>Self Stabilization</h1>
<p>Trying to &#8220;engineer-in&#8221; correctness in a distributed system is essentially impossible. Instead, design the system so it <em>constantly drives itself towards stability</em>.</p>
<p>This may or may not involve actual detection of errors.</p>
</div>
<div class="slide">
<h1>Security</h1>
<ul>
	<li><strong>Authentication:</strong> Reliably identifying a client (user or external system) attempting to use system resources.</li>
	<li><strong>Authorization:</strong> Once a client is authenticated, controlling access to those resources for which the client is permitted to use.</li>
</ul>
</div>
<div class="slide">
<h1>Topologies</h1>
<ul>
	<li>Client–server (2-tier) architecture</li>
	<li>3-tier architecture</li>
	<li>N-tier architecture</li>
	<li>Tightly coupled (clustered)</li>
	<li>Peer-to-peer</li>
	<li>Space based</li>
</ul>
</div>
<div class="slide">
<h1>Client–server (2-tier) Architecture</h1>
<p>A client requests data or work from a server, or sends data updates to a server. The client then formats and presents the results to the user. Often, the server is a database and the client implements non-trivial &#8220;business domain logic&#8221; (business logic, for short).</p>
<p>Note that <em>tier</em> often implies a vertical orientation; <em>client down to server and back up to client</em>.</p>
<p>Examples:</p>
<ul>
	<li>Typical VisualBasic apps.</li>
	<li>Simpler, low-volume web applications.</li>
</ul>
</div>
<div class="slide">
<h1>3-tier Architecture</h1>
<p>A presentation tier, a middle tier handling &#8220;business logic&#8221;, and a database (persistence) tier. The middle tier implements most of the logic that would be in the client and some of the logic that would be in the &#8220;server&#8221; (database?) in a 2-tier system.</p>
<ul>
	<li>The &#8220;standard&#8221; architecture of mid-sized, mid-volume Internet and IT systems.</li>
	<li>Having three tiers simplifies the responsibilities of each tier, compared to 2-tier systems.
	<ul>
		<li>Putting logic in the UI is bad because it&#8217;s hard to test and it doesn&#8217;t cleanly separation &#8220;concerns&#8221;.</li>
	</ul></li>
</ul>
</div>
<div class="slide">
<h1>N-tier Architecture</h1>
<p>Generalization of 3-tier architecture. There may be more than 3 vertical tiers, but often there are <em>horizontal</em> (peer) services that separate responsibilities, usually only at the mid tier and persistence &#8220;levels&#8221; (but the UI should be <em>componentized</em>).</p>
<p>Typical of all high-volume, high-availability web sites and IT applications.</p>
<p>Examples:</p>
<ul>
	<li>Cloud computing</li>
	<li>Email?</li>
</ul>
</div>
<div class="slide">
<h1>Tightly Coupled (Clustered)</h1>
<p>Usually refers to a cluster of servers or services that collaborate closely, perhaps to solve a problem with <em>divide and conquer</em> after which the individual contributions are combined to produce the final result.</p>
<p>Tight coupling may imply that failure of one element causes the work of all elements to fail. An exception is typical <em>map-reduce</em> systems (which we&#8217;ll discuss in a subsequent lecture), like <em>Hadoop</em>, which handle single node failures.</p>
<p>Example:</p>
<ul>
	<li>Multicore Processor</li>
	<li>Map-Reduce</li>
</ul>
</div>
<div class="slide">
<h1>Master-Slave</h1>
<p>An arrangement where one system dictates the work performed by subordinate systems.</p>
<p>Also used for arrangements of similar systems where one system is designated the primary source of data and/or computation (the &#8220;master&#8221;), but work may <em>fail over</em> to a backup (&#8220;slave&#8221;) system if the master fails. The slave(s) may have to do all the work the master does (e.g., store data records) in order to take over. <em>Primary-secondary</em> is sometimes used to describe this arrangement.</p>
<p>The slave is now considered the master. After recovery, the old master may re-enter the system as a slave (or become the master again).</p>
<p>Example:</p>
<ul>
	<li>Datebase master-slave server</li>
</ul>
</div>
<div class="slide">
<h1>Peer-to-peer</h1>
<p>In contrast to <em>master-slave</em>, an architecture where no one system has a special role relative to the others in a group that provides a service. No one system directs the work of others, either. Rather, all systems divide the responsibilities equally, as <em>peers</em>, including the management of work.</p>
<p>Example:</p>
<ul>
	<li><em>Mesh</em> network</li>
</ul>
</div>
<div class="slide">
<h1>Space Based</h1>
<p>An infrastructure that creates the illusion of one single address-space. Data (and sometimes code!) are transparently replicated among &#8220;physical&#8221; elements. Sometimes called <em>virtualization</em> (but that has other meanings, too).</p>
<p>Examples:</p>
<ul>
	<li>Terracotta &#8211; Virtualization of data across <span class="caps">JVM</span> instances.</li>
	<li>Tuple spaces &#8211; e.g., Linda</li>
</ul>
</div>
<div class="slide">
<h1>Examples of Distributed Systems and Applications</h1>
<p>For more examples, see the list on the <a href="http://en.wikipedia.org/wiki/Distributed_computing">Distributed Computing</a> Wikipedia page.</p>
</div>
<div class="slide">
<h1>Scaling Systems, Part II</h1>
<p>We&#8217;ll return to <em>Scaling Systems</em> next month after the Midterm. For the next few weeks, we&#8217;ll focus on <span class="caps">SQL</span> and <em>NoSQL</em> databases.</p>
</div>
<div class="slide">
<h1>Reading Assignments:</h1>
<ul>
	<li><a href="http://www.slideshare.net/jboner/scalability-availability-stability-patterns">Scalability, Availability, Stability Patterns</a>. A (long) presentation that covers many essentials of building systems that satisfy requirements we&#8217;ve discussed. It also discusses <em>NoSQL</em> databases that we&#8217;ll explore in subsequent weeks. Some of the other concepts discussed (like immutability and referential transparency) will be discussed later in the course. Skim the sections on data flow concurrency and event processing approaches; we won&#8217;t cover them in the course. I also don&#8217;t expect you to remember the lists of products in each category!</li>
	<li><a href="http://blog.heroku.com/archives/2010/7/20/nosql/">NoSQL, Heroku, and You</a>. One cloud service vendor&#8217;s take on the importance of NoSQL databases.</li>
</ul>
</div>
<div class="slide">
<h1>For Further Research</h1>
<ul>
	<li>Diomidis Spinellis and Georgios Gousios, &#8220;Beautiful Architecture&#8221;, O&#8217;Reilly, 2009. <span class="caps">ISBN</span>: 0596517984. Good essays on architecture.</li>
	<li><a href="http://en.wikipedia.org/wiki/Consensus_(computer_science)">Consensus</a>.</li>
	<li><a href="http://en.wikipedia.org/wiki/Self-stabilisation">Self Stabilization</a>.</li>
	<li><a href="http://en.wikipedia.org/wiki/Byzantine_fault_tolerance">Byzantine fault tolerance</a>.</li>
	<li>Martin Fowler, et al., &#8220;Patterns of Enterprise Application Architecture&#8221;, Addison-Wesley, 2003. <span class="caps">ISBN</span>: 0321127420. Conventional, object-oriented approach. Does not cover the latest thinking on highly-distributed architectures.</li>
</ul>
</div>
<div class="slide">
<h1>Add New Functionality (step 1)</h1>
<p>This week, we&#8217;ll finally add the <span class="caps">NYSE</span> data to the project.</p>
<p>Make sure you have pulled the latest changes from the project on the <code>COMP-388-488</code> branch.</p>
<p>Open the <code>README.md</code> file (it&#8217;s nicely formatted on GitHub) and follow the directions in the newly-revised section called <strong>Import the Data</strong>. It explains the new scripts in the <code>bin</code> directory (which we&#8217;ll also discuss in class) that you use to import the data.</p>
<p>After importing the data, read the next section on using the web app, which explains a few things you&#8217;ll need to know for the current state of the project.</p>
</div>
<div class="slide">
<h1>Add New Functionality (step 2)</h1>
<p>Note that the instructions mention a <code>datatmp</code> directory that holds temporary <span class="caps">JSON</span> files that were generated from the original <span class="caps">YAML</span> files and imported into MongoDB. These <span class="caps">JSON</span> files contain one-line <span class="caps">JSON</span> expressions as required by <code>mongoimport</code>. Once the data import is done and the <code>mongo</code> console commands suggested in the <span class="caps">README</span> work correctly, you can delete <code>datatmp</code>.</p>
</div>
<div class="slide">
<h1>Add New Functionality (step 3)</h1>
<p>For our next exercise (#2), we&#8217;ll answer the question, &#8220;What stocks are available?&#8221;. We&#8217;ll add a feature that returns the available stock symbols.</p>
<p>There is a new branch on the GitHub project, based on <code>COMP-388-488</code>, called <code>exercise2</code>. run these commands, where the <code>#...</code> are comments:</p>
<div class="code-tiny">
<pre name="code" id="code" class="brush: bash,;">

git fetch                        # grab the latest off GitHub, but don't merge changes
git branch -a                    # Show all the local and remote branches
git log origin/COMP-388-488 ^COMP-388-488  # show me what's changed!
git checkout COMP-388-488        # move to this branch (if not already there)
git merge origin/COMP-388-488    # merge to my local branch
git branch --track exercise2 origin/exercise2   # create local copy of "exercise2"
git checkout exercise2           # change to the "exercise2" branch
# start working...
</pre></div>
<p>Note that <code>git pull</code> is the combination of <code>git fetch</code> and <code>git merge</code>.</p>
</div>
<div class="slide">
<h1>Add New Functionality (step 4)</h1>
<p>Run jetty in <code>sbt</code> (i.e., <code>jetty-run</code>) and go to the web page. The <code>bogus</code> button is gone and there is now a <code>List Stocks</code> button. If you click it, you&#8217;ll get the same sort of error message that <code>bogus</code> triggered. Your mission is to make this work.</p>
<p>The UI code is already prepared. You just need to modify the server code, starting with the <span class="caps">REST</span> interface.</p>
</div>
<div class="slide">
<h1>Add New Functionality (step 5)</h1>
<ul>
	<li>Edit <code>RestfulDataPublisher.scala</code>. We need to do a little <em>refactoring</em> first.</li>
	<li>Change <code>getStatsFromInstrumentAnalysisServerSupervisors</code> to take this argument: <code>message: InstrumentCalculationMessages</code>.</li>
	<li>Change <code>supervisor !! CalculateStatistics(allCriteria)</code> to <code>supervisor !! message</code>.</li>
	<li>Now this method is more general to meet our needs.</li>
</ul>
</div>
<div class="slide">
<h1>Add New Functionality (step 6)</h1>
<ul>
	<li>Also in <code>RestfulDataPublisher.scala</code>, in method <code>getAllDataFor</code>, change:</li>
</ul>
<div class="code-tiny">
<pre name="code" id="code" class="brush: scala,;">

val results = getStatsFromInstrumentAnalysisServerSupervisors(allCriteria)
</pre></div>
<p>to</p>
<div class="code-tiny">
<pre name="code" id="code" class="brush: scala,;">

val results = getStatsFromInstrumentAnalysisServerSupervisors(CalculateStatistics(allCriteria))
</pre></div>
<ul>
	<li>Run the tests; they should all pass!</li>
	<li>In what follows, use the sbt <code>~test</code> target to keep your tests passing as much as possible. There will be some intermediate steps when they won&#8217;t pass.</li>
</ul>
</div>
<div class="slide">
<h1>Add New Functionality (step 7)</h1>
<ul>
	<li>Edit <code>InstrumentAnalysisServer.scala</code>.</li>
	<li>Add this new object definition after the definition of <code>CalculateStatistics</code>:</li>
</ul>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

case class GetInstrumentList(range: scala.collection.immutable.NumericRange[Char]) extends InstrumentCalculationMessages
</pre></div>
<ul>
	<li>(You can import <code>NumericRange</code> if you don&#8217;t want to put this fully-qualified name in the declaration.)</li>
</ul>
</div>
<div class="slide">
<h1>Add New Functionality (step 8)</h1>
<ul>
	<li>Back in <code>RestfulDataPublisher.scala</code>, edit the <code>restRequest</code> method.</li>
	<li>Add a case statement for the string &#8220;list_stocks&#8221;. (Follow the example for &#8220;stats&#8221;).</li>
	<li>Have the case handler call a method similar to <code>getAllDataFor</code>. Call it <code>getAllInstruments</code>. Pass one argument; the <code>instruments</code> variable, of type <code>String</code>.</li>
</ul>
</div>
<div class="slide">
<h1>Add New Functionality (step 9)</h1>
<ul>
	<li>If you copied and pasted <code>getAllDataFor</code> ;), change the first several lines in the <code>try</code> block to the following lines:</li>
</ul>
<div class="code-tiny">
<pre name="code" id="code" class="brush: scala,;">

// Hack! Just grab the first and last letters in the "instruments" string
// and use them as the range, but handle the case of 0 or 1 characters.
val symbolRange = instruments.trim match {
  case "" =&gt; `A` to `Z`  // default
  case s  =&gt; s.length match {
    case 1 =&gt; `A` to s.charAt(0).toUpper  // 1 character; use as end
    case n =&gt; s.charAt(0).toUpper to s.charAt(n-1).toUpper
  }
}
val results = getStatsFromInstrumentAnalysisServerSupervisors(GetInstrumentList(symbolRange))
val result = compact(render(JSONMap.toJValue(Map("instrument-list" -&gt; results))))
</pre></div>

<ul>
	<li><strong>Warning:</strong> those backticks ` should be forward ticks &#8217; (formatting problem!).</li>
</ul>
</div>
<div class="slide">
<h1>Add New Functionality (step 9b)</h1>
<p>(Added after the original lecture&#8230;)</p>
<p>In the exception handling code for <code>getAllInstruments</code>, note that the calls to <code>makeErrorString</code> won&#8217;t work, because the arguments to <code>getAllInstruments</code> are different than the arguments to <code>getAllDataFor</code>.</p>
<ul>
	<li>Instead, call a new function named <code>makeAllInstrumentsErrorString</code>.</li>
	<li>Create the <code>makeAllInstrumentsErrorString</code> method, taking an appropriate argument list.</li>
</ul>
</div>
<div class="slide">
<h1>Add New Functionality (step 10)</h1>
<ul>
	<li>Edit <code>InstrumentAnalysisServerSupervisors.scala</code>.</li>
	<li>In the <code>defaultHandler</code>, add this case clause.</li>
</ul>
<div class="code-tiny">
<pre name="code" id="code" class="brush: scala,;">

case GetInstrumentList(range) =&gt; self.reply(getInstrumentList(range))
</pre></div>
</div>
<div class="slide">
<h1>Add New Functionality (step 11)</h1>
<ul>
	<li>Create the <code>getInstrumentList</code> method, which takes one argument: <code>range: scala.collection.immutable.NumericRange[Char]</code>. It should look similar to the <code>calculate</code> method. The main difference is the <code>for</code> &#8220;comprehension&#8221; (loop):</li>
</ul>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

{
  val futures = for {
    letter &lt;- range  // Recall that range is something like 'A' to 'D'
    oneLetterRange = letter to letter
    instrument = Instrument(letter.toString)
    calculator &lt;- getOrMakeInstrumentAnalysisServerFor(instrument, Price(Dollars))
  } yield (calculator !!! GetInstrumentList(oneLetterRange))
  Futures.awaitAll(futures.toList)
  futuresToJSON(futures.toList, "None!")
}
</pre></div>
</div>
<div class="slide">
<h1>Add New Functionality (step 12)</h1>
<ul>
	<li>Edit <code>InstrumentAnalysisServer.scala</code>.</li>
	<li>Add the same case clause to <code>defaultHandler</code> that you added in <code>InstrumentAnalysisServerSupervisors.scala</code>.</li>
	<li>However, change the call to a <code>getInstrumentList</code> method to be a call on the <code>helper</code> object in the file.</li>
	<li>Create this method in the helper class. It must take the same one-argument that <code>InstrumentAnalysisServerSupervisors.getInstrumentList</code> took.</li>
	<li>Copy the body of <code>fetchPrices</code> to <code>getInstrumentList</code>.</li>
	<li>Make this new method public, not <code>protected</code>! (In Scala, the default is public)</li>
</ul>
</div>
<div class="slide">
<h1>Add New Functionality (step 13)</h1>
<ul>
	<li>In <code>getInstrumentList</code>, change the argument to the <code>Get</code> object that&#8217;s sent to <code>dataStorageServer</code> to <code>Pair("instrument_list", range.toList.head.toString)</code>. (We&#8217;ll just assume here that there is only one character in the range; we&#8217;re using one instance of this class per letter.)</li>
	<li>Change the error message for the <code>None</code> case to something appropriate.</li>
	<li>Change the <code>Some</code> case to simply return the <code>result</code>.</li>
</ul>
</div>
<div class="slide">
<h1>Add New Functionality (step 14)</h1>
<ul>
	<li>Implement <code>formatInstrumentListResults(result, range)</code>. Follow the example of <code>formatPriceResults</code>.</li>
	<li>Instead of the <code>criteria</code> entry in the Map, return &#8220;range&#8221; as the key and <code>range.toString</code> as the value.</li>
	<li>Keep the <code>results</code> part as is.</li>
</ul>
</div>
<div class="slide">
<h1>Add New Functionality (step 15)</h1>
<ul>
	<li>Edit <code>DataStorageServer</code>.</li>
	<li>Rename <code>getData</code> to <code>getDataForRange</code></li>
	<li><em>Copy</em> the function signature for <code>getDataForRange</code> and create a new <code>getData</code> with it. Use the following body:</li>
</ul>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

(criteria \ "instrument_list") match {
	case JField(key, JString(value)) =&gt; getInstrumentList(value)
  case _ =&gt; getDataForRange(criteria)
} 
</pre></div>
</div>
<div class="slide">
<h1>Add New Functionality (step 16)</h1>
<ul>
	<li>Create method <code>getInstrumentList</code>.</li>
	<li>Here we will use a hack to reduce the amount of code we would have to write for the general case. We&#8217;ll only worry about getting the list from MongoDB, not all data stores. (How could you eliminate this hack with a more general solution??)</li>
</ul>
<div class="code-tiny">
<pre name="code" id="code" class="brush: scala,;">

protected[persistence] def getInstrumentList(prefix: String): JValue = dataStore match {
  case mongo: MongoDBDataStore =&gt; 
    val data = for {
      json &lt;- mongo.getInstrumentList(prefix)
    } yield json
    toJSON(data toList)
  case _ =&gt; throw new RuntimeException("Can't get the instrument list from datastore "+dataStore)
}
</pre></div>
</div>
<div class="slide">
<h1>Add New Functionality (step 17)</h1>
<ul>
	<li>Add these imports to <code>MongoDBDataStore</code>.</li>
</ul>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

import net.liftweb.json.JsonAST._
import net.liftweb.json.JsonDSL._
import org.joda.time.format._
</pre></div>
</div>
<div class="slide">
<h1>Add New Functionality (step 18)</h1>
<ul>
	<li>Create method <code>getInstrumentList</code> in <code>MongoDBDataStore</code>. Here it is:</li>
</ul>
<div class="code-tiny">
<pre name="code" id="code" class="brush: scala,;">

// Hack!
def getInstrumentList(prefix: String): Iterable[JSONRecord] = try {
  // TODO: We hard-code the name of the thing we want, the "stock_symbol". Should be abstracted...
  val list = collection.distinct("stock_symbol")
  val buff = new scala.collection.mutable.ArrayBuffer[String]()
  val iter = list.iterator
  while (iter.hasNext) {
    buff += iter.next
  }
  // Must put in a timestamp to make JSONRecord happy:
  val format = DateTimeFormat.forPattern("yyyy-MM-dd")
  List(JSONRecord(("date" -&gt; format.print(new DateTime)) ~ ("letter" -&gt; prefix) ~ ("symbols" -&gt; buff.toList)))
} catch {
  case th =&gt; 
    log.error("MongoDB Exception: ", th)
    throw th
}
</pre></div>
</div>
<div class="slide">
<h1>Add New Functionality (step 19)</h1>
<p>Try it out! use <code>jetty-run</code> in <code>sbt</code>, enter two letters for the <code>Symbols</code> in the UI and click <code>List Stocks</code>. You should get a table with one row for all the symbols that start with the letter <code>A</code>, one row for <code>B</code>, etc.</p>
<p><strong>Warning:</strong> If might run out of memory if you ask for <code>A-Z</code> symbols! Try small ranges first.</p>
<p>Make sure the price queries still work.</p>
</div>
<div class="slide">
<h1>Add New Functionality (step 20)</h1>
<p>We did all these changes without adding tests for them. That&#8217;s not really the best way to work (as we&#8217;ll see later in the course). Go back through the changes and create tests for as many of them as you can. Where we copied existing code, find tests for the original code and see if you can copy and adapt those tests.</p>
</div>
<div class="slide">
<h1>Add New Functionality (final)</h1>
<p>Please commit your changes to GitHub by the start of class next week.</p>
</div>
<div class="title slide">
<h1>Lecture 4: Scaling Data, Part I</h1>
<p>For decades, Relational Databases have been the dominate tool for data persistence. There are other models that are also decades old.</p>
<p>You can find a short summary of many of them <a href="http://www.unixspace.com/context/databases.html">here</a>. We&#8217;ll discuss a few of them now.</p>
</div>
<div class="slide">
<h1>Hierarchical and Network Model</h1>
<ul>
	<li>Hierarchical:
	<ul>
		<li>Tree-based, parent-child relationships.</li>
		<li>1:N (one parent, N children).</li>
		<li>Popular in the late 1960&#8217;s through the 1970&#8217;s.</li>
	</ul></li>
	<li>Network:
	<ul>
		<li>M:N (many to many).</li>
		<li>Formally defined in 1971 at the Conference on Data Systems Languages (<span class="caps">CODASYL</span>).</li>
		<li>Based on set theory.</li>
		<li>Can have cycles in the network.</li>
	</ul></li>
</ul>
</div>
<div class="slide">
<h1>Relational Model</h1>
<ul>
	<li><span class="caps">RDBMS</span> &#8211; Relational Database Management System.</li>
	<li>Devised by Edgar F. Codd at <span class="caps">IBM</span> in 1970.</li>
	<li>A <strong>relation</strong>: a set of tuples (i.e., rows a table) that have the same &#8220;attributes&#8221; (i.e., columns).</li>
	<li>Rows are unique.</li>
	<li>Columns have types and unique names.</li>
	<li>Each row has the same set of columns.</li>
	<li>The sequence of rows and columns are not significant.</li>
	<li>1 or more columns may be indexed to speed up queries.</li>
</ul>
</div>
<div class="slide">
<h1>Object-Oriented Model</h1>
<ul>
	<li>Attempts to unify the programming and persistence models for languages like C++, Java, Smalltalk, etc.</li>
	<li>Supports inheritance.</li>
	<li>Eliminates the <em>impedence mismatch</em> required to persist objects to relational tables (inheritance is particularly tricky).</li>
	<li>Emerged in the 90&#8217;s.</li>
</ul>
</div>
<div class="slide">
<h1>Object-Oriented Model (cont.)</h1>
<ul>
	<li>Never really displaced <span class="caps">RDBMS</span>, even though most IT development is done using OO languages!
	<ul>
		<li>Performance was a serious problem in early OODBMSs.</li>
		<li>Database architects and developers tend to be conservative.</li>
		<li>Using <span class="caps">RDBMS</span> continued to be &#8220;good enough&#8221;.</li>
	</ul></li>
</ul>
</div>
<div class="slide">
<h1>Object/Relational Model</h1>
<ul>
	<li>Adds to the relational model the ability to define new types and specify the unique operations on those types.</li>
	<li>Examples include geospatial data, time-series data (e.g., stock prices), and binary media like images, audio, and video.</li>
	<li>Doesn&#8217;t support inheritance in the usual <span class="caps">OOP</span> sense.</li>
	<li>Most of the big <span class="caps">RDBMS</span> vendors offer some O/R capabilities.</li>
	<li>Compromise solution that also emerged in the 90&#8217;s.</li>
</ul>
</div>
<div class="slide">
<h1>Requirements for Data Persistence</h1>
<ul>
	<li><span class="caps">ACID</span>
	<ul>
		<li><strong>A</strong>: Atomicity</li>
		<li><strong>C</strong>: Consistency</li>
		<li><strong>I</strong>: Isolation</li>
		<li><strong>D</strong>: Durability</li>
	</ul></li>
</ul>
<p>When we discussed <span class="caps">ACID</span> two weeks ago, we mostly talked about <span class="caps">ACI</span> in the context of <em>software transactional memory</em>. Let&#8217;s talk a bit more about durability.</p>
</div>
<div class="slide">
<h1>Durability</h1>
<p><em>Committed transactions are permanent.</em></p>
<p>&#8230;meaning they will survive system failure.</p>
<p>Often implemented with a transaction log that can be &#8220;replayed&#8221; if recovery is required.</p>
<p>But what if the log was on the system that failed? What if we can&#8217;t wait for the time it takes to replay the log (after we fix the broken system)?</p>
</div>
<div class="slide">
<h1>Requirements for &#8220;Web Scale&#8221; Data Persistence</h1>
<ul>
	<li><strong>High Availability:</strong> If there&#8217;s one server, we can&#8217;t tolerate it crashing.</li>
	<li><strong>Horizontal Scaling:</strong> No one server can &#8220;implement&#8221; Google.</li>
	<li><strong>Flexibility, Extensibility:</strong> So we can grow our business with minimal cost.</li>
</ul>
</div>
<div class="slide">
<h1>Some Techniques We&#8217;ll Discuss</h1>
<ul>
	<li>Replication</li>
	<li>Schema-less Design</li>
	<li>MapReduce</li>
</ul>
</div>
<div class="slide">
<h1>Some Techniques We&#8217;ll Discuss</h1>
<ul>
	<li><strong>Replication</strong></li>
	<li>Schema-less Design</li>
	<li>MapReduce</li>
</ul>
</div>
<div class="slide">
<h1>Replication and Sharding</h1>
<p><strong>Replication:</strong> Duplicate copies of the same data.</p>
<ul>
	<li>Replication Enables Failover</li>
	<li>If you have duplicate data and duplicate software, then if one system goes down, the other(s) can take over the load.</li>
	<li>Three of the possible configurations:
	<ul>
		<li><strong>Master-Slave:</strong> One dominate server; if it fails, the slave takes over.</li>
		<li><strong>Mated Pair:</strong> Computation distributed between pairs. If one fails, the other takes the full load.</li>
		<li><strong>N Peers:</strong> Scaled up version of <em>mated pair</em> to N servers.</li>
	</ul></li>
</ul>
</div>
<div class="slide">
<h1>Replication and Sharding</h1>
<p><strong>Sharding:</strong> Splitting a large data set across multiple servers.</p>
<ul>
	<li>Customer orders on the East coast are stored in New Jersey.</li>
	<li>Customer orders on the West coast are stored in Oregon.</li>
	<li>&#8230;<br />
or split <em>functionality</em> across servers:</li>
	<li>Customer orders on one server.</li>
	<li>Inventory on another server.</li>
	<li>&#8230;</li>
</ul>
</div>
<div class="slide">
<h1>Sharding with Replication</h1>
<p>Get horizontal scalability and replication by combining both sharding with replication. Here&#8217;s an example using MongoDB.</p>
<p><img src="images/mongodb_sharding_replica_sets.png"><img></div>
<div class="slide">
<h1>Distributed Data and Latency</h1>
<p>When you scale by sharding (or <em>partitioning</em>) your data. You would like to maintain <span class="caps">ACID</span> compliant transactions across the data shards. The traditional approach is to rely upon distributed transactions and two-phase commit.</p>
</div>
<div class="slide">
<h1>Distributed Transactions &amp; Two-Phase Commit</h1>
<ul>
	<li><strong>Distributed Transactions:</strong> Join transactions on individual systems into a larger transaction that spans the systems.</li>
	<li><strong>Two-Phase Commit:</strong> A <em>consensus</em> protocol for whether to complete or abort the distributed transaction:<br />
1. <em>Commit Request Phase:</em> Ask all participants to prepare to commit and <em>vote</em> whether or not to proceed.<br />
2. <em>Commit Phase:</em> Complete the commit <em>if all</em> participants vote yes, otherwise abort.</li>
</ul>
</div>
<div class="slide">
<h1>What Happens at Enormous Scales?</h1>
<p>Imagine you&#8217;re Amazon. You have thousands (millions?) of customers shopping at your site every day. You are saving information about searches, products viewed, products put in wish lists, orders placed, credit cards charged, etc.</p>
<p>Massive sharding and replication don&#8217;t eliminate new phenomena that happen at large scales&#8230;</p>
</div>
<div class="slide">
<h1><span class="caps">CAP</span></h1>
<p>Eric Brewer (Professor at the University of California, Berkeley and the cofounder and chief scientist at Inktomi) conjectured in 2000 that you can&#8217;t satisfy all three of the following properties at once in World-scale systems.</p>
<ul>
	<li><strong>C</strong> &#8211; Consistency: To a client, an operation occurs all at once (Note: this is really <em>Atomicity</em> in <span class="caps">ACID</span>).</li>
	<li><strong>A</strong> &#8211; Availability: Every operation completes to an expected result.</li>
	<li><strong>P</strong> &#8211; Partition Tolerance: Operations will complete, even if some system components are unavailable (&#8220;partitioned&#8221; from the others).</li>
</ul>
</div>
<div class="slide">
<h1><span class="caps">CAP</span> (cont.)</h1>
<p>In <a href="http://nosqlsummer.org/paper/cap-theorem">The <span class="caps">CAP</span> Theorem</a>, Seth Gilbert and Nancy Lynch elaborate on <span class="caps">CAP</span>, providing a proof of it, and offering real-world solutions.</p>
<p>They point out:</p>
<ul>
	<li>Consistency: Distributed operations in a transaction appear as if they are on one node.</li>
	<li>Availability: A weak form of availability is implied; there is no explicit limit on how long a transaction will take to complete and return a result!</li>
	<li>Partition Tolerance: No set of failures less than total network failure is allowed to cause the system to respond incorrectly.</li>
</ul>
</div>
<div class="slide">
<h1><span class="caps">CAP</span>: Pick Two</h1>
<p>Brewer observed that you can pick two of the three: CA, AP, or CP.</p>
<p>(Section 3.2 of Gilbert and Lynch discuss these combinations.)</p>
</div>
<div class="slide">
<h1>Consistency (Atomicity) and Availability</h1>
<p>&#8230; but not Partition Tolerance.</p>
<p>E.g., distributed systems in a &#8220;reliable&#8221; <span class="caps">LAN</span>.</p>
<ul>
	<li>Atomicity is provided by distributed transactions and 2-phase commit.</li>
	<li>Availability is ensured by system reliability.</li>
	<li>But if a partition forms (e.g., a node goes down), atomicity and availability are not guaranteed.
	<ul>
		<li>I.e., these systems are usually designed with the assumption of no partitions and guaranteed atomicity, so they will appear unavailable when a partition forms.</li>
	</ul></li>
</ul>
</div>
<div class="slide">
<h1>Availability and Partition Tolerance</h1>
<p>&#8230; but not Consistency (Atomicity)</p>
<p>E.g., Google, Amazon, &#8230;</p>
<ul>
	<li>Systems remain available, even when someone cuts a trans-ocean data cable&#8230;</li>
	<li>However, the data seen on either side of the cut might be different.</li>
	<li>Data caches can exhibit this property. You&#8217;re local cache of search results might be slightly stale, but returning a result quickly is more important than taking longer to return a more accurate result.</li>
</ul>
</div>
<div class="slide">
<h1>Consistency (Atomicity) and Partition Tolerance</h1>
<p>&#8230; but not Availability. Useful when it&#8217;s better to never allow stale data, even if it means that no service is available at all.</p>
<p>E.g., a distributed <span class="caps">DBMS</span> in a <span class="caps">LAN</span>, using distributed locking.</p>
<ul>
	<li>There are rarely partitions, so it&#8217;s usually &#8220;tolerant&#8221;.</li>
	<li>Atomicity is provided by the <span class="caps">DBMS</span> and distributed transaction framework.</li>
	<li>But if a partition occurs (e.g., node crash), it might become unavailability, but it never returns inconsistent data.</li>
</ul>
</div>
<div class="slide">
<h1>Distributed Data and Latency</h1>
<p>Users expect fast responses (low latency), but the speed of light can&#8217;t be increased. (It takes about 19ms for light to travel from New York to London) Also, to be globally available requires distribution of services for fault tolerance.</p>
</div>
<div class="slide">
<h1>Distributed Data and Latency (cont.)</h1>
<p>To meet these goals, your architecture has to tolerate high latency (<a href="http://www.infoq.com/articles/pritchett-latency">Dan Pritchett</a>). A couple of techniques help.</p>
<ul>
	<li>Moving data and computing resources close to customers.
	<ul>
		<li>Lowers the round-trip time</li>
	</ul></li>
	<li>Doing as much calculation asynchronously as possible.
	<ul>
		<li>E.g., google indexes the web asynchronously, so searches use precomputed data and are &#8220;instantaneous&#8221;.</li>
	</ul></li>
</ul>
<p><img src="images/google-search.png"><img></p>
</div>
<div class="slide">
<h1>Distributed Data and Latency (cont.)</h1>
<p>Suppose you scale by partitioning your data. You would like to maintain <span class="caps">ACID</span> compliant transactions across the data partitions. The traditional approach is to rely upon distributed transactions and two-phase commit.</p>
</div>
<div class="slide">
<h1>The Problem with Distributed Transactions</h1>
<p>But distributed transactions create <em>synchronous</em> couplings across the databases, which can increase latency substantially</p>
<p>When partitions are present, the transaction may never complete successfully!</p>
</div>
<div class="slide">
<h1>The alternative to <span class="caps">ACID</span> is <span class="caps">BASE</span>:</h1>
<ul>
	<li><b>B</b>asically <b>A</b>vailable</li>
	<li><b>S</b>oft state</li>
	<li><b>E</b>ventually consistent</li>
</ul>
<p>(A contrived acronym, like <span class="caps">ACID</span>.)</p>
<p>When availability is the top priority, then try to always provide some level of service, don&#8217;t insist on absolutely consistent state (i.e., tolerate some stale data), and expect the system to become consistent, <em>eventually</em>.</p>
<p>There&#8217;s a spectrum between <span class="caps">ACID</span> and <span class="caps">BASE</span> for <em>each part</em> of the system.</p>
</div>
<div class="slide">
<h1><span class="caps">ACID</span> vs <span class="caps">BASE</span></h1>
<p>To be clear, <span class="caps">BASE</span> is a <strong>compromise</strong>.</p>
<p>Everyone would prefer to always have <span class="caps">ACID</span> compliance, but they are willing to accept <span class="caps">BASE</span> when <span class="caps">ACID</span> can&#8217;t be met.</p>
</div>
<div class="slide">
<h1>Some Techniques We&#8217;ll Discuss</h1>
<ul>
	<li>Replication</li>
	<li><strong>Schema-less Design</strong></li>
	<li>MapReduce</li>
</ul>
</div>
<div class="slide">
<h1>Do We Need an <span class="caps">RDBMS</span>?</h1>
<p>The issues of scaling, <span class="caps">CAP</span> and <span class="caps">BASE</span> vs. <span class="caps">ACID</span> that we have just discussed apply equally to traditional <span class="caps">RDBMS</span>, as well as to newer persistence technologies.</p>
</div>
<div class="slide">
<h1>Do We Need an <span class="caps">RDBMS</span>?</h1>
<ul>
	<li>Amazon, Google, eBay, Yahoo!, and other large-scale Internet companies have found that the cost of scaling traditional <span class="caps">RDBMS</span> is high and not always &#8220;worth it&#8221;.</li>
	<li>Social networking sites like Twitter and Facebook have enormous <em>graphs</em> of social relationships to manage.</li>
	<li>If data is easily sharded, because the shards have no references spanning them, then is the relational model essential?</li>
	<li>If <span class="caps">ACID</span> isn&#8217;t essential for all operations, are there lighter-weight persistence alternatives?</li>
</ul>
</div>
<div class="slide">
<h1>&#8220;NoSQL&#8221;</h1>
<p><em>Not <span class="caps">SQL</span></em> or <em>Not Only <span class="caps">SQL</span></em></p>
<ul>
	<li>If you have a graph of data, use a <em>graph</em> database.</li>
	<li>If you need great flexibility in the data format, use an &#8220;informal&#8221;, easily-changed schema, use a <em>document-oriented</em> or <em>column oriented</em> database.</li>
	<li>If an eventually-consistent, highly-scalable database is needed, consider &#8230; several options</li>
</ul>
</div>
<div class="slide">
<h1>Categories of &#8220;NoSQL&#8221; Databases</h1>
<ul>
	<li>Column Oriented (vs. the row orientation of <span class="caps">RDBMS</span>)</li>
	<li>Document Oriented</li>
	<li>Key-Value/Tuple Stores</li>
	<li>Eventually Consistent Key-Value Stores</li>
	<li>Graph Databases</li>
	<li>Grid Databases</li>
</ul>
<p>(Compare with <a href="http://nosql-database.org/">NoSQL-Database.org</a>)</p>
</div>
<div class="slide">
<h1>Column Oriented</h1>
<p>E.g., <em>Cassandra, Hadoop/HBase, Hypertable</em></p>
<p><strong>Column-oriented</strong> storage is often better for <span class="caps">OLAP</span> (OnLine Analytical Processing), e.g., Data analytics using Data Warehouses.</p>
<p><strong>Row-oriented</strong> storage if often better for <span class="caps">OLTP</span> (OnLine Transaction Processing), e.g., typical &#8220;live&#8221; transactions.</p>
</div>
<div class="slide">
<h1>Column Oriented (cont.)</h1>
<p><strong>Column-oriented</strong> storage is often better for&#8230;</p>
<ul>
	<li>optimizing space (compression) for very different-sized values in the same column (e.g., binary data).</li>
	<li>optimizing disk access for small subsets of all columns.</li>
	<li>Adding and removing columns frequently.</li>
</ul>
<p>Many of the largest NoSQL database instances are column databases.</p>
</div>
<div class="slide">
<h1>Document Oriented</h1>
<p>E.g., <em>MongoDB, CouchDB, Terrastore</em></p>
<p>Stores <em>documents</em>, usually in the form of <span class="caps">JSON</span> (JavaScript Object Notation), <span class="caps">YAML</span> (Yet Another Markup Language), or <span class="caps">XML</span> (eXtensible Markup Language).</p>
<ul>
	<li><strong>Schemaless:</strong> No fixed schema, <em>semistructured</em> data.
	<ul>
		<li>Contrast with <span class="caps">RDBMS</span>.</li>
		<li>But the document must be &#8220;well formed&#8221; (valid <span class="caps">JSON</span>, <span class="caps">YAML</span>, or <span class="caps">XML</span>).</li>
	</ul></li>
	<li>Often lightweight, so performance is often very good.
	<ul>
		<li>(We&#8217;ll explore this topic more next week.)</li>
	</ul></li>
</ul>
</div>
<div class="slide">
<h1>Document Oriented (cont.)</h1>
<ul>
	<li>Often support a query capability or language (even tough they&#8217;re <em>schemaless</em>).</li>
	<li>Often support a <em>MapReduce</em> capability.</li>
	<li>Excellent for medium-sized datasets with rapidly-evolving &#8220;schema&#8221;.</li>
</ul>
</div>
<div class="slide">
<h1>Digression: Why the Term &#8220;Document&#8221;?</h1>
<ul>
	<li><span class="caps">XML</span> (and <span class="caps">HTML</span>) are simplified derivatives of <span class="caps">SGML</span> (Standard Generalized Markup Language).
	<ul>
		<li>Long-time standard in the publishing industry.</li>
		<li><strong>Markup</strong> is the term for editing and arranging content for publication.</li>
	</ul></li>
</ul>
<p>Hence, we store <span class="caps">JSON</span> <em>documents</em> in MongoDB and CouchDB, etc.</p>
<p>Similarly, we store <span class="caps">YAML</span> or <span class="caps">XML</span> in documents tailored to them.</p>
</div>
<div class="slide">
<h1>Key-Value Stores</h1>
<p>E.g., <em>Amazon SimpleDB, Riak, Redis, Tokyo Cabinet, Scalaris, MemcacheDB, BerkeleyDB, MNesia.</em></p>
<p>Think of hash maps on <em>steroids</em>.</p>
<ul>
	<li>May be purely in-memory (with optional flushing to disk) and resident on one machine.</li>
	<li>Excellent for &#8220;persisting&#8221; semi-structured data with shorter lifespans (e.g., web sessions).</li>
	<li>Used when durability and consistency are lower priorities compared to speed.</li>
</ul>
</div>
<div class="slide">
<h1>Eventually Consistent Key-Value Stores</h1>
<p>E.g., <em>Amazon Dynamo, Dynomite, Voldemort</em></p>
<p>More emphasis on longer-lived objects that need to be persisted, but for which rapid retrieval is still important.</p>
<ul>
	<li>Transparent replication of data.</li>
	<li>Transparent clustering of nodes.</li>
	<li>Great for fault tolerance, especially for &#8220;active sessions&#8221;.</li>
</ul>
</div>
<div class="slide">
<h1>Graph Databases</h1>
<p>E.g., <em>Neo4J, Flock</em></p>
<p>Built in semantics for representing graphs, including cycles.</p>
<ul>
	<li>First-class support for nodes, edges, and properties to associate information with nodes and edges.</li>
	<li>Good when lots of expensive joins would be required in a <span class="caps">RDBMS</span>.</li>
	<li>Handle evolving schema easily.</li>
</ul>
</div>
<div class="slide">
<h1>Grid Databases</h1>
<p>E.g., <em>GridGain, HazelCast, Coherence</em></p>
<p>Less like a database in the usual sense and more of a virtualized space where data is transparently resident on more than one server/service.</p>
</div>
<div class="slide">
<h1>&#8220;Polyglot Persistence&#8221;</h1>
<p>A big trend today is that non-trivial systems mix different programming languages, libraries and tools. Do we use just one language to write all parts of a standard web application? No.<sup class="footnote" id="fnr1"><a href="#fn1">1</a></sup></p>
<p>The same phenomenon is now happening at the persistence level. Often, one persistence strategy doesn&#8217;t fit all needs in complex, distributed systems. You might use a fast, key-value store for user sessions, then persist key &#8220;events&#8221; to an <span class="caps">RDBMS</span>, for example.</p>
<p><sup class="footnote" id="fnr1"><a href="#fn1">1</a></sup> Well, maybe we could with JavaScript&#8230;</p>
</div>
<div class="slide">
<h1>Some Techniques We&#8217;ll Discuss</h1>
<ul>
	<li>Replication</li>
	<li>Schema-less Design</li>
	<li><strong>MapReduce</strong></li>
</ul>
<p>We&#8217;ll discuss MapReduce in a few weeks&#8230;</p>
</div>
<div class="slide">
<h1>Reading Assignment: <span class="caps">CAP</span> and <span class="caps">BASE</span></h1>
<ul>
	<li>Julian Brown, <a href="http://www.julianbrowne.com/article/viewer/brewers-cap-theorem">Brewer&#8217;s <span class="caps">CAP</span> Theorem: The Kool Aid Amazon and eBay Have Been Drinking</a>. Sometimes amusing discussion of Brewer&#8217;s theorem. (We&#8217;ll read Brewer&#8217;s original presentation &#8211; a conference keynote &#8211; in a later assignment.)</li>
	<li>Dan Pritchett, <a href="http://queue.acm.org/detail.cfm?id=1394128"><span class="caps">BASE</span>: An Acid Alternative</a>. Excellent discussion of the limitations of <span class="caps">ACID</span> for large-scale, distributed systems, and the alternative, <span class="caps">BASE</span>. Provides specific examples of techniques for relaxing consistency.</li>
</ul>
<p>Also useful, but not required:</p>
<ul>
	<li>Coda Hale, <a href="http://codahale.com/you-cant-sacrifice-partition-tolerance/">You Can&#8217;t Sacrifice Partition Tolerance</a>. A good discussion of <span class="caps">CAP</span> that clears up some common misunderstandings. Also mentions Brewer&#8217;s other work on the concepts of <em>yield</em> and <em>harvest</em>.</li>
</ul>
</div>
<div class="slide">
<h1>Reading Assignment:</h1>
<p>Read the discussion on MongoDB <em>Replication</em> and <em>Sharding</em> (links on subsequent slides). MongoDB&#8217;s implementations are representative examples of these general techniques and the reading will also help you get more familiar with MongoDB, which we&#8217;ll discuss in depth next week.</p>
<p>Focus instead on the concepts discussed. The particular syntax details of MongoDB commands and the details of which techniques to use with particular versions of MongoDB, etc. aren&#8217;t important.</p>
</div>
<div class="slide">
<h1>Reading Assignment: Replication</h1>
<p><a href="http://www.mongodb.org/display/DOCS/Replication">mongodb.org/display/<span class="caps">DOCS</span>/Replication</a></p>
<p>Follow the link in the section <em>Verifying propagation of writes with getlasterror</em>.  What&#8217;s important here is why this is an issue &#8211; why would a client care if propagation happens immediately or not?</p>
<p>View the video or read the slides describing MongoDB&#8217;s new approach to replication, called <em>replica sets</em>.</p>
<ul>
	<li><a href="http://lacantine.ubicast.eu/videos/21-06-2010-130932-partie-6/">Video</a></li>
	<li><a href="http://www.slideshare.net/mongodb/mongodb-replica-sets">Slides</a></li>
</ul>
<p>(Yes, it appears that something is wrong with the last 5 or so slides, but the &#8220;good&#8221; slides have the content I care about&#8230;)</p>
</div>
<div class="slide">
<h1>Reading Assignment: Sharding</h1>
<p><a href="http://www.mongodb.org/display/DOCS/Sharding+Introduction">mongodb.org/display/<span class="caps">DOCS</span>/Sharding+Introduction</a></p>
<p>Make sure you understand the different goals of replication and sharding and how they also complement each other. Also, when combined, as discussed on the Sharding page, are there any <em>single points of failure</em>?</p>
</div>
<div class="slide">
<h1>Exercise</h1>
<p>Complete exercise2, which was assigned last week. It is due by the start of the next class, September 28.</p>
</div>
<div class="title slide">
<h1>Lecture 5: Scaling Data, Part II</h1>
<p>Today and next week we&#8217;ll discuss some NoSQL databases in depth.</p>
</div>
<div class="slide">
<h1>MongoDB and CouchDB</h1>
<ul>
	<li>MongoDB: <a href="http://mongodb.org">mongodb.org</a></li>
	<li>CouchDB: <a href="http://couchdb.apache.org">couchdb.apache.org</a></li>
</ul>
<p>Both are document oriented, use <span class="caps">JSON</span>, are schemaless, and support JavaScript for programming many database operations. But they are very different in other ways, a reflection of their different goals.</p>
</div>
<div class="slide">
<h1>CouchDB Architecture</h1>
<p>Internal architecture.</p>
<p><img src="images/CouchDB-architecture-sketch.png"><img><br />
<br />
(source: <a href="http://couchdb.apache.org/">couchdb.apache.org</a>)</div>
<div class="slide">
<h1>MongoDB Architecture</h1>
<p>Simpler internal architecture. Lots of small services, as shown here:</p>
<p><img src="images/mongodb_sharding_replica_sets.png"><img><br />
<br />
(source: <a href="http://mongodb.org/">mongodb.org</a>)</div>
<div class="slide">
<h1>Differences Between MongoDB and CouchDB</h1>
<ul>
	<li>Persistence Strategy</li>
	<li>Scalability</li>
	<li>Queries</li>
	<li>MapReduce</li>
	<li>Transactions</li>
	<li>&#8220;Driver&#8221; APIs</li>
	<li>Ideal Applications</li>
</ul>
<p>(Some of these points adapted from <a href="http://www.mongodb.org/display/DOCS/Comparing+Mongo+DB+and+Couch+DB">Comparing Mongo DB and Couch DB</a>)</p>
</div>
<div class="slide">
<h1>Persistence Strategy</h1>
<p><em>CouchDB uses <strong><span class="caps">MVCC</span></strong>, while MongoDB uses <strong>update in place</strong>.</em></p>
<p>Recall that <span class="caps">MVCC</span> is <em>multiversion concurrency control</em>. We discussed it when talking about <em>software transactional memory</em> (<span class="caps">STM</span>). In <span class="caps">MVCC</span> a new version of the document is created with the desired changes. The previous versions are still available, until they are specifically deleted (or <em>compacted</em> into fewer versions).</p>
<p>Update in place just means that we insert changes directly into the existing document&#8217;s record, so previous values are overwritten.</p>
</div>
<div class="slide">
<h1>Advantages of <span class="caps">MVCC</span></h1>
<p>Better for <strong>durability</strong>. <em>Append-only log files</em> are a database industry standard for durable transactions. CouchDB uses an append-only BTree on disk, so updates are durable (if the files survive&#8230;). If CouchDB crashes, you just restart and go. (BTrees are N-ary sorted trees that are optimal for relatively slow read operations, like disk and file access.)</p>
<p>If conflicting updates happen, <em>both</em> of them are saved.</p>
<p><span class="caps">MVCC</span> is very good for syncing master-master database configurations. For example, you can create a copy of the database, take it offline and work on it, then sync it to the other copies when back online again. CouchDB has bi-directional replication.</p>
<p><strong>Note:</strong> distributed version control systems like <em>git</em> work the same way.</p>
</div>
<div class="slide">
<h1>Disadvantages of <span class="caps">MVCC</span></h1>
<p>Making copies of documents is slower, consumes more space over time. Compaction is required occasionally.</p>
<p>Update conflicts must be resolved manually (although now update is &#8220;lost&#8221; and CouchDB deterministically picks a default &#8220;winner&#8221;).</p>
</div>
<div class="slide">
<h1>Advantages of Update in Place</h1>
<p>Faster write performance, especially for updates. Since the document isn&#8217;t copied, updates are faster. However, this statement ignores disk seek time for finding those records. An append-only file on a disk with no other read/write operations will have minimal seek time, thereby boosting performance. (This is  a case where real-world performance will have to be determined by measurement.)</p>
<p>Compaction isn&#8217;t needed to remove unneeded copies of documents, since multiple versions aren&#8217;t created.</p>
<p>Better for Master-Slave configurations with failover.</p>
</div>
<div class="slide">
<h1>Disadvantages of Update in Place</h1>
<p>If conflicting updates occur, only the last one survives. Transactions are more important to avoid collisions without the recovery option that <span class="caps">MVCC</span> provides (e.g., picking a previous version or merging results some how).</p>
<p>If MongoDB crashes, you will probably need to repair the database, prolonging the recovery and restoration of normal service. This is one reason why MongoDB recommends replicated database instances, so service is not interrupted. However, once the crashed instances are running again, you&#8217;ll need to resync them, to get the most recent transactions pushed to the newly-recovered instance.</p>
</div>
<div class="slide">
<h1>Disadvantages of Update in Place (cont.)</h1>
<p><em>CouchDB is much more durable for single database instances, but most production systems should have replication anyway.</em></p>
</div>
<div class="slide">
<h1>Other Notes on Durability</h1>
<p>To maximize write performance, MongoDB uses memory-mapped files that are persisted to disk every 60 seconds, by default (using <em>fsync</em>). This also means that concurrent reads can see stale data, even after an <span class="caps">API</span> call for writing returns. Synchronous disk writes are possible, but they impede performance.</p>
<p>CouchDB can also do &#8220;delayed commits&#8221;, i.e., write operations return immediately, but the actual fsync occurs every second, by default. However, they recommend not doing delayed commits, trading some some performance for better durability.</p>
<p>(see also <a href="http://www.mikealrogers.com/2010/07/mongodb-performance-durability/">MongoDB Performance and Durability</a>)</p>
</div>
<div class="slide">
<h1>Other Notes on Durability (cont.)</h1>
<p><strong>Note:</strong> High end servers often have battery-backed <span class="caps">RAID</span> controllers, where the fsync appears to complete faster, but the <span class="caps">RAID</span> delays commits (often using sophisticated algorithms to sequence reads and writes in order to minimize disk head seeks). You get the best of both worlds, fast fsync plus durability ensured by battery backup.</p>
<p><strong>Moral:</strong> You have to understand your full system and measure what you want to optimize.</p>
</div>
<div class="slide">
<h1>Scalability</h1>
<p>CouchDB uses replication to scale, where different instances can work on different parts of the data. However, that approach is limited when the database becomes huge. There are some third party sharding/partitioning approaches, the leader of which is <a href="http://github.com/cloudant/bigcouch">BigCouch</a>, which provides transparent clustering, fault-tolerance, and high availability. (Cloudant provides professional services for CouchDB installations.)</p>
<p>MongoDB uses replication for durability and availability and sharding for scalability. (Discussed in last week&#8217;s reading assignment.)</p>
</div>
<div class="slide">
<h1>Durability, Replication, and Consistency</h1>
<p>When replicating CouchDB instances, you get <em>eventual consistency</em>. Note that if one replica is offline, consistency can&#8217;t happen until it comes online again.</p>
<p>Some NoSQL systems, like Cassandra, let you define that a write operation is complete when M of N replicas have received the write.</p>
</div>
<div class="slide">
<h1>Queries</h1>
<p>MongoDB provides a full-featured, <em>ad hoc</em> query capability using JavaScript as the query language. You can do almost any kind of query that you can do with <span class="caps">SQL</span> in a <span class="caps">SQL</span> database. For some cases, the built-in MapReduce framework has to be used. (We&#8217;ll cover that in a few weeks.)</p>
<p>CouchDB does not provide an <em>ad hoc</em> query mechanism. Instead, it emphasizes creating views onto the data. You design your database with specific indexing and MapReduce operations that execute incremental when updates are made. These views efficiently expose the data you want, formatted the way you want it.</p>
</div>
<div class="slide">
<h1>MapReduce</h1>
<p>Both systems support <em>MapReduce</em>. CouchDB requires writing MapReduce functions to construct the views. MongoDB provides MapReduce for optimizing some computations, but the query language doesn&#8217;t require MapReduce functions.</p>
</div>
<div class="slide">
<h1>Transactions</h1>
<p>Neither database supports the full transaction capabilities typically found in RDBMSs. They do this to keep the systems lighter and faster.</p>
<p>Instead, MongoDB offers several <a href="http://www.mongodb.org/display/DOCS/Atomic+Operations">atomic operations</a> for <em>single</em> documents (i.e., rows, in <span class="caps">RDBMS</span> terminology).</p>
<p>Similarly, CouchDB also supports document-level transactions through <span class="caps">MVCC</span>, providing optimistic updates, but records when a collision occurs, recording <em>both</em> updates, and using a deterministic algorithm to pick the &#8220;winner&#8221;. Normally, though, the application should decide how to resolve the collision.</p>
</div>
<div class="slide">
<h1>&#8220;Driver&#8221; APIs: CouchDB</h1>
<p>While there are language drivers for CouchDB, the primary way to interact with a CouchDB database is through a <span class="caps">REST</span> <span class="caps">API</span>. This is particularly useful for building two-tier applications, with a web (presentation) tier that communicates with the persistence tier over <span class="caps">REST</span>. All business logic is implemented as part of the database view design described above.</p>
<p>This model is very convenient for smaller applications. Larger applications typically use 3 or more tiers.</p>
</div>
<div class="slide">
<h1>&#8220;Driver&#8221; APIs: MongoDB</h1>
<p>For performance reasons, MongoDB is accessed primarily through language drivers for C++, Java, Ruby, etc. These drivers talk a proprietary binary protocol. There is also a limited <span class="caps">REST</span> <span class="caps">API</span> available. The driver approach is more traditional for n-tier applications, but it is less convenient for applications where web pages want to access a MongoDB database directly (over <span class="caps">HTTP</span>).</p>
</div>
<div class="slide">
<h1>Ideal Applications</h1>
<p>So, while superficially similar, they are very different in important ways, which affects the kinds of applications for which each is ideal.</p>
</div>
<div class="slide">
<h1>Ideal Applications: CouchDB</h1>
<p>CouchDB is ideal for:</p>
<ul>
	<li>Productivity applications with built in databases, where offline work is common, with subsequent synching to the &#8220;master&#8221;. Think email, calendaring, &#8220;<span class="caps">TODO</span>&#8221; and similar apps.</li>
	<li>Persistence with easy replication is more important that update throughput.</li>
	<li>Easy integration with web front ends, through <span class="caps">REST</span>.</li>
	<li>Many apps that Ruby on Rails is currently used to implement.</li>
</ul>
</div>
<div class="slide">
<h1>Ideal Applications: MongoDB</h1>
<p>MongoDB is ideal for:</p>
<ul>
	<li>Applications with high-volume writes/updates, especially if some write losses are tolerable (e.g., sensor networks).</li>
	<li>System &#8220;logs&#8221; (especially with <a href="http://www.mongodb.org/display/DOCS/Capped+Collections">capped collections</a>).</li>
	<li>Applications requiring ad hoc query support.</li>
	<li>Applications requiring fast language-specific drivers.</li>
</ul>
</div>
<div class="slide">
<h1>Conclusions: MongoDB vs. CouchDB</h1>
<p>MongoDB is philosophically more like a traditional <span class="caps">RDBMS</span>, and you use it in much the same way.</p>
<p>CouchDB is more like an application platform for two-tier applications that require persistence, with solid, easy replication.</p>
<p><em>JavaScript from the database to the browser is becoming a compelling application development approach.</em></p>
</div>
<div class="slide">
<h1>Key-Value Stores</h1>
<p>E.g., <em>Amazon SimpleDB, Riak, Redis, Tokyo Cabinet, Scalaris, MemcacheDB, BerkeleyDB, Mnesia.</em></p>
<p>Think of hash maps on <em>steroids</em>.</p>
<ul>
	<li>May be purely in-memory (with optional flushing to disk) and resident on one machine.</li>
	<li>Excellent for &#8220;persisting&#8221; semi-structured data with shorter lifespans (e.g., web sessions).</li>
	<li>Used when durability and consistency are lower priorities compared to speed.</li>
</ul>
</div>
<div class="slide">
<h1>Eventually Consistent Key-Value Stores</h1>
<p>E.g., <em>Amazon Dynamo, Dynomite, Voldemort</em></p>
<p>More emphasis on longer-lived objects that need to be persisted, but for which rapid retrieval is still important.</p>
<ul>
	<li>Transparent replication of data.</li>
	<li>Transparent clustering of nodes.</li>
	<li>Great for fault tolerance, especially for &#8220;active sessions&#8221;.</li>
</ul>
<p>Your homework reading will include a paper on Dynamo.</p>
</div>
<div class="slide">
<h1>Are Key-Value Stores Really Databases?</h1>
<p><a href="http://memcached.org/">Memcached</a> has been around a while. It&#8217;s a popular in-memory, distributed cache. It&#8217;s great for caching database queries in memory, for faster repeat retrieval, storing user sessions between page views in a web application, etc.</p>
<p>The definition of &#8220;database&#8221; has expanded in recent years, so now we think of a key-value store, like memcached, as a datastore, <em>if</em> it is backed by some sort of durability.</p>
<p><a href="http://memcachedb.org/">MemcacheDB</a> is built on top of Memcached to provide this durability. It uses another, fairly old, open-source NoSQL store, <a href="http://www.oracle.com/technetwork/database/berkeleydb/index.html">BerkeleyDB</a> to provide persistence.</p>
</div>
<div class="slide">
<h1>MemcacheDB</h1>
<p>It&#8217;s <span class="caps">API</span> is compliant with the Memcache protocol:</p>
<ul>
	<li>get(also multiple get)</li>
	<li>set, add, replace</li>
	<li>append/prepend</li>
	<li>incr, decr</li>
	<li>delete</li>
	<li>stats</li>
</ul>
<p>Very simple! If all you need is key-based storage and retrieval of &#8220;blobs&#8221;, then a key-value store like this can be ideal.</p>
</div>
<div class="slide">
<h1>Redis</h1>
<p><a href="http://code.google.com/p/redis/">Redis</a> provides data-structure aware storage. Not just key-values (e.g., a map or hash), where values are &#8220;blobs&#8221;, but also <span class="caps">API</span> calls specifically for working with strings, lists, sets, and sorted sets.</p>
</div>
<div class="slide">
<h1>Redis</h1>
<p>Other features:</p>
<ul>
	<li>Many language bindings.</li>
	<li>Very high speed.</li>
	<li>Integrated into Akka (for durable persistent data structures).</li>
	<li>Limited support for fault tolerance and clustering.</li>
</ul>
<p>So, useful for the same sorts of tasks MemcacheDB would be used for, plus cases where awareness of the additional data structures is useful.</p>
</div>
<div class="slide">
<h1>Key-Value Store: General Considerations</h1>
<ul>
	<li>How often is data synced to disk?</li>
	<li>How is data replicated to other nodes (for distributed stores)?</li>
	<li>How is fault tolerance supported?</li>
</ul>
</div>
<div class="slide">
<h1>Reading Assignment: CouchDB</h1>
<p>Read <a href="http://guide.couchdb.org/editions/1/en/why.html">Chapter 1</a> of <em>CouchDB, The Definitive Guide</em>, which describes the philosophy behind CouchDB, the kinds of applications it is suitable for, etc.</p>
</div>
<div class="slide">
<h1>Reading Assignment: MongoDB</h1>
<p>Read the MongoDB pages on <a href="http://www.mongodb.org/display/DOCS/Querying">queries</a> and <a href="http://www.mongodb.org/display/DOCS/Advanced+Queries">advanced queries</a>. We&#8217;ll use them in today&#8217;s exercise (discussed below).</p>
</div>
<div class="slide">
<h1>Reading Assignment: Amazon Dynamo</h1>
<p>Giuseppe DeCandia, Deniz Hastorun, Madan Jampani, Gunavardhan Kakulapati, Avinash Lakshman, Alex Pilchin, Swaminathan Sivasubramanian, Peter Vosshall and Werner Vogels, <a href="http://www.allthingsdistributed.com/2007/10/amazons_dynamo.html">Dynamo: Amazon’s Highly Available Key-value Store</a></p>
</div>
<div class="slide">
<h1>Reading Assignment: Cassandra</h1>
<p>Avinash Lakshman and Prashant Malik, <a href="http://www.cs.cornell.edu/projects/ladis2009/papers/lakshman-ladis2009.pdf">Cassandra — A Decentralized Structured Storage System</a></p>
</div>
<div class="slide">
<h1>Exercise: Mongo Queries</h1>
<p>This week, since I&#8217;ve given you longer reading assignments, I&#8217;ll give you a shorter exercise ;) We&#8217;ll use the mongo console to query the stock data. We&#8217;ll return to the web application next week, when we&#8217;ll incorporate some of this work in the application.</p>
<p>Start <code>mongodb</code> and <code>mongo</code> in separate command windows, as you&#8217;ve done before. On the next page is an example <code>mongo</code> session. They show the <code>&gt;</code> mongo prompt and the resulting output on my database instance. (Some of your results may be slightly different.)</p>
</div>
<div class="slide">
<h1>Exercise: Mongo Queries (cont.)</h1>
<p>Getting general help and help on database-level commands.</p>
<div class="code-small">
<pre name="code" id="code" class="brush: plain,;">

&gt; help()
	  db.help()                    help on db methods
	  db.mycoll.help()             help on collection methods
	  rs.help()                    help on replica set methods
		...
&gt; db.help()
DB methods:
	  db.addUser(username, password[, readOnly=false])
	  db.auth(username, password)
	  db.cloneDatabase(fromhost)
	  db.commandHelp(name) returns the help for the command
	  db.copyDatabase(fromdb, todb, fromhost)
	  db.createCollection(name, { size : ..., capped : ..., max : ... } )
		...
</pre></div>
<p></p>
</div>
<div class="slide">
<h1>Exercise: Mongo Queries (cont.)</h1>
<p>Getting collection-level commands.</p>
<div class="code-small">
<pre name="code" id="code" class="brush: plain,;">

&gt; db.foo.help()
DBCollection help
	  db.foo.find().help() - show DBCursor help
	  db.foo.count()
	  db.foo.dataSize()
	  db.foo.distinct( key ) - eg. db.foo.distinct( 'x' )
	  db.foo.drop() drop the collection
	  db.foo.dropIndex(name)
	  ...
</pre></div>
<p><strong>Note:</strong> <code>foo</code> is just a placeholder. You can use any real collection name instead.</p>
</div>
<div class="slide">
<h1>Exercise: Mongo Queries (cont.)</h1>
<div class="code-small">
<pre name="code" id="code" class="brush: plain,;">

&gt; show dbs
admin
local
stocks_yahoo_NYSE
&gt; use stocks_yahoo_NYSE
switched to db stocks_yahoo_NYSE
&gt; show collections
A_dividends
A_prices
B_dividends
B_prices
C_dividends
C_prices
...
</pre></div>
</div>
<div class="slide">
<h1>Exercise: Mongo Queries (cont.)</h1>
<p>How many documents in a collection? Show me one item:</p>
<div class="code-small">
<pre name="code" id="code" class="brush: plain,;">

&gt; db.A_dividends.count()
8322
&gt; db.A_prices.count()
693733
&gt; db.A_dividends.findOne()
{
    "_id" : ObjectId("4c9f75bbf0c81d093e48b0cc"),
    "date" : "2007-09-26",
    "dividends" : 0.04,
    "stock_symbol" : "ATU",
    "exchange" : "NYSE"
}
...
</pre></div>
</div>
<div class="slide">
<h1>Exercise: Mongo Queries (cont.)</h1>
<div class="code-small">
<pre name="code" id="code" class="brush: plain,;">

&gt; db.A_prices.findOne()
{
    "_id" : ObjectId("4c9f7586f0c81d093e3e1ae7"),
    "close" : 27.13,
    "high" : 27.4,
    "date" : "2008-03-07",
    "stock_symbol" : "ATU",
    "exchange" : "NYSE",
    "volume" : 591000,
    "adj close" : 27.13,
    "low" : 26.18,
    "open" : 26.18
}
...
</pre></div>
</div>
<div class="slide">
<h1>Exercise: Mongo Queries (cont.)</h1>
<p>Find all unique values for a particular field in the collection.</p>
<div class="code-small">
<pre name="code" id="code" class="brush: plain,;">

&gt; db.A_prices.distinct("stock_symbol")          
[
    "AA",
    "AAI",
    "AAP",
    "AAR",
    "AAV",
    "AB",
    "ABA",
    "ABB",
    "ABC",
...
</pre></div>
</div>
<div class="slide">
<h1>Exercise: Mongo Queries (cont.)</h1>
<p>Find all documents matching a specific field value, limited to 5 items.</p>
<div class="code-tiny">
<pre name="code" id="code" class="brush: plain,;">

&gt; db.A_prices.find({stock_symbol: "AA"}).limit(5)
{ "_id" : ObjectId("4c9f75a2f0c81d093e445ce3"), "close" : 36.6, "high" : 37.9, "date" : "2008-03-07", "stock_symbol" : "AA", "exchange" : "NYSE", "volume" : 17752400, "adj close" : 36.6, "low" : 36.13, "open" : 37.01 }
{ "_id" : ObjectId("4c9f75a2f0c81d093e445ce4"), "close" : 38.37, "high" : 39.28, "date" : "2008-03-06", "stock_symbol" : "AA", "exchange" : "NYSE", "volume" : 11279900, "adj close" : 38.37, "low" : 38.26, "open" : 38.85 }
{ "_id" : ObjectId("4c9f75a2f0c81d093e445ce5"), "close" : 38.71, "high" : 39.15, "date" : "2008-03-05", "stock_symbol" : "AA", "exchange" : "NYSE", "volume" : 11754600, "adj close" : 38.71, "low" : 38.1, "open" : 38.25 }
{ "_id" : ObjectId("4c9f75a2f0c81d093e445ce6"), "close" : 38, "high" : 38.94, "date" : "2008-03-04", "stock_symbol" : "AA", "exchange" : "NYSE", "volume" : 15715600, "adj close" : 38, "low" : 37.1, "open" : 37.9 }
{ "_id" : ObjectId("4c9f75a2f0c81d093e445ce7"), "close" : 38.32, "high" : 38.46, "date" : "2008-03-03", "stock_symbol" : "AA", "exchange" : "NYSE", "volume" : 13964700, "adj close" : 38.32, "low" : 37.13, "open" : 37.17 }
...
</pre></div>
</div>
<div class="slide">
<h1>Exercise: Mongo Queries (cont.)</h1>
<p>Find all documents matching a specific field value, sorted by date (both ways), limited to 3 items.</p>
<div class="code-tiny">
<pre name="code" id="code" class="brush: plain,;">

&gt; db.A_prices.find({stock_symbol: "AA"}).sort({date: 1}).limit(3)
{ "_id" : ObjectId("4c9f75a3f0c81d093e448a4b"), "close" : 65.37, "high" : 65.75, "date" : "1962-01-02", "stock_symbol" : "AA", "exchange" : "NYSE", "volume" : 134400, "adj close" : 0.74, "low" : 65.37, "open" : 65.37 }
{ "_id" : ObjectId("4c9f75a3f0c81d093e448a4a"), "close" : 66.37, "high" : 66.37, "date" : "1962-01-03", "stock_symbol" : "AA", "exchange" : "NYSE", "volume" : 179200, "adj close" : 0.75, "low" : 65.25, "open" : 65.37 }
{ "_id" : ObjectId("4c9f75a3f0c81d093e448a49"), "close" : 66.37, "high" : 66.87, "date" : "1962-01-04", "stock_symbol" : "AA", "exchange" : "NYSE", "volume" : 193600, "adj close" : 0.75, "low" : 66.37, "open" : 66.37 }
&gt; db.A_prices.find({stock_symbol: "AA"}).sort({date: -1}).limit(3)
{ "_id" : ObjectId("4c9f75a2f0c81d093e445ce3"), "close" : 36.6, "high" : 37.9, "date" : "2008-03-07", "stock_symbol" : "AA", "exchange" : "NYSE", "volume" : 17752400, "adj close" : 36.6, "low" : 36.13, "open" : 37.01 }
{ "_id" : ObjectId("4c9f75a2f0c81d093e445ce4"), "close" : 38.37, "high" : 39.28, "date" : "2008-03-06", "stock_symbol" : "AA", "exchange" : "NYSE", "volume" : 11279900, "adj close" : 38.37, "low" : 38.26, "open" : 38.85 }
{ "_id" : ObjectId("4c9f75a2f0c81d093e445ce5"), "close" : 38.71, "high" : 39.15, "date" : "2008-03-05", "stock_symbol" : "AA", "exchange" : "NYSE", "volume" : 11754600, "adj close" : 38.71, "low" : 38.1, "open" : 38.25 }
...
</pre></div>
</div>
<div class="slide">
<h1>Exercise: Mongo Queries (cont.)</h1>
<p>Find the historical high and low closing values for AA.</p>
<div class="code-tiny">
<pre name="code" id="code" class="brush: plain,;">

&gt; db.A_prices.find({stock_symbol: "AA"}).sort({close: 1}).limit(1)
{ "_id" : ObjectId("4c9f75a2f0c81d093e446234"), "close" : 18.03, "high" : 18.4, "date" : "2002-10-09", "stock_symbol" : "AA", "exchange" : "NYSE", "volume" : 4345100, "adj close" : 16.04, "low" : 17.81, "open" : 18 }
&gt; db.A_prices.find({stock_symbol: "AA"}).sort({close: -1}).limit(1)
{ "_id" : ObjectId("4c9f75a3f0c81d093e44860f"), "close" : 94.5, "high" : 94.5, "date" : "1966-04-21", "stock_symbol" : "AA", "exchange" : "NYSE", "volume" : 235200, "adj close" : 1.15, "low" : 92.75, "open" : 93.12 }
...
</pre></div>
</div>
<div class="slide">
<h1>Exercise: Mongo Queries (cont.)</h1>
<p>Using logical comparison operations. (There are others&#8230;)</p>
<div class="code-tiny">
<pre name="code" id="code" class="brush: plain,;">

&gt; db.A_prices.find({close: { $lte: 25.0}}).limit(3)
{ "_id" : ObjectId("4c9f7586f0c81d093e3e2126"), "close" : 24.75, "high" : 25.57, "date" : "2001-10-25", "stock_symbol" : "ATU", "exchange" : "NYSE", "volume" : 116400, "adj close" : 6.16, "low" : 24.5, "open" : 25.55 }
{ "_id" : ObjectId("4c9f7586f0c81d093e3e212a"), "close" : 24.8, "high" : 25, "date" : "2001-10-19", "stock_symbol" : "ATU", "exchange" : "NYSE", "volume" : 101200, "adj close" : 6.17, "low" : 24.1, "open" : 24.4 }
{ "_id" : ObjectId("4c9f7586f0c81d093e3e212b"), "close" : 24.15, "high" : 24.99, "date" : "2001-10-18", "stock_symbol" : "ATU", "exchange" : "NYSE", "volume" : 36000, "adj close" : 6.01, "low" : 24.15, "open" : 24.8 }
&gt; db.A_prices.find({close: { $gte: 25.0}}).limit(3)
{ "_id" : ObjectId("4c9f7586f0c81d093e3e1ae7"), "close" : 27.13, "high" : 27.4, "date" : "2008-03-07", "stock_symbol" : "ATU", "exchange" : "NYSE", "volume" : 591000, "adj close" : 27.13, "low" : 26.18, "open" : 26.18 }
{ "_id" : ObjectId("4c9f7586f0c81d093e3e1ae8"), "close" : 27.07, "high" : 27.72, "date" : "2008-03-06", "stock_symbol" : "ATU", "exchange" : "NYSE", "volume" : 679200, "adj close" : 27.07, "low" : 27, "open" : 27.35 }
{ "_id" : ObjectId("4c9f7586f0c81d093e3e1ae9"), "close" : 27.56, "high" : 27.89, "date" : "2008-03-05", "stock_symbol" : "ATU", "exchange" : "NYSE", "volume" : 478500, "adj close" : 27.56, "low" : 27.14, "open" : 27.48 }
...
</pre></div>
</div>
<div class="slide">
<h1>Exercise: Mongo Queries (cont.)</h1>
<p>Using JavaScript expressions in queries.</p>
<div class="code-tiny">
<pre name="code" id="code" class="brush: plain,;">

&gt; db.B_prices.find("this.stock_symbol.length == 2").limit(1)
{ "_id" : ObjectId("4c9f75bcf0c81d093e48ed60"), "close" : 15.39, "high" : 15.92, "date" : "2008-03-07", "stock_symbol" : "BC", "exchange" : "NYSE", "volume" : 1542700, "adj close" : 15.39, "low" : 15.2, "open" : 15.61 }
...
</pre></div>
</div>
<div class="slide">
<h1>Exercise: Mongo Queries (cont.)</h1>
<p>Using regular expressions in queries. Limiting the fields returned.</p>
<div class="code-tiny">
<pre name="code" id="code" class="brush: plain,;">

&gt; db.D_prices.find({stock_symbol: /D.*G$/}).limit(1)
{ "_id" : ObjectId("4c9f7611f0c81d093e5d78ed"), "close" : 12.68, "high" : 12.88, "date" : "2008-03-07", "stock_symbol" : "DHG", "exchange" : "NYSE", "volume" : 194900, "adj close" : 12.68, "low" : 12.55, "open" : 12.69 }
&gt; db.D_prices.find({stock_symbol: /D.*G$/}, {stock_symbol:1, _id:0}).limit(1)
{ "stock_symbol" : "DHG" }
...
</pre></div>
</div>
<div class="slide">
<h1>Exercise: Mongo Queries (cont.)</h1>
<p>Finally, some more involved JavaScript.</p>
<div class="code-tiny">
<pre name="code" id="code" class="brush: plain,;">

&gt; var ds = db.D_prices.distinct("stock_symbol") 
&gt; for (i in ds) { var d = ds[i]; if (d.charAt(d.length-1) == "T") print(d); }
DCT
DDT
DFT
DHT
DKT
DST
DT
DTT
...
</pre></div>
</div>
<div class="slide">
<h1>Exercise: Mongo Queries (cont.)</h1>
<p>Now for the exercises: Email your answers to the following questions by the start of class next week. You can capture the output of your terminal session, if you want. Whatever you do, show me the answer for each question, as well as the query (or queries) you used to get it.</p>
<ul>
	<li>What were the earliest and latest trading dates for the stock with the symbol <code>BAM</code>?</li>
	<li>What were the highest and lowest closing prices for <code>CSC</code> and on what dates did they occur?</li>
	<li>Write a query that returns the first 100 trading days from the A table where the price closed above $100. Limit the fields returned to show just the date, the stock symbol, and the closing price (also suppress the id). Show the results of the query.</li>
</ul>
</div>
<div class="slide">
<h1>Exercise: Mongo Queries (cont.)</h1>
<ul>
	<li>The &#8220;volume&#8221; is the number of shares traded that day. What &#8220;A&#8221; stock had the lowest number of shares traded in a day, <em>other than zero</em>, and what was the date (or dates).</li>
	<li>How many times did &#8220;AA&#8221; pay a dividend?</li>
	<li>How many times did &#8220;AA&#8221; pay a dividend in 2007? What were the dates when those dividends were paid?</li>
	<li>What stock symbols start with &#8220;C&#8221; and end with &#8220;M&#8221;?<br />
</div><br />
<div class="slide"></li>
</ul>
<h1 class="slide0">Lecture 6: Scaling Data, Part <span class="caps">III</span></h1>
<p>We end our tour of new database technologies with a discussion of column-oriented databases and graph databases.</p>
</div>
<div class="slide">
<h1>Cassandra: A Column-Oriented Database</h1>
<p>Design goals:</p>
<ul>
	<li>Reliability through distributed processing, no single point of failure.</li>
	<li>High write throughput.</li>
	<li>Trade <span class="caps">RDBMS</span> features for a simple data model with easy, dynamic control over data layout and format.</li>
</ul>
</div>
<div class="slide">
<h1>Cassandra: Developed at Facebook</h1>
<p>Originally designed for Facebook&#8217;s Inbox Search feature.</p>
<ul>
	<li>Very high write throughput required.</li>
	<li>Replication to geographically-distributed data centers.
	<ul>
		<li>Minimizes search latencies.</li>
	</ul></li>
</ul>
</div>
<div class="slide">
<h1>Cassandra: Inspirations</h1>
<ul>
	<li>Inspired by Amazon&#8217;s Dynamo and Google&#8217;s BigTable.
	<ul>
		<li>But provides better write performance.</li>
	</ul></li>
	<li>Open-source Apache Project.
	<ul>
		<li>But Facebook has maintained its own fork.</li>
	</ul></li>
</ul>
</div>
<div class="slide">
<h1>Cassandra: Columns</h1>
<p><em>Column Oriented</em> means that columns are easy to query for, as well as to add and remove in the &#8220;schema&#8221;. This supports evolution of features.</p>
<p>However, operations are keyed by rows and each row operation is atomic, independent of the number of columns involved.</p>
</div>
<div class="slide">
<h1>Cassandra: Columns</h1>
<ul>
	<li><strong>Column Families:</strong> a group of columns.
	<ul>
		<li><strong>Super Column Family</strong>: a column family within a column family.</li>
	</ul></li>
</ul>
</div>
<div class="slide">
<h1><span class="caps">API</span></h1>
<p>Just 3 methods:</p>
<ul>
	<li>insert(table, key, rowMutation)</li>
	<li>get(table, key, columnName)</li>
	<li>delete(table, key, columnName)</li>
</ul>
<p><em>columnName</em> can refer to a single column, or a column family.</p>
</div>
<div class="slide">
<h1>Distributed System Techniques</h1>
<p>Cassandra uses many distributed system techniques for scaling and availability. We&#8217;ll discuss these:</p>
<ul>
	<li>Partitioning</li>
	<li>Replication</li>
	<li>Membership</li>
	<li>Failure Handling</li>
	<li>Scaling</li>
</ul>
</div>
<div class="slide">
<h1>Partitioning</h1>
<p>Dynamically partition the data over the cluster.</p>
<ul>
	<li>To hard to do this manually.</li>
	<li>Keys are hashed, using consistent hashing.</li>
	<li>The range of possible hash values is treated as a &#8220;ring&#8221; that wraps.</li>
	<li>Each node is assigned a random position on the ring.</li>
</ul>
<p>When a row&#8217;s key is hashed, the node with the closest key <em>greater than</em> the row&#8217;s key is assigned the responsibility for coordinating reads and writes.</p>
</div>
<div class="slide">
<h1>Reads and Writes</h1>
<p>The responsible node decides what replicas should also handle the request.</p>
<ul>
	<li>Reads can be configured to use the value of the nearest replica or a <em>quorum</em> of replica responses.</li>
	<li>Writes are routed to all the designated replicas and the write is only considered complete when a <em>quorum</em> of replicas respond that the write was successful.</li>
</ul>
</div>
<div class="slide">
<h1>Failures and Balancing</h1>
<p>If a node fails or a new one is added, only its immediate neighbor nodes in the ring are affected.</p>
<p>The initial distribution of nodes doesn&#8217;t account for the actual distribution of keys in the data nor the performance of particular nodes. Hence, it can be imbalanced. Cassandra will move nodes on the ring to adjust performance.</p>
</div>
<div class="slide">
<h1>Replication</h1>
<p>Each Cassandra &#8220;instance&#8221; is configured with a <em>replication factor</em> of N, the number of nodes to which each data item is replicated.</p>
<p>When a node is responsible for a row, it stores the row locally and replicates it to N-1 other nodes.</p>
<p>Cassandra can be configured to ensure that each row is replicated across multiple data centers, so every row remains available even in the event of a total failure of a data center.</p>
</div>
<div class="slide">
<h1>Membership</h1>
<p>Membership and health of the nodes is managed through a <em>Gossip</em> protocol called <em>Scuttlebutt</em>. The <em>Phi Accrual Failure Detector</em> module is used by each node to publish its &#8220;suspicions&#8221; about the health of every other node, rather than publishing an &#8220;up&#8221; or &#8220;down&#8221; report that may not be accurate. The suspicion level rises, as concerns about a node rise. At the same time, the probability of error decreases.</p>
<p>This turns out to be a much faster way to detect node failure than other detection schemes.</p>
</div>
<div class="slide">
<h1>Bootstrapping</h1>
<p>When a node starts for the first time, it chooses a random position on the ring, then &#8220;Gossips&#8221; its position to the cluster. This is how all the other nodes know the members of the cluster, for replication, etc.</p>
</div>
<div class="slide">
<h1>Scaling</h1>
<p>A new node can be assigned a key that allows it to offload an overloaded node. The overloaded node then uses kernel-to-kernel copying techniques to move the data it is no longer responsible for to the new node.</p>
</div>
<div class="slide">
<h1>Local Persistence: Writes</h1>
<p>For local storage, Cassandra relies on the local file system. (By contrast, Google&#8217;s BigTable is designed for <span class="caps">GFS</span>, a distributed file system.)</p>
<p>Writes are appended to a commit log. Only <em>after</em> this succeeds is the same change written to an in-memory data structure.</p>
<p>Facebook uses a dedicated disk on each system for the commit log, to minimize seeks and thereby optimize writes.</p>
<p>When the in-memory storage reaches a certain size threshold, it is written to another disk and the rows are indexed for fast retrieval.</p>
</div>
<div class="slide">
<h1>Local Persistence: Writes</h1>
<p>Over time, many such files written from the in-memory data structure will exist. A background process merges them into one file. Also, old commit logs are eventually deleted, once the in-memory structures they represent are persisted.</p>
<p>Hence, durability is ensured through a combination of the commit log and the row files, replicated across the cluster.</p>
<p>Since no files are ever modified for updates, no locks are required. Cassandra also groups writes to be synchronous, maximizing disk write speeds.</p>
</div>
<div class="slide">
<h1>Local Persistence: Reads</h1>
<p>First, the in-memory data structure is searched for the row. If not found, the <em>newest</em> to <em>oldest</em> files are searched, in order.</p>
<p>To avoid searching a file that is unlikely to contain the row, a <em>bloom filter</em> that summarizes the keys in the file is also stored in the file and and memory. It is examined to determine if the file has the row.</p>
<p>Column locations are also indexed, so getting to the correct disk block is optimized.</p>
</div>
<div class="slide">
<h1>Cassandra and Column Databases: Conclusion</h1>
<ul>
	<li>Great for schema that need to evolve by adding columns.</li>
	<li>Great for fast queries by column(s), without reading entire rows.</li>
	<li>Optimized for write performance, while maintaining fast reads.</li>
	<li>Trade full <span class="caps">RDBMS</span> features for flexibility and performance.</li>
</ul>
</div>
<div class="slide">
<h1>Graph Databases</h1>
<p>Graph databases model relationships as first class features.</p>
<p>Contrast with relational databases, where relationships are managed through joins over keys from one set of records to another set of records, either in the same table or different tables. For M:N relationships, you have to manually create a separate <em>join table</em>. For data best modeled as a <em>network</em> of <em>nodes</em>, this isn&#8217;t very convenient, nor does it perform well, in most cases.</p>
</div>
<div class="slide">
<h1>Graph Examples</h1>
<ul>
	<li>The Internet!</li>
	<li>Physical maps: streets, public transit, geography, etc.</li>
	<li>Complex business rules.</li>
	<li>Manifests for shipping.</li>
	<li>Parts lists and their relationships for assembly lines and finished products (e.g., airplanes!).</li>
</ul>
</div>
<div class="slide">
<h1>Graph Databases and OO Middleware</h1>
<p>An <em>object</em> is actually a graph of smaller objects:</p>
<ul>
	<li>Smaller graphs (collections).</li>
	<li>&#8220;Leaf&#8221; nodes, like integers, floats, etc.</li>
</ul>
<p>(It&#8217;s sometimes useful to treat other small objects, like strings as leaf nodes, too.)</p>
<p>Hence, for applications with complex object graphs, a graph database might be a better fit than a relational database.</p>
</div>
<div class="slide">
<h1>Elements of a Graph Database</h1>
<p>At its core a graph database supports the following concepts from standard graph theory.</p>
<ul>
	<li>Nodes</li>
	<li>Arcs</li>
	<li>Properties</li>
</ul>
</div>
<div class="slide">
<h1>Nodes</h1>
<p>A node is analogous to a row in a relational database. In a graph for a particular application, it is an &#8220;entity&#8221; whose relationships to other entities are of primary interest.</p>
<p>Examples:</p>
<ul>
	<li>Twitter, Facebook, LinkedIn, etc. users.</li>
	<li>Airports served by an airline.</li>
	<li>Addresses to which mail and packages are delivered.</li>
</ul>
</div>
<div class="slide">
<h1>Arcs</h1>
<p>The connections (relationships) between nodes. Can be unidirectional or bidirectional.</p>
<p>Examples:</p>
<ul>
	<li>Your followers and who you follow on Twitter.</li>
	<li>Your friends and their friends, ad infinitum, on Facebook, LinkedIn, etc.</li>
	<li>Flight &#8220;legs&#8221; between two airports.</li>
	<li>Delivery route between two addresses for mail and/or package deliveries.</li>
</ul>
<p>Which of these are always bidirectional? Sometimes?</p>
</div>
<div class="slide">
<h1>Arcs (cont.)</h1>
<p>Traversals (paths) are formed from multiple, contiguous arcs.</p>
<ul>
	<li>They may be circular.
	<ul>
		<li>The may go from one node to another and back again.</li>
	</ul></li>
	<li>There will be dead ends.</li>
	<li>There will be clumps with relatively few arcs between the clumps.</li>
</ul>
<p>For a real-world example, see this video of a <a href="http://www.youtube.com/watch?v=se2u5RyGaNE">LinkedIn employee&#8217;s own social graph</a>.</p>
</div>
<div class="slide">
<h1>Properties</h1>
<p>Key-value pairs associated with nodes and arcs. Most of the interesting data is in these properties!</p>
<p>Example Properties for Nodes:</p>
<ul>
	<li>Where you live, your profession, interests, age, marital status, etc., etc.</li>
	<li>Airport capacity, number of gates, hours of operation, etc.</li>
	<li>Business or personal address? Apartment building or free standing house? Hostile dogs?</li>
</ul>
</div>
<div class="slide">
<h1>Properties (cont.)</h1>
<p>Example Properties for Arcs:</p>
<ul>
	<li>Is this a professional or personal relationship.</li>
	<li>How often is this relationship used?
	<ul>
		<li>Twitter direct messages.</li>
		<li>Emails sent.</li>
	</ul></li>
	<li>Daily flight schedule (including number of flights, passengers carried per flight, etc.).</li>
	<li>Distance between two addresses.</li>
	<li>Hazards or barriers between two addresses.</li>
</ul>
</div>
<div class="slide">
<h1>Graph Databases vs. Others</h1>
<p>Recall that most of the database <em>kinds</em> we&#8217;ve discussed can scale through <em>sharding</em>. That <strong>assumes</strong> there are relatively few relationships between the shards. Graph databases <em>emphasize</em> connections, so sharding requires careful understanding of the actual clumps in the data.</p>
<p>Where <em>joins</em> can be expensive in an <span class="caps">RDBMS</span>, graphs optimize traversals.</p>
</div>
<div class="slide">
<h1>Neo4J</h1>
<p><a href="http://neo4j.org">Neo4J</a> and its Wikipedia <a href="http://en.wikipedia.org/wiki/Neo4j">page</a>.</p>
<p>Neo4j is a graph database. It is an embedded, disk-based, fully-transactional Java persistence engine that stores data structured in graphs rather than in tables.</p>
</div>
<div class="slide">
<h1>Neo4J: Features</h1>
<ul>
	<li>Object-oriented Java <span class="caps">API</span>.</li>
	<li>massive scalability; handles graphs of several billion nodes/relationships/properties on a single machine and can be sharded to scale out across multiple machines.</li>
	<li>Support for common <span class="caps">RDBMS</span> database features:
	<ul>
		<li><span class="caps">ACID</span> transactions.</li>
		<li>Durable persistence.</li>
		<li>Concurrency control.</li>
	</ul></li>
</ul>
</div>
<div class="slide">
<h1>FlockDB</h1>
<p><a href="http://en.wikipedia.org/wiki/FlockDB">Wikipedia</a> and on <a href="http://github.com/twitter/flockdb">GitHub</a>.</p>
<p>Goals:</p>
<ul>
	<li>High throughput for add/update/remove operations.</li>
	<li>Support complex arithmetic queries.</li>
	<li>Paging through query result sets with millions of entries.</li>
	<li>Archiving of edges with later retrieval.</li>
	<li>Horizontal scaling, including replication.</li>
	<li>Online data migration</li>
</ul>
</div>
<div class="slide">
<h1>FlockDB</h1>
<p>Non-goals include:</p>
<ul>
	<li>Multi-hop queries (or graph-walking queries)</li>
	<li>Automatic shard migrations</li>
</ul>
<p>FlockDB tries to solve fewer problems, such as Neo4J, so it is much simpler than other graph databases.</p>
</div>
<div class="slide">
<h1>Developed at Twitter</h1>
<p>Twitter uses FlockDB to store social graphs (who follows whom, who blocks whom) and secondary indices. As of April 2010, the Twitter FlockDB cluster stores 13+ billion edges and sustains peak traffic of 20k writes/second and 100k reads/second.</p>
<p>Written in Scala.</p>
</div>
<div class="slide">
<h1>Gephi: An Open-Source Tool for Graph Analysis.</h1>
<p><a href="http://gephi.org">gephi.org</a>.</p>
<p>An open-source tool for visualizing and analyzzing large networks graphs.</p>
<ul>
	<li>Uses a 3D render engine to display graphs in real-time.</li>
	<li>Supports data exploration, analysis, filtering, manipulation, and graphing of graph data.</li>
</ul>
</div>
<div class="slide">
<h1>Gephi: Gotchas</h1>
<p>It&#8217;s a Java app that uses a lot of <span class="caps">RAM</span>.</p>
<p>The included example graph, of the relationships between characters in the Phantom of the Opera, runs fine with the default configuration.</p>
<p>For larger graphs, follow the instructions for increasing the heap size. Only run it on a reasonably powerful machine.</p>
</div>
<div class="slide">
<h1>Graph Databases: Conclusion</h1>
<p><a href="http://portal.acm.org/citation.cfm?id=1322433">Survey of Graph Database Models</a> provides a detailed survey (requires <span class="caps">ACM</span> online access).</p>
<p><a href="http://nosqlsummer.org/paper/graph-traversal-pattern">The Graph Traversal Pattern</a> is a technical paper on graph databases.</p>
</div>
<div class="slide">
<h1>Reading Assignment: Cassandra</h1>
<ul>
	<li><a href="http://en.wikipedia.org/wiki/Apache_Cassandra">Apache Cassandra</a> (Wikipedia).</li>
	<li>Avinash Lakshman and Prashant Malik, <a href="http://www.cs.cornell.edu/projects/ladis2009/papers/lakshman-ladis2009.pdf">Cassandra &#8211; A Decentralized, Structured Storage System</a>.</li>
</ul>
</div>
<div class="slide">
<h1>Reading Assignment: Graph Databases</h1>
<p>Rather than a reading on graph databases, read this Wikipedia page on graphs in computer science, which describes the fundamental terminology used in graph databases, too.</p>
<ul>
	<li><a href="http://en.wikipedia.org/wiki/Graph_(data_structure)">Graph data structure</a> (Wikipedia).</li>
</ul>
</div>
<div class="slide">
<h1>Reading Assignment: MapReduce</h1>
<p>In preparation for our next class, when we&#8217;ll finally discuss MapReduce, read the classic paper that introduced the first MapReduce framework, used at Google.</p>
<ul>
	<li><a href="http://en.wikipedia.org/wiki/MapReduce">MapReduce</a> (Wikipedia).</li>
</ul>
</div>
<div class="slide">
<h1>Exercise: Filter Stock Queries</h1>
<p>Since we started, the project has had one major flaw; if you query for closing prices for a list of stocks, you get the results for <em>all</em> stocks in the same tables. We did one fix in an earlier exercise, where we filtered the results after the database query was made. Now let&#8217;s do it in a more appropriate way, as part of the query itself.</p>
</div>
<div class="slide">
<h1>Exercise: Filter Stock Queries (cont.)</h1>
<p>Several pieces are already in place. <code>RestfulDataPublisher</code> already sends the &#8220;instrument&#8221; information to the <code>InstrumentAnalysisServerSupervisor</code> in a <code>CriteriaMap</code> object. (<code>CriteriaMap</code> wraps a normal <code>Map</code> with some convenience methods.)</p>
<p><code>InstrumentAnalysisServerSupervisor</code> sends the instrument information to the <code>InstrumentAnalysisServers</code>, in a modified <code>CriteriaMap</code>. However, <code>InstrumentAnalysisServer</code> does not pass this information any further down the stack.</p>
</div>
<div class="slide">
<h1>Exercise: Filter Stock Queries (cont.)</h1>
<p>Look at <code>InstrumentAnalysisServerHelper.fetchPrices</code> (in <code>InstrumentAnalysisServer.scala</code>). Note the <code>Map</code> it passes to <code>DataStoreServer</code>. It passes a <code>Map</code> object, rather than a <code>CriteriaMap</code>, to provide a clean separation between the &#8220;domain-specific&#8221; <code>CriteriaMap</code> and <code>InstrumentAnalysisServer</code> higher in the &#8220;stack&#8221;, and the more generic <code>DataStoreServer</code> and <code>DataStore</code> types lower down:</p>
<div class="code-tiny">
<pre name="code" id="code" class="brush: scala,;">

dataStorageServer !! Get(Map("start" -&gt; start, "end" -&gt; end))
</pre></div>
<p>(Note, I recently refactored the project to use a <code>Map</code>, rather than a Lift <span class="caps">JSON</span> <code>JValue</code>, due to problems with the latter&#8230;)</p>
</div>
<div class="slide">
<h1>Exercise: Filter Stock Queries (cont.)</h1>
<p><code>("start" -&gt; start)</code> is converted to a <code>Pair[String, org.joda.time.DateTime]</code> before they are passed to the <code>Map</code> &#8220;factory&#8221; method. For example, if the <code>start</code> value is &#8220;2010-10-01&#8221; and <code>end</code> is &#8220;2010-10-05&#8221;, the map would be.</p>
<div class="code-small">
<pre name="code" id="code" class="brush: javascript,;">

Map("start" -&gt; "2010-10-01", "end" -&gt; "2010-10-05")
</pre></div>
</div>
<div class="slide">
<h1>Exercise: Filter Stock Queries (cont.)</h1>
<p>Step 1: Pull the &#8220;exercise4_start&#8221; branch from GitHub.</p>
<p>I pushed a new branch to GitHub called &#8220;exercise4_start&#8221;. You&#8217;ll want to start from there!</p>
<ul>
	<li>Follow the instructions in early notes for pulling new branches from my GitHub repo. Pull my &#8220;exercise4_start&#8221;.</li>
	<li>Create a local work branch called &#8220;exercise4&#8221;.</li>
	<li>Merge my &#8220;exercise4_start&#8221; to your &#8220;exercise4&#8221;.</li>
</ul>
</div>
<div class="slide">
<h1>Exercise: Filter Stock Queries (cont.)</h1>
<p>Step 2: Pull the &#8220;exercise4_start&#8221; branch from GitHub. Start <code>sbt</code></p>
<ul>
	<li>Start <code>sbt</code>.</li>
	<li>Run the <code>~test</code> action to continuously check for broken code.</li>
</ul>
</div>
<div class="slide">
<h1>Exercise: Filter Stock Queries (cont.)</h1>
<p>Step 3: Add the instruments</p>
<ul>
	<li>Add another <code>Pair</code> to the <code>Map</code> inside the <code>Get</code> message object sent to the <code>dataStoreServer</code>. Use <code>stock_symbol</code> as the key and a new list, named <code>symbols</code> as the value. Note that the <code>instruments</code> parameter to the method is of type <code>List[Instrument]</code>. All we want is a <code>List[String]</code>, where each <code>String</code> is the <code>symbol</code> field in the corresponding <code>Instrument</code>.</li>
</ul>
<ul>
	<li>Create a local <code>val</code> named <code>symbols</code>. Initialize it with the list of symbols (<code>Strings</code>) created by calling the <code>map</code> method on <code>instruments</code> and passing a block that extracts the <code>symbol</code> field from each instrument. (Hint: there is already a method to do this, in <code>object Instrument</code>.)</li>
	<li>In the <code>Get(Map(...))</code> sent to the <code>dataStorageServer</code>, add the key-value pair with &#8220;stock_symbol&#8221; as the key and the new <code>symbols</code> list as the value.</li>
</ul>
</div>
<div class="slide">
<h1>Exercise: Filter Stock Queries (cont.)</h1>
<p>Note that <code>InstrumentAnalysisServer</code> has many details about how domain concepts, like &#8220;instruments&#8221; are mapped to the actual storage details, like &#8220;stock_symbol&#8221;, so that <code>DataStorageServer</code> and the <code>DataStore</code> types can remain relatively agnostic about domain concepts. This makes them more reusable for other applications.</p>
</div>
<div class="slide">
<h1>Exercise: Filter Stock Queries (cont.)</h1>
<p>Step 4: Extend <code>DataStorageServer</code> to use other query parameters.</p>
<p>In <code>DataStorageServer.getDataForRange</code>, the <code>criteria</code> object is passed in as an argument.</p>
<ul>
	<li>Add this <code>criteria</code> object as the <em>third</em> argument in the call to <code>DataStore.range</code>. (At this point, the compilation will fail in <code>sbt</code>.)</li>
</ul>
</div>
<div class="slide">
<h1>Exercise: Filter Stock Queries (cont.)</h1>
<p>Step 5: Extend the <code>DataStore</code> types to use this query object.</p>
<ul>
	<li>Modify the declaration of <code>DataStore.range</code> to accept this argument <strong>before</strong> the <code>maxNum</code> argument.
	<ul>
		<li>Give it the name <code>otherCriteria</code>.</li>
		<li>Give it a default value of <code>Map.empty</code> (one way of specifying an empty map). In other words, the <code>otherCriteria</code> argument will have this signature: <code>otherCriteria: Map[String,Any] = Map.empty</code>. (Note that the type parameters aren&#8217;t required on the right-hand side of the equals sign. Do you understand why?)</li>
	</ul></li>
</ul>
<ul>
	<li>Add the same argument to the definitions of <code>InMemoryDataStore.range</code> and <code>MongoDBDataStore.range</code>.</li>
</ul>
</div>
<div class="slide">
<h1>Exercise: Filter Stock Queries (cont.)</h1>
<p>Step 6: Fix the tests.</p>
<p>At this point, there should be a few test failures, all caused by changes that need to be made in <code>DataStoreTestBase</code>. Specifically, we are still calling the <code>range</code> method on a <code>DataStore</code> object without the new, third argument. Note that this is only a problem for the cases where we explicitly pass the <code>maxNum</code> argument. (Do you understand why that&#8217;s true?)</p>
<ul>
	<li>Look at the test error messages and find the lines in <code>DataStoreTestBase</code> where the changes are required.</li>
	<li>Insert <code>Map.empty</code> as the <em>third</em> argument to the <code>range</code> call, before the current third argument, the <code>maxNum</code> value.</li>
</ul>
<p>Now the tests should pass!</p>
</div>
<div class="slide">
<h1>Exercise: Filter Stock Queries (cont.)</h1>
<p>Step 7: Continue implementing the new query support.</p>
<p>Go back to <code>MongoDBDataStore</code> and look at the <code>range</code> method. Now we&#8217;ll use the new <code>otherCriteria</code> object. I recently refactored the code to use a MongoDB <code>QueryBuilder</code>. We need to append additional information to the query. To keep the exercise simpler, we&#8217;ll hard code the fact that <code>otherCriteria</code> may now have a key-value pair <code>("stock_symbol", List[String])</code>. (I say &#8220;may have&#8221;, because clients won&#8217;t always pass a <code>otherCriteria</code> map with this key-value pair, like some of the tests in <code>DataStoreTestBase</code>!)</p>
<ul>
	<li>Using the Scala <code>Map</code> <span class="caps">API</span>, add a conditional that tests for the presence of this key in <code>otherCriteria</code>.</li>
	<li>&#8230;</li>
</ul>
</div>
<div class="slide">
<h1>Exercise: Filter Stock Queries (cont.)</h1>
<p>Step 7 (cont.): Continue implementing the new query support.</p>
<ul>
	<li>If the key is found, add the key-value pair to the query:
	<ul>
		<li>Use the <code>QueryBuilder</code> code already in the method as an example.</li>
		<li>Find the JavaDocs for <code>QueryBuilder</code> and <code>BasicDBList</code> <a href="http://api.mongodb.org/java/2.2/index.html">here</a>.</li>
		<li>Write code that creates a <code>BasicDBList</code> and adds each element from the <code>symbols:List[String]</code> to it. (That is, we have to convert the Scala <code>List</code> to something MongoDB understands: <code>BasicDBList</code>.)</li>
		<li>Use the <code>and(key)</code> method and the <code>in(myBasicDBList)</code> methods on the <code>QueryBuilder</code> object (i.e., add these changes <strong>before</strong> the line that calls <code>qb.get</code>!).</li>
	</ul></li>
</ul>
</div>
<div class="slide">
<h1>Exercise: Filter Stock Queries (cont.)</h1>
<p>Step 8: Try it out!!</p>
<p>Run the application and open the web page in a browser. Enter a few stock symbols and date ranges. You should now see results only for the stocks you specified, not for all stocks in the same collection!</p>
<p>Note that we have left out some work; besides hard-coding a particular enhancement, rather than handling the general case, we haven&#8217;t supported this change in <code>InMemoryDataStore</code> and we haven&#8217;t updated our tests! We&#8217;ll fix this later.</p>
<p>Please push your work to GitHub by the start of class on October 19th.</p>
</div>
<div class="slide">
<h1>Reminder</h1>
<p><strong>No class</strong> next week (10/12).<br />
<strong>Midterm</strong>, the first 1/2 of our session on (10/19)</p>
</div>
<div class="title slide">
<h1>Lecture 7: Midterm and Scaling Systems, Part II</h1>
<p>In this lecture, we&#8217;ll complete our discussion of distributed systems by examining the most popular framework for distributed data computation (&#8220;big data&#8221;): <a href="http://en.wikipedia.org/wiki/MapReduce">MapReduce</a>.</p>
</div>
<div class="slide">
<h1>How Would You Index the Web?</h1>
<p>Google indexes the web by finding all the links to web pages related to particular keywords. A page with the most links for a given keyword will appear first in a search for that keyword.</p>
<p>(Of course it&#8217;s more complicated than this, but this is the basic idea.)</p>
<p>By the way, how much data is out there??</p>
</div>
<div class="slide">
<h1>Size of teh InterWebs</h1>
<center>
<p><img src="images/size-of-the-web.jpg"></img></p>
</center>
</div>
<div class="slide">
<h1>Recall from Lecture 4: Scaling Data, Part I</h1>
<p>&#8230; your architecture has to tolerate high latency (<a href="http://www.infoq.com/articles/pritchett-latency">Dan Pritchett</a>). A couple of techniques help.</p>
<ul>
	<li>Moving data and computing resources close to customers.
	<ul>
		<li>Lowers the round-trip time</li>
	</ul></li>
	<li>Doing as much calculation asynchronously as possible.
	<ul>
		<li>E.g., google indexes the web asynchronously, so searches use precomputed data and are &#8220;instantaneous&#8221;.</li>
	</ul></li>
</ul>
<p><img src="images/google-search.png"><img></p>
</div>
<div class="slide">
<h1>Pre-computation of Data</h1>
<p>Obviously you can&#8217;t index the Internet on demand if you want to return results this fast.</p>
<p>In 2004, Google published a paper by Jeffrey Dean and Sanjay Ghemawat, called <a href="http://labs.google.com/papers/mapreduce.html">MapReduce: Simplified Data Processing on Large Clusters</a>, which introduced its approach, <strong>MapReduce</strong>.</p>
<p>The name is taken from the classic <em>map</em> and <em>reduce</em> operations over collections, but there are differences&#8230;</p>
</div>
<div class="slide">
<h1>What Is MapReduce?</h1>
<p>MapReduce is inspired by the combination two classic operations on collections: <code>map</code> and <code>reduce</code>.</p>
<ul>
	<li><code>map</code>: Transforms each item in a collection to another value and builds a new collection of the same size as the original collection.</li>
</ul>
<div class="code-tiny">
<pre name="code" id="code" class="brush: scala,;">

List(1,2,3,4,5) map (i =&gt; i*i)  // List(1,4,9,16,25)
</pre></div>
<ul>
	<li><code>reduce</code>: Reduces a collection of items to a smaller collection or single value.</li>
</ul>
<div class="code-tiny">
<pre name="code" id="code" class="brush: scala,;">

List(1,2,3,4,5) reduceLeft ((total,i) =&gt; total*i)  // 120 == 5!
</pre></div>
<ul>
	<li>(You might also <code>filter</code>: Create a new collection of some items from the original.)</li>
</ul>
<div class="code-tiny">
<pre name="code" id="code" class="brush: scala,;">

List(1,2,3,4,5) filter (i =&gt; i%2 == 0)  // List(2,4)
</pre></div>
</div>
<div class="slide">
<h1>What Is MapReduce?</h1>
<p>In the context of MapReduce the input collections are key-value pairs. I&#8217;ll use the word <em>dictionary</em>, rather than <em>map</em>, to avoid confusion with the map <em>operation</em>.</p>
<ul>
	<li><code>map</code>: Filters values of interest and partitions them based on some criteria, creating <em>new</em> key-value pairs, where the new keys are often not the same keys as in the input dictionary. There can be multiple, tiered map steps.</li>
	<li>The MapReduce framework sends the new key-value pairs with the <em>same</em> key to the <em>same</em> MapReduce instance in the cluster for processing.</li>
	<li><code>reduce</code>: Reduces the results from the nodes to compute the final result.</li>
</ul>
</div>
<div class="slide">
<h1>Classic Example: Word Counts</h1>
<p>Count the appearance of each word in a set of documents (Pseudo-Java syntax).</p>
<div class="code-tiny">
<pre name="code" id="code" class="brush: scala,;">

void map(String, documentName, String documentContents) {
  // documentName: the "key" (the name of the document, e.g., file)
  // documentContents: the "value" (String for the doc's contents)
  if (documentName.equals("Index")) return;
  for (String word : tokenize(documentContents))
    emitNewKeyValue(word, "1");  // new (key, value) pair: (word, count)
}

void reduce(String word, Iterator partialCounts) {
  // word: a word "key" we handled in the map (tokenized from documents)
  // partialCounts: a list of aggregated partial counts ("values")
  int result = 0;
  for (String pc : partialCounts)
    result += ParseInt(pc);
  emit(AsString(result));
}
</pre></div>
</div>
<div class="slide">
<h1>Classic Example: Word Counts (cont.)</h1>
<ul>
	<li><code>map</code> returns void and calls <code>emitNewKeyValue</code>.
	<ul>
		<li>You might not want to do anything with the input.</li>
		<li>In this case, we ignore the document if it is an &#8220;index&#8221; document.</li>
		<li>Otherwise, we emit <em>new</em> key-value pairs (1000&#8217;s??), where the key is a word and the value is the count &#8220;1&#8221;. Note that a duplicate word-&#8220;1&#8221; pair is emitted every time the same word appears.</li>
	</ul></li>
</ul>
<ul>
	<li><code>reduce</code> is called for each unique word (as a key), with a list of all the &#8220;counts&#8221; emitted for that word.
	<ul>
		<li>We parse those count strings and add the integers to compute the total count for the word across all the documents (except index documents&#8230;).</li>
	</ul></li>
</ul>
</div>
<div class="slide">
<h1>MapReduce Implementations: Hadoop</h1>
<p>Google&#8217;s MapReduce is not open to the public.</p>
<p>Yahoo! open sourced <a href="http://hadoop.apache.org/">Hadoop</a> in 2006, its implementation of MapReduce. It is now an &#8220;umbrella&#8221; <a href="http://hadoop.apache.org/">Apache Project</a> that includes not only a MapReduce implementation, but additional support tools:</p>
<ul>
	<li><strong><span class="caps">HDFS</span></strong>: A distributed file system that provides high throughput access to application data.</li>
	<li><strong>ZooKeeper</strong>: A high-performance coordination service for distributed applications.</li>
</ul>
</div>
<div class="slide">
<h1>Other Hadoop-related Apache Projects</h1>
<ul>
	<li><strong>Avro</strong>: A data serialization system.</li>
	<li><strong>HBase</strong>: A scalable, distributed database that supports structured data storage for large tables.</li>
	<li><strong>Hive</strong>: A data warehouse infrastructure that provides data summarization and ad hoc querying.</li>
	<li><strong>Mahout</strong>: A Scalable machine learning and data mining library.</li>
	<li><strong>Pig</strong>: A high-level data-flow language and execution framework for parallel computation.</li>
</ul>
</div>
<div class="slide">
<h1>Hadoop?</h1>
<p>The creator of Hadoop, Doug Cutting, named it after his young son&#8217;s pet Elephant.</p>
<p><em>Mahout</em> is the term for a person in India who tames and manages work Elephants.</p>
</div>
<div class="slide">
<h1>Hadoop History</h1>
<table>
	<tr>
		<th>Year </th>
		<th>Event </th>
	</tr>
	<tr>
		<td> 2005-2006 </td>
		<td> Based on Google paper, MapReduce implementation, named &#8220;Hadoop&#8221;, added to the <em>Nutch</em> search project. </td>
	</tr>
	<tr>
		<td> 2006 </td>
		<td> Moved Hadoop to a subproject of Apache <em>Lucence</em>. </td>
	</tr>
	<tr>
		<td> 2008 </td>
		<td> Hadoop becomes a top-level Apache Project. </td>
	</tr>
	<tr>
		<td> 2008 </td>
		<td> Yahoo! runs a 10,000 node Hadoop, Linux cluster to process data for its search engine. (Google&#8217;s cluster is certainly larger.) </td>
	</tr>
</table>
<p>(Adapted from Tom White, &#8220;Hadoop: The Definitive Guide, Second Edition&#8221; &#8211; see the references.)</p>
</div>
<div class="slide">
<h1>New York Times Hadoop Story</h1>
<p>Amazon offers Hadoop services in its Cloud Computing service, EC2.</p>
<p>In 2007, The New York Times wanted to convert to PDFs its microfiche of every issue ever published. They used 100 Amazon EC2 instances and a Hadoop application to process 4TB of raw image <span class="caps">TIFF</span> data (stored in Amazon&#8217;s S3 datastore) into 11 million finished PDFs in the space of 24 hours at a computation cost of about $240 (not including bandwidth).</p>
</div>
<div class="slide">
<h1>Aside: Cloud Computing (1/3)</h1>
<p>What if you don&#8217;t want to own and manage a cluster, especially if you only need a lot of compute power occasionally? In cloud computing, you rent compute time and resources for short or long time intervals.</p>
<p>The servers in the cloud are actually running <em>virtual images</em> of the operating system, so you might actually share a &#8220;slice&#8221; of hardware, but be isolated as if you had the machine to yourself.</p>
<p>These OS images sometimes come preconfigured with common applications required (like database servers, Java, etc.).</p>
<p>When you&#8217;re done with an <em>instance</em>, it is safely thrown away.</p>
</div>
<div class="slide">
<h1>Aside: Cloud Computing (2/3)</h1>
<p>+ You don&#8217;t worry about system administration, hardware, a datacenter.<br />
+ You only buy the computing power you need.<br />
+ You can scale up or down quickly, as needed.</p>
<p>- Network bandwidth often inadequate for very high throughput applications.<br />
- Cost and performance of a cloud service eventually becomes higher than a self-owned datacenter for very large operations (e.g., Google).</p>
</div>
<div class="slide">
<h1>Aside: Cloud Computing (3/3)</h1>
<p><strong>The Value Proposition</strong></p>
<ul>
	<li>Supports massive horizontal scaling of computation.</li>
	<li>In a cloud environment, you can do tremendous computation in a short period of time without investing in your own computing infrastructure.</li>
</ul>
</div>
<div class="slide">
<h1>Hadoop Pros and Cons</h1>
<p>+ Full-featured, high-scalable architecture for computation.</p>
<p>- Some setup required&#8230;<br />
- Verbose syntax. See this <a href="http://hadoop.apache.org/mapreduce/docs/r0.21.0/mapred_tutorial.html#Example%3A+WordCount+v1.0">actual word count example</a>.</p>
<p>Tools like <a href="http://pig.apache.org/">Pig</a> and <a href="http://github.com/nathanmarz/cascalog">Cascalog</a> provide higher-levels of abstraction for creating Hadoop jobs.</p>
</div>
<div class="slide">
<h1>Other MapReduce Implementations</h1>
<p>Many NoSQL databases are bundling MapReduce implementations. For example:</p>
<ul>
	<li><strong>CouchDB</strong>: Used to build &#8220;views&#8221; incrementally, instead of providing a full, ad hoc query engine.</li>
	<li><strong>MongoDB</strong>: Used to do computations that would be done with <span class="caps">GROUP</span> BY clauses in <span class="caps">SQL</span>.</li>
</ul>
<p>The <a href="http://en.wikipedia.org/wiki/MapReduce">Wikipedia</a> page on MapReduce lists many other implementations.</p>
</div>
<div class="slide">
<h1>Aside: <span class="caps">SQL</span> <span class="caps">GROUP</span> BY (1/3)</h1>
<p>Suppose you want to list the unique customers in the following table and sum up how much each customer has spent. (Adapted from <a href="http://www.sql-tutorial.com/sql-group-by-sql-tutorial/"><span class="caps">SQL</span> Tutorial</a>)</p>
<div class='small'>
<table>
	<tr>
		<th>OrderID</th>
		<th>OrderDate</th>
		<th>OrderPrice</th>
		<th>OrderQuantity</th>
		<th>CustomerName</th>
	</tr>
	<tr>
		<td> 1</td>
		<td> 12/22/2005</td>
		<td> 160 </td>
		<td> 2</td>
		<td> Smith </td>
	</tr>
	<tr>
		<td> 2</td>
		<td> 08/10/2005</td>
		<td> 190 </td>
		<td> 2</td>
		<td> Johnson </td>
	</tr>
	<tr>
		<td> 3</td>
		<td> 07/13/2005</td>
		<td> 500 </td>
		<td> 5</td>
		<td> Baldwin </td>
	</tr>
	<tr>
		<td> 4</td>
		<td> 07/15/2005</td>
		<td> 420 </td>
		<td> 2</td>
		<td> Smith </td>
	</tr>
	<tr>
		<td> 5</td>
		<td> 12/22/2005</td>
		<td> 1000</td>
		<td> 4</td>
		<td> Wood </td>
	</tr>
	<tr>
		<td> 6</td>
		<td> 10/02/2005</td>
		<td> 820 </td>
		<td> 4</td>
		<td> Smith </td>
	</tr>
	<tr>
		<td> 7</td>
		<td> 11/03/2005</td>
		<td> 2000</td>
		<td> 2</td>
		<td> Baldwin </td>
	</tr>
</table>
</div>
</div>
<div class="slide">
<h1>Aside: <span class="caps">SQL</span> <span class="caps">GROUP</span> BY (2/3)</h1>
<p>Here&#8217;s the query:</p>
<div class="code-tiny">
<pre name="code" id="code" class="brush: scala,;">

SELECT CustomerName, SUM(OrderPrice) FROM Sales
GROUP BY CustomerName
</pre></div>
<p>Note the <em>aggregate</em> function <code>SUM</code>. Combined with <code>GROUP BY</code>, it effectively sums the totals for each customer.</p>
</div>
<div class="slide">
<h1>Aside: <span class="caps">SQL</span> <span class="caps">GROUP</span> BY (3/3)</h1>
<p>Result of the query:</p>
<div class='small'>
<table>
	<tr>
		<th>CustomerName</th>
		<th>OrderPrice</th>
	</tr>
	<tr>
		<td> Baldwin</td>
		<td> 2500 </td>
	</tr>
	<tr>
		<td> Johnson</td>
		<td> 190  </td>
	</tr>
	<tr>
		<td> Smith  </td>
		<td> 1400 </td>
	</tr>
	<tr>
		<td> Wood   </td>
		<td> 1000 </td>
	</tr>
</table>
</div>
</div>
<div class="slide">
<h1>MapReduce Requirements</h1>
<ul>
	<li>Must be able to chop data into pieces that can be processed independently, hence in parallel.
	<ul>
		<li>E.g., process microfiche images for each year on a separate server.</li>
		<li>E.g., count things&#8230;</li>
	</ul></li>
	<li>Must have a good <code>map</code> function.
	<ul>
		<li>You want a balanced distribution of key-value pairs.</li>
	</ul></li>
</ul>
</div>
<div class="slide">
<h1>Other MapReduce Characteristics</h1>
<ul>
	<li>You&#8217;re trading away resource efficiency for time efficiency.
	<ul>
		<li>You may duplicate <em>lots</em> work in the parallel processing, thereby &#8220;wasting&#8221; resources, but you can get results much faster.</li>
	</ul></li>
	<li>MapReduce frameworks handle distribution of processing to nodes, monitoring of nodes, including detection of node failures, and rerouting processes off failed nodes.</li>
</ul>
</div>
<div class="slide">
<h1>MapReduce Disadvantages</h1>
<ul>
	<li>Not all computations fit the model.</li>
	<li>Not ideal for <em>real-time</em> computation; it&#8217;s optimized for <em>batch</em> processing.
	<ul>
		<li>Google is migrating to a new system called <a href="http://googleblog.blogspot.com/2010/06/our-new-search-index-caffeine.html">Caffeine</a> that provides more incremental and near-real time indexing.</li>
	</ul></li>
</ul>
</div>
<div class="slide">
<h1>Reading: Distributed Systems and &#8220;Big Data&#8221;</h1>
<p>To conclude our discussion of distributed systems and <em>big data</em>:</p>
<ul>
	<li>Arnon Rotem-Gal-Ozhttp, <a href="//www.rgoarchitects.com/Files/fallacies.pdf">Fallacies of Distributed Computing Explained</a></li>
	<li>Edd Dumbill, <a href="http://radar.oreilly.com/2010/09/the-smaq-stack-for-big-data.html">The <span class="caps">SMAQ</span> stack for big data</a>. Nice summary of some of the leading open-source technologies used for data processing.</li>
</ul>
</div>
<div class="slide">
<h1>Reading Assignment: MapReduce</h1>
<p>Start with the Wikipedia page on <a href="http://en.wikipedia.org/wiki/MapReduce">MapReduce</a>.</p>
<p>Then read the classic paper that introduced the first MapReduce framework, used at Google.</p>
<ul>
	<li>Jeffrey Dean and Sanjay Ghemawat, <a href="http://labs.google.com/papers/mapreduce.html">MapReduce: Simplified Data Processing on Large Clusters</a>.</li>
</ul>
<p>These authors also wrote a chapter on MapReduce called <em>Distributed Programming with Mapreduce</em>, in &#8220;Beautiful Code&#8221;, Chapter 23, pgs. 371-382.</p>
</div>
<div class="slide">
<h1>Other References</h1>
<p>Probably the best book on Hadoop, written by one of the core developers, Tom White:</p>
<ul>
	<li>Tom White, &#8220;Hadoop: The Definitive Guide, Second Edition&#8221;, O&#8217;Reilly, 2010, <span class="caps">ISBN</span>: 9781449389734. Available on Loyola&#8217;s <a href="http://proquestcombo.safaribooksonline.com.flagship.luc.edu/9781449398644">Safari Online</a>.</li>
	<li>Google&#8217;s new MapReduce replacement, <a href="http://googleblog.blogspot.com/2010/06/our-new-search-index-caffeine.html">Caffeine</a>.</li>
</ul>
</div>
<div class="slide">
<h1>Exercise: MongoDB&#8217;s MapReduce</h1>
<p>It would be too much work to setup and use Hadoop, so we&#8217;ll do an exercise this week using MongoDB&#8217;s MapReduce implementation on our stock data. Use the MongoDB <a href="http://www.mongodb.org/display/DOCS/MapReduce">MapReduce page</a> as a reference.</p>
</div>
<div class="slide">
<h1>Moving Averages of Asset Prices</h1>
<p><em>Moving averages</em> of asset prices are popular because they smooth out the noise in prices. Some technical analysts believe that the behavior of these averages can indicate likely turning points for the asset price.</p>
<p>A moving average is the average of the price for the <em>last</em> N days.</p>
</div>
<div class="slide">
<h1>50- and 200-Day Moving Averages</h1>
<center>
<p><img src="images/mova-6-orclcross.png"></img></p>
</center>
</div>
<div class="slide">
<h1>Calculating Moving Averages (1/3)</h1>
<p>Calculate the 50-day moving average for AA <em>ending</em> on 1980-03-12. The following code would be entered in the <code>mongo</code> console or put in a <code>.js</code> file and piped into the console: <code>mongo &lt; file.js</code>.</p>
<div class="code-small">
<pre name="code" id="code" class="brush: plain,;">

use stocks_yahoo_NYSE;

var map1 = function () {
  // Use the stock_symbol as the key and use a JavaScript
  // Object as the value, which contains the closing price
  // and the date.
  emit(this.stock_symbol, {close: this.close, date: this.date});
}
</pre></div>
</div>
<div class="slide">
<h1>Calculating Moving Averages (2/3)</h1>
<div class="code-small">
<pre name="code" id="code" class="brush: plain,;">

var reduce1 = function (key, values) {
  // For this key (the stock symbol), and set of values
  // (the object with the closing price and date), first
  // grab the LAST date, which is the date for this
  // moving average.
  var date = values[values.length-1].date

  // Now compute the moving average:
  var sum = 0;
  for (var n in values) {
      sum += values[n].close;
  }
  var avg = sum / values.length

  // Return the result, using the same keys as before!!
  return {date: date, close: avg};
}
</pre></div>
</div>
<div class="slide">
<h1>Calculating Moving Averages (3/3)</h1>
<div class="code-small">
<pre name="code" id="code" class="brush: plain,;">

// Invoke mapReduce with map1 and reduce1. 
// The query limits the documents to 'AA',
// the STARTING date of 1980-01-01, 
// and 50-days worth of data.
var result1 = db.A_prices.mapReduce(map1, reduce1, { query: {stock_symbol: 'AA', date: {$gte: '1980-01-01'}}, limit: 50})

// Get the answer from result1. Note the find() call:
db[result1.result].find()                                                 
// Here is the answer:
// { "_id" : "AA", "value" : { "date" : "1980-03-12", "close" : 63.235600000000005 } }

</pre></div>
</div>
<div class="slide">
<h1>Exercise: Using MongoDB&#8217;s MapReduce</h1>
<ul>
	<li>Find the 200-day moving average of &#8216;AA&#8217;, <em>ending</em> on the date 1990-10-15.</li>
</ul>
<ul>
	<li>Calculate how many days since 2008-01-01 that &#8216;<span class="caps">AZZ</span>&#8217; gained more than $1 in a single trading day.  Hints:
	<ul>
		<li>In your map function, filter out the days when the gains were less than $1, including loses. Also, what you &#8220;emit&#8221; will be much simpler and <em>very</em> similar to the word counting example we discussed earlier in the lecture. (Big hint&#8230;)</li>
		<li>In you filter function, all you need to do is count.</li>
		<li>Don&#8217;t forget to adjust the query used when invoking the mapReduce function.</li>
		<li>I picked the parameters to make the result fairly small, so you should be able to check the answer manually, using a simple &#8220;ordinary&#8221; query.<br />
</div><br />
<div class="slide"></li>
	</ul></li>
</ul>
<h1 class="slide0">Lecture 8: Effective Object-Oriented Programming (<span class="caps">OOP</span>), Part I</h1>
<p>Object-oriented programming (<span class="caps">OOP</span>) is the most popular <em>paradigm</em> for software development. It&#8217;s been around a while, but people continue to refine it.</p>
</div>
<div class="slide">
<h1>What Is <span class="caps">OOP</span>?</h1>
<p>It depends on who you ask. There are different <em>flavors</em> of <span class="caps">OOP</span> and different feature sets that systems support which claim to be object-oriented.</p>
<p>Almost all flavors include this:</p>
<p><strong>Object</strong>: An <em>encapsulation</em> of <em>state</em> and <em>functions</em> that manipulate that state.</p>
</div>
<div class="slide">
<h1>What Is <span class="caps">OOP</span>? (cont)</h1>
<p><strong>Encapsulation:</strong> Limit the scope for access. Object systems usually provide means to protect access to object internals.<br />
<strong>State:</strong> The logical combination of the values of the object&#8217;s <em>properties</em> (a.k.a. <em>fields</em> or <em>attributes</em>).<br />
<strong>Functions:</strong> Like normal functions, but with special access to the internals of the object, and with an implicit or explicit parameter referring to the object (e.g., <code>this</code> or <code>self</code>).</p>
</div>
<div class="slide">
<h1>More Terms</h1>
<p>You&#8217;ll also see these terms used in some, but not all language communities.</p>
<p><strong>Member</strong>: A generic term for an object&#8217;s functions and its properties (a.k.a. fields or attributes). <br />
<strong>Member function</strong> or <strong>Method</strong>: what the object&#8217;s functions are sometimes called.</p>
<p>Also,</p>
<p><strong>State space</strong>: All the possible values of <em>state</em> an object might have.</p>
</div>
<div class="slide">
<h1>Encapsulation</h1>
<p>OO languages let you limit the access to object internals and even to objects themselves. For example, in Java:</p>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

package gui.windowing;

public interface Window {...}
...
private class MacWindow implements Window {
  protected MacWindow(Dimensions dimensions) {
    this.dimensions = dimensions;
  }
  
  private Dimensions dimensions;
}
</pre></div>
<p>Only types in the same package can create <code>MacWindow</code>, <code>X11Window</code>, etc. objects and only the objects can access their <code>dimensions</code>.</p>
</div>
<div class="slide">
<h1>Encapsulation (cont.)</h1>
<p>Why is encapsulation important?</p>
<ul>
	<li>To expose the <strong>abstractions</strong> represented by the object.</li>
	<li>To hide the <strong>implementation</strong> details used inside the object.</li>
	<li>To clearly mark the line of separation between the two.</li>
</ul>
<p>Hiding the implementation has several advantages.</p>
<ul>
	<li>It gives the maintainer the freedom to change the internals as needed, while (hopefully) keeping the abstraction <em>invariant</em> (unchanged).</li>
	<li>Minimizes the <em>coupling</em> between the object and the clients of the object.</li>
</ul>
</div>
<div class="slide">
<h1>Aside: Coupling</h1>
<p>Unnecessary coupling between objects is one of the <em>most serious impediments</em> to productivity and quality (minimizing bugs) in mature software projects.</p>
<p>I once worked with a client with such a serious coupling problem that it was extremely difficult to implement new, competitive features. They also had to deploy <strong>multi-gigabyte</strong> jar files (far larger than the <span class="caps">JVM</span> itself), because they couldn&#8217;t separate the &#8220;components&#8221; into smaller &#8220;groups&#8221;.</p>
</div>
<div class="slide">
<h1>Module Encapsulation</h1>
<p>But most OO languages have poor support for building <em>components</em> or <em>modules</em>, collections of classes that work closely together. You only want <em>clients</em> to access a limited set of publicly visible types.</p>
<p><strong>Abstract Factory Pattern</strong> (see &#8220;Design Patterns: Elements of Reusable Object-Oriented Software&#8221;):</p>
<center>
<span style="width: 100%;">
<img src="images/Windows_WindowsFactories.png"></img>
</span>
</center>
</div>
<div class="slide">
<h1>Module Encapsulation (cont.)</h1>
<p>Scala has better encapsulation controls, so we can achieve this public/private separation. You can more precisely specify package visibility, for example. However, everything is public, by default, and people rarely think about <em>component-level encapsulation</em>.</p>
<p>A separate &#8220;module&#8221; construct would make the language bigger, but also make people think more about <em>modularity</em>.</p>
</div>
<div class="slide">
<h1>Module Encapsulation (cont.)</h1>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

package gui.windowing {

  abstract class Window(dimensions: Dimensions) {...}  
  abstract class WindowFactory {
    def make(properties: Properties): Window
  }
  
  protected[gui] package mac {
    MacWindow(...) extends Window(...) {...}
    object MacWindowFactory extends WindowFactory {
      def make(properties: Properties): Window = {...}
    }
  }
  protected[gui] package windows {
    WindowsWindow(...) extends Window(...) {...}
    ...
  }
  ...
}
</pre></div>
</div>
<div class="slide">
<h1>Module Encapsulation (cont.)</h1>
<p>In this example, the <em>abstractions</em> <code>Window</code> and <code>WindowFactory</code> are public and visible to clients of <code>gui.windowing</code>, while the <em>concrete</em> classes for each <span class="caps">GUI</span> platform are protected from clients, yet visible to any type within the <code>gui</code> package hierarchy.</p>
</div>
<div class="slide">
<h1>Module Encapsulation (cont.)</h1>
<p>Other languages are more explicit about public vs. private scoping. In Erlang, for example, you must declare which functions are accessible (&#8220;exported&#8221;) to clients. All others are private to the module.</p>
</div>
<div class="slide">
<h1>Good Object Design: Lesson 1</h1>
<p>Think carefully about modular boundaries.</p>
<ul>
	<li>What <em>minimal abstractions</em> should this module expose?</li>
	<li>What are implementation details that should be hidden?</li>
	<li>What characteristics are likely to change a lot as the module evolves?
	<ul>
		<li>These are best hidden!</li>
	</ul></li>
	<li>What characteristics are more stable?
	<ul>
		<li>These are safer to expose.</li>
		<li>Often core domain concepts don&#8217;t change often (but not always!).</li>
	</ul></li>
</ul>
<p>Remember that any changes to public abstractions require the client code to change and retest!</p>
</div>
<div class="slide">
<h1>State</h1>
<p>Consider this expanded example of the <code>Window</code> abstraction.</p>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

package gui.windowing {

  abstract class Window(dimensions: Dimensions) {
    protected var _dimensions: Dimensions
    protected var _position: Point
    protected var _hidden: Boolean
    
    def resize(newDimensions: Dimensions): Unit // like "void"
    def moveTo(newPosition: Point): Unit   
    def hide: Unit
    def show: Unit
  }  
}
</pre></div>
</div>
<div class="slide">
<h1>State (cont.)</h1>
<p>The <em>state</em> is the &#8220;sum&#8221; of the current values of <code>dimensions</code>, <code>position</code>, and <code>hidden</code>. Put another way, it is a particular value, represented here by a 3-dimensional <em>tuple</em> in the <em>state space</em>.</p>
<center>
<span style="width: 100%;">
<img src="images/StateSpace.png"></img>
</span>
</center>
<p>(Of course, <code>Dimensions</code> and <code>Position</code> are themselves 3-dimensional.)</p>
</div>
<div class="slide">
<h1>Good Object Design: Lesson 2</h1>
<p>A common source of bugs is poorly-managed object state. To avoid this problem:</p>
<ul>
	<li>Once a constructor completes, the object should be in a <em>known-good state</em>.</li>
	<li><em>Every</em> method should transition the object from one known-good state to another (possibly the same) known-good state.</li>
	<li>Clean up resources when the object becomes garbage.<sup class="footnote" id="fnr1"><a href="#fn1">1</a></sup> <sup class="footnote" id="fnr2"><a href="#fn2">2</a></sup></li>
</ul>
<p><sup class="footnote" id="fnr1"><a href="#fn1">1</a></sup> C++ and C# have <em>destructors</em> for this purpose (but they may be invoked too late for some resources, like database connections).<br />
<sup class="footnote" id="fnr2"><a href="#fn2">2</a></sup> Java has finalizers, but they are effectively useless, maybe even harmful.</p>
</div>
<div class="slide">
<h1>Design by Contract<sup class="footnote" id="fnr1"><a href="#fn1">1</a></sup></h1>
<p><a href="http://en.wikipedia.org/wiki/Design_by_contract">Design by Contract</a> (DbC) is a programming discipline where you specify assertions about program behavior that the language infrastructure can enforce during testing, but disable in production deployments, for performance reasons.</p>
<p><sup class="footnote" id="fnr1"><a href="#fn1">1</a></sup> A registered trademark of Eiffel Software</p>
</div>
<div class="slide">
<h1>Design by Contract (cont.)</h1>
<p>There are three facets of a contract.</p>
<ul>
	<li><strong>Preconditions:</strong> Assertions about state that must be true when entering a function.</li>
	<li><strong>Postconditions:</strong> Assertions about state that must be true when returning from a function.</li>
	<li><strong>Invariants:</strong> Assertions that should be true both before and after function invocation.</li>
</ul>
<p>It&#8217;s possible to define these at the object level, i.e., applicable to all its functions, especially invariants.</p>
</div>
<div class="slide">
<h1>Preconditions</h1>
<p><strong>Preconditions</strong> are what must be true in order for the function to do its job. A trivial example: there must be enough free memory for the function to allocate the objects it creates.</p>
<p>Hence, these are requirements on the runtime environment and the clients using the function. Here is an example using our Windowing <span class="caps">API</span> and a &#8220;mythical&#8221; DbC framework that uses annotations.</p>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

package gui.windowing {

  @precondition(dimensions.foreach {dimension =&gt; 
       dimension.greaterThanZero == true})
  abstract class Window(dimensions: Dimensions) {
    ...
  }  
}
</pre></div>
</div>
<div class="slide">
<h1>Postconditions</h1>
<p><strong>Postconditions</strong> are what the function guarantees to satisfy when it finishes its job, <em>if</em> the preconditions are true. A trivial example: a function might promise to never return <code>null</code>.</p>
<p>Hence, these are requirements on the function itself, constituting promises to clients. Here is an example using our Windowing <span class="caps">API</span>.</p>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

package gui.windowing {

  abstract class Window(dimensions: Dimensions) {

    @postcondition(this.position.isVisibleOnScreen)
    def moveTo(newPosition: Point): Unit
    ...
  }  
}
</pre></div>
</div>
<div class="slide">
<h1>Invariants</h1>
<p><strong>Invariants</strong> must be true before and after function invocation. They may specify some object (or global) property that doesn&#8217;t change. They may specify a logical constraint that must remain true, etc. Invariants can be requirements on the function, the environment, or both.</p>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

package gui.windowing {

  abstract class Window(dimensions: Dimensions) {

    @invariant(this.hidden == $previous.hidden)
    def moveTo(newPosition: Point): Unit
    ...
  }  
}
</pre></div>
<p>I&#8217;m using <code>$previous.hidden</code> to refer the state of the <code>hidden</code> property <em>before</em> the function invocation.</p>
</div>
<div class="slide">
<h1>Tool Support for Design by Contract</h1>
<p>DbC was <a href="http://eiffel.com/developers/design_by_contract.html">invented for Eiffel</a>, which contains language constructs for expressing constructs and for enforcing the constructs at runtime. Normally, enforcement is disabled in production builds, for performance.</p>
<p>Few other languages embraced DbC to this extent (unfortunately), but you can come very close using other tools.</p>
<ul>
	<li>I wrote a DbC library for Java called <a href="http://contract4j.org">Contract4J</a> (now dormant). It used <a href="http://aspectj.org">AspectJ</a> to &#8220;instrument&#8221; code to inject the tests and to evaluate them at runtime.</li>
	<li>I wrote a general-purpose &#8220;aspect&#8221; framework for Ruby called <a href="http://aquarium.rubyforge.org/">Aquarium</a>, which also lets you do &#8220;basic&#8221; DbC.</li>
</ul>
</div>
<div class="slide">
<h1>DbC and Test-Driven Development</h1>
<p><em>Test-Driven Development</em> (<span class="caps">TDD</span>), which we&#8217;ll discuss in a few weeks, accomplishes many of the same goals as DbC. It is now more commonly used.</p>
<p>Before <span class="caps">TDD</span>, in the early 90&#8217;s, I used DbC very successfully in a medical ultrasound project (written in C). Only <strong>one</strong> bug was ever reported against our subsystem. I still think in DbC terms, even when using <span class="caps">TDD</span>.</p>
</div>
<div class="slide">
<h1>Classes</h1>
<p>So far, we have just discussed <strong>objects</strong>.</p>
<p><strong>Class</strong>: A template for creating objects.</p>
<p>Like a cookie cutter used to stamp out objects with the same members and with a particular state value. We&#8217;ve already used this familiar concept supported by Scala and Java.</p>
</div>
<div class="slide">
<h1>Scala Has Classes (for Example)</h1>
<p>Scala example, patterned after Java&#8217;s <code>Exception</code> Hierarchy:<br />
<div class="code-small"></p>

<pre name="code" id="code" class="brush: scala,;">

class Exception(
    message: String = "[No Message]", 
    cause: Option[Exception] = None) {

  def stackTrace: List[String] = ...
}

val exception1 = new Exception("Network error")
println(exception1.message + ": " + exception1.stackTrace)

val exception2 = new Exception("Unknown Stock Symbol")
println(exception2.message + ": " + exception2.stackTrace)
</pre></div>
</div>
<div class="slide">
<h1>Inheritance</h1>
<p><strong>Inheritance</strong>: When one class inherits the members of another, with added <em>specializations</em>.</p>
<p><strong>Specialization</strong>: Going from more generic to more specific.</p>
<center>
<img src="images/UML1.png"></img>
</center>
</div>
<div class="slide">
<h1>Inheritance in Scala</h1>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

class NetworkException(
    address: IpAddress, 
    message: String = "", 
    cause: Option[Exception] = None) extends Exception(
      formatMessage(address, message), cause){
  
  def formatMessage(address: IpAddress, message: String) = ...
}
class ConnectionFailed(...) extends NetworkException(...) {...}

val address = new IpAddress("google.com")
val exception = new ConnectionFailed(address)
println(exception.message + ": " + exception.stackTrace)
</pre></div>
</div>
<div class="slide">
<h1>Specialization</h1>
<p>Note these two classes:</p>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

class Exception(
    message: String = "[No Message]", 
    cause: Option[Exception] = None) {
  ...
}

class NetworkException(
    address: IpAddress, 
    message: String = "", 
    cause: Option[Exception] = None) extends Exception(...) {
  ...
}
</pre></div>
<p><code>Exception</code> has two properties, <code>message</code> and <code>cause</code>, while <code>NetworkException</code> has those properties plus the <code>address</code> property.</p>
</div>
<div class="slide">
<h1>Specialization (cont.)</h1>
<p>Note that the set of possible <code>NetworkException</code> objects is <em>smaller</em>  than the set of possible <code>Exception</code> objects, even though <code>NetworkException</code> has one <em>more</em> <strong>property</strong> than <code>Exception</code> has. This is because a valid <code>Exception</code> object can be an instance of other kinds of exceptions, e.g., <code>NullPointerException</code>, <code>InvalidArgumentException</code>, etc.</p>
<p>However, there are <em>fewer</em> possible behaviors for <strong>methods</strong> (<strong>member functions</strong>) in <code>Exception</code> than for <code>NetworkException</code>, because <code>Exception</code> has fewer <strong>properties</strong> upon which a method could act.</p>
<p>In other words, when I have a reference to an <code>Exception</code>, I can&#8217;t do as much with it as I can do if I know I have a <code>NetworkException</code>.</p>
</div>
<div class="slide">
<h1>Specialization (cont.)</h1>
<p>To be explicit:</p>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

val ex = new Exception("Boo!", someOtherException)
println(ex.message)
println(ex.cause)

// vs.

val nex =  NetworkException(new IpAddress("google.com"),
  "Bogus address?", looksLikeABogusAddressException)
  
println(nex.address)
println(nex.message)
println(nex.cause)
</pre></div>
</div>
<div class="slide">
<h1>Liskov Substitution Principle (<span class="caps">LSP</span>)</h1>
<p><em>Let q(x) be a property provable about objects x of type T. Then q(y) should be true for objects y of type S where S is a subtype of T.</em></p>
<p><span style="text-align: right; width: 100%"><br />
(The <a href="http://en.wikipedia.org/wiki/Liskov_substitution_principle">Liskov Substitution Principle</a>)<br />
</span></p>
<p>It&#8217;s a definition of <em>subtyping</em>; If I claim that <code>S</code> is a subtype of <code>T</code>, then objects of type <code>S</code> must obey the <em>contract</em> defined for objects of type <code>T</code>.</p>
<p>I said <em>contract</em>, didn&#8217;t I? There&#8217;s a close relationship between <span class="caps">LSP</span> and Design by Contract.</p>
</div>
<div class="slide">
<h1>Liskov Substitution Principle (cont.)</h1>
<center>
<p><code>Square</code> <em>is a</em> <code>Rectangle</code></p>
</center>
<p>True? What does <em>is a</em> mean??</p>
</div>
<div class="slide">
<h1>Liskov Substitution Principle (cont.)</h1>
<p>What&#8217;s the contract for <code>Rectangle</code>?</p>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

// We'll ignore its position
class Rectangle(val height: Int, val width: Int) {
  @invariant(this.height == $previous.height)
  def setWidth(w: Int) = width = w
  
  @invariant(this.width == $previous.width)
  def setHeight(h: Int) = height = h
}
</pre></div>
</div>
<div class="slide">
<h1>Liskov Substitution Principle (cont.)</h1>
<p>A test for <code>Rectangle</code>:</p>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

val r = new Rectangle(2, 4)
r.setWidth(3)
assert (r.height == 4)  // didn't change
</pre></div>
</div>
<div class="slide">
<h1>Liskov Substitution Principle (cont.)</h1>
<p>I claim that <code>Square</code> <em>is a</em> <code>Rectangle</code>:</p>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">


class Square(val side: Int) extends Rectangle(side, side)

val s = new Square(4)
s.setWidth(3)
assert (s.height == 4)  // True???
</pre></div>
<p>Does the assertion still pass? No.</p>
</div>
<div class="slide">
<h1>Liskov Substitution Principle (cont.)</h1>
<p>The claim that <code>Square</code> <em>is a</em> <code>Rectangle</code> is not precise enough.</p>
<p>Rather it is <code>Square</code> <em>behaves as a</em> <code>Rectangle</code>, which is <em>false</em>.</p>
<p><span class="caps">LSP</span> tells us that substitutability is based on <em>behavior</em>, not &#8220;structural&#8221; simularities.</p>
</div>
<div class="slide">
<h1>Liskov Substitution Principle (cont.)</h1>
<p>But it&#8217;s not always false that <code>Square</code> <em>behaves as a</em> <code>Rectangle</code>!</p>
<ul>
	<li>If <code>Square</code> and <code>Rectangle</code> are <em>immutable</em>, then <code>Square</code> is substitutable for <code>Rectangle</code>, because the breakage was related to mutation!</li>
	<li>Note that contracts are two-way, involving a client. If the client never modifies a square, then the rectangle contract is never tested.</li>
</ul>
<p>So, once again, we need to understand an object&#8217;s <em>contract</em>.</p>
</div>
<div class="slide">
<h1>Prototype-Based Languages</h1>
<p><em>Not all OO systems have classes!</em></p>
<p><em>Prototype-based languages</em> don&#8217;t have classes. (Hence they are also called <em>classless</em> languages.) Instead, you just build up objects &#8220;from scratch&#8221;.</p>
<p>JavaScript object-literal notation (essentially, a hash map):<br />
<div class="code-small"></p>

<pre name="code" id="code" class="brush: scala,;">

var exception = {
  address: "google.com",
  message: "Could not connect to google.com",
  stackTrace: function() { ... }
};
console.log(exception.stackTrace());
</pre></div>
</div>
<div class="slide">
<h1>Prototype-Based Languages (cont.)</h1>
<p>You can add and remove members at will after creating the object.</p>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

delete exception.address;   // remove the 'address' element

exception.name = "ExceptionFormerlyRepresentingANetworkException";
</pre></div>
</div>
<div class="slide">
<h1>Aside: <em>Open Classes</em></h1>
<p>Note that many <em>dynamically-typed, class-based</em> languages, e.g., Ruby, allow this kind of object modification, too. They are said to have <em>open classes</em>.</p>
<p>Most <em>statically-typed</em> languages, like Scala, Java, C#, and C++, have closed classes. You can&#8217;t add or remove members in objects.<sup class="footnote" id="fnr1"><a href="#fn1">1</a></sup></p>
<p><sup class="footnote" id="fnr1"><a href="#fn1">1</a></sup> There are some workarounds, both byte-code level hacks and some language features, like Scala&#8217;s <em>implicits</em>.</p>
</div>
<div class="slide">
<h1>Prototype-Based Languages (cont.)</h1>
<p>In most prototype-based languages, there is a <code>clone</code> method for making <em>shallow</em> or <em>deep</em> copies from existing objects.</p>
<ul>
	<li><strong>shallow copy</strong>: References to members are <em>shared</em>.</li>
	<li><strong>deep copy</strong>: References to members are also copied <em>recursively</em>.</li>
</ul>
<p>Shallow copies are cheaper, but you have to be careful about modifying members; all copies will see the modifications. Deep copies are more expensive, but cleanly separate the states of the objects.</p>
</div>
<div class="slide">
<h1>Prototype-Based Languages (cont.)</h1>
<p>Once you have a clone, then you can extend it to add new members (i.e., <em>specialize</em> it). So:</p>
<p><em>Pure prototype-based languages don&#8217;t have class-based inheritance.</em></p>
<p>Instead, they support per-object extension.</p>
</div>
<div class="slide">
<h1>Good Object Design: Lesson 3</h1>
<p><code>NullPointerExceptions</code> (<code>NPEs</code>) are a serious problem in applications, usually indicating bugs. Can we eliminate <code>nulls</code> and <code>NPEs</code>? We can reduce their occurrence if we explicitly represent the concept of <em>optional</em>.</p>
<p>We need a type that says, &#8220;I either have a value for you or I don&#8217;t.&#8221;</p>
</div>
<div class="slide">
<h1>Java Map <span class="caps">API</span></h1>
<div class="code-small">
<pre name="code" id="code" class="brush: java,;">

interface Map&lt;K,V&gt; {
  ...
  V get(Object key);
  ...
}
</pre></div>
<p>Note that <code>get</code> could return <code>null</code> or an object. It&#8217;s easy to forget to check for <code>null</code>.</p>
<p><strong>Problem:</strong> The <span class="caps">API</span> doesn&#8217;t explicitly state that <code>nulls</code> are a possible return value. (You have to read the documentation.)</p>
</div>
<div class="slide">
<h1>Scala Map <span class="caps">API</span></h1>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

trait Map[K,+V] {
  ...
  def get(K key): Option[V]
  ...
}
</pre></div>
<p>Note that the return value, <code>Option[V]</code> explicitly says, &#8220;I might not have a value for that key.&#8221; Put another way, &#8220;It&#8217;s optional that I&#8217;ll return a value&#8230;&#8221;</p>
</div>
<div class="slide">
<h1><code>Option[+A]</code></h1>
<p>From the Scala library source:</p>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

sealed abstract class Option[+A] {
  def isEmpty: Boolean
  def get: A
  ...
}
final case class Some[+A](x: A) extends Option[+A] {
  def isEmpty: Boolean = false
  def get: A = x
}
case object None extends Option[Nothing] {
  def isEmpty: Boolean = true
  def get = throw new NoSuchElementException("None.get")
}
</pre></div>
</div>
<div class="slide">
<h1><code>Option[+A]</code>: Sealed Hierarchies</h1>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

sealed abstract class Option[+A] {
  def isEmpty: Boolean
  def get: A
  ...
}
</pre></div>
<p><strong>sealed:</strong> Only allowed subclasses must be defined in the <em>same file</em>.</p>
<p>Sometimes you want the type hierarchy to be open ended, e.g., geometric shapes in a graphics program. Other times, a class hierarchy represents a <em>finite set of well-defined &#8220;members&#8221;</em>.</p>
</div>
<div class="slide">
<h1><code>Option[+A]</code>: Sealed Hierarchies (cont.)</h1>
<p><code>Option[+A]</code> abstracts over a set with two elements, &#8220;something&#8221; (<code>Some[+A]</code>) and &#8220;nothing&#8221; (<code>None</code>).</p>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

sealed abstract class Option[+A] {...}
... Some[+A](x: A) extends Option[+A] {...}
... None extends Option[Nothing] {...}
</pre></div>
</div>
<div class="slide">
<h1><code>Option[+A]</code>: Abstract</h1>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

sealed abstract class Option[+A] {
  def isEmpty: Boolean
  def get: A
  ...
}
</pre></div>
<p><strong>abstract:</strong> The type <em>declares</em> an abstraction. Zero or more members that are <em>declared</em> might also be <em>defined</em> here.</p>
<p>We&#8217;re only showing abstract method declarations here, but the full <code>Option[+A]</code> type also has many <em>concrete</em> methods.</p>
</div>
<div class="slide">
<h1><code>Option[+A]</code>: <em>Covariant</em> Typing (<code>[+A]</code>)</h1>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

sealed abstract class Option[+A] {
  def get: A
  def isEmpty: Boolean
  ...
}
</pre></div>
<p><strong>+A:</strong> If <code>B</code> is a <em>subtype</em> of <code>A</code>, then <code>Option[B]</code> is a <em>subtype</em> of <code>Option[A]</code>.</p>
<p>There are also cases where you want <code>SomeType[-A]</code>, where if <code>B</code> is a <em>subtype</em> of <code>A</code>, then <code>Option[B]</code> is a <em>supertype</em> of <code>Option[A]</code>. We&#8217;ll come back to the question of what constitutes a <em>subtype</em>.</p>
</div>
<div class="slide">
<h1><code>Option[+A]</code>: <code>final</code> class</h1>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

final case class Some[+A](x: A) extends Option[+A] {
  def isEmpty: Boolean = false
  def get: A = x
}
</pre></div>
<p><strong>final</strong>: You are not allowed to <em>subtype</em> this type.</p>
<p>Part of the enforcement of the property that <code>Option[+A]</code> has a fixed, well-defined set of subtypes.</p>
</div>
<div class="slide">
<h1><code>Option[+A]</code>: <code>case</code> class</h1>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

final case class Some[+A](x: A) extends Option[+A] {
  def isEmpty: Boolean = false
  def get: A = x
}
</pre></div>
<p><strong>case</strong>: Causes the compiler to add additional methods. that are very useful.</p>
</div>
<div class="slide">
<h1><code>Option[+A]</code>: <code>case</code> class (cont.)</h1>
<p>Properties of <code>case</code> classes:</p>
<ul>
	<li>All constructor arguments default to <code>vals</code> (<em>fields</em>).</li>
	<li>Methods <code>toString</code>, <code>equals</code>, <code>hashCode</code> generated.</li>
	<li>A <em>companion object</em>, <code>object Some</code>, is also generated. It has these methods:
	<ul>
		<li><code>apply(x: A)</code>: a <em>factory</em> for creating a <code>Some[A]</code> without <code>new</code>. E.g.,</li>
	</ul></li>
</ul>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

def apply[A](x: A) = new Some(x)
</pre></div>

	<ul>
		<li><code>unapply[A](s: Some[A])</code>: a special method used in <em>pattern matching</em> to extract the wrapped value without calling <code>get</code> directly, etc.</li>
	</ul></div>
<div class="slide">
<h1><code>Unapply</code> and Pattern Matching</h1>
<p>Here&#8217;s a standard Scala idiom for extracting values from a map:</p>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

val oddMap = Map("one" -&gt; 1, "three" -&gt; 3, ...)
oddMap.get("two") match {
  case Some(value) =&gt; println("two -&gt; "+value)
  case None =&gt; println("No value for \"two\"")
}
</pre></div>
<p>Notice how we can&#8217;t <em>avoid</em> handling the case where nothing was available for the key. If we tried to treat the object returned by <code>get</code> as an <code>Int</code> and call <code>Int</code> methods, we would get type errors. If <code>get</code> returned <code>null</code>, the compiler couldn&#8217;t catch the error.</p>
</div>
<div class="slide">
<h1><code>Option[+A]</code>: <code>case</code> class (cont.)</h1>
<p>So, adding <code>case</code> to the declaration is equivalent to this:<br />
<div class="code-small"></p>

<pre name="code" id="code" class="brush: scala,;">

final class Some[+A](val x: A) extends Option[+A] {
  def isEmpty: Boolean = false
  def get: A = x
  def equals(other: AnyRef): Boolean = {...}
  def hashCode: Int = {...}
  def toString: String = {...}
}
object Some {
  def apply[A](x: A) = new Some(x)
  def unapply[A](s: Some[A]) = {...}
}
</pre></div>
</div>
<div class="slide">
<h1><code>Option[+A]</code>: <code>object</code> (<em>Singletons</em>)</h1>
<p><strong>Singleton</strong>: Where one and only one instance of a type is allowed.</p>
<p>In most languages, you use a convention, the <a href="http://en.wikipedia.org/wiki/Singleton_pattern">Singleton Design Pattern</a> to do this. In scala, it&#8217;s a keyword, <code>object</code>.</p>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

case object None extends Option[Nothing] {
  def isEmpty: Boolean = true
  def get = throw new NoSuchElementException("None.get")
}
</pre></div>
<p>We only need one instance of <code>None</code>, because it has only one possible <em>state</em>, hence it&#8217;s best to use a singleton <code>object</code>.</p>
</div>
<div class="slide">
<h1><code>Option[+A]</code>: <code>Nothing</code></h1>
<p><strong>Nothing</strong>: A subtype of <em>all</em> other types, with <em>no</em> instances.</p>
<p>Used for proper type safety.<br />
<div class="code-small"></p>

<pre name="code" id="code" class="brush: scala,;">

case object None extends Option[Nothing] {...}
</pre></div>
<p>Because <code>None</code> extends <code>Option[Nothing]</code> <em>and</em> <code>Option[+A]</code> is <em>covariant</em> in <code>A</code>, a <code>None</code> can be used anywhere an <code>Option[+A]</code> is required.</p>
</div>
<div class="slide">
<h1><code>Option[+A]</code> vs. <code>null</code> Recap</h1>
<p>Note that we used the type system and names to more explicitly describe code behavior.</p>
<p>The names chosen for the classes in the exception hierarchy also demonstrate this goal.</p>
<p>However, there needs to be a balance between <em>abstraction</em> and <em>concreteness</em>.</p>
</div>
<div class="slide">
<h1>Recap: Good Object-Oriented Design, Part I</h1>
<ul>
	<li>Clarify your encapsulation boundaries.</li>
	<li>Always be in a known good state.</li>
	<li>Know the possible states of your objects.
	<ul>
		<li>Make the type system work for you.</li>
	</ul></li>
	<li>Clarify the contract of use.
	<ul>
		<li>Don&#8217;t forget how it applies to subclasses!</li>
	</ul></li>
	<li>Avoid <code>nulls</code> with <code>Option[+A]</code>.</li>
</ul>
</div>
<div class="slide">
<h1>Exercise</h1>
<p>I&#8217;m not assigning a new exercise this week. Rather, I&#8217;m assigning more reading than usual. Also, since many of you are behind on the project assignment, I want you to try to catch up this week.</p>
</div>
<div class="slide">
<h1>Reading Assignment: <span class="caps">SOLID</span> Principles</h1>
<p>The <span class="caps">SOLID</span> principles (an acronym) of OO design include the Liskov Substitution Principle and 4 others. They were cataloged by my former boss, Robert &#8220;Uncle Bob&#8221; Martin.</p>
<ul>
	<li><a href="http://en.wikipedia.org/wiki/Solid_(object-oriented_design)"><span class="caps">SOLID</span> Principles of Object-Oriented Design</a> (Wikipedia).</li>
	<li><a href="http://butunclebob.com/ArticleS.UncleBob.PrinciplesOfOod">Principles of <span class="caps">OOD</span></a>. An older, but more complete blog post and accompanying articles (PDFs) that describe the <span class="caps">SOLID</span> principles.</li>
</ul>
</div>
<div class="slide">
<h1>Reading Assignment: Design Patterns</h1>
<p>Design Patterns are one of the most influential ideas in software development in the last 20 years. At some point, you should buy your own copy of Erich Gamma, Richard Helm, Ralph Johnson, John M. Vlissides, &#8220;Design Patterns: Elements of Reusable Object-Oriented Software&#8221;, Addison-Wesley, 1994, <span class="caps">ISBN</span> 0201633612. The authors are affectionately known as the <em>Gang of Four</em>. For now, read the following.</p>
<ul>
	<li><a href="http://en.wikipedia.org/wiki/Design_pattern_(computer_science)">Design Pattern</a>. Provides some historical background, but not a very clear description of what patterns <strong>are</strong>. Also has a good list of documented patterns.</li>
	<li><a href="http://sourcemaking.com/design_patterns">Design Patterns</a>. A succinct description of the concept of patterns and description of the <em>Gang of Four</em> patterns.</li>
</ul>
</div>
<div class="slide">
<h1>Reading Assignment: Specific Design Patterns</h1>
<p>Read the Wikipedia (or SourceMaking) descriptions of these, representative patterns.</p>
<ul>
	<li><a href="http://en.wikipedia.org/wiki/Abstract_factory_pattern">Abstract Factory Pattern</a>.</li>
	<li><a href="http://en.wikipedia.org/wiki/Singleton_pattern">Singleton Pattern</a>.</li>
	<li><a href="http://en.wikipedia.org/wiki/Observer_pattern">Observer Pattern</a>.</li>
</ul>
</div>
<div class="slide">
<h1>Reading Assignment: Design by Contract</h1>
<ul>
	<li><a href="http://en.wikipedia.org/wiki/Design_by_contract">Design by Contract</a>.</li>
</ul>
</div>
<div class="title slide">
<h1>Lecture 9: Effective Object-Oriented Programming (<span class="caps">OOP</span>), Part II</h1>
</div>
<div class="slide">
<h1>Why Are Objects Interesting?</h1>
<p>Because managing complexity is one of our biggest challenges. Mentally, we object encapsulation in our daily lives to avoid being overwhelmed by sensory input. Object-Oriented Programming tries to apply that same strategy to managing software complexity.</p>
<p>However, like any tool, objects can be used in situations where their drawbacks outweigh their benefits.</p>
</div>
<div class="slide">
<h1>Some History</h1>
<div class='small'>
<table>
	<tr>
		<th>Year </th>
		<th>Event</th>
		<th>Features</th>
		<th>Notes</th>
	</tr>
	<tr>
		<td> 1967 </td>
		<td> Simula </td>
		<td> Objects, classes, subclasses, virtual methods, coroutines, discrete event simulation, garbage collection. </td>
		<td> First OO Language.</td>
	</tr>
	<tr>
		<td> 1972 </td>
		<td> Smalltalk </td>
		<td> Object-oriented, dynamically typed, reflective. </td>
		<td> First public version in 1980</td>
	</tr>
</table>
</div>
</div>
<div class="slide">
<h1>Some History (cont.)</h1>
<div class='small'>
<table>
	<tr>
		<th>Year </th>
		<th>Event</th>
		<th>Features</th>
		<th>Notes</th>
	</tr>
	<tr>
		<td> 1983 </td>
		<td> C++ </td>
		<td> Classes, virtual functions, operator overloading, multiple inheritance, templates. </td>
		<td> Most widely used OO language in the 90s. (?) </td>
	</tr>
	<tr>
		<td> 1986 </td>
		<td> Eiffel </td>
		<td> Design by contract, command-query separation, uniform-access principle, single-choice principle, open-closed principle, and option-operand separation </td>
		<td> Very innovative. Still used in some industries, esp. in Europe.</td>
	</tr>
</table>
<p>In 1984, Apple introduced the Macintosh, the first popular copmuter with a Graphical User Interface. GUIs were quickly seen as ideal for <span class="caps">OOP</span>.</p>
</div>
</div>
<div class="slide">
<h1>Some History (cont.)</h1>
<div class='small'>
<table>
	<tr>
		<th>Year </th>
		<th>Event</th>
		<th>Features</th>
		<th>Notes</th>
	</tr>
	<tr>
		<td> 1995 </td>
		<td> Java </td>
		<td> &#8220;Simplified C++&#8221;, plus byte code running on a virtual machine. </td>
		<td> Rapid adoption with the Internet. </td>
	</tr>
	<tr>
		<td> 1995 </td>
		<td> JavaScript </td>
		<td> Prototype-based, scripting, dynamically and weakly typed, first-class functions, closures, higher-order functions. </td>
		<td> Also considered a functional programming language. Inspired by Scheme. </td>
	</tr>
</table>
</div>
</div>
<div class="slide">
<h1>Some History (cont.)</h1>
<div class='small'>
<table>
	<tr>
		<th>Year </th>
		<th>Event</th>
		<th>Features</th>
		<th>Notes</th>
	</tr>
	<tr>
		<td> 2003 </td>
		<td> Scala </td>
		<td> Object-oriented and functional programming. </td>
		<td> Runs on the <span class="caps">JVM</span> and .<span class="caps">NET</span> <span class="caps">CLR</span>. </td>
	</tr>
	<tr>
		<td> 2007 </td>
		<td> Clojure </td>
		<td> Lisp on the <span class="caps">JVM</span>. </td>
		<td> Innovative approaches to mutable state. </td>
	</tr>
</table>
<p>The rise of functional programming, with some languages taking a hybrid object-functional approach, like Scala, OCaml, and JavaScript, while other languages are discounting the value of objects, like Clojure.</p>
</div>
</div>
<div class="slide">
<h1>Eiffel Innovations</h1>
<ul>
	<li><strong>Design by Contract:</strong> Discussed last lecture.</li>
	<li><strong>Command-Query Separation:</strong></li>
	<li><strong>Uniform-Access Principle:</strong></li>
	<li><strong>Single-Choice Principle:</strong> (a.k.a. <em>Don&#8217;t Repeat Yourself</em>)</li>
	<li><strong>Open-Closed Principle:</strong></li>
	<li><strong>Option-Operand Separation:</strong> (We won&#8217;t discuss this one.)</li>
</ul>
</div>
<div class="slide">
<h1>Command-Query Separation</h1>
<p>To keep each &#8220;piece&#8221; of code as simple as possible, each object and function should <em>do only one &#8220;thing&#8221;</em>. This is the <em>Single Responsibility Principle</em>, the &#8220;S&#8221; in the <span class="caps">SOLID</span> principles.</p>
</div>
<div class="slide">
<h1>Command-Query Separation (cont.)</h1>
<p>If a function executes a &#8220;command&#8221; and it returns a value (&#8220;query&#8221;), it&#8217;s doing <em>two</em> things. Hence, you should have separate command and query functions:</p>
<ul>
	<li><strong>Command:</strong> Do something, i.e., update state, but don&#8217;t return values. (It might return a &#8220;success&#8221; indicator&#8230;)</li>
	<li><strong>Query:</strong> Return a result, but don&#8217;t alter state (at least not the visible state &#8211; it may update an internal <em>cache</em>, for example.)</li>
</ul>
<p>Example: JavaBean getters and setters.</p>
</div>
<div class="slide">
<h1>CQ Separation: Counterexamples</h1>
<p><strong>Builders:</strong></p>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

import org.chicagoscala.awse.domain.finance._
val criteria = CriteriaMap().
  withInstruments(instruments).
  withStatistics(statistics).
  withStart(start).
  withEnd(end)
</pre></div>
<p><strong>Functional Operations:</strong></p>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

// Generate a sequence of strings: "2", "4"
(1 to 10) filter (_ % 2 == 0) map (_.toString) take 2
// ...immutable.IndexedSeq[java.lang.String] = Vector(2, 4)
</pre></div>
</div>
<div class="slide">
<h1>Uniform-Access Principle</h1>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

case class Person(name:String, age: Int)
...
val dean = Person("Dean Wampler")
println(dean.name)
</pre></div>
<p>Am I calling a method <code>name</code> or accessing a &#8220;bare&#8221; <code>name</code> field??</p>
</div>
<div class="slide">
<h1>Uniform-Access Principle (cont.)</h1>
<p>The <em>caller</em> doesn&#8217;t care whether a method is invoked or a bare field is accessed.</p>
<p>The <em>implementer</em> might want to start with a simple bare field access, then eventually replace it with a method call (e.g., to do lazy initialization, etc.).</p>
<p>The <em>uniform-access principle</em> means the caller&#8217;s code doesn&#8217;t have to change, because the syntax is identical. (The code might need a recompile).</p>
</div>
<div class="slide">
<h1>Uniform-Access Principle (cont.)</h1>
<p>Note that the JavaBean convention for getters and setters does <em>not</em> support this principle!</p>
<div class="code-small">
<pre name="code" id="code" class="brush: java,;">

class Person {
  private String name;
  public String getName() { return name; }
  
  public Person(String name) { this.name = name; }
}
...
val dean = Person("Dean Wampler")
println(dean.getName());
// very different from:
// println(dean.name);
</pre></div>
</div>
<div class="slide">
<h1>Single-Choice Principle</h1>
<p>This is now more commonly known as <span class="caps">DRY</span>, <em>Don&#8217;t Repeat Yourself</em>. It means, don&#8217;t write code that duplicates the work of other code.</p>
<ul>
	<li>Leads to bloat.</li>
	<li>Each version must be maintained, kept in sync.
	<ul>
		<li>It&#8217;s very common for the versions to &#8220;grow&#8221; out of sync, leading to bugs.</li>
	</ul></li>
</ul>
</div>
<div class="slide">
<h1>Good Object Design: Lesson 4</h1>
<p><em>Don&#8217;t Repeat Yourself</em> is more valuable than it might sound at first. Removing duplication pays dividends in terms of code quality, size, and maintainability over the life of a project.</p>
</div>
<div class="slide">
<h1>Open-Closed Principle</h1>
<p>The &#8220;O&#8221; in the <span class="caps">SOLID</span> principles.</p>
<p>How can we add new behavior to the system without editing existing code? Philip Wadler called this the <em>Expression Problem</em>.</p>
<p>If we edit existing code,</p>
<ul>
	<li>we must retest, redeploy&#8230;</li>
	<li>we force clients of the code to modify their code and retest, redeploy&#8230;</li>
</ul>
</div>
<div class="slide">
<h1>Open-Closed Principle (cont.)</h1>
<p>Inheritance is a classic way to do this. Our windowing example demonstrates this:</p>
<center>
<span style="width: 100%;">
<img src="images/Windows_WindowsFactories.png"></img>
</span>
</center>
<p>We could add iPhone and Android classes, for example, without changing any existing classes&#8230; in principle&#8230;</p>
</div>
<div class="slide">
<h1>Open-Closed Principle (cont.)</h1>
<p>In practice, when you introduce new subclasses, the existing abstractions may not fully support their needs, forcing some changes on the existing types. Hopefully, that&#8217;s rare.</p>
</div>
<div class="slide">
<h1>Open-Closed Principle (cont.)</h1>
<p>We&#8217;ll return to this principle when we talk about <em>Type Classes</em> in functional programming.</p>
</div>
<div class="slide">
<h1>Good Object Design: Lesson 5</h1>
<p>In long-lived projects, take the time to factor out abstractions so you can exploit the <em>Open-Closed Principle</em>. It will minimize the maintenance effort over time.</p>
</div>
<div class="slide">
<h1>Strong Dependencies</h1>
<p>Last time, we talked at length about encapsulation. We also mentioned that it helps minimize dependencies (coupling) between modules. Some of the principles we just discussed also do this. Let&#8217;s explore dependencies some more.</p>
<center>
<p><img src="images/Module_Dependencies.png"></img></p>
</center>
<p>Is it bad if <code>GUI</code> depends on <code>MacWindowFactory</code>??</p>
</div>
<div class="slide">
<h1><code>gui.windowing</code></h1>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

package gui.windowing {

  abstract class Window(dimensions: Dimensions) {...}  
  abstract class WindowFactory {
    def make(properties: Properties): Window
  }
  
  protected[gui] package mac {
    MacWindow(...) extends Window(...) {...}
    object MacWindowFactory extends WindowFactory {
      def make(properties: Properties): Window = {...}
    }
  }
  protected[gui] package windows {
    WindowsWindow(...) extends Window(...) {...}
    ...
  }
  ...
}
</pre></div>
</div>
<div class="slide">
<h1>Other Modules</h1>
<p><span class="caps">BAD</span>:<br />
<div class="code-small"></p>

<pre name="code" id="code" class="brush: scala,;">

object MyApp {
  def makeNewWindow(properties: Properties) {
    val window = mac.MacWindowFactory.make(properties)
    // Other Mac-specific calls...
  }
}
</pre></div>
<p><span class="caps">GOOD</span>:<br />
<div class="code-small"></p>

<pre name="code" id="code" class="brush: scala,;">

object MyApp {
  def makeNewWindow(properties: Properties) {
    val window = WindowFactory.make(properties)
    // Other generic calls...
  }
}
</pre></div>
</div>
<div class="slide">
<h1>Why Are Strong Dependencies Bad?</h1>
<ul>
	<li><strong>Testing</strong></li>
	<li><strong>Maintenance</strong></li>
</ul>
</div>
<div class="slide">
<h1>Testing</h1>
<p>If I want to test a module, I have to set up all its dependencies. That&#8217;s painful if the dependencies are <strong>concrete</strong> objects like database connections, user interfaces, external processes, etc.</p>
<p>For example, I could only test the &#8220;bad&#8221; version of <code>MyApp.makeNewWindow</code> with a Macintosh. Also, in general, creating <span class="caps">GUI</span> widgets is much slower than avoiding real UI calls.</p>
<p>But if <code>makeNewWindow</code> depends only on abstractions (e.g., Java interfaces), I can use a <em>stub</em> implementation of <code>WindowFactory</code> that makes <em>unit</em> testing easy and fast.</p>
<p>(We&#8217;ll revisit testing in a few weeks.)</p>
</div>
<div class="slide">
<h1>Maintenance</h1>
<p>If you have several other teams that depend on the implementation of <code>MacWindowFactory</code>, you can&#8217;t change it without pain:</p>
<ul>
	<li>You have to plan with those teams when to introduce the changes.</li>
	<li>You and they have to coordinate the changes.</li>
	<li>They have to <em>unit</em> test their changes in isolation.</li>
	<li>The organization has to <em>integration</em> test the changes.</li>
	<li>All the changes need to be deployed in a coordinated manner.</li>
</ul>
</div>
<div class="slide">
<h1>Good Object Design: Lesson 6</h1>
<p>Keep dependencies to a minimum.</p>
<ul>
	<li>Depend only on abstractions.</li>
	<li>Depend on a minimum number of modules.</li>
</ul>
</div>
<div class="slide">
<h1>Inheritance Is A Strong Dependency</h1>
<p>It&#8217;s important to note that <em>inheritance is a form of strong dependency</em>. (About the strongest in fact.) The advantages vs. disadvantages need to be weighed.</p>
</div>
<div class="slide">
<h1>Inheritance Is A Strong Dependency (cont.)</h1>
<p><strong>Advantages:</strong></p>
<ul>
	<li>Reuse of state and behavior.</li>
	<li>Grouping of &#8220;logically-similar&#8221; things.</li>
</ul>
<p><strong>Disadvantages:</strong></p>
<ul>
	<li>Any change to parent may require changes to child.</li>
	<li>Proper implementations of <code>clone</code>, <code>equals</code>, <code>hashCode</code> challenging.</li>
	<li>Can&#8217;t &#8220;abstract over&#8221; the dependency.</li>
</ul>
<p>Like any form of dependency, it should be used <em>sparingly</em>.</p>
</div>
<div class="slide">
<h1>Composition vs. Inheritance</h1>
<p>Compare the following approaches:</p>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

abstract class Addressable(
  ..., val city:String, val state:String, val zip:ZipCode)
  
case class Person(name:String, age: Int)
  extends Addressable
</pre></div>
<p>Does <code>Person</code> <em>behave as</em> an <code>Addressable</code>? What does <em>that</em> mean?</p>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

class Address(
  ..., val city:String, val state:String, val zip:ZipCode)
  
case class Person(name:String, age: Int, address: Address)
</pre></div>
<p>Makes more sense to say <code>Person</code> <em>has an</em> <code>Address</code>.</p>
</div>
<div class="slide">
<h1>Composition vs. Inheritance (cont.)</h1>
<p>Not only does &#8220;<code>Person</code> <em>has an</em> <code>Address</code>&#8221; make more sense, but now we can treat address as an abstraction. For example, we can pass in the correct kind of address appropriate for the country the person lives.</p>
</div>
<div class="slide">
<h1>Less Trivial Example:</h1>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

package graphics {
  // Abstraction
  trait Rectangle {...}
}
package opengl {
  // Concrete implementation.
  class OGLRectangle(val lowerLeft: Point, val upperRight: Point) 
    extends graphics.Rectangle {...}
}
package gui.windowing.x11 {  
  // Inherits concrete implementation
  class X11Window(properties: Properties) 
    extends opengl.OGLRectangle(...) {...}
}
</pre></div>
</div>
<div class="slide">
<h1>Versus:</h1>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

package graphics {
  // Abstraction
  trait Rectangle {...}  
}
package opengl {
  // Concrete implementation.
  class OGLRectangle(val lowerLeft: Point, val upperRight: Point) 
    extends graphics.Rectangle {...}
}
package gui.windowing.x11 {  
  // Uses an object implementing abstraction.
  class X11Window(properties: Properties, rect: Rectangle) {...} 
}
</pre></div>
<p>We <em>compose</em> the X11 window with an implementing rectangle.</p>
</div>
<div class="slide">
<h1>Composition vs. Inheritance (cont.)</h1>
<p>So, dependency on abstractions is the weakest form of dependency. Therefore, we should prefer <em>composing</em> behavior over <em>inheriting</em> it.</p>
<p><strong>Object Properties:</strong></p>
<p>Every property is a reference to another object (as long as you consider, numbers, booleans, etc. objects&#8230;)</p>
</div>
<div class="slide">
<h1>Mixins</h1>
<p>An alternative to using <em>properties</em> is to use <em>mixins</em>, which are like standalone objects (they have their own <em>behavior</em>: state and/or functions), but they are designed to be mixed into other objects using the inheritance mechanism, but with weaker coupling.</p>
<p>Most of the time, these behaviors will be <em>orthogonal</em>.</p>
<center>
<span style="width: 100%;">
<img src="images/StateSpace.png"></img>
</span>
</center>
</div>
<div class="slide">
<h1>Example: Logging Mixin</h1>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

package utils {
  trait Logging {
    def error(message: String) = {...}
    def warning(message: String) = {...}
    def info(message: String) = {...}
  }
}

package gui.windowing.x11 {  
  // Make all windows with logging mixed in:
  object X11WindowFactory extends WindowFactory { 
    def make(properties: Properties) = {
      val dimensions = // get dimensions from properties
      new X11Window(dimensions) with utils.Logging
    } // returns window WITH Logging mixed in!
  } 
}
</pre></div>
</div>
<div class="slide">
<h1>Mixins (cont.)</h1>
<p>Other times, the mixin behavior may be closely linked to the class.</p>
<p>Example: How could you model the M:N relationship between windowing toolkits (e.g., Xll, Windows, Aqua, etc.) and the low-level graphics APIs (e.g., OpenGL, DirectX, Quartz, etc.)</p>
</div>
<div class="slide">
<h1>Joining <span class="caps">GUI</span> and Graphics Libs</h1>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

package graphics { // for any graphics library...
  trait Rectangle {  // abstraction of rectangle.
    val lowerLeft: Point  // traits don't have constructors,
    val upperRight: Point // ... so we declare "fields" here.
    ...
  }
}
package opengl {  // OpenGL-specific "driver"
  trait OGLRectangle extends graphics.Rectangle {...}
}
package gui.windowing.x11 {  
  // "self type" declaration:
  // X11Window will be composed with a Rectangle...
  abstract class X11Window(properties: Properties) { 
    self: Rectangle =&gt;
    ...
  } 
}
</pre></div>
</div>
<div class="slide">
<h1>Self Types in Scala</h1>
<p><em>Self type declarations</em>, like this:</p>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

abstract class X11Window(properties: Properties) { 
  self: Rectangle =&gt;
  ...
}
</pre></div>
<p>are &#8220;promises&#8221; that any <em>concrete</em> class eventually created from <code>X11Window</code> will mix in a <code>Rectangle</code> trait. In byte code, it is identical to <code>X11Window extends Rectangle</code>, but avoids the <em>is a</em> trap (Liskov Substitution Principle).</p>
</div>
<div class="slide">
<h1>Self Types in Scala</h1>
<p>In other words, we could write it this way:</p>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

abstract class X11Window(properties: Properties) 
  extends Rectangle { 
  ...
}
</pre></div>
<p>However, that would imply that <code>X11Window</code> is <em>substitutable</em> for <code>Rectangle</code> (Liskov), which is a poor inheritance relationship.</p>
<p>Self types emphasize instead that we will get the &#8220;Rectangle&#8221; behavior we need through a mixin.</p>
</div>
<div class="slide">
<h1>Instantiating the Objects</h1>
<p>So, to create actual objects the factory method would do this:</p>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

object X11WindowFactory extends WindowFactory { 
 def make(properties: Properties) = {
  val dimensions = // get dimensions from properties
  new X11Window(dimensions) with utils.Logging with OGLRectangle
  {
   val lowerLeft  = // get it from the dimensions
   val upperRight = // get it from the dimensions
  }
 } // returns window WITH Logging WITH OGLRectangle!
} 
</pre></div>
<p>Note: this technique is called the <a href="http://jonasboner.com/2008/10/06/real-world-scala-dependency-injection-di.html">Cake Pattern</a> (also discussed <a href="http://programming-scala.labs.oreilly.com/ch13.html">here</a> and used to <a href="http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.63.5834&amp;rep=rep1&amp;type=pdf">implement the Scala compiler itself</a>).</p>
</div>
<div class="slide">
<h1>Counterexample: Exception Hierarchies</h1>
<p>The Java exception hierarchy (and similar hierarchies in many other languages) is a good use of a deep inheritance hierarchy.</p>
<center>
<p><img src="images/exceptFig1.gif"></img></p>
</center>
<p>(credit: <a href="http://www.artima.com/designtechniques/exceptions.html">http://www.artima.com/designtechniques/exceptions.html</a>)</p>
</div>
<div class="slide">
<h1>Counterexample: Exception Hierarchies</h1>
<p>Why? Because this hierarchy forms a <em>classification tree</em>, similar to the way that all life on Earth is classified into the <em>Phylogenetic Tree</em>.</p>
<center>
<p><img src="images/450px-Phylogenetic_tree.png"></img></p>
</center>
<p>(credit: <a href="http://en.wikipedia.org/wiki/Phylogenetic_tree">http://en.wikipedia.org/wiki/Phylogenetic_tree</a>)</p>
</div>
<div class="slide">
<h1>Counterexample: Exception Hierarchies</h1>
<p>However, this only works if this hierarchy is very stable.</p>
</div>
<div class="slide">
<h1>Good Object Design: Lesson 7</h1>
<p>Prefer <em>composition</em> over <em>inheritance</em>.</p>
</div>
<div class="slide">
<h1>Problems with Objects</h1>
<p>Objects offer benefits, but they also pose theoretical and practical problems.</p>
<ul>
	<li><strong>Cloning Objects</strong></li>
	<li><strong>Determining Equality</strong></li>
	<li><strong>Typing of Object-Oriented Code</strong></li>
	<li><strong>Unrestrained Mutability</strong></li>
	<li><strong>Reusability</strong></li>
</ul>
</div>
<div class="slide">
<h1>Cloning Objects: Two Strategies</h1>
<ul>
	<li><strong>Shallow Copy:</strong> Parts are <em>shared</em>. References to other &#8220;sub-objects&#8221; in the new copy point to the same sub-objects in the original object.<br />
+ Faster cloning.<br />
- Changes to sub-objects affect both objects, so state is harder to control.</li>
	<li><strong>Deep Copy:</strong> Sub-objects are also copied, so the new and old objects are completely independent.<br />
- Expensive cloning.<br />
+ Easier to control state of each object separately.</li>
</ul>
<p>This is a language (or <span class="caps">API</span>) design decision. Needs to be consistently applied!</p>
</div>
<div class="slide">
<h1>Cloning Objects (cont.)</h1>
<p>Note that the &#8220;state problem&#8221; goes away if the objects are <em>immutable</em>!</p>
<p>This fact is exploited by <em>software transactional memory</em> implementations (e.g., subtree sharing) that we discussed earlier in the course.</p>
<p>Recall that modifications are implemented by creating new objects where the &#8220;invariant&#8221; parts are shared. No object is ever modified directly.</p>
</div>
<div class="slide">
<h1>Determining Equality</h1>
<p>It&#8217;s actually hard to <a href="http://www.artima.com/lejava/articles/equality.html">write a correct equality operator</a>. Let&#8217;s talk about Java, as a representative example.</p>
</div>
<div class="slide">
<h1>The Signature of <code>equals</code></h1>
<p>A common mistake is to get the signature wrong. Suppose I define <code>equals</code> for the <code>MacWindow</code> class we discussed earlier:</p>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

boolean equals(MacWindow window) {...}  // WRONG!!
</pre></div>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

boolean equals(Object other) {...}  // Right!
</pre></div>
<p>Why? Because in Java collections, all objects are <code>Object</code>, so the run time won&#8217;t look for the method that takes an <code>MacWindow</code> argument. Rather, it will use the &#8220;closest&#8221; <code>equals</code> method that takes an <code>Object</code> argument, perhaps the one on <code>Object</code> itself.</p>
</div>
<div class="slide">
<h1>Overlooking <code>hashCode</code></h1>
<p>You have to keep <code>hashCode</code> consistent with <code>equals</code>:</p>
<p><em>If <code>equals</code> says that two objects are equivalent, then <code>hashCode</code> applied to each object should return the same value.</em></p>
<p>The default <code>Object.hashCode</code> simply uses the object&#8217;s reference address. So, if you put an  object in a <code>HashSet</code> for example, then test for its presence using an equal but different object, you <em>might</em> (or not) get a false negative, depending on whether or not the <em>addresses</em> of the two objects both get hashed into the same bucket!</p>
</div>
<div class="slide">
<h1>Mutability: <code>equals</code>, <code>hashCode</code></h1>
<p>This is related to the previous problem with <code>HashSet</code> and similar collections. Suppose you create an object, put it in a <code>HashSet</code>, then mutate the object. You <em>might</em> find that the <code>HashSet</code> no longer believes it has the object!</p>
<p>This is because the <code>HashSet</code> uses the value of <code>hashCode</code> to determine the correct bucket for the object. However, if the object is mutable, then the value returned by <code>hashCode</code> changes, so <code>HashSet</code> might start looking in the wrong bucket for the object!</p>
</div>
<div class="slide">
<h1><code>equals</code> Is an <em>Equivalence Relation</em></h1>
<p>Your <code>equals</code> must satisfy the following properties:</p>
<ul>
	<li><strong>Reflexive:</strong> for any non-null value <code>x</code>, the expression <code>x.equals(x)</code> should return true.</li>
	<li><strong>Symmetric:</strong> for any non-null values <code>x</code> and <code>y</code>, <code>x.equals(y)</code> should return true <em>if and only if</em> <code>y.equals(x)</code> returns true.</li>
	<li><strong>Transitive:</strong> for any non-null values <code>x</code>, <code>y</code>, and <code>z</code>, if <code>x.equals(y)</code> returns true and <code>y.equals(z)</code> returns true, then <code>x.equals(z)</code> should return true.</li>
</ul>
</div>
<div class="slide">
<h1><code>equals</code> Is an <em>Equivalence Relation</em> (cont.)</h1>
<ul>
	<li><strong>Consistent:</strong> for any non-null values <code>x</code> and <code>y</code>, multiple invocations of <code>x.equals(y)</code> should consistently return true or false, provided no information used in equals comparisons on the objects is modified.</li>
	<li><strong>Nulls:</strong> For any non-null value <code>x</code>, <code>x.equals(null)</code> should return false.</li>
</ul>
</div>
<div class="slide">
<h1><code>equals</code> Is an <em>Equivalence Relation</em></h1>
<p>That doesn&#8217;t sound hard, but a classic mistake is to allow objects to be considered equal if the values of their <em>common supertypes are equal</em>.</p>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

// Scala syntax now...
class Point2D(val x: Double, val y: Double) { 
  override def equals(other: Any): Boolean = other match {
      case p: Point2D =&gt; x == p.x &amp;&amp; y == p.y
      case _ =&gt; false
    }
  }}
  
class Point3D(x: Double, y: Double, val z: Double)
    extends Point2D(x, y) { 
  override def equals(other: Any): Boolean = other match {
      case p: Point3D =&gt; x == p.x &amp;&amp; y == p.y &amp;&amp; z == p.z
      case _ =&gt; false
    }
  }}
</pre></div>
</div>
<div class="slide">
<h1><code>equals</code> Is an <em>Equivalence Relation</em></h1>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

val p2 = new Point2D(1, 2)
val p3 = new Point3D(1, 2, 3)
p2 == p3   // true
p3 == p2   // false!
</pre></div>
<p>Not only is symmetry broken, but this can lead to strange affects in collections, again.</p>
<p>(It also begs the question, is Liskov Substitutability satisfied by <br />
<code>Point2D &lt;: Point3D</code>?)</p>
</div>
<div class="slide">
<h1><code>equals</code> Is an <em>Equivalence Relation</em></h1>
<p>You could implement a fix for the symmetry by making the relation <code>a == b || b == a</code>, but this breaks transitivity:</p>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

val p2 = new Point2D(1, 2)
val p33 = new Point3D(1, 2, 3)
val p34 = new Point3D(1, 2, 4)
p2 == p33   // true
p33 == p2   // true, if we "fix" symmetry (see exercises)

p33 == p2   // true
p2  == p34  // true
p33 == p34  // false!
</pre></div>
</div>
<div class="slide">
<h1>Equals</h1>
<p>So, in most cases, you must also require the objects to be of the <em>same</em> type. However, than can be cases where a subtype doesn&#8217;t add any more <em>state</em> to the parent type. (We&#8217;ll see an example later in the lecture.) Objects of these types <em>could</em> be compared.</p>
<p>However, it&#8217;s still a questionable idea. Perhaps there shouldn&#8217;t be two different types after all?</p>
<p>See <a href="http://www.artima.com/lejava/articles/equality.html">here</a> for more details on show to implement this case.</p>
</div>
<div class="slide">
<h1>Typing of Object-Oriented Languages</h1>
<p>Creating a sophisticated and &#8220;sound&#8221; type system in object-oriented languages is harder than in a comparable functional language, because of subtyping. Java didn&#8217;t really try very hard. Scala goes quite far, but it takes some effort to master the type system (which is <em>Turing complete</em>, by the way).</p>
<p>Compare Haskell to Scala. Haskell infers most type information, while Scala is limited to <em>local type inference</em>, which is why the types of function arguments must be declared.</p>
</div>
<div class="slide">
<h1>Type &#8220;Invariance&#8221; Under Transformations</h1>
<p>Another common problem related to subtyping is what I&#8217;ll call the desire for <em>type invariance under transformations</em>. Here&#8217;s an example to describe what this means.</p>
<p>Suppose you want to map over a Scala <code>List</code>. Conveniently, <code>List</code> inherits a <code>map</code> method implementation that is defined in one of its ancestor types, <code>TraversableLike</code>.</p>
<p>Here&#8217;s the problem, I would like the result to also have the type <code>List</code>, not <code>TraversableLike</code> or some other lowest-common denominator type. However, I definitely don&#8217;t want <code>TraversableLike</code> to know about <code>List</code> or another other subtype.</p>
</div>
<div class="slide">
<h1>Type &#8220;Invariance&#8221; Under Transformations</h1>
<p>In a lot of strongly-typed object-oriented languages, there is no built-in way to get a new collection with the same type as the original (with the type parameter for the <code>List</code> possibly changed). Scala pre-2.8 also didn&#8217;t do this. However, Scala 2.8 exploits <em>implicit parameters</em> and special factory objects to do this.</p>
</div>
<div class="slide">
<h1>Type &#8220;Invariance&#8221; Under Transformations</h1>
<p>We want something &#8220;equivalent&#8221; to this <code>map</code> method signature for <code>List</code>:</p>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

class List[A] {
  def map [B] (f: (A) ⇒ B): List[B]
  ...
}
</pre></div>
<p>Here is the actual signature for <code>TraversableLike.map</code></p>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

trait TraversableLike {
  def map [B, That] (f: (A) ⇒ B)(
      implicit bf: CanBuildFrom[Repr, B, That]) : That
  ...
}
</pre></div>
</div>
<div class="slide">
<h1>Type &#8220;Invariance&#8221; Under Transformations</h1>
<p>Note there are two argument <em>lists</em> and the second one takes a single <code>implicit</code> parameter. Recall that the user doesn&#8217;t have to specify these parameters if a suitable object is in scope. Here, <code>CanBuildFrom</code> is supplied by the Scala library. It knows how to build a <code>List[B]</code> object (which is what <code>That</code> represents), based on the current &#8220;representation&#8221; <code>Repr</code> and the type parameter <code>B</code>.</p>
</div>
<div class="slide">
<h1>Static Types vs. Real-World Variability</h1>
<p>It is sometimes said that &#8220;objects model the real world&#8221;. One problem with this view is that real world objects are not always fixed and unchangeable. They can be more fluid, depending on context and changes over time.</p>
<p>However, class-based and especially statically-typed languages don&#8217;t reflect this fluid nature of reality. Prototype languages and languages with &#8220;open types&#8221; are more accommodating to this kind of change.</p>
<p>Yet, as we&#8217;ll discuss in subsequent lectures, trying to mimic the world too faithfully is overkill for most programming problems.</p>
</div>
<div class="slide">
<h1>Unrestrained Mutability</h1>
<p>It&#8217;s a hallmark of <span class="caps">OOP</span> that you send messages to objects, which do appropriate computations, possibly modifying internal state, then send a reply to the caller and/or send other messages to other objects.</p>
<p>However, the mutability part presents problems.</p>
</div>
<div class="slide">
<h1>Mutability and Correctness</h1>
<p>We saw earlier that <code>hashCode</code> and <code>equals</code> are unreliable when objects mutate.</p>
<p>Mutability also makes evaluating <em>correctness</em> (e.g., through testing) more difficult, because if we are testing one thing, we have to also test how it affects mutable objects with which it interacts.</p>
<p>Furthermore, as we discussed last week, you have to carefully consider the state transitions of an object.</p>
</div>
<div class="slide">
<h1>Mutability and Concurrency</h1>
<p>However, more than any other reason, the growing need to embrace <em>concurrency</em> to create scalable and reliable applications has made mutability more problematic.</p>
<p>As we discussed in an earlier lecture, all the locking challenges of multi-threaded programming go away when objects are immutable.</p>
</div>
<div class="slide">
<h1>Reusability</h1>
<p>As <span class="caps">OOP</span> went mainstream, a perceived benefit was the ability to create <em>reusable object libraries</em>. This largely failed, except in limited cases (such as collections libraries and windowing APIs).</p>
<p>Why?</p>
</div>
<div class="slide">
<h1>Reusability and &#8220;Baroque&#8221; Abstractions</h1>
<p>We&#8217;ll explore this topic in depth towards the end of the course, but for now, note that objects can expose abstractions with almost no constraints at all. They can take virtually any form, following many different conventions and styles. Paradoxically, this freedom <em>inhibits</em> reuse, because one object library is rarely <span class="caps">API</span>-compatible with others.</p>
<p>Also, library designers often do a poor job of <em>minimizing dependencies</em> (coupling), so to use their library requires you to use lots of dependencies you might not want.</p>
<p>(We felt this pain, unfortunately, when setting up the Akka project.)</p>
</div>
<div class="slide">
<h1>Conclusions, Part II</h1>
<p>Effective OO design exploits principles like the <em>Open-Closed Principle</em> and the <em>Liskov-Substitution Principle</em> to minimize coupling and the impact of changes on clients of the code, etc.</p>
<p>In addition to their benefits, objects present a number of difficulties. Correct implementations of <code>equals</code> and <code>hashCode</code> are hard to write. Mutability causes a number of problems.</p>
</div>
<div class="slide">
<h1>Reading Assignments: <span class="caps">OOP</span></h1>
<ul>
	<li><a href="http://jonasboner.com/2008/10/06/real-world-scala-dependency-injection-di.html" title="DI">Real-World Scala: Dependency Injection</a>.</li>
	<li><a href="http://www.artima.com/lejava/articles/equality.html">How to Write an Equality Method in Java</a>.</li>
</ul>
</div>
<div class="slide">
<h1>Reading Assignments: FP</h1>
<ul>
	<li><a href="http://en.wikipedia.org/wiki/Functional_programming">Functional Programming</a> (Wikipedia).</li>
	<li><a href="http://www.defmacro.org/ramblings/fp.html">Functional Programming for the Rest of Us</a>.</li>
</ul>
</div>
<div class="slide">
<h1>Exercise 1: Equality</h1>
<p>Implement the &#8220;improved&#8221; equals methods for <code>Point2D</code> and <code>Point3D</code> that satisfy symmetry. Demonstrate by example that they satisfy symmetry, but still fail to satisfy transitivity.</p>
</div>
<div class="slide">
<h1>Exercise 2: Design by Contract</h1>
<p>In the Akka project, consider <code>DataStore.range</code> in the <code>org.chicagoscala.awse.persistence</code> package.</p>
<p>Write down all the preconditions, postconditions, and invariants that you can think of that would be reasonable constraints on this method. (Hint: the <code>DataStoreTest</code> checks some, but not all of the possibilities.)</p>
</div>
<div class="slide">
<h1>Exercise 3: Select a &#8220;Mini-Project&#8221; by Next Tuesday</h1>
<p>Talk to me over the next week about what you want to do for the mini-project we discussed last week. We need to agree on a project by next Tuesday, November 9.</p>
</div>
<div class="slide">
<h1>Appendix: <span class="caps">LSP</span> Revisited</h1>
<p>Let&#8217;s return to the Liskov Substitution Principle (<span class="caps">LSP</span>) and discuss how it works under inheritance.</p>
<p>Recall this definition from the last lecture:</p>
</div>
<div class="slide">
<h1>Liskov Substitution Principle (<span class="caps">LSP</span>)</h1>
<p><em>Let q(x) be a property provable about objects x of type T. Then q(y) should be true for objects y of type S where S is a subtype of T.</em></p>
<p><span style="text-align: right; width: 100%"><br />
(The <a href="http://en.wikipedia.org/wiki/Liskov_substitution_principle">Liskov Substitution Principle</a>)<br />
</span></p>
<p>It&#8217;s a definition of <em>subtyping</em>; If I claim that <code>S</code> is a subtype of <code>T</code>, then objects of type <code>S</code> must obey the <em>contract</em> defined for objects of type <code>T</code>.</p>
<p>I said <em>contract</em>, didn&#8217;t I? There&#8217;s a close relationship between <span class="caps">LSP</span> and Design by Contract.</p>
</div>
<div class="slide">
<h1>How Subclasses Must Behave</h1>
<p>First, let&#8217;s define <code>Output</code> and <code>LineOrientedOutput</code> classes:</p>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

class Output(val name: String) {
  def write(chars: Array[Character]) = {...}
  override def toString = "Output(" + name + ")"
}
class LineOrientedOutput(name: String) 
    extends Output(name) {
  def writeln(string: String) = {...}
  override def toString = "LineOrientedOutput(" + name + ")"
}
</pre></div>
<p><code>LineOrientedOutput</code> <em>specializes</em> <code>Output</code> to add support for writing a line at a time.</p>
</div>
<div class="slide">
<h1>How Subclass Must Behave (cont.)</h1>
<p>Now, consider <em>function literals</em> (a.k.a <em>anonymous functions</em>) in Scala, which we&#8217;ll use in a call to <code>List.map</code>:</p>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

// Return a list of Output streams.
def toOutputs(list: List[String]): List[Output] =
  list map { s =&gt; new Output("out" + s) }

val outputs: List[Output] = toOutputs(List("A", "B"))
// =&gt; List(Output(outA), Output(outB))
</pre></div>
</div>
<div class="slide">
<h1>How Subclass Must Behave (cont.)</h1>
<p>For the anonymous function, the scala compiler generates an <em>anonymous subclass</em> of the <code>Function1[String,Output]</code> <em>trait</em>:</p>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

new Function1[String,Output] {
  def apply(s: String) = new Output("out" + s)
}
</pre></div>
<p>Note that the <em>body</em> of the function literal is used to define the <code>apply</code> method, which is abstract in the <code>Function1[A,B]</code> trait.</p>
</div>
<div class="slide">
<h1>How Subclass Must Behave (cont.)</h1>
<p>Let&#8217;s extract the anonymous function into a <code>val</code> and pass it to <code>toOutputs</code>:</p>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

val s2o: (String =&gt; Output) = s =&gt; new Output("out" + s)

def toOutputs(
     list: List[String], f: String=&gt;Output): List[Output] =
  list map f

val outputs: List[Output] = toOutputs(List("A", "B"), s2o)
// =&gt; List(Output(outA), Output(outB))
</pre></div>
<p>Is there a <em>subclass</em> of <code>String =&gt; Output</code>? If so, how should it behave?</p>
</div>
<div class="slide">
<h1>Function1 Subtypes</h1>
<p>Recall that the type is actually <code>Function1[-A,+R]</code>, where <code>A</code> is the type of the single argument and <code>R</code> is the type of the return value. Recall also from the last lecture that the <code>+R</code> means the return type behaves <em>covariantly</em> under inheritance, while <code>-A</code> means that the argument behaves <em>contravariantly</em> under inheritance. Let&#8217;s understand what this really means.</p>
</div>
<div class="slide">
<h1>Covariant and Contravariant Behaviors</h1>
<p>If I have a parameterized type <code>X[+A]</code>, it means that <code>X[String]</code> is a <em>subtype</em> of <code>X[AnyRef]</code>, since <code>String</code> is a <em>subtype</em> of <code>AnyRef</code>. This is <em>covariant</em> behavior.</p>
<p>However, if I have a parameterized type <code>Y[-A]</code>, it means that <code>Y[String]</code> is a <em>super type</em> of <code>Y[AnyRef]</code>, since <code>String</code> is a <em>subtype</em> of <code>AnyRef</code>. This is <em>contravariant</em> behavior.</p>
<p>The contravariant behavior is harder to grasp. Keep in mind that we are <em>always</em> discussing inheritance in the context of the <em>Liskov Substitution Principle</em>. Inheritance only has meaning in the sense that I can <em>substitute</em> an object of one type for an object of another type (i.e. a &#8220;parent&#8221; type).</p>
</div>
<div class="slide">
<h1>Covariant and Contravariant Behaviors (cont.)</h1>
<p>So, what does this mean for <code>Function1[-A,+R]</code>? First consider the <code>+R</code> for the return value, which behaves <em>covariantly</em>. In our example, we defined a function this way:</p>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

val s2o: (String =&gt; Output) = s =&gt; new Output("out" + s)
</pre></div>
<p>Suppose we define a new function that returns <code>LineOrientedOutput</code>:</p>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

val s2loo: (String =&gt; LineOrientedOutput) = 
  s =&gt; new LineOrientedOutput("out" + s)

def toOutputs ... // same

val outputs: List[Output] = toOutputs(List("A", "B"), s2loo)
// returns: List[Output] = List(LineOrientedOutput(outA), LineOrientedOutput(outB))
</pre></div>
<p>This works fine!</p>
</div>
<div class="slide">
<h1>Covariant Behavior of Return Values</h1>
<p><code>s2loo</code> <em>always</em> returns a <code>LineOrientedOutput</code>. That&#8217;s fine, because the clients that use <code>toOutputs</code> expect a <code>List[Output]</code> and <code>List[LineOrientedOutput]</code> is a subtype.</p>
<p>This is why return values must be <em>covariant</em>.</p>
<p>So, <code>s2loo</code> of type <code>Function[String,LineOrientedOutput]</code> is a <em>subtype</em> of <code>Function1[String,Output]</code>, since <code>LineOrientedOutput</code> is a <em>subtype</em> of <code>Output</code>.</p>
</div>
<div class="slide">
<h1>Contravariant Behavior of Arguments</h1>
<p>Now consider what we can do with the arguments, which behave <em>contravariantly</em>, since <code>Function1</code> is declared <code>Function1[-A,+R]</code>.</p>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

val a2o: (Any =&gt; Output) = 
  s =&gt; new Output("out" + s.toString)

def toOutputs ... // same

val outputs: List[Output] = toOutputs(List("A", "B"), a2o)
// returns: List[Output] = List(LineOrientedOutput(outA), LineOrientedOutput(outB))
</pre></div>
<p>This also works!</p>
</div>
<div class="slide">
<h1>Contravariant Behavior of Arguments</h1>
<p>Why does it work? <code>toOutputs</code> only accepts a <code>List[String]</code> as the first argument. Each string will be passed to the 2nd argument, the transformation function which creates an <code>Output</code>. In this case, <code>a2o</code> is that function. It can handle <code>Any</code> object, so it can easily handle strings. Hence, no breakage.</p>
<p>So, <code>a2o</code> of type <code>Function[Any,Output]</code> is also a <em>subtype</em> of <code>Function1[String,Output]</code>, even though <code>Any</code> is a <em>supertype</em> of <code>String</code>.</p>
</div>
<div class="slide">
<h1><span class="caps">LSP</span> and Design by Contract</h1>
<p>Remember that we&#8217;re describing the way that <code>Function1.apply</code> behaves under inheritance.</p>
<p><span class="caps">LSP</span> says that we can substitute an object if it <em>broadens</em> the allowed input values its methods can handle, because clients will still only pass the subset of values the <em>preconditions</em> say are acceptable. Hence, the precondition contract is preserved.</p>
<p>Similarly, an object is substitutable if its methods return a <em>narrower</em> set of values, because that set will always be within a broader set the client expects, as defined by the <em>postconditions</em>.</p>
<p>That&#8217;s how <span class="caps">LSP</span> and Design by Contract are related.</p>
</div>
<div class="title slide">
<h1>Lecture 10: Functional Programming (FP): Into the Real World</h1>
<p>Functional Programming is the oldest <em>paradigm</em> of software development, yet it has had relatively little penetration outside academia, at least until recently.</p>
<p>We&#8217;ll discuss why this transition is happening next week.</p>
</div>
<div class="slide">
<h1>What Is Functional Programming?</h1>
<p>FP treats computation as the <em>application of functions</em> rather than the direct <em>mutation of state</em>.</p>
<p>FP has its roots in mathematics, specifically <em>lambda calculus</em><sup class="footnote" id="fnr1"><a href="#fn1">1</a></sup>, a formal system developed in the 1930s to investigate function definition, function application,  recursion, etc. (Yes, before the invention of electronic computers.) Many functional programming languages can be viewed as elaborations on the lambda calculus.</p>
<p><sup class="footnote" id="fnr1"><a href="#fn1">1</a></sup> For this reason, anonymous functions in many languages are called <em>lambdas</em>.</p>
<p>(Adapted from <a href="http://en.wikipedia.org/wiki/Functional_programming">Wikipedia</a>.)</p>
</div>
<div class="slide">
<h1>State in Functional Programming</h1>
<p>There is a common misconception that functional programs are <em>stateless</em>. If this were true, they could accomplish <em>nothing</em>, except to heat up your computer!</p>
<p>Where object oriented programs (for example) change state by mutating variables explicitly, <em>pure</em> functional programs represent state <em>on the stack</em> only.</p>
<p>That is, the values you pass to functions and the values they return represent the current state of the world.</p>
</div>
<div class="slide">
<h1>FP and Mathematics</h1>
<p>How is FP like mathematics?</p>
</div>
<div class="slide">
<h1>Immutability</h1>
<p>Math variables are not, well &#8230; <em>variable</em>.</p>
<p>x = cos(y)<sup>2</sup></p>
<p>When <code>y</code> is chosen, <code>x</code> is <em>fixed</em>.</p>
</div>
<div class="slide">
<h1>Immutability Benefits</h1>
<p>We have seen many cases where mutability is problematic in software:</p>
<ul>
	<li>Multithreaded concurrency.</li>
	<li>Behavior of <code>equals</code> and <code>hashCode</code>.</li>
	<li>Shallow cloning.</li>
</ul>
</div>
<div class="slide">
<h1>No Side Effects</h1>
<p>Just as <code>x</code> is not mutable, so to is the rest of the world. So, by definition, immutability means there can be no <em>side effects</em>. This also has important implications for functions:</p>
<p>x = cos(y)<sup>2</sup></p>
<p><strong>All</strong> work done by <code>cos(y)</code> (for example) is returned and assigned to <code>x</code>. there is no global state that is updated.<sup class="footnote" id="fnr1"><a href="#fn1">1</a></sup></p>
<p>Functions without side effects are called <em>pure.</em></p>
<p><sup class="footnote" id="fnr1"><a href="#fn1">1</a></sup> However, a real implementation might update &#8220;invisible&#8221; state like a cache of previously-calculated values.</p>
</div>
<div class="slide">
<h1>Benefits of No Side Effects</h1>
<p>If the work of a function is independent of global state:</p>
<ul>
	<li><strong>Referentially Transparency:</strong> I can call it <em>anywhere</em> and <em>anytime</em>.</li>
	<li><strong>Correctness:</strong> I can reason about its behavior (e.g., test it) in isolation.</li>
	<li><strong>Memoization:</strong> I can substitute a value for the function invocation (subject to the arguments). That is, I can remember previous invocations with particular arguments and cache the results for faster subsequent invocations. I.e., create a &#8220;memo&#8221; of the previous call.</li>
</ul>
</div>
<div class="slide">
<h1>First Class Functions</h1>
<p>Functions are <em>first class</em> concepts, just like values.</p>
<p>square(z) = z<sup>2</sup><br />
x = square(cos(y))</p>
<p>Note that square takes a <em>value</em>, but the value could be a &#8220;variable&#8221; <em>or</em> a function.</p>
<p>That is, <em>functions are values</em>.</p>
<p>Note: a function that takes other functions as arguments or returns a function value is called a <em>higher-order function</em>.</p>
</div>
<div class="slide">
<h1>Benefits of First Class Functions</h1>
<p><strong>Composition:</strong> Just like object composition, <em>function composition</em> is a rich, <em>generative</em> tool.</p>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

// Generate a sequence of strings:
(1 to 10) filter (_ % 2 == 0) map (_.toString) take 2
// ...immutable.IndexedSeq[java.lang.String] = Vector(2, 4)
</pre></div>
<p><em>Generative</em> means I can combine pieces to generate new, more complex behaviors.</p>
</div>
<div class="slide">
<h1>Objects as &#8220;First Class Functions&#8221;</h1>
<p>Actually, this is not all that different than what you&#8217;ve done in Java, which doesn&#8217;t have first class functions:</p>
<div class="code-small">
<pre name="code" id="code" class="brush: java,;">

// Pretend FilterFunc and MapFunc are interfaces with 
// apply methods:
FilterFunc even = new FilterFunc { 
  boolean apply(int i) { return i % 2 == 0; }
}
MapFunc stringize = new MapFunc {
  String apply(int i) { return Integer.toString(i); }
}
// Pretend there is a Range type and there are filter and
// map methods that take "*Func" objects, and there is 
// a take method:
new Range(1, 10).filter(even).map(stringize).take(2)
</pre></div>
</div>
<div class="slide">
<h1>Closures as Objects</h1>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

var count = -1
val uniqueFileName: Function1[String, String] = { prefix =&gt;
  count += 1
  prefix + count
}
uniqueFileName("/foo/bar") // =&gt; "/foo/bar/0"
uniqueFileName("/foo/bar") // =&gt; "/foo/bar/1"
uniqueFileName("/foo/bar") // =&gt; "/foo/bar/2"
</pre></div>
<p><code>uniqueFileName</code> refers to a variable outside its scope (including its argument list). It forms a <em>closure</em>, i.e., it &#8220;closes over&#8221; the variables it references. Note that the 3 calls behave just like a stateful object.</p>
<p><em>Objects are essentially closures</em>. (Especially clear in prototype-based languages, like JavaScript.)</p>
</div>
<div class="slide">
<h1>Imperative vs. Declarative Programming</h1>
<p><strong>Imperative Programming:</strong> Tell the system <em>how</em> to do a computation.<br />
<strong>Declarative Programming:</strong> Tell the system <em>what</em> computation to do.</p>
<p>Declarative programming:</p>
<ul>
	<li>More clearly separates abstraction (the <em>what</em>) from implementation (the <em>how</em>).</li>
	<li>Minimizes writing the <em>how</em>.</li>
	<li>Minimizes <em>visible</em> side effects (therefore, promotes <em>referentially transparent</em>).</li>
	<li>Can sometimes be understood by non-programmers (e.g., project &#8220;stakeholders&#8221;).</li>
</ul>
</div>
<div class="slide">
<h1>FP != Imperative Programming (IP)</h1>
<p>Both have &#8220;functions&#8221;, but FP emphasizes the application of (mathematical) functions, while IP emphasizes state changes. In fact, IP puts no constraints on mutability, side effects, etc. We&#8217;ve already seen in this course how these &#8220;freedoms&#8221; can be problematic.</p>
<p>Note that <span class="caps">OOP</span> and <em>procedural programming</em> (pre-<span class="caps">OOP</span>, e.g., C) are both examples of Imperative Programming.</p>
</div>
<div class="slide">
<h1>Higher-Kinded Types</h1>
<p>Much of type theory has been worked out in FP, then applied more broadly. Consider constructing an <code>Exception</code>:</p>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

case class MyException(...) extends RuntimeException(...)
val ex = MyException("This is an exception.")
</pre></div>
<p>Now consider creating a <code>List</code> of <code>Exceptions</code>:</p>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

type ExceptionList = List[Exception]
</pre></div>
<p>(We&#8217;ve used Scala&#8217;s way of declaring a <code>type</code>, just like a variable. You can think of it like a type &#8220;alias&#8221;).</p>
</div>
<div class="slide">
<h1>Higher-Kinded Types (cont.)</h1>
<p>The example illustrates an analogy; <code>List[A]</code> is a <em>type constructor</em>, used to construct <em>concrete types</em> like <code>List[Exception]</code>, just like the <code>MyException</code> class is used to construct <em>concrete objects</em>.</p>
<p>Because types like <code>List[A]</code> takes a type as an argument, they are called <em>higher-kinded</em> types, analogous to <em>higher-order</em> functions, which take other functions as arguments or return function results.</p>
</div>
<div class="slide">
<h1>Higher-Kinded Types (cont.)</h1>
<p>Why are they useful, because they let us abstract over the details of the &#8220;contained&#8221; type and focus on operations applied to the container itself.</p>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

def printList(list: List[_]) = list map println
printList(List(1, "two", 3.3))
// =&gt; 1
// =&gt; two
// =&gt; 3.3
</pre></div>
<p>Note that we use the wildcard <code>_</code> for the <code>List[_]</code> parameter, because we don&#8217;t care what it is.<sup class="footnote" id="fnr1"><a href="#fn1">1</a></sup></p>
<p><sup class="footnote" id="fnr1"><a href="#fn1">1</a></sup> Actually, on the <span class="caps">JVM</span> we have no choice, because this type information is <em>erased</em> in the byte code.</p>
</div>
<div class="slide">
<h1>Higher-Kinded Types (cont.)</h1>
<p>Note also the <em>point-free style</em> of the function definition:</p>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

def printList(list: List[_]) = list map println
</pre></div>
<p>It&#8217;s equivalent to this</p>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

def printList(list: List[_]) = list map (x =&gt; println(x))
</pre></div>
<p>Not having to write &#8220;boilerplate&#8221;, like the <code>x</code> variable, simplifies the code and minimizes mistakes. This is also a benefit in Scala of using <em>function application</em>, e.g., <code>foo(x)</code>, vs. object method syntax, e.g., <code>x.foo</code>. For the latter, if <code>println</code> were a method on all objects, we would have to write:</p>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

def printList(list: List[_]) = list map (x =&gt; x.println)
</pre></div>
</div>
<div class="slide">
<h1>For Comprehensions (Expressions)</h1>
<p>Consider this code from <code>InstrumentAnalysisServerSupervisor</code>, which calculates (or retrieves) the desired statistics for the desired instruments (stocks):</p>
<div class="code-tiny">
<pre name="code" id="code" class="brush: scala,;">

def calculate (criteria: CriteriaMap) = {
  val futures = // Save a sequence of "futures"
    for {     // "for comprehension"
      instrument &lt;- criteria.instruments // each instrument
      statistic  &lt;- criteria.statistics  // each statistic
      calculator &lt;-       // get an InstrumentAnalysisServer...
        getOrMakeInstrumentAnalysisServerFor(instrument, statistic)
    } yield (    // "yield" the future; goes into sequence
      calculator !!!    // send message to actor, returning future 
        CalculateStatistics(    // message to send...
          criteria.             // criteria ...
            withInstruments(instrument).  // this instrument
            withStatistics(statistic)))   // this statistic
  Futures.awaitAll(futures)    // Wait for all futures to finish
  futuresToJSON(futures, ...)  // convert result to JSON
}
</pre></div>
</div>
<div class="slide">
<h1>For Comprehensions</h1>
<p>Let&#8217;s focus on the <em>for comprehension</em>.</p>
<div class="code-tiny">
<pre name="code" id="code" class="brush: scala,;">

for {
  instrument &lt;- criteria.instruments   // iterates through list
  statistic  &lt;- criteria.statistics    // same
  calculator &lt;-  // getOrMake... returns an Option[...]
    getOrMakeInstrumentAnalysisServerFor(instrument, statistic)
} yield (...)
</pre></div>
<p><code>getOrMakeInstrumentAnalysisServerFor</code> returns an <code>Option[A]</code>. Even though it has 0 or 1 item, it behaves like any other collection. You can &#8220;iterate&#8221; through it, for example.</p>
</div>
<div class="slide">
<h1>For Comprehensions</h1>
<p>Other languages have similar constructs, e.g., <em>list comprehensions</em> (Python) or <em>sequence comprehensions</em>.</p>
<p>You are <em>comprehending</em> a collection, processing it, and possibly generating a new collection, etc.</p>
<p>It&#8217;s <em>declarative</em>. You don&#8217;t have to worry about loop counters, &#8220;fencepost errors&#8221;, etc.</p>
</div>
<div class="slide">
<h1>For Comprehensions</h1>
<p>What does this do?</p>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

val list =
  List(Some(0), None, Some(1), None, Some(2), None, Some(3))
val list2 = for {
  option &lt;- list
  number &lt;- option
  if number % 2 == 0
} yield (number)
</pre></div>
</div>
<div class="slide">
<h1>For Comprehensions</h1>
<p>What does this do?</p>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

val list =
  List(Some(0), None, Some(1), None, Some(2), None, Some(3))
val list2 = for {
  option &lt;- list
  number &lt;- option
  if number % 2 == 0
} yield (number)

// list2: List[Int] = List(0, 2)
</pre></div>
<p>No checks for <code>None</code> required! They are simply filtered out by the &#8220;iteration&#8221; over each option. Another argument for preferring <code>Options</code> instead of <code>nulls</code>, which would require explicit checks.</p>
</div>
<div class="slide">
<h1>For Comprehensions</h1>
<p>In the Akka project, many methods return <code>Option[A]</code> so that when they have no results (and return <code>None</code>) they are simply ignored by for comprehensions.</p>
<p>(Note: There are times when you might want to report that no results were found, but that can usually be handled in the lower-level method.)</p>
<p>For comprehensions are very declarative. They abstract over the details of handling iteration, &#8220;no results&#8221; (i.e., <code>None</code> or <code>Nil</code> lists), etc.</p>
</div>
<div class="slide">
<h1>For Comprehensions</h1>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

val list = for {
  number &lt;- (0 to 4)
  if number % 2 == 0
  nstring = "#" + number
} yield (nstring)
// =&gt; Vector(#0, #2, #4)
</pre></div>
<p>The three kinds of expressions in for comprehensions are shown in this example:</p>
<ul>
	<li><strong>Generators:</strong> &#8220;Generate&#8221; a sequence, e.g., <code>number &lt;- (0 to 4)</code>.</li>
	<li><strong>Filters:</strong> Filter some of the values, e.g., <code>if number % 2 == 0</code>.</li>
	<li><strong>Definitions:</strong> E.g., <code>string = number.toString</code>, where <code>string</code> is a value (without the <code>val</code> required).</li>
</ul>
</div>
<div class="slide">
<h1>For Comprehensions</h1>
<p>In Scala, for comprehensions that <code>yield</code> are actually &#8220;sugar&#8221; around calls to <code>map</code> and <code>flatMap</code> (the <code>x &lt;- expression</code> expressions), and <code>filter</code> (the <code>if</code> expressions).</p>
<p>If the comprehension doesn&#8217;t <code>yield</code> (as in the following example), it is sugar around equivalent <code>filter</code> and <code>foreach</code> expressions:</p>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

// Note: this comprehension has "pure" side effects!
for {
  number &lt;- (0 to 4)
  if number % 2 == 0
  nstring = "#" + number
} println (nstring)
</pre></div>
</div>
<div class="slide">
<h1>For Comprehensions</h1>
<p>The <em>first</em> generator is sugar for <em>map</em>.</p>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

for (i &lt;- (0 to 5)) yield i
// =&gt; ...immutable.IndexedSeq[Int] = Vector(0, 1, 2, 3, 4, 5)

// It's equivalent to: 
(0 to 5) map (i =&gt; i)
// =&gt; ...immutable.IndexedSeq[Int] = Vector(0, 1, 2, 3, 4, 5)
</pre></div>
<p>The for comprehension syntax is a bit easier to follow.</p>
</div>
<div class="slide">
<h1>For Comprehensions</h1>
<p>Where does <code>flatMap</code> come in?? Consider this comprehension:</p>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

for {
  i &lt;- (1 to 4)
  j &lt;- (1 to i)  // like a nested for loop in Java
} yield (i,j)
// =&gt; ....immutable.IndexedSeq[(Int, Int)] = \ 
//  Vector((1,1), (2,1), (2,2), (3,1), (3,2), (3,3), (4,1), (4,2), (4,3), (4,4))

// Sugar for a call to map and flatMap? It's equivalent to: 
(1 to 4) map (i =&gt; i) flatMap (j =&gt; (1 to j) map {x =&gt; (j,x)})
// =&gt; same
</pre></div>
<p>The second version only takes one line ;), but it&#8217;s <strong>much</strong> harder to understand.</p>
</div>
<div class="slide">
<h1>Invocation Styles</h1>
<p><strong>receiver.method(args)</strong> vs. <strong>function(receiver, args)</strong></p>
<p>If you cut your teeth on OO languages, the syntax <code>receiver.method(args)</code> or perhaps <code>receiver message args</code> is familiar. It&#8217;s called the <em>method invocation</em> or <em>message send</em> syntax, depending on the OO environment.</p>
<p>Note that it is really syntactic sugar for <code>function(receiver, args)</code>. This syntax is called <em>function application</em> syntax. In fact, it is actually used in some OO languages, like Python.</p>
</div>
<div class="slide">
<h1>Invocation Styles (cont.)</h1>
<p>We&#8217;ve seen an example where the function application syntax is advantageous, for using <em>point free style</em>:</p>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

def printList(list: List[_]) = list map println
</pre></div>
<p>There are no &#8220;points&#8221;, e.g., variables required, which are actually distracting, once you become accustomed to this style. That can take a while, but it has the strong benefit of minimizing clutter and promoting a composition of behavior using <em>combinators</em>. (We won&#8217;t have time to explore these further.)</p>
</div>
<div class="slide">
<h1><span class="caps">OCP</span> and The Expression Problem</h1>
<p>Last week, we discussed the <em>Open-Closed Principle</em> (<span class="caps">OCP</span>), an object-oriented solution to a problem that Philip Wadler called the <em>Expression Problem</em>.</p>
</div>
<div class="slide">
<h1><span class="caps">OCP</span> and The Expression Problem (cont.)</h1>
<p>Specifically, how do we add new behavior without modifying existing code? This is useful so we minimize the need to retest and redeploy code that has already been tested and deployed, which if often costly in many scenarios. (Think about Google retesting and redeploying their code&#8230;)</p>
</div>
<div class="slide">
<h1><span class="caps">OCP</span> and The Expression Problem (cont.)</h1>
<p>The object-oriented approach is to use <em>inheritance</em>, where clients depend only on a <em>well-defined abstraction</em>, which is implemented by <em>concrete subtypes</em>. New &#8220;behaviors&#8221; can be added by defining new concrete subtypes for the same abstraction.</p>
<p>As long as the abstraction is sufficiently expressive and clients don&#8217;t depend on the concrete subtypes, we can add new behaviors to the code base without modifying existing code.<sup class="footnote" id="fnr1"><a href="#fn1">1</a></sup></p>
<p><sup class="footnote" id="fnr1"><a href="#fn1">1</a></sup> Recall that, every now and then, the abstraction won&#8217;t be general enough to support a new behavior, so the abstraction and possibly all the subtypes will require modification.</p>
</div>
<div class="slide">
<h1><span class="caps">OCP</span> and The Expression Problem (cont.)</h1>
<p>Example: geometric shapes</p>
<div class="code-tiny">
<pre name="code" id="code" class="brush: scala,;">

case class Point(x: Double, y: Double)
trait Shape { 
  def draw: Unit
}
case class Circle(center: Point, radius: Double) extends Shape { 
  def draw: Unit = // draw the shape
}
case class Rectangle(lowerLeft: Point, upperRight: Point) extends Shape { 
  def draw: Unit = // draw the shape
}
</pre></div>
</div>
<div class="slide">
<h1><span class="caps">OCP</span> and The Expression Problem (cont.)</h1>
<p>Now, we can easily add new shapes (&#8220;behaviors&#8221;) in other files by extending <code>Shape</code>. Now, client code won&#8217;t break when we add (or remove) shapes, if the client code only depends on <code>Shape</code>.</p>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

val shapes = ...
shapes foreach { _.draw }
</pre></div>
</div>
<div class="slide">
<h1><span class="caps">OCP</span> and The Expression Problem (cont.)</h1>
<p>But wait! Even these case classes are abstractions in the sense that <code>draw</code> will be <em>different</em> depending on the <em>graphics library</em>, OS, etc. In fact, you might not even need <code>draw</code> in many contexts (e.g., rendering an image, but not  drawing it).</p>
<p>Also, what if we suddenly need the ability to <em>serialize</em> and <em>deserialize</em> shapes, e.g., for writing to and reading from files? Now we have to modify the whole hierarchy, which means finding and modifying all shape definitions throughout the code base (they aren&#8217;t necessarily defined together), then retesting, redeploying, etc.</p>
<p>Or, do we??</p>
</div>
<div class="slide">
<h1><span class="caps">OCP</span> and The Expression Problem (cont.)</h1>
<p>In &#8220;naïve&#8221; OO, we would say that the <em>draw</em>, <em>serialize</em>, and <em>deserialize</em> must be methods on the <code>Point</code> and <code>Shape</code> type hierarchies. At least as early as the nineties, people realized it&#8217;s not a good idea, and sometimes impossible, to add every such method to objects. So, they invented the <em>Visitor Design Pattern</em>, which is documented in the &#8220;Gang of Four&#8221; patterns book.</p>
<p>This is actually an <em>inelegant</em> pattern that disrupts the code significantly. It&#8217;s been widely criticized, even called an <em>antipattern</em>. We won&#8217;t discuss it further. Instead, let&#8217;s discuss a far more elegant solution: <em>type classes</em>.</p>
</div>
<div class="slide">
<h1>Type Classes</h1>
<p>So, how do we add new behaviors to types, <em>as if the types already supported these behaviors</em>? In OO terms, we would like the new behaviors to work like methods on the types, but we <em>still</em> don&#8217;t want to modify existing code.</p>
<p>Enter <em>type classes</em>, a term from Haskell, where the word <code>class</code> here should not be confused with the notion of <code>class</code> in typical OO languages (like Scala).</p>
</div>
<div class="slide">
<h1>Type Classes</h1>
<p>Both the visitor pattern and type classes support the following two goals:</p>
<ol>
	<li>Avoiding the difficulty of adding a &#8220;similar&#8221; behavior to a family of existing types.</li>
	<li>Avoiding <em>feature creep</em> in types, where behavior is now available <em>globally</em>, even when it&#8217;s only needed in a few <em>local contexts</em>.</li>
</ol>
<p>To explain #2, recall that <code>draw</code> might not be needed by all clients of the <code>Shapes</code>. Only those clients which draw shapes should pay that &#8220;tax&#8221;. Also, a Window&#8217;s version shouldn&#8217;t have X11 code hanging around.</p>
</div>
<div class="slide">
<h1>Type Classes</h1>
<p>Superficially, a type class is like an interface that defines some operations to support a behavior:</p>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

val shapes = ...
trait Drawable { 
  def draw: Unit
}
</pre></div>
<p>There is a &#8220;class&#8221; (or set) of types that can support this behavior, hence the name. But don&#8217;t take this analogy too seriously&#8230;</p>
</div>
<div class="slide">
<h1>Type Classes</h1>
<p>Is this any different than the <em>mixins</em> we saw previously? Yes:</p>
<ul>
	<li>The implementation of <code>draw</code> varies with the type, unlike typical mixin behavior.</li>
	<li>To use a mixin, we have to control instantiation of the objects, which isn&#8217;t always possible.</li>
</ul>
<p>So, it&#8217;s not really the same as an interface (trait) in OO terms.</p>
<p>Type classes were invented for Haskell. Here&#8217;s how we can simulate them in Scala. We use <em>implicits</em>.</p>
</div>
<div class="slide">
<h1>Type Classes</h1>
<div class="code-tiny">
<pre name="code" id="code" class="brush: scala,;">

// An exception for when we FORGET to support a shape!
case class DrawNotSupported(a: Any) 
  extends RuntimeException(a.toString + ".draw() not supported")
  
class Drawable(shape: Shape) {
  def draw = shape match {
    case c: Circle =&gt; doDraw(c)
    case r: Rectangle =&gt; doDraw(r)
    case _ =&gt; throw DrawNotSupported(shape) 
  }
  private
  def doDraw(s: Shape) = println(s) // just print it for now.
}

object Drawable {
  // An implicit method, invoked by the compiler...
  implicit def shapeToDrawable(s: Shape) = new Drawable(s)
}
...
</pre></div>
</div>
<div class="slide">
<h1>Type Classes</h1>
<div class="code-tiny">
<pre name="code" id="code" class="brush: scala,;">

...
case class Point(x: Double, y: Double)
trait Shape   // No draw methods now!
case class Circle(center: Point, radius: Double) extends Shape
case class Rectangle(lowLeft:Point,upRight:Point) extends Shape

import Drawable._  // bring the implicit method in scope

Circle(Point(0.0, 0.0), 5.0).draw  // call the draw "method"!
// =&gt; Circle(Point(0.0,0.0),5.0)
Rectangle(Point(0.0, 0.0), Point(4.0, 2.0)).draw
// =&gt; Rectangle(Point(0.0,0.0),Point(4.0,2.0))

// Add a new Triangle class:
case class Triangle(a:Point,b:Point,c:Point) extends Shape
Triangle(Point(0.0, 0.0), Point(2.0, 0.0), Point(1.0, 1.0)).draw
// =&gt; ...DrawNotSupported: Triangle(...) does not support draw
// =&gt;   (stack trace)
</pre></div>
</div>
<div class="slide">
<h1>Type Classes</h1>
<p>- Easy to forget to change the type class code when the type hierarchy changes.<br />
- <em>Everything</em> about a particular type is not in one place.</p>
<p>+ Localizes behavior not universally applicable for types. (It&#8217;s lexically scoped, too!)<br />
+ Permits the addition of behavior without modifying existing types (<span class="caps">OCP</span>/Expression Problem).</p>
<p>(Some of these points are more specific to the Scala implementation).</p>
</div>
<div class="slide">
<h1>Pattern Matching vs. Inheritance</h1>
<p>We&#8217;ve seen many examples of pattern matching, like this one we just used.</p>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

class Drawable(shape: Shape) {
  def draw = shape match {
    case c: Circle =&gt; ...
    case r: Rectangle =&gt; ...
    case _ =&gt; throw DrawNotSupported(shape) 
  }
}
</pre></div>
<p>We also saw a drawback; it&#8217;s easy to forget to modify this code when the type hierarchy changes. Traditional OO would claim this code is an <em>antipattern</em>, for this reason. You should always replace it with inheritance. Yet, we just some reasons why this is not always a good idea.</p>
</div>
<div class="slide">
<h1>Pattern Matching vs. Inheritance (cont.)</h1>
<p>All design decisions are tradeoffs. Sometimes, the inheritance based solution is best. Other times, type classes are best.</p>
<p>This is a general principle: <em>Always question absolute statements about software design. There are always pros and cons.</em></p>
</div>
<div class="slide">
<h1>Pattern Matching and Modularity</h1>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

class Drawable(shape: Shape) {
  def draw = shape match {
    case c: Circle =&gt; ...
    case r: Rectangle =&gt; ...
    case _ =&gt; throw DrawNotSupported(shape) 
  }
}
</pre></div>
<p>Most languages have some form of <code>switch/case</code> statement. It&#8217;s usually syntactic sugar for <code>if/else</code> expressions. Most functional languages provide much richer pattern matching, often using it ubiquitously like inheritance is used in OO programs.</p>
</div>
<div class="slide">
<h1>Pattern Matching and Modularity (cont.)</h1>
<p>Here&#8217;s the same example expanded a bit.</p>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

class Drawable(shape: Shape) {
  def draw = shape match {
    case Circle(center, radius) =&gt; 
      drawCircle(center, radius)
    case Rectangle(lowerLeft, upperRight) =&gt; 
      drawRect(lowerLeft, upperRight)
    case _ =&gt; throw DrawNotSupported(shape) 
  }
  ...
}
</pre></div>
<p>The <code>unapply</code> methods are called that were provided automatically by the <code>case</code> keyword used to declare these types.</p>
</div>
<div class="slide">
<h1>Pattern Matching and Modularity (cont.)</h1>
<p>The <code>Circle.unapply</code> method is created on the <em>companion object</em>.</p>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

object Circle {
  ...
  def unapply(c: Circle):Option[Pair(Point,Point)] = 
    Some(Pair(c.center, c.radius))
}
</pre></div>
<p>The pattern-match byte code generated by the compiler does a type check on the <code>Shape</code> object (in the previous slide). If it&#8217;s a circle, it is passed to <code>Circle.unapply</code> to &#8220;deconstruct&#8221; it. Note that a <code>Tuple</code> is used to hold the returned values (a <code>Pair</code> in this case), wrapped in a <code>Some</code>. By returning <code>Option</code>, <code>unapply</code> is free to reject the operation, say if it doesn&#8217;t like one of the values.</p>
</div>
<div class="slide">
<h1>Pattern Matching and Modularity (cont.)</h1>
<p>This kind of pattern matching is a <em>principled</em> way to extract data from composites, without violating encapsulation, since the author of the type controls what gets extracted and how.</p>
<p>In the general case, the values exposed might not be the same as the properties of the object, but some computation over them. There might be no readers for object properties; only pattern matching support.</p>
<p>Note that other languages, like Erlang and Haskell, use pattern matching with different function signatures. Scala uses <em>overloaded</em> functions in the typical OO way, instead.</p>
</div>
<div class="slide">
<h1>Pattern Matching and Collections</h1>
<p>As a last example, pattern matching is a beautiful way to compute over a collection.</p>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

def double[A](list: List[A]): List[A] = list match {
  case Nil =&gt; Nil
  case head :: tail =&gt; head :: head :: double(tail)
}
double(1 :: 2 :: 3 :: 4 :: Nil)
// =&gt; List[Int] = List(1, 1, 2, 2, 3, 3, 4, 4)
double(Nil)
// =&gt; List[Nothing] = List()
</pre></div>
<p>This is classic functional style. There are no mutable variables. Recursion is used (another heavily-used concept in FP), and the state is on the stack!</p>
</div>
<div class="slide">
<h1>Laziness</h1>
<p>If you remember (fondly?) your math courses, you were often asked to manipulate expressions symbolically, e.g., reduce them to simpler forms, compute integrals or derivatives, etc. Then, you might have been asked to evaluate the expression for a final numerical result.</p>
<p>Also, you worked with infinite data types, like the set of real numbers, without having to specify a finite limit, like you have to do in software.</p>
</div>
<div class="slide">
<h1>Laziness</h1>
<p>&#8230; or do you?</p>
<p>In functional programming, <em>lazy evaluation</em> allows you to represent data structures &#8230; and computations &#8230; without requiring immediate evaluate.</p>
<p>In Haskell, everything is lazy by default. Let&#8217;s see one way to write the Fibonacci sequence (0, 1, 1, 2, 3, 5, 8, 13, &#8230;) using this feature.</p>
<p>First, recall the simplest definition of the Fibonacci sequence is this (using pseudo code):</p>
<div class="code-tiny">
<pre name="code" id="code" class="brush: plain,;">

fibs(0) = 0
fibs(1) = 1
fibs(n) = fibs(n-1) + fibs(n-2)
</pre></div>
</div>
<div class="slide">
<h1>Laziness</h1>
<p>Here is one of many ways to implement the sequence in Haskell.</p>
<div class="code-tiny">
<pre name="code" id="code" class="brush: plain,;">

fibs = 0 : 1 : zipWith (+) fibs (tail fibs)
</pre></div>
<p>This is an <em>infinite</em> recursion. (Notice the point free style&#8230;) <code>fibs</code> is the sequence and it is defined by two recursive calls to itself. The sequence starts with 0 and 1 (<code>:</code> is the &#8220;cons&#8221; operator, which is <code>::</code> in Scala). The expression <code>zipWith (+) fibs (tail fibs)</code> is easiest to understand schematically:</p>
<div class="code-tiny">
<pre name="code" id="code" class="brush: plain,;">

val fibs2 = [0, 1, 1, 2, 3, 5, ...] // infinite!
val tail  = [1, 1, 2, 3, 5, ...]
val zipped = fibs2 zip tail // =&gt; [[0, 1], [1, 1], [1, 2], [2, 3], ...]
val map = zipped map (array =&gt; array[0] + array[1])
// =&gt; [1, 2, 3, 5, ...] which is everything after the initial 0 and 1!!
</pre></div>
</div>
<div class="slide">
<h1>Laziness</h1>
<p>This only works if the sequences are not evaluated <em>strictly</em>; i.e., they are <em>lazy</em>.</p>
<p>Most Scala collections are <em>strict</em>, but <code>Streams</code> are lazy. So, here&#8217;s the same formula in Scala (Courtesy <a href="http://www.scala-blogs.org/2007/12/project-euler-fun-in-scala.html">Jorge Ortiz</a>):</p>
<div class="code-tiny">
<pre name="code" id="code" class="brush: scala,;">

lazy val fib: Stream[Long] = 
  Stream.cons(0, Stream.cons(1, fib.zip(fib.tail).map(p =&gt; p._1 + p._2)))
fib.take(15).print
// =&gt; 0, 1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89, 144, 233, 377, ...
</pre></div>
<p>Not as elegant as the Haskell case.</p>
</div>
<div class="slide">
<h1>Lazy Functions</h1>
<p>Of course, functions are also lazy in the sense that we define a computation, but treat it as a value that we can pass around and evaluate later.</p>
</div>
<div class="slide">
<h1>No Side Effects and Laziness: Drawbacks</h1>
<p>What&#8217;s wrong with this code?</p>
<div class="code-tiny">
<pre name="code" id="code" class="brush: scala,;">

println("Input your name, please.")
val response = readLine
</pre></div>
<ol>
	<li>Both lines have side effects.<br />
We&#8217;re modifying the state of the world when we do I/O, which seems to violate the goal of side-effect-free functions.</li>
	<li>They can&#8217;t be evaluated <em>lazily</em>.<br />
A virtue of lazy evaluation is that the runtime can decide when or even if to evaluate an expression, but clearly we must have these two expressions evaluated and in the order shown.</li>
</ol>
</div>
<div class="slide">
<h1>No Side Effects and Laziness: Drawbacks</h1>
<p>All functional languages must allow for these &#8220;exceptions&#8221;. Hybrid object-functional languages, like Scala, simply allow these exceptions anytime; they are just normal procedural code.</p>
<p>&#8220;Pure&#8221; languages like Haskell use special containers, called <em>monads</em>, which let the programmer clearly indicate these statements must be strict and/or allow side effects.</p>
<p>Just as <em>software transactional memory</em> offers a &#8220;principled&#8221; way to manage state changes, techniques like monads are a &#8220;principled&#8221; way to allow essential side effects and strict evaluation in a controlled way.</p>
</div>
<div class="slide">
<h1>Reading Assignments: FP</h1>
<ul>
	<li>Dean Wampler and Alex Payne, <a href="http://programming-scala.labs.oreilly.com/ch08.html">Functional Programming in Scala</a>, chapter 8 in <a href="http://programming-scala.labs.oreilly.com">Programming Scala</a>.</li>
</ul>
</div>
<div class="slide">
<h1>Reading Assignments: <span class="caps">OOP</span> vs. FP</h1>
<ul>
	<li>Dean Wampler, <a href="http://blog.objectmentor.com/articles/2009/04/20/is-the-supremacy-of-object-oriented-programming-over">Is the Supremacy of Object-Oriented Programming Over?</a>. A blog post I wrote last year on the changing landscape for FP vs. <span class="caps">OOP</span>. Read the non-<span class="caps">SPAM</span> comments, too.</li>
</ul>
</div>
<div class="slide">
<h1>Reading Assignments: Domain Specific Languages</h1>
<ul>
	<li><a href="http://www.martinfowler.com/bliki/DomainSpecificLanguage.html">Domain Specific Languages</a>. We talked about declarative programming. Domain-specific languages also tend to be declarative. Read this short introduction to get the &#8220;gist&#8221; of their purpose.</li>
</ul>
</div>
<div class="slide">
<h1>Optional Reading: Combinator Parsers, Etc.</h1>
<ul>
	<li>Daniel Spiewak, <a href="http://www.codecommit.com/blog/scala/the-magic-behind-parser-combinators">The Magic Behind Parser Combinators</a>. A good example of a <span class="caps">DSL</span> for parsing. The <span class="caps">DSL</span> is a Scala library for writing parser grammers in a syntax that is very similar to Backus-Naur form.</li>
	<li>Daniel Spiewak, <a href="http://dl.dropbox.com/u/1679797/CME%20Conf/Linguistic%20Programming%20v1.pdf">Linguistic Programming</a>. A talk that Daniel is giving <em>next week</em> at a <span class="caps">CME</span> conference here in Chicago. The example code is <a href="https://github.com/djspiewak/linguistic-programming">here</a>.</li>
</ul>
</div>
<div class="slide">
<h1>Exercise 1: Fibonacci Sequence</h1>
<p>Implement the following recursive algorithm to compute the Fibonacci value for input n. Calculate the values for n = 0 to 10. What happens if you try a very large n, like 10000 or 1000000?</p>
<div class="code-tiny">
<pre name="code" id="code" class="brush: plain,;">

fibs(0) = 0
fibs(1) = 1
fibs(n) = fibs(n-1) + fibs(n-2)
</pre></div>
<p>The Scala compiler does <em>tail-call optimization</em>. Does that work here?</p>
<p>The easy way to do this and the subsequent exercises is to start <code>sbt</code> in the Akka project directory and run <code>console-quick</code>. You&#8217;re now in the Scala <span class="caps">REPL</span> where you can experiment. You can copy code to the terminal to run it and you can save the output to submit as your solution (clean it up, first&#8230;).</p>
</div>
<div class="slide">
<h1>Exercise 2: Fibonacci Sequence</h1>
<p>Using the zip definition (repeated below), try <code>fib.take(100).print</code>. What happens for large N. Why?</p>
<div class="code-tiny">
<pre name="code" id="code" class="brush: scala,;">

lazy val fib: Stream[Long] = 
  Stream.cons(0, Stream.cons(1, fib.zip(fib.tail).map(p =&gt; p._1 + p._2)))
fib.take(100).print
// =&gt; 0, 1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89, 144, 233, 377, ...
</pre></div>
<p>Change the implementation to use <code>scala.math.BigInt</code>. What is the minimum number of code changes you have to make? (Hint, do you have to change line 2? Why or why not?) Now what happens when you run the code?</p>
</div>
<div class="slide">
<h1>Exercise 3: Fibonacci Sequence</h1>
<p>There are simple implementations that use iteration, a for loop, to avoid the problems of the first, recursive implementation. Find one on the web (or in an algorithms text) and implement it. Run the function with n = 0 to 10, 100 and 1000.</p>
</div>
<div class="slide">
<h1>Exercise 4: Type Classes</h1>
<p>It&#8217;s common for object-oriented languages to add a <code>toString</code> method to their root <code>Object</code> type. Note that this is essentially a <em>serialization</em> method. However, the default implementation is usually not very useful (e.g., Java&#8217;s). Also, the most useful format for the generated strings will be context dependent, i.e., sometimes you&#8217;ll want <span class="caps">XML</span>, sometimes <span class="caps">JSON</span>, sometimes an ad-hoc format. So, this is actually an excellent example for a type class implementation.</p>
<p>Using the type class example for <code>Shapes</code> starting around slide #40, implement <code>toXML</code> &#8220;methods&#8221; that write shape instances in a simple <span class="caps">XML</span> format. Show some examples where the methods generate <span class="caps">XML</span>.</p>
</div>
<div class="slide">
<h1>Mini-Project</h1>
<p>I haven&#8217;t heard from many of you about the mini-project you want to do. By Friday, I want each of you to reach an agreement with me on your mini-project.</p>
</div>
<div class="title slide">
<h1>Lecture 11: <span class="caps">OOP</span> vs. FP: a Critique of Pure Programming</h1>
<p>Functional Programming is starting to go &#8220;mainstream&#8221; (it&#8217;s still very early in that process). This implies that people are seeing problems with Object-Oriented Programming or how it is used. This lecture explores this trend.</p>
</div>
<div class="slide">
<h1>Why Is Industry Interest in FP Growing?</h1>
<p>We&#8217;ve discussed this before: concurrency. Multithreaded programming requires <em>synchronized access to shared, mutable state</em>. This is hard for all the reasons we&#8217;ve seen before.</p>
<p>However, immutable state, a hallmark of FP, doesn&#8217;t have this problem.</p>
</div>
<div class="slide">
<h1>A Little History; How Did <span class="caps">OOP</span> Go Mainstream?</h1>
<p>One common view is that <span class="caps">OOP</span> went mainstream in the 80&#8217;s and 90&#8217;s with the emergence of graphical user interfaces (GUIs). The object paradigm was a natural fit and it made the complexity of <span class="caps">GUI</span> development easier to manage.</p>
<p>Once people started using <span class="caps">OOP</span> for GUIs, they soon discovered that <span class="caps">OOP</span> is more broadly applicable. Soon, it became the &#8220;received wisdom&#8221; that <span class="caps">OOP</span> should be used universally for <em>modularizing</em> applications.</p>
<p>A similar trend is happening with FP. Industry is looking at FP for concurrency, but recognizing broader applicability.</p>
</div>
<div class="slide">
<h1>Were We Wrong About <span class="caps">OOP</span>?</h1>
<p>The nature of programming challenges has changed.</p>
<ul>
	<li>Slow Pace vs. Agility</li>
	<li>Self Contained vs. Globally Connected</li>
	<li>Self Sufficient vs. Integrated Architectures</li>
	<li>Data-centric vs. Compute-centric apps.</li>
</ul>
<p>and</p>
<ul>
	<li>and Lessons Learned From Experience
	<ul>
		<li>Representing domain models in code &#8211; how far to go?</li>
	</ul></li>
</ul>
</div>
<div class="slide">
<h1>How FP Affects Architecture</h1>
<ul>
	<li>Brian McNamara, <a href="http://lorgonblog.wordpress.com/2008/09/22/how-does-functional-programming-affect-the-structure-of-your-code/">How does functional programming affect the structure of your code?</a>. Argues that FP makes code better at all levels of the architecture.</li>
</ul>
</div>
<div class="slide">
<h1>Other Modularity Ideas</h1>
<ul>
	<li>Aspect-Oriented Programming (<span class="caps">AOP</span>)</li>
	<li>Design Patterns</li>
</ul>
</div>
<div class="slide">
<h1><span class="caps">AOP</span>: An Example Problem</h1>
<p>Consider this object model:</p>
<div class="code-tiny">
<pre name="code" id="code" class="brush: scala;">// Typical OO, with lots of mutability, also poor encapsulation, etc...
case class Money(value: BigDecimal) {
  def + (m: Money) = Money(value + m.value)
  def - (m: Money) = Money(value - m.value)
}

case class Customer(var name: String)

trait Account {
  val customer: Customer
  var balance: Money
  def deposit(amount: Money) = balance += amount
  def withdraw(amount: Money) = balance -= amount
}

case class CheckingAccount(customer: Customer, var balance: Money) extends Account 
case class SavingsAccount(customer: Customer, var balance: Money, 
  var interestRate: Double) extends Account 
</pre><p></div><div class="codeurl"><a href="txmt://open?url=file:///Users/deanwampler/projects/Loyola/COMP388-488/Presentations/PragmaticsOfIndustrialSWDevelopment/code/bank-account.scala">code/bank-account.scala</a></div></p>
</div>
<div class="slide">
<h1><span class="caps">AOP</span>: An Example Problem (cont.)</h1>
<div class="code-tiny">
<pre name="code" id="code" class="brush: scala;">val customer = Customer("Dean")

val ca = CheckingAccount(customer, Money(1000.0))
println("Checking: initial account: " + ca)
ca.deposit(Money(1000.0))
ca.withdraw(Money(500.0))
println("Checking: final account: " + ca)

val sa = SavingsAccount(customer, Money(2000.0), .02)
println("Savings: initial account: " + sa)
sa.withdraw(Money(1200.0))
sa.deposit(Money(100.0))
sa.interestRate = 0.3
println("Checking: final account: " + sa)

// Checking: initial account: CheckingAccount(Customer(Dean),Money(1000.0))
// Checking: final account: CheckingAccount(Customer(Dean),Money(1500.0))
// Savings: initial account: SavingsAccount(Customer(Dean),Money(2000.0),0.02)
// Checking: final account: SavingsAccount(Customer(Dean),Money(900.0),0.3)</pre><p></div><div class="codeurl"><a href="txmt://open?url=file:///Users/deanwampler/projects/Loyola/COMP388-488/Presentations/PragmaticsOfIndustrialSWDevelopment/code/bank-account-usage.scala">code/bank-account-usage.scala</a></div></p>
</div>
<div class="slide">
<h1><span class="caps">AOP</span> and Modularity</h1>
<p><em>Aspect-Oriented Programming</em> was invented in the mid-nineties to address a particular kind of modularity problem. Imagine I need to have all state changes to <code>Customers</code> and <code>Accounts</code> persisted? I could do this:</p>
<div class="code-tiny">
<pre name="code" id="code" class="brush: scala;">trait Persister {
  def getFromDataBase[A](propertyName: String): Option[A] =  { /* nasty */ }
  // returns optional previous value (like Scala's mutable map.put())
  def putToDatabase[A](propertyName: String, newValue: A): Option[A] =  { /* nasty */ }
}
...
case class Customer(initialName: String) extends Persister{
  protected var _name = initialName
  def name = {
    _name = getFromDataBase("name")  // avoid stale data
    _name
  }
  def name_=(newName: String) = {
    _name = newName
    putToDatabase("name", _name)
  }
}</pre><p></div><div class="codeurl"><a href="txmt://open?url=file:///Users/deanwampler/projects/Loyola/COMP388-488/Presentations/PragmaticsOfIndustrialSWDevelopment/code/bank-account-bad-persistence.scala">code/bank-account-bad-persistence.scala</a></div></p>
</div>
<div class="slide">
<h1>Modularity Breakdown</h1>
<p>Recall that <code>Customer</code> was:</p>
<div class="code-small">
<pre name="code" id="code" class="brush: scala,;">

case class Customer(var name: String)
</pre></div>
<p>The code is now <em>significantly</em> more complicated, making it much harder to develop, test, maintain, etc., etc.</p>
<p>Worse, I would require similar code for <em>every</em> class that was backed by a datastore.</p>
</div>
<div class="slide">
<h1>Cross-Cutting Concerns</h1>
<p>Because the persistence code is basically the same in every class that uses it, we say it is a <em>cross-cutting concern</em>. It cuts right across the modularity (class) boundaries of the domain model. Modularity is severely compromised.</p>
<p>There are other kinds of cross-cutting concerns:</p>
<ul>
	<li>Transactions</li>
	<li>Security</li>
	<li>Logging</li>
	<li>Error handling</li>
</ul>
</div>
<div class="slide">
<h1>Enterprise Java Beans</h1>
<p><em>Enterprise Java Beans</em> (EJBs) where a flawed attempt to address this problem (the flaws were mostly fixed in the v3.0 redo). This model let you specify some data for persistence, transactions, security, etc. in <span class="caps">XML</span> configuration files, but you still had very invasive code in your domain objects.</p>
<p>Specifically, while the model &#8220;separated concerns&#8221; such as persistence from the domain model, the model objects needed to subclass <span class="caps">EJB</span> container types, implement methods to support lifecycle management, etc.</p>
<p>That is, EJBs traded one set of problems for another set.</p>
</div>
<div class="slide">
<h1>Aspect-Oriented Programming</h1>
<p>The idea behind aspects is that the domain model shouldn&#8217;t need to know the details of persistence, transactions, etc. <em>and</em> it shouldn&#8217;t be necessary to introduce framework code, either.</p>
<p>Instead, you should be able to inject the behavior where needed through tools, language support, etc.</p>
</div>
<div class="slide">
<h1><span class="caps">AOP</span> Schematic View: Before</h1>
<center>
<span style="width: 100%;">
<img src="images/tangled-code.png"></img>
</span>
</center>
</div>
<div class="slide">
<h1><span class="caps">AOP</span> Schematic View: After</h1>
<center>
<span style="width: 100%;">
<img src="images/aspects.png"></img>
</span>
</center>
</div>
<div class="slide">
<h1>Characteristics of <span class="caps">AOP</span> Solutions</h1>
<p>An aspect solution has two parts.</p>
<ul>
	<li><strong>Quantification:</strong> You need to specify in a succinct way (code or declarations) which &#8220;points of execution&#8221; to observe or modify in the code base.</li>
	<li><strong>Behavior Modification</strong>: Once identified, you need ways to modify the behavior.</li>
</ul>
</div>
<div class="slide">
<h1><span class="caps">AOP</span> Terminology</h1>
<ul>
	<li><strong>Join Points:</strong> The points of execution where observation or modification might be needed.</li>
	<li><strong>Pointcuts:</strong> (yes, one word.) A set of join points, like a result set for a query over all <em>join points</em>.</li>
	<li><strong>Advice:</strong> The behavior modification inserted by an <em>aspect</em>.</li>
	<li><strong>Aspect:</strong> A class-like type that combines <em>pointcuts</em> and <em>advice</em>.</li>
</ul>
</div>
<div class="slide">
<h1>Code for <span class="caps">AOP</span></h1>
<p>The code might look something like this:</p>
<div class="code-tiny">
<pre name="code" id="code" class="brush: scala;">trait Named { 
  def name: String
  def name_=(n:String):Unit
}
case class Customer(var name: String) extends Named

class InstrumentedCustomer(customer: Customer) 
    extends Named with Persister {
  def name = {
    getFromDataBase("name") match {  // avoid stale data
      case Some(x) =&gt; customer.name = x   // call customer.name_=()
      case None =&gt;
    }
    customer.name  // call customer.name method
  }
  def name_=(newName: String) = {
    customer.name = newName
    putToDatabase("name", newName)
  }
}</pre><p></div><div class="codeurl"><a href="txmt://open?url=file:///Users/deanwampler/projects/Loyola/COMP388-488/Presentations/PragmaticsOfIndustrialSWDevelopment/code/bank-account-instrumented.scala">code/bank-account-instrumented.scala</a></div></p>
</div>
<div class="slide">
<h1><span class="caps">AOP</span> Tools</h1>
<p>To minimize writing this kind of code and to inject the behavior in &#8220;normal&#8221; objects (as opposed to instantiating special wrapper objects), several techniques are available:</p>
<ul>
	<li><strong>AspectJ:</strong> Superset of Java with declarative aspects.</li>
	<li><strong>Byte Code Instrumentation:</strong> e.g., Spring (early versions), JBoss, etc.</li>
</ul>
</div>
<div class="slide">
<h1>AspectJ Example</h1>
<p>Here is a &#8220;schematic&#8221; AspectJ aspect:</p>
<div class="code-tiny">
<pre name="code" id="code" class="brush: scala;">// Schematic AspectJ with mixed Scala syntax:
public aspect PersisentCustomer {
  public pointcut setName(Customer c, String newName) :
    call(Customer.name_=(*)) &amp;&amp; this(c) &amp;&amp; args(newName);

  public pointcut getName(Customer c) :
    call(Customer.name()) &amp;&amp; this(c);
  
  after(Customer c, String newName) returning : setName(c, newName) {
    // Use a singleton version of Persister
    PersisterSingleton.putToDatabase(c, "name", newName);
  }
  
  before(Customer c) : getName(c) {
    PersisterSingleton.getFromDatabase(c, "name") match {
      case Some(x) =&gt; c.name = x
      case None =&gt;
    }
  }
}</pre><p></div><div class="codeurl"><a href="txmt://open?url=file:///Users/deanwampler/projects/Loyola/COMP388-488/Presentations/PragmaticsOfIndustrialSWDevelopment/code/bank-account-aspect.scala">code/bank-account-aspect.scala</a></div></p>
<p>(I don&#8217;t expect you to fully understand this code&#8230;)</p>
</div>
<div class="slide">
<h1>Aspects Beyond Cross-Cutting Concerns</h1>
<p>Is this all there is for aspects? Note that the cross-cutting concerns that we mentioned, persistence, transactions, security, and logging, are sometimes called <em>non-functional requirements</em>, because they mostly relate to implementation concerns, rather than business requirements. (This is not really an accurate distinction; everything we do is ultimately tied in some way to business requirements&#8230;)</p>
</div>
<div class="slide">
<h1>Aspects Beyond Cross-Cutting Concerns</h1>
<p>We could imagine implementing &#8220;functional&#8221; requirements:</p>
<ul>
	<li>Treat interest calculations as a feature that is mixed into the basic account type. Note that we didn&#8217;t show <code>CheckingAccount</code> with interest, but often checking accounts do pay interest.</li>
	<li>Mixin overdraft handling, perhaps on a per-account basis. (That is, &#8220;premium&#8221; account holders get better overdraft protection than others.)<br />
<br/><br/></li>
</ul>
<p>(Notice that I used the term &#8220;mixin&#8221; a few times. Hmm&#8230;)</p>
</div>
<div class="slide">
<h1>Do We Really Need Aspects?</h1>
<p>I was actively involved in the <span class="caps">AOP</span> community between 2002 and 2008. I expected <span class="caps">AOP</span> to have broad applicability as a technique for composing applications from &#8220;features&#8221;, beyond the sorts of cross-cutting concerns shown here. I even wrote an <a href="http://aquarium.rubyforge.org"><span class="caps">AOP</span> framework for Ruby</a> and a <a href="http://contract4j.org">Design by Contract tool for Java</a> in AspectJ.</p>
<p>However, broader applicability never materialized. Why?</p>
</div>
<div class="slide">
<h1>Why Isn&#8217;t <span class="caps">AOP</span> Pervasive?</h1>
<p>First, while the vision of feature composition is attractive, attempts to make it work proved difficult (e.g., <a href="http://www.research.ibm.com/hyperspace/">Multidimensional Separation of Concerns</a>).</p>
<p>Also, most of the time, developers don&#8217;t really need feature composition. Traditional coding approaches, i.e., regular classes, are good enough.</p>
</div>
<div class="slide">
<h1>Why Isn&#8217;t <span class="caps">AOP</span> Pervasive? (cont.)</h1>
<p>Second, <span class="caps">AOP</span> was originally invented by people look at problems in Java and it really only gained traction in the Java community, with some penetration in .<span class="caps">NET</span>.</p>
<p>In dynamically-typed languages with open classes, like Ruby, it&#8217;s quite easy to implement &#8220;advice-like&#8221; behavior, using the <em>metaprogramming</em> features of the languages.</p>
<p>A good example is the <code>ActiveRecord</code> persistence framework in Ruby on Rails.</p>
</div>
<div class="slide">
<h1>Why Isn&#8217;t <span class="caps">AOP</span> Pervasive? (cont.)</h1>
<p>Third, the <em>advice</em> feature of <span class="caps">AOP</span> can be implemented by mixins.</p>
<p>Languages like Scala, Ruby, Python, JavaScript, and many others let you create and use mixins (<code>traits</code> in Scala).</p>
</div>
<div class="slide">
<h1>Why Isn&#8217;t <span class="caps">AOP</span> Pervasive? (cont.)</h1>
<div class="code-tiny">
<pre name="code" id="code" class="brush: scala;">trait Persister {
  def getFromDataBase[A](propertyName: String): Option[A] =  { /* nasty */ }
  def putToDatabase[A](propertyName: String, newValue: A): Option[A] =  { /* nasty */ }
}

trait Named { 
  def name: String
  def name_=(n:String):Unit
}

trait PersistentName extends Named with Persister {
  def name = {
    getFromDataBase("name") match {  // avoid stale data
      case Some(x) =&gt; super.name = x   // call parent's setter
      case None =&gt;
    }
    super.name  // call parent's getter
  }
  def name_=(newName: String) = {
    super.name = newName
    putToDatabase("name", newName)
  }
}

case class Customer(var name: String) extends Named

val dean = new Customer("Dean") with PersistentName</pre><p></div><div class="codeurl"><a href="txmt://open?url=file:///Users/deanwampler/projects/Loyola/COMP388-488/Presentations/PragmaticsOfIndustrialSWDevelopment/code/bank-account-mixin.scala">code/bank-account-mixin.scala</a></div></p>
</div>
<div class="slide">
<h1>Why Isn&#8217;t <span class="caps">AOP</span> Pervasive? (cont.)</h1>
<p>So we can get <em>advice</em> without aspects, although it&#8217;s still tedious to write all these special cases. We also still don&#8217;t have <em>quantification</em>.</p>
<p>Functional data structures can address both limitations.</p>
<p>Objects are just ad hoc groupings of collections and &#8220;atoms&#8221; (numbers, strings, etc.), recursively. More specifically, they work like <em>maps</em> and in languages like JavaScript, they <em>are</em> maps!</p>
<p>So, if you create a <code>PersistentMap</code> (in this case, meaning persistent to a database, not as in the <em>software transactional memory</em> case.) and represent our objects as maps, we&#8217;ve solved the quantification problem!</p>
</div>
<div class="slide">
<h1>Why Isn&#8217;t <span class="caps">AOP</span> Pervasive? (cont.)</h1>
<div class="code-tiny">
<pre name="code" id="code" class="brush: scala;">trait KeyValuePersister[K,V] {
  def getFromDataBase(key: K): Option[V] = { /* nasty */ }
  def putToDatabase(key: K, newValue: V): Option[V] = { /* nasty */ }
}

trait PersistentMap[K,V] extends scala.collection.mutable.Map[K,V] with KeyValuePersister[K,V] {
  override def get(key: K) = {
    val newValue = getFromDataBase(key)  // avoid stale data
    newValue match {
      case Some(x) =&gt; super.put(key, x)
      case None =&gt;
    }
    newValue
  }
  override def put(key: K, newValue: V) = {
    super.put(key, newValue)
    putToDatabase(key, newValue)
  }
}

val dean = new scala.collection.mutable.HashMap[String,Any] with PersistentMap[String,Any]
dean.put("name", "Dean")</pre><p></div><div class="codeurl"><a href="txmt://open?url=file:///Users/deanwampler/projects/Loyola/COMP388-488/Presentations/PragmaticsOfIndustrialSWDevelopment/code/persistent-map.scala">code/persistent-map.scala</a></div></p>
</div>
<div class="slide">
<h1>Why Isn&#8217;t <span class="caps">AOP</span> Pervasive? (cont.)</h1>
<p>What this means is that if we just use <code>Maps</code> (and perhaps a few other fundamental collections), we can instrument them as needed with less effort than instrumenting lots of ad-hoc classes. The quantification problem is reduced.</p>
<p>The key point here is that working with more &#8220;primitive&#8221; building blocks; functions, and core data structures, it is actually easier to <em>generate</em> the variations of behavior we need. We&#8217;ll return to this point in a few weeks when we talk about <em>simplicity</em> in systems, etc.</p>
</div>
<div class="slide">
<h1>Design Patterns</h1>
<p>A <em>solution</em> to a <em>problem</em> in a <em>context</em>.</p>
<p>Patterns are &#8220;templates&#8221; for solving recurring problems in similar, but often slightly different ways. For example, a software design issue that occurs in different languages.</p>
<p>The <em>context</em> part is important. Part of a pattern&#8217;s description is the context information about when it is applicable and when it <em>isn&#8217;t</em>. These details are designed to prevent the misapplication of a pattern.</p>
</div>
<div class="slide">
<h1>Design Patterns (cont.)</h1>
<p>Design Patterns actually originated with the building architect, Christopher Alexander, who cataloged recurring ideas in buildings, even those built by non-professionals.</p>
<p>Kent Beck and Ward Cunningham, who would later invent <em>Extreme Programming</em>, first began applying Alexander&#8217;s work to software in the mid-1980s. The &#8220;Gang of Four&#8221; book in 1994 exposed them to the wider world.</p>
</div>
<div class="slide">
<h1>Criticisms of Patterns</h1>
<p>Not everyone thinks patterns are a good idea. <a href="http://www.c2.com/cgi/wiki?AreDesignPatternsMissingLanguageFeatures">Are Design Patterns Missing Language Features</a> is a good starting place for the discussion.</p>
<p>Peter Norvig argues that dynamic languages like Lisp are so powerful that most of the patterns aren&#8217;t needed. In particular, he claims that 16 of the 23 GoF patterns are unnecessary in Lisp.</p>
<p>For example, I mentioned last week that <em>Visitor</em> is very ugly and invasive, where a functional approach, like type classes, is much more elegant.</p>
</div>
<div class="slide">
<h1>Criticisms of Patterns (cont.)</h1>
<p>Here is a list of &#8220;unnecessary&#8221; patterns, adapted from <a href="http://www.c2.com/cgi/wiki?AreDesignPatternsMissingLanguageFeatures">AreDesignPatternsMissingLanguageFeatures</a> on the <a href="http://www.c2.com">c2 wiki</a>.</p>
<div class='tiny'>
<table>
	<tr>
		<td> Visitor  </td>
		<td> Generic functions (multiple dispatch), type classes </td>
		<td> </td>
	</tr>
	<tr>
		<td> Factory  </td>
		<td> Meta classes, closures, companion objects (Scala) </td>
		<td> </td>
	</tr>
	<tr>
		<td> Singleton </td>
		<td> Meta classes, object declarations (Scala) </td>
		<td> </td>
	</tr>
	<tr>
		<td> Iterator </td>
		<td> Anonymous functions </td>
		<td> used with higher order functions, like map, filter, etc.) </td>
	</tr>
	<tr>
		<td> Interpreter </td>
		<td> Macros (extending the language), <code>eval</code> functions, meta-circular interpreters, support for parser generation (for differing syntax) </td>
		<td> </td>
	</tr>
	<tr>
		<td> Command </td>
		<td> Closures, anonymous functions, first-class functions, lexical scope </td>
		<td> </td>
	</tr>
	<tr>
		<td> Adapter </td>
		<td> Delegation, macros, meta classes </td>
		<td> a.k.a. Handle-Body </td>
	</tr>
</table>
</div>
</div>
<div class="slide">
<h1>Table (cont.)</h1>
<div class='tiny'>
<table>
	<tr>
		<td> Run and return successor </td>
		<td> Tail-call optimization </td>
		<td> </td>
	</tr>
	<tr>
		<td> Abstract factory, flyweight, factory-method, state, proxy, chain-of-responsibility </td>
		<td> First-class types </td>
		<td> </td>
	</tr>
	<tr>
		<td> Mediator, Observer </td>
		<td> Method combination </td>
		<td> </td>
	</tr>
	<tr>
		<td> Builder Pattern </td>
		<td> Multi Methods </td>
		<td> </td>
	</tr>
	<tr>
		<td> Facade Pattern </td>
		<td> Modules </td>
		<td> </td>
	</tr>
	<tr>
		<td> Strategy Pattern </td>
		<td> higher-order functions </td>
		<td> </td>
	</tr>
</table>
</div>
<p>The patterns and their functional replacements go by numerous names in different languages and contexts.</p>
</div>
<div class="slide">
<h1>Criticisms of Patterns (cont.)</h1>
<p>The problem with the criticisms of design patterns, in my view, is that they tend to confuse the concepts with how they are implemented. Some patterns are clearly of dubious value, like <em>Visitor</em>, and should be used only as a last resort. Other patterns, like <em>Observer</em>, are far more useful and powerful. Different languages make these &#8220;good&#8221; patterns easier or harder to implement. Sometimes a pattern is just a built-in feature (like <em>Singleton</em> in Scala).</p>
<p>Some of the OO patterns are redundant with functional concepts. Others aren&#8217;t. Functional programming has its own patterns, although the community has not adopted the patterns terminology.</p>
</div>
<div class="slide">
<h1>Reusability that Works</h1>
<p>Notes from Jason Zaugg&#8217;s Intro to Scalaz at the <span class="caps">NYC</span> Scala group:</p>
<p>http://vimeo.com/15264203</p>
</div>
<div class="slide">
<h1>Why <span class="caps">OOP</span> Then? Why FP Now?</h1>
<p>Software development is still a young discipline, ~70 years old, compared to other forms of &#8220;engineering&#8221;.</p>
<p>We&#8217;re still figuring out what works best. The problems we&#8217;re solving and the applications we&#8217;re building are changing rapidly, too.</p>
<p>Here&#8217;s a very high level view of how things have evolved in the last 30 years.</p>
</div>
<div class="slide">
<h1><span class="caps">GUI</span>, Pre-Internet Era, 1980s &#8211; 1995:</h1>
<p>The characteristics of <span class="caps">GUI</span>-based applications before the Internet:</p>
<ul>
	<li><strong>Dominant Apps:</strong> &#8220;Productivity&#8221; tools (e.g., MS Office).</li>
	<li><strong>UIs:</strong> &#8220;Thick&#8221; desktop UIs.</li>
	<li><strong>Architectures:</strong> Self-contained and autonomous.</li>
	<li><strong>Business Model:</strong> Dominated by commercial development.</li>
	<li><strong>Release Cycles:</strong> Relatively long.</li>
</ul>
</div>
<div class="slide">
<h1>Internet Era, 1995 &#8211; late 2000&#8217;s:</h1>
<p>Application characteristics during the &#8220;formative&#8221; years of the Internet, dominated by e-commerce and search:</p>
<ul>
	<li><strong>Dominant Apps:</strong> E-commerce and search</li>
	<li><strong>UIs:</strong> &#8220;Thin&#8221; browser-based UIs.</li>
	<li><strong>Architectures:</strong> Large components, networked together.</li>
	<li><strong>Business Model:</strong> Dominated by open-source development.</li>
	<li><strong>Release Cycles:</strong> Relatively short release cycles.</li>
</ul>
</div>
<div class="slide">
<h1>Big Data Era, late 2000&#8217;s &#8211; ??:</h1>
<p>Application characteristics as the Internet matures, where people try to leverage the vast data sets that are being accumulated (Web 2.0??):</p>
<ul>
	<li><strong>Dominant Apps:</strong> Social networking, context-aware service delivery.</li>
	<li><strong>UIs:</strong> &#8220;Rich&#8221; browser-based UIs.</li>
	<li><strong>Architectures:</strong> Small services, choreographed together.</li>
	<li><strong>Business Model:</strong> Dominated by social networking and other data</li>
	<li><strong>Release Cycles:</strong> Asymptotically towards zero-length release cycles (a.k.a continuous delivery).</li>
</ul>
</div>
<div class="slide">
<h1>Summarized Together</h1>
<div class='tiny'>
<table>
	<tr>
		<th></th>
		<th>Pre-Internet </th>
		<th>Internet </th>
		<th>Big Data </th>
	</tr>
	<tr>
		<th>Apps </th>
		<td> Productivity Tools </td>
		<td> E-Commerce, search </td>
		<td> Social networking, context-aware services </td>
	</tr>
	<tr>
		<th>UIs </th>
		<td> Thick desktop </td>
		<td> Thin browser </td>
		<td> Rich Browser </td>
	</tr>
	<tr>
		<th>Architecture </th>
		<td> Self-contained, autonomous </td>
		<td> Large components, networked </td>
		<td> Small services, choreographed </td>
	</tr>
	<tr>
		<th>Dev Model </th>
		<td> Commercial </td>
		<td> Open-Source </td>
		<td> Data aggregators </td>
	</tr>
	<tr>
		<th>Cycle Times </th>
		<td> Long </td>
		<td> Short </td>
		<td> Approaching 0 </td>
	</tr>
</table>
</div>
</div>
<div class="slide">
<h1>Trends</h1>
<p>Note that most of the categories have been trending to lower values:</p>
<ul>
	<li><strong>UIs:</strong> Smaller UI toolkits (but delivering richer features).</li>
	<li><strong>Structure:</strong> Smaller, focused pieces, &#8220;glued&#8221; together.</li>
	<li><strong>Dev Model:</strong> Lower cost.</li>
	<li><strong>Cycle Times:</strong> Shorter and shorter; approaching zero!</li>
</ul>
</div>
<div class="slide">
<h1>Trends (cont.)</h1>
<p>We&#8217;ll discuss the implications for software process next week. For <span class="caps">OOP</span> vs. FP, the smaller components and faster cycles means there is little incentive for building object models.</p>
<ul>
	<li>Faster modification.</li>
	<li>Changing requirements.</li>
	<li>Each service only cares about a data slice.</li>
	<li><span class="caps">UML</span> modeling is absurd now&#8230;</li>
</ul>
</div>
<div class="slide">
<h1>Questions</h1>
<ul>
	<li>Why is industry adopting FP now?</li>
</ul>
<ul>
	<li>Contrasting <span class="caps">OOP</span> and FP:</li>
	<li>Is the software of the future likely to be more FP or more <span class="caps">OOP</span> (or perhaps something else)?</li>
	<li>Why is FP more interesting and <span class="caps">OOP</span> less interesting today?</li>
</ul>
</div>
<div class="slide">
<h1>Notes<br />
point free style and composition.</h1>
</div>
<div class="title slide">
<h1>Lecture 12: Complexity vs. Simplicity Part I: Effective Software Development Processes, Scrum, XP, and Lean</h1>
</div>
<div class="slide">
<h1>Project Planning</h1>
<p>“If a project is truly innovative, you cannot possibly know its exact cost and exact schedule at the beginning.”</p>
<p>John Gavin, Director of the Lunar Module Program, in an article in M.I.T.&#8217;s Technology Review, 1994, and quoted in his obituary on November 4, 2010 in the <a href="http://nyti.ms/a2yPRN">New York Times</a>.</p>
<p>The pervasive principle that successful systems, processes, tools, etc. avoid unnecessary complexity. We start by looking at the evolution of software processes.</p>
<ul>
	<li>Fundamental requirements for any process.</li>
	<li>Waterfall, Agile Methodologies, and others.</li>
	<li>Why many approaches fail:</li>
	<li>Excess complexity.</li>
	<li>Poor mapping to the real &#8220;nature&#8221; of software development.</li>
	<li>What should a process do?</li>
</ul>
</div>
<div class="slide">
<h1>Complexity vs. Simplicity Part II: Scrum, XP, and Lean</h1>
<p>Agile software processes</p>
<ul>
	<li>Scrum &#8211; arguably the first?</li>
	<li>XP &#8211; a complete, small-team process</li>
	<li>Lean &#8211; Toyota Manufacturing</li>
	<li>Scaling Agile</li>
	<li>Is there one &#8220;true&#8221; software process for industrial development?</li>
</ul>
</div>
<div class="slide">
<h1>Reading for Next Week&#8217;s Lecture</h1>
<ul>
	<li>Eric Brewer, <a href="http://www.cs.berkeley.edu/~brewer/cs262b-2004/PODC-keynote.pdf">Toward Robust, Distributed Systems</a>. The keynote at the <a href="http://www.podc.org/podc2000/"><span class="caps">ACM</span> Symposium on Principles of Distributed Computing</a> that introduced Brewer&#8217;s <span class="caps">CAP</span> theorem. Focus on the first 2/3^rd^s of the presentation (up to <em>The DQ Principle</em>.)<br />
</div><br />
<div class="slide"></li>
</ul>
<h1 class="slide0">Lecture 13: Complexity vs. Simplicity Part <span class="caps">III</span>: Simple Systems</h1>
<p><span class="caps">SOA</span> vs. the rest. See Brewer&#8217;s <span class="caps">CAP</span> theorem keynote.</p>
<ul>
	<li>&#8220;Essential&#8221; vs. &#8220;Accidental&#8221; complexity.</li>
	<li>Examples of simple systems that succeeded.</li>
	<li>Examples of complex systems that failed.</li>
</ul>
</div>
<div class="title slide">
<h1>Lecture 14: Student Presentations on the Code Project and Course Review</h1>
</div>
<div class="title slide">
<h1>References</h1>
<div class='small'>
<p>Some of the books listed below are available through <a href="http://proquestcombo.safaribooksonline.com.flagship.luc.edu/">Loyola&#8217;s account on Safari Books Online</a>.</p>
</div>
</div>
<div class="slide">
<h1>Required Texts</h1>
<div class='small'>
<p>Various papers, blog posts, etc. will be assigned for each lecture.</p>
</div>
</div>
<div class="slide">
<h1>Recommended Reading</h1>
<div class='small'>
<p>I don&#8217;t expect you to read all these references! Some will be assigned as homework reading. All are listed here for further investigation, as you see fit.</p>
<ul>
	<li>Dean Wampler and Alex Payne, &#8220;Programming Scala&#8221;, O&#8217;Reilly, 2009. <span class="caps">ISBN</span>: 0596155957. My comprehensive introduction to Scala. You can read it for free by following the links on <a href="http://programmingscala.com">http://programmingscala.com</a> or on <a href="http://proquestcombo.safaribooksonline.com.flagship.luc.edu/">Loyola&#8217;s Safari Books Online</a>.</li>
	<li>Harold Abelson and Gerald Jay Sussman, &#8220;Structure and Interpretation of Computer Programs&#8221;, <span class="caps">MIT</span> Press, 1996. <span class="caps">ISBN</span>: 0262011530. <a href="http://mitpress.mit.edu/sicp/">Online access</a>. A one-volume survey of computer science. Master this book and you&#8217;ll be well ahead of most software developers!</li>
	<li>Erich Gamma, Richard Helm, Ralph Johnson, John M. Vlissides, &#8220;Design Patterns: Elements of Reusable Object-Oriented Software&#8221;, Addison-Wesley, 1994, <span class="caps">ISBN</span> 0201633612. Possibly the most important software development book of the last 20 years (and still a best seller). Because there are four authors and this book was published not long after the infamous trial in China of the <em>Gang of Four</em> (including Mao&#8217;s widow), the authors are affectionately known as the &#8220;Gang of Four&#8221; and this book is informally called the &#8220;Gang of Four book&#8221;.</li>
	<li>Andrew Hunt and David Thomas, &#8220;The Pragmatic Programmer: From Journeyman to Master&#8221;, Addison-Wesley, 1999. <span class="caps">ISBN</span>: 020161622X. Very good advice for growing your professional career.<br />
</div></li>
</ul>
</div>
<div class="slide">
<h1>References</h1>
<div class='small'>
<p>The rest of theses resources are for your further research. Some will be assigned as readings for particular lectures.</p>
</div>
</div>
<div class="slide">
<h1>Scala, Akka, JavaScript</h1>
<div class='small'>
<ul>
	<li><a href="http://www.scala-lang.org/node/1305">Learning Scala</a> on the <a href="http://scala-lang.org">Scala Language Website</a>, where you&#8217;ll also find information about downloads, tutorials, <em>Scaladocs</em>, etc.</li>
	<li><a href="http://www.naildrivin5.com/scalatour/wiki_pages/MainPage">Another Tour of Scala</a>. Concise guide to Scala.</li>
	<li>The <a href="http://akkasource.org">Akka Framework</a> and the <a href="http://docs.akkasource.org">documentation</a> for it. The course project and many examples in the lectures use Akka.</li>
	<li><a href="http://www.slideshare.net/jboner/akka-scala-summit-oscon-2010">Jonas Bon&#233;r&#8217;s presentation on Akka at <span class="caps">OSCON</span> 2010</a>, which is also shown on the home page for the Akka Framework documentation: <a href="http://doc.akkasource.org">doc.akkasource.org</a></li>
	<li><a href="http://polyglotprogramming.com/papers/SeductionsOfScala.pdf">The Seductions of Scala</a> a presentation I occasionally give at conferences and user groups.</li>
	<li>Douglas Crockford, &#8220;JavaScript: The Good Parts&#8221;, O&#8217;Reilly, 2008. <span class="caps">ISBN</span>: 9780596517748.<br />
</div></li>
</ul>
</div>
<div class="slide">
<h1>Lock-Based Concurrency</h1>
<div class='small'>
<ul>
	<li>Brian Goetz, Tim Peierls, Joshua Bloch, Joseph Bowbeer, David Holmes, Doug Lea, &#8220;Java Concurrency in Practice&#8221;, Addison-Wesley, 2006. <span class="caps">ISBN</span>: 0321349601. The <em>definitive</em> guide to lock-based concurrency on the <span class="caps">JVM</span> and related important topics like how Java&#8217;s memory model affects program behavior and correctness. Most of the concepts apply to any programming language.</li>
	<li>Edward A. Lee. <em>The problem with threads</em>. <span class="caps">IEEE</span> Computer, 39(5):33–42, May 2006. An essay on why threads aren&#8217;t as beneficial as once thought.<br />
</div></li>
</ul>
</div>
<div class="slide">
<h1>Actor-Based Concurrency</h1>
<div class='small'>
<ul>
	<li><a href="http://en.wikipedia.org/wiki/Actor_model">Actor Model</a> (Wikipedia).</li>
	<li>Akka&#8217;s Actor <a href="http://doc.akkasource.org/actors-scala">documentation</a>.</li>
	<li><a href="http://www.ibm.com/developerworks/java/library/j-gpars/index.html">Resolve common concurrency problems with GPars</a>. Discusses a Groovy concurrency library that wraps several models, including Executors and Fork/Join from the Java Concurrency <span class="caps">API</span>, Actors, Agents and Dataflow Variables (the last two we won&#8217;t cover in the course).&#8212;<br />
</div></li>
</ul>
</div>
<div class="slide">
<h1>Software Transactional Memory</h1>
<div class='small'>
<ul>
	<li>Simon Peyton Jones, <em>Beautiful Concurrency</em>, in &#8220;Beautiful Code&#8221;, Chapter 24, pgs. 385-406. Online:  <a href="http://research.microsoft.com/en-us/um/people/simonpj/papers/stm/#beautiful">http://research.microsoft.com/en-us/um/people/simonpj/papers/stm/#beautiful</a>.</li>
	<li>Simon Peyton Jones, QCon 2007 Keynote on <span class="caps">STM</span>, <a href="http://research.microsoft.com/~simonpj/papers/stm/STM-OSCON.pdf">slides</a>, <a href="http://blip.tv/file/get/OSCON-OSCON2007SimonPeytonJones914.mov">video</a>.</li>
	<li><a href="http://en.wikipedia.org/wiki/Software_transactional_memory">Software Transactional Memory</a> (Wikipedia).</li>
	<li>R. Mark Volkmann, <a href="http://java.ociweb.com/mark/stm/article.html">Software Transactional Memory</a> (<span class="caps">OCI</span> web site).</li>
	<li>R. Mark Volkmann, <a href="http://java.ociweb.com/mark/stm/STM_1up.pdf">Tackling Concurrency with <span class="caps">STM</span></a></li>
	<li>Michael L. Scott, et al. <a href="http://www.cs.rochester.edu/u/scott/papers/2006_TRANSACT_RSTM.pdf">Lowering the Overhead of Nonblocking Software Transactional Memory</a>.</li>
	<li><a href="http://clojure.org/refs">Clojure <span class="caps">STM</span></a>.</li>
	<li>Rich Hickey&#8217;s QCon presentation on <a href="http://www.google.com/url?sa=t&amp;source=web&amp;cd=3&amp;sqi=2&amp;ved=0CCsQFjAC&amp;url=http%3A%2F%2Fqconlondon.com%2Flondon-2009%2Ffile%3Fpath%3D%2Fqcon-london-2009%2Fslides%2FRichHickey_PersistentDataStructuresAndManagedReferences.pdf&amp;rct=j&amp;q=clojure%20persistent%20data%20structures&amp;ei=xkyNTO_iGYSjnQfY19j5Cg&amp;usg=AFQjCNFpIFm5FOItUjTne013vOEwAnYGZQ&amp;cad=rja">Persistent Data Structures and Managed References</a>. <a href="http://www.infoq.com/presentations/Value-Identity-State-Rich-Hickey">Video</a> of the same presentation.</li>
	<li><a href="http://blog.higher-order.net/2009/02/01/understanding-clojures-persistentvector-implementation/">Understanding Clojures PersistentVector Implementation</a></li>
	<li>Excellent blog post comparing <a href="http://eclipsesource.com/blogs/2009/12/13/persistent-trees-in-git-clojure-and-couchdb-data-structure-convergence/">Persistent Trees in Git, Clojure, and CouchDB</a><br />
(See also the links on <em>Multiversion Concurrency Control</em> in the section on <em><span class="caps">SQL</span> and NoSQL Databases</em>.)<br />
</div></li>
</ul>
</div>
<div class="slide">
<h1><span class="caps">ACID</span>, <span class="caps">CAP</span>, and <span class="caps">BASE</span> (1/2)</h1>
<div class='small'>
<ul>
	<li><a href="http://en.wikipedia.org/wiki/ACID"><span class="caps">ACID</span></a> (Wikipedia).</li>
	<li>Eric Brewer, <a href="http://www.cs.berkeley.edu/~brewer/cs262b-2004/PODC-keynote.pdf">Toward Robust, Distributed Systems</a>. The keynote at the <a href="http://www.podc.org/podc2000/"><span class="caps">ACM</span> Symposium on Principles of Distributed Computing</a> that introduced Brewer&#8217;s <span class="caps">CAP</span> theorem.</li>
	<li>Julian Brown, <a href="http://www.julianbrowne.com/article/viewer/brewers-cap-theorem">Brewer&#8217;s <span class="caps">CAP</span> Theorem: The kool aid Amazon and Ebay have been drinking</a>. A sometimes humorous summary of Brewer&#8217;s <span class="caps">CAP</span> theorem. Also has a good list of references for more information.</li>
	<li>Coda Hale, <a href="http://codahale.com/you-cant-sacrifice-partition-tolerance/">You Can&#8217;t Sacrifice Partition Tolerance</a>. A good discussion of <span class="caps">CAP</span> that clears up some common misunderstandings. Also mentions Brewer&#8217;s other work on the concepts of <em>yield</em> and <em>harvest</em>.</li>
	<li>Seth Gilbert and Nancy Lynch, <a href="http://nosqlsummer.org/paper/cap-theorem">The <span class="caps">CAP</span> Theorem</a>. Proves Brewer&#8217;s conjecture (hence, it&#8217;s now called Brewer&#8217;s Theorem) and elaborated on solutions, etc.<br />
</div></li>
</ul>
</div>
<div class="slide">
<h1><span class="caps">ACID</span>, <span class="caps">CAP</span>, and <span class="caps">BASE</span> (2/2)</h1>
<div class='small'>
<ul>
	<li>Dan Pritchett, <a href="http://queue.acm.org/detail.cfm?id=1394128"><span class="caps">BASE</span>: An Acid Alternative</a>. Excellent discussion of the limitations of <span class="caps">ACID</span> for large-scale, distributed systems, and the alternative, <span class="caps">BASE</span>. Provides specific examples of techniques for relaxing consistency. (The <span class="caps">PDF</span> version &#8211; click the <span class="caps">PDF</span> icon under the title &#8211; has a nicer format than the online article.)</li>
	<li>Dan Pritchett, <a href="http://www.infoq.com/articles/pritchett-latency">The Challenges of Latency</a>.</li>
	<li><a href="http://dbmsmusings.blogspot.com/2010/04/problems-with-cap-and-yahoos-little.html">My Problem with <span class="caps">CAP</span> and Yahoo&#8217;s Little Known NoSQL System</a>.</li>
	<li>Werner Vogels, <a href="http://portal.acm.org/ft_gateway.cfm?id=1466448&amp;type=pdf">Eventually Consistent</a>. (Also <a href="http://www.allthingsdistributed.com/2008/12/eventually_consistent.html">here</a>) A specific look at different kinds of eventual consistency and how they informed the design of several Amazon technologies.</li>
	<li>Haifeng Yu and Amin Vahdat, <a href="http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.34.7743&amp;rep=rep1&amp;type=pdf">Design and Evaluation of a Continuous Consistency Model for Replicated Services</a></li>
	<li>Guy Pardon, <a href="http://guysblogspot.blogspot.com/2008/09/cap-solution-proving-brewer-wrong.html" title="Proving Brewer Wrong">A <span class="caps">CAP</span> Solution</a>. An argument that if you don&#8217;t require all three properties at the same time, you can work around the <span class="caps">CAP</span> theorem.<br />
</div></li>
</ul>
</div>
<div class="slide">
<h1><span class="caps">SQL</span> and NoSQL Databases</h1>
<div class='small'>
<ul>
	<li>Billy Newport, <a href="http://strangeloop2010.com/talk/presentation_file/14447/Newport-EnterpriseNoSQL.pdf">Enterprise NoSQL: Silver Bullet or Poison Pill?</a>. Keynote given at the <a href="http://strangeloop2010.com">Strangeloop 2010 Conference</a>. Provides practical guidance on the tradeoffs of <span class="caps">SQL</span> vs. NoSQL databases.</li>
	<li><a href="http://nosql-database.org/">NoSQL-Database.org</a>. Lists of NoSQL categories and implementations.</li>
	<li><a href="http://nosql.mypopescu.com/">MyNoSQL</a>. Good running blog on all things NoSQL.</li>
	<li><a href="http://en.wikipedia.org/wiki/Multiversion_concurrency_control">Multiversion Concurrency Control</a> (Wikipedia). Unfortunately, the text can be a little confusing.</li>
	<li><a href="http://blog.heroku.com/archives/2010/7/20/nosql/">NoSQL, Heroku, and You</a>. Good discussion of why NoSQL is important.</li>
	<li><a href="http://nosqlsummer.org/papers">NoSQL Summer</a>.</li>
	<li>E.F. Codd, <a href="http://nosqlsummer.org/paper/codd-relational-model">A Relational Model of Data for Large Shared Data Banks</a></li>
	<li><a href="http://en.wikipedia.org/wiki/Column-oriented_DBMS">Column-oriented <span class="caps">DBMS</span></a><br />
</div></li>
</ul>
</div>
<div class="slide">
<h1>Document-Oriented Databases: MongoDB, CouchDB</h1>
<div class='small'>
<ul>
	<li><a href="http://mongodb.org">MongoDB</a>. <a href="http://http://api.mongodb.org/">Language APIs</a>.</li>
	<li><a href="http://couchdb.org">CouchDB</a></li>
	<li>J. Chris Anderson, Jan Lehnardt, and Noah Slater, &#8220;CouchDB, The Definitive Guide&#8221;, O&#8217;Reilly, 2010. <span class="caps">ISBN</span>: 9780596155896. Also available to read <a href="http://guide.couchdb.org/">online</a>.</li>
	<li><a href="http://www.mongodb.org/display/DOCS/Comparing+Mongo+DB+and+Couch+DB">Comparing Mongo DB and Couch DB</a>. The differences from MongoDB&#8217;s perspective.</li>
	<li>Mikeal Rogers, <a href="http://www.mikealrogers.com/2010/07/mongodb-performance-durability/">MongoDB Performance and Durability</a>. A controversial, but generally objective analysis of the tradeoffs of using CouchDB vs. MongoDB from the perspective of one of CouchDB&#8217;s developers. See also this discussion of the blog post on <a href="http://news.ycombinator.com/item?id=1495620">Hacker News</a>.</li>
	<li><a href="http://www.mikealrogers.com/2010/07/mongodb-performance-durability/">MongoDB Performance and Durability</a></li>
	<li>Ethan Gunderson, <a href="http://ethangunderson.com/blog/two-reasons-to-not-use-mongodb/">Two Reasons to not Use MongoDB</a>. Not the flame bait that it may appear, Gunderson, who is a Chicago-based developer at Obtiva, describes a few of the tradeoffs about MongoDB that you should understand before choosing it. He covers some of the same territory as Mikeal Rogers&#8217; blog post.</li>
	<li><a href="http://www.thebuzzmedia.com/mongodb-single-server-data-durability-guide/">MongoDB Single Server Data Durability Guide</a>. A guide to setting up MongoDB for durability (might be slightly dated).<br />
</div></li>
</ul>
</div>
<div class="slide">
<h1>Key-Value Stores</h1>
<div class='small'>
<ul>
	<li>Giuseppe DeCandia, Deniz Hastorun, Madan Jampani, Gunavardhan Kakulapati, Avinash Lakshman, Alex Pilchin, Swami Sivasubramanian, Peter Vosshall and Werner Vogels, &#8220;Dynamo: Amazon&#8217;s Highly Available Key-Value Store&#8221;, in the Proceedings of the 21st <span class="caps">ACM</span> Symposium on Operating Systems Principles, Stevenson, WA, October 2007. Available online: <a href="http://www.allthingsdistributed.com/files/amazon-dynamo-sosp2007.pdf"><span class="caps">PDF</span></a> and <a href="http://www.allthingsdistributed.com/2007/10/amazons_dynamo.html">online</a>.</li>
	<li><a href="http://memcachedb.org/">MemcacheDB</a>, based on <a href="http://memcached.org/">Memcached</a>.</li>
	<li><a href="http://www.oracle.com/technetwork/database/berkeleydb/index.html">BerkeleyDB</a>.</li>
	<li><a href="http://aws.amazon.com/simpledb/">SimpleDB</a>.</li>
	<li><a href="http://code.google.com/p/redis/">Redis</a>.</li>
	<li><a href="http://wiki.basho.com/display/RIAK/Riak">Riak</a>.</li>
	<li><a href="http://fallabs.com/tokyocabinet/">Tokyo Cabinet</a>.</li>
	<li><a href="http://www.erlang.org/doc/apps/mnesia/">Mnesia</a>.<br />
</div></li>
</ul>
</div>
<div class="slide">
<h1>Column-Oriented Databases</h1>
<ul>
	<li><a href="http://en.wikipedia.org/wiki/Apache_Cassandra">Apache Cassandra</a>.</li>
	<li>Avinash Lakshman and Prashant Malik, <a href="http://www.cs.cornell.edu/projects/ladis2009/papers/lakshman-ladis2009.pdf">Cassandra &#8211; A Decentralized, Structured Storage System</a>.</li>
</ul>
</div>
<div class="slide">
<h1>Graph Databases (1/2)</h1>
<div class='small'>
<ul>
	<li><a href="http://en.wikipedia.org/wiki/Graph_(data_structure)">Graph (data structure)</a> (Wikipedia).</li>
	<li><a href="http://gephi.org">Gephi</a>. A graph visualization tool kit. The download page has a link to the <a href="http://wiki.gephi.org/">gephi wiki</a> with <a href="http://wiki.gephi.org/index.php?title=Datasets">sample datasets</a>. (<span class="caps">WARNING</span>: requires a lot of memory!)</li>
	<li><a href="http://en.wikipedia.org/wiki/Graph_database">Graph Database</a> (Wikipedia).</li>
	<li><a href="http://neo4j.org">Neo4J</a> and on <a href="http://en.wikipedia.org/wiki/Neo4j">Wikipedia</a>.</li>
	<li><a href="http://en.wikipedia.org/wiki/FlockDB">FlockDB</a> (Wikipedia) and on <a href="http://github.com/twitter/flockdb">GitHub</a>.</li>
	<li><a href="http://infogrid.org/">InfoGrid</a> and a <a href="http://infogrid.org/blog/2010/02/operations-on-a-graph-database-part-1/">tutorial</a>.<br />
</div></li>
</ul>
</div>
<div class="slide">
<h1>Graph Databases (2/2)</h1>
<div class='small'>
<ul>
	<li><a href="http://www.nosqldatabases.com/main/2010/8/23/gremlin-a-graph-based-programming-language.html">Gremlin: a graph based programming language</a>.</li>
	<li>Marko A. Rodriguez and Peter Neubauer, <a href="http://nosqlsummer.org/paper/graph-traversal-pattern">The Graph Traversal Pattern</a>.</li>
	<li>Renzo Angles, Claudio Gutierrez, <a href="http://portal.acm.org/citation.cfm?id=1322433">Survey of Graph Database Models</a> (requires <span class="caps">ACM</span> online access).<br />
</div></li>
</ul>
</div>
<div class="slide">
<h1>Miscellaneous Database References</h1>
<ul>
	<li><a href="http://en.wikipedia.org/wiki/Gizzard_(scala_framework)">Gizzard</a> is a database-neutral sharding framework that supports different backends.</li>
</ul>
</div>
<div class="slide">
<h1>Distributed Systems &#8211; General (1/2)</h1>
<div class='small'>
<ul>
	<li>Arnon Rotem-Gal-Ozhttp, <a href="//www.rgoarchitects.com/Files/fallacies.pdf">Fallacies of Distributed Computing Explained</a></li>
	<li><a href="http://en.wikipedia.org/wiki/Distributed_computing">Distributed Computing</a> (Wikipedia).</li>
	<li><a href="http://www.bacchae.co.uk/docs/dist.html">A Primer on Distributed Computing</a>. A basic discussion of the issues and techniques involved in building a distributed system, like <a href="http://setiathome.berkeley.edu/">SETI@home</a>.</li>
	<li>George Reese, &#8220;Cloud Application Architectures&#8221;, O&#8217;Reilly, 2009. <span class="caps">ISBN</span>: 9780596156367.</li>
	<li>Diomidis Spinellis and Georgios Gousios, &#8220;Beautiful Architecture&#8221;, O&#8217;Reilly, 2009. <span class="caps">ISBN</span>: 0596517984. Good essays on architecture.<br />
</div></li>
</ul>
</div>
<div class="slide">
<h1>Distributed Systems &#8211; General (2/2)</h1>
<div class='small'>
<ul>
	<li><a href="http://en.wikipedia.org/wiki/Consensus_(computer_science)">Consensus</a>.</li>
	<li><a href="http://en.wikipedia.org/wiki/Self-stabilisation">Self Stabilization</a>.</li>
	<li><a href="http://en.wikipedia.org/wiki/Byzantine_fault_tolerance">Byzantine fault tolerance</a>.</li>
	<li>Martin Fowler, et al., &#8220;Patterns of Enterprise Application Architecture&#8221;, Addison-Wesley, 2003. <span class="caps">ISBN</span>: 0321127420. Conventional, object-oriented approach. Does not cover the latest thinking on highly-distributed architectures.</li>
	<li><a href="http://highscalability.com/">highscalability.com</a>. A web site devoted to general topics related to scalability.</li>
	<li><a href="http://www.allthingsdistributed.com/">Werner Vogels&#8217; blog</a>. Werner is the <span class="caps">CTO</span> of Amazon.<br />
</div></li>
</ul>
</div>
<div class="slide">
<h1>Distributed Systems &#8211; Examples</h1>
<div class='small'>
<ul>
	<li><a href="http://setiathome.berkeley.edu/">SETI@home</a>.</li>
	<li><a href="http://boinc.berkeley.edu/">Boinc</a>. The software used by many distributed projects, like <a href="http://setiathome.berkeley.edu/">SETI@home</a>, to use idle computer resources available in a wide network, for computing challenges that are too big for single, powerful computers, but are easily distributed to large numbers of more ordinary computers.</li>
	<li><a href="http://en.wikipedia.org/wiki/Tuple_space">Tuple Space</a> (Wikipedia).</li>
	<li><a href="http://www.terracotta.org/">Terracotta</a>. A toolkit that &#8220;virtualizes&#8221; a single <span class="caps">JVM</span> instance across multiple systems.</li>
	<li><a href="http://github.com/mesos/spark">Spark</a>. A framework for iterative and interactive cluster computing.</li>
	<li><a href="http://blog.locut.us/main/2008/10/6/swarm-a-true-distributed-programming-language.html">Swarm: a true distributed programming language</a><br />
</div></li>
</ul>
</div>
<div class="slide">
<h1>Distributed Systems &#8211; MapReduce Frameworks (1/2)</h1>
<div class='small'>
<ul>
	<li><a href="http://en.wikipedia.org/wiki/MapReduce">MapReduce</a> (Wikipedia).</li>
	<li>Jeffrey Dean and Sanjay Ghemawat, <a href="http://labs.google.com/papers/mapreduce.html">MapReduce: Simplified Data Processing on Large Clusters</a>. Also linked to <a href="http://nosqlsummer.org/paper/google-mapreduce">here</a>.</li>
	<li>Jeffrey Dean and Sanjay Ghemawat, <em>Distributed Programming with Mapreduce</em>, in &#8220;Beautiful Code&#8221;, Chapter 23, pgs. 371-382.</li>
	<li><a href="http://hadoop.apache.org/">Hadoop</a>. An open source map-reduce framework, originally developed at Yahoo!</li>
	<li>Tom White, &#8220;Hadoop: The Definitive Guide, Second Edition&#8221;, O&#8217;Reilly, 2010, <span class="caps">ISBN</span>: 9781449389734. Available on Loyola&#8217;s <a href="http://proquestcombo.safaribooksonline.com.flagship.luc.edu/9781449398644">Safari Online</a>.</li>
	<li>Google&#8217;s new MapReduce replacement, <a href="http://googleblog.blogspot.com/2010/06/our-new-search-index-caffeine.html">Caffeine</a>.<br />
</div></li>
</ul>
</div>
<div class="slide">
<h1>Distributed Systems &#8211; MapReduce Frameworks (2/2)</h1>
<div class='small'>
<ul>
	<li><a href="http://pig.apache.org/">Pig</a></li>
	<li><a href="http://www.slideshare.net/xefyr/pig-making-hadoop-easy">Pig: Making Hadoop Easy</a>.</li>
	<li><a href="http://github.com/nathanmarz/cascalog">Cascalog</a>.</li>
	<li><a href="http://www.theregister.co.uk/2010/09/24/google_percolator/">Google Percolator – global search jolt sans MapReduce comedown</a>. Google&#8217;s just-announced replacement for their MapReduce-based search indexing infrastructure.</li>
	<li><a href="http://www.cloudera.com/blog/2010/09/twitter-analytics-lead-kevin-weil-and-a-presenter-at-hadoop-world-interviewed/">Twitter Analytics Lead, Kevin Weil, and a Presenter at Hadoop World Interviewed</a>. How Hadoop and related tools are used by Twitter.</li>
	<li><a href="http://www.mongodb.org/display/DOCS/MapReduce">MongoDB&#8217;s MapReduce</a>.<br />
</div></li>
</ul>
</div>
<div class="slide">
<h1>Data and Analytics</h1>
<div class='small'>
<ul>
	<li>Edd Dumbill, <a href="http://radar.oreilly.com/2010/09/the-smaq-stack-for-big-data.html">The <span class="caps">SMAQ</span> stack for big data</a>. Nice summary of some of the leading open-source technologies used for data processing.</li>
	<li>Toby Segaran and Jeff Hammerbacher, &#8220;Beautiful Data&#8221;, O&#8217;Reilly, 2009. <span class="caps">ISBN</span>: 0596157118.</li>
	<li>Julie Steele and Noah Ilinsky, &#8220;Beautiful Visualization&#8221;, O&#8217;Reilly, 2010. <span class="caps">ISBN</span>: 1449379869.</li>
	<li>A <a href="http://www.quora.com/What-are-the-best-blogs-about-data">list of data blogs</a> posted on <a href="http://www.quora.com">Quora</a>.<br />
</div></li>
</ul>
</div>
<div class="slide">
<h1>Data Sources</h1>
<div class='small'>
<ul>
	<li><a href="http://infochimps.org/">infochimps.org</a></li>
	<li><a href="http://www.freebase.com/">freebase.com</a></li>
	<li><a href="http://www.trendingtopics.org/">trendingtopics.org</a></li>
	<li><a href="http://developer.amazonwebservices.com/connect/kbcategory.jspa?categoryID=243">Free Data Sets</a> on Amazon Web Services.<br />
</div></li>
</ul>
</div>
<div class="slide">
<h1>Git Resources</h1>
<div class='small'>
<ul>
	<li><a href="http://gitref.org">gitref.org</a>. Very good quick reference on git commands and concepts.</li>
	<li><a href="http://progit.org/">Pro Git</a>. A well regarded book, available free online.</li>
	<li><a href="http://git-scm.com">git-scm.com</a> for downloads and documentation.</li>
	<li><a href="http://github.com">github.com</a> (where the project code will be hosted) also has helpful documentation.</li>
	<li><a href="http://jeffkreeftmeijer.com/2010/why-arent-you-using-git-flow/">Why aren&#8217;t you using git-flow?</a>.<br />
</div></li>
</ul>
</div>
<div class="slide">
<h1>Object-Oriented Programming (General)</h1>
<div class='small'>
<ul>
	<li><a href="http://en.wikipedia.org/wiki/Object-oriented_programming">Object-oriented programming</a> (Wikipedia). Good overview of the history and &#8220;flavors&#8221; of <span class="caps">OOP</span>.</li>
	<li>Bertrand Meyer, &#8220;Object-Oriented Software Construction, 2nd Edition&#8221;, Prentice Hall, 2000, <span class="caps">ISBN</span> 0-13-629155-4.</li>
	<li>Rebecca Wirfs-Brock  and Alan McKean, &#8220;Object Design: Roles, Responsibilities, and Collaboration&#8221;, Addison-Wesley, 2003, <span class="caps">ISBN</span> 0201379430.</li>
	<li>James Rumbaugh, et al., &#8220;Object-Oriented Modeling and Design&#8221;, Prentice Hall, 1991, <span class="caps">ISBN</span> 0-13-629841-9.</li>
	<li>Grady Booch, &#8220;Object-Oriented Analysis and Design with Applications, 3rd Edition&#8221;, Addison-Wesley, 2007, <span class="caps">ISBN</span> 020189551X.</li>
</ul>
</div>
</div>
<div class="slide">
<h1>Design by Contract</h1>
<div class='small'>
<ul>
	<li><a href="http://en.wikipedia.org/wiki/Design_by_contract">Design by Contract</a>.</li>
	<li><a href="http://contract4j.org">Contract4J</a>.</li>
</ul>
</div>
</div>
<div class="slide">
<h1>Object-Oriented Programming (Specifics)</h1>
<div class='small'>
<ul>
	<li>Erich Gamma, Richard Helm, Ralph Johnson, John M. Vlissides, &#8220;Design Patterns: Elements of Reusable Object-Oriented Software&#8221;, Addison-Wesley, 1994, <span class="caps">ISBN</span> 0201633612. See the longer discussion in the first <strong>Recommended Reading</strong> section.</li>
	<li><a href="http://en.wikipedia.org/wiki/Design_pattern_(computer_science)">Design Pattern</a>. This page doesn&#8217;t provide a great discussion of what a design pattern <strong>is</strong>, but it does offer a nice catalog of known (or alleged) patterns.</li>
	<li><a href="http://sourcemaking.com/design_patterns">Design Patterns</a>. A succinct description of patterns and details on the</li>
	<li><a href="http://en.wikipedia.org/wiki/Abstract_factory_pattern">Abstract Factory Design Pattern</a> (Wikipedia).</li>
	<li><a href="http://en.wikipedia.org/wiki/Singleton_pattern">Singleton Design Pattern</a> (Wikipedia).</li>
	<li><a href="http://en.wikipedia.org/wiki/Visitor_pattern">Visitor Pattern</a> (Wikipedia). A truly ugly pattern. A good illustration of forcing a &#8220;pure&#8221; OO solution when a much more elegant approach should be used instead, i.e., <em>type classes</em> (see the FP section below.)</li>
	<li><a href="http://www.c2.com/cgi/wiki?AreDesignPatternsMissingLanguageFeatures">Are Design Patterns Missing Language Features</a>. A starting place for criticisms of patterns.</li>
	<li>Peter Norvig, <a href="http://www.norvig.com/design-patterns">Design Patterns</a>. Argues that 16 of the 23 GoF patterns are unnecessary in languages like Lisp.</li>
</ul>
</div>
</div>
<div class="slide">
<h1>Object-Oriented Programming (Specifics)</h1>
<div class='small'>
<ul>
	<li>Martin Odersky, Lex Spoon, and Bill Venners, <a href="http://www.artima.com/lejava/articles/equality.html">How to Write an Equality Method in Java</a>.</li>
	<li>Joshua Bloch, &#8220;Effective Java, Second Edition&#8221;, Addison-Wesley, 2008, <span class="caps">ISBN</span> 0321356683.</li>
	<li><a href="http://en.wikipedia.org/wiki/Solid_(object-oriented_design)"><span class="caps">SOLID</span> Principles of Object-Oriented Design</a> (Wikipedia).</li>
	<li><a href="http://butunclebob.com/ArticleS.UncleBob.PrinciplesOfOod">Principles of <span class="caps">OOD</span></a>. An older, but more complete blog post and accompanying articles (PDFs) that describe the <span class="caps">SOLID</span> principles.</li>
	<li>Eric Evans, &#8220;Domain-Driven Design &#8211; Tackling Complexity in the Heart of Software&#8221;, Addison-Wesley, 2004, <span class="caps">ISBN</span> 0321125215.</li>
</ul>
</div>
</div>
<div class="slide">
<h1>Functional Programming</h1>
<div class='small'>
<ul>
	<li><a href="http://en.wikipedia.org/wiki/Functional_programming">Functional Programming</a> (Wikipedia).</li>
	<li>John Hughes, <a href="http://www.cs.kent.ac.uk/people/staff/dat/miranda/whyfp90.pdf">Why Functional Programming Matters</a>. A seminal paper making the case for FP. This <a href="http://day-to-day-stuff.blogspot.com/2010/09/why-functional-programming-matters.html">paper</a> ports the examples to Scala.</li>
	<li><a href="http://www.defmacro.org/ramblings/fp.html">Functional Programming for the Rest of Us</a>.</li>
</ul>
</div>
</div>
<div class="slide">
<h1>Functional Programming (Specifics)</h1>
<div class='small'>
<ul>
	<li>Erik Meier, <a href="http://ecn.channel9.msdn.com/o9/mix/10/mp4/FTL01.mp4">Asynchronous and Event-Driven Programming</a> (video).</li>
	<li>&#8220;Type classes&#8221;:* <a href="http://en.wikipedia.org/wiki/Visitor_pattern">Visitor Pattern</a> (Wikipedia).</li>
	<li>Type classes in Scala; two blog posts: <a href="http://debasishg.blogspot.com/2010/06/scala-implicits-type-classes-here-i.html">first</a>, <a href="http://debasishg.blogspot.com/2010/07/refactoring-into-scala-type-classes.html">second</a>.</li>
	<li>Daniel Spiewak <a href="http://www.codecommit.com/blog/scala/the-magic-behind-parser-combinators">The Magic Behind Parser Combinators</a>. Lucid introduction to building parsers using Scala&#8217;s parser combinator library, which I also discuss in <a href="http://programming-scala.labs.oreilly.com/ch11.html">my book</a> as a tool for building <em>Domain Specific Languages</em> (DSLs).</li>
	<li>Daniel Spiewak, <a href="http://dl.dropbox.com/u/1679797/CME%20Conf/Linguistic%20Programming%20v1.pdf">Linguistic Programming</a>. A talk that Daniel is giving <em>next week</em> at a <span class="caps">CME</span> conference here in Chicago. The example code is <a href="https://github.com/djspiewak/linguistic-programming">here</a>.</li>
	<li>Jorge Ortiz <a href="http://www.scala-blogs.org/2007/12/project-euler-fun-in-scala.html">Project Euler Fun In Scala</a>). Shows the Stream-based Fibonacci Sequence.</li>
</ul>
</div>
</div>
<div class="slide">
<h1><span class="caps">OOP</span> vs. Functional Programming</h1>
<div class='small'>
<ul>
	<li>Brian McNamara, <a href="http://lorgonblog.wordpress.com/2008/09/22/how-does-functional-programming-affect-the-structure-of-your-code/">How does functional programming affect the structure of your code?</a>. Argues that FP makes code better at all levels of the architecture.</li>
	<li>Matthew Podwysocki, <a href="http://codebetter.com/blogs/matthew.podwysocki/archive/2009/03/09/which-is-more-beautiful-architecture-fp-or-oop.aspx">Which Is More Beautiful Architecture &#8211; FP or <span class="caps">OOP</span></a>. Argues that the paper by Bertrand Meyer, which claims that <span class="caps">OOP</span> is superior to FP, is flawed. Matt also discusses Brian McNamara&#8217;s blog post.</li>
</ul>
</div>
</div>
<div class="slide">
<h1>Aspect-Oriented Programming</h1>
<div class='small'>
<ul>
	<li><a href="http://aosd.net">Aspect-Oriented Software Development</a>.</li>
	<li><a href="http://www.eclipse.org/aspectj/">AspectJ</a>.</li>
	<li><a href="http://static.springsource.org/spring/docs/2.5.x/reference/aop.html">Spring <span class="caps">AOP</span></a>.</li>
	<li>Ramnivas Laddad, &#8220;AspectJ in Action, Second Edition&#8221;, Manning, 2010, <span class="caps">ISBN</span> 1933988053.</li>
	<li><a href="http://www.research.ibm.com/hyperspace/">Multidimensional Separation of Concerns</a>.</li>
	<li><a href="http://aquarium.rubyforge.org">Aquarium</a>. An <span class="caps">AOP</span> framework for Ruby.</li>
	<li><a href="http://contract4j.org">Contract4J</a>. A <em>Design by Contract</em> tool for Java, written in AspectJ.</li>
</ul>
</div>
</div>
<div class="slide">
<h1>General Programming</h1>
<div class='small'>
<ul>
	<li>Andy Oram and Greg Wilson, &#8220;Beautiful Code&#8221;, O&#8217;Reilly, 2009. <span class="caps">ISBN</span>: 0596510046.</li>
	<li>Federico Biancuzzi and Chromatic, &#8220;Masterminds of Programming&#8221;, O&#8217;Reilly, 2009. <span class="caps">ISBN</span>: 9780596515171.<br />
</div></li>
</ul>
</div>
<div class="slide">
<h1>Software Process</h1>
<div class='small'>
<ul>
	<li>Kent Beck, &#8220;Extreme Programming Explained: Embrace Change&#8221;, 2nd Edition, Addison-Wesley, 2005. <span class="caps">ISBN</span>: 0321278658.</li>
	<li>Mary and Tom Poppendieck, &#8220;Implementing Lean Software Development&#8221;, Addison-Wesley, 2007. <span class="caps">ISBN</span>: 0321437381.</li>
	<li>Mike Cohn, &#8220;User Stories Applied&#8221;, Addison-Wesley, 2004. <span class="caps">ISBN</span>: 0321205685.</li>
	<li>Mike Cohn, &#8220;Agile Estimating and Planning&#8221;, Addison-Wesley, 2006. <span class="caps">ISBN</span>: 0131479415.</li>
	<li>Scott Berkun, &#8220;The Art of Project Management&#8221;, O&#8217;Reilly, 2005. <span class="caps">ISBN</span>: 0596007868.<br />
</div></li>
</ul>
</div>
<div class="slide">
<h1>Simplicity</h1>
<ul>
	<li><a href="http://www.noop.nl/2010/09/simplicity-a-new-model.html">Simplicity: a New Model</a>.</li>
</ul>
</div>
<div class="slide">
<h1>Business</h1>
<div class='small'>
<ul>
	<li>Carliss Y. Baldwin and Kim B. Clark, &#8220;Design Rules: Volume 1: The Power of Modularity&#8221;, <span class="caps">MIT</span> Press, 2000. <span class="caps">ISBN</span>: 0262024667.</li>
	<li>Clayton M. Christensen and Michael E. Raynor, &#8220;The Innovators Solution&#8221;, Harvard Business School Press, 2003, <span class="caps">ISBN</span>: 1578518520.<br />
</div></li>
</ul>
</div>
<div class="slide">
<h1>Miscellaneous</h1>
<div class='small'>
<ul>
	<li>Christopher Alexander and co-authors wrote several books on design patterns in (building) architecture, which inspired a similar movement in software development. Here are two of them.
	<ul>
		<li>&#8220;The Timeless Way of Building&#8221;, Oxford, 1979, <span class="caps">ISBN</span> 0195024028.</li>
		<li>&#8220;A Pattern Language&#8221;, Oxford, 1977, <span class="caps">ISBN</span> 0195019199.</li>
	</ul></li>
</ul>
</div>
</div>
<div class="slide">
<h1>Off Topic: Career Advice</h1>
<div class='small'>
<p>You might find useful&#8230;</p>
<ul>
	<li>Matt Might, <a href="http://matt.might.net/articles/books-papers-materials-for-graduate-students/">matt.might.net/articles/books-papers-materials-for-graduate-students/</a>.</li>
	<li>Nathan Marz, <a href="http://nathanmarz.com/blog/how-to-get-a-job-at-a-kick-ass-startup-for-programmers.html">How to get a job at a kick-ass startup for programmers</a>.<br />
</div><br />
</div><br />
<div class="slide"></li>
</ul>
<h1 class="slide0">Appendix: Final Project Ideas</h1>
<p>Recall that you will need to do a short presentation on the last day of class. You will discuss some aspect of the long-running <span class="caps">NYSE</span> project or some other topic you worked on or studied. For example, you could extend the <span class="caps">NYSE</span> application with a new feature, you could do more analysis of the data in the MongoDB database, or you could explore another topic related to the course.</p>
<p>The following list is designed to give you ideas, but I&#8217;m open to other ideas. Please select a topic to work on and discuss it with me by <b>November 9<sup>th</sup></b>. Don&#8217;t forget to consider the course topics that we haven&#8217;t covered yet!</p>
</div>
<div class="slide">
<h1>Analysis of the <span class="caps">NYSE</span> Data</h1>
<p>Write Mongo JavaScript functions, possibly using MapReduce, to do additional analysis of the data. Possibilities include:</p>
<ul>
	<li>Find the most volatile stocks or time periods.</li>
	<li>Calculate 50 and 200 day moving averages for many stocks over a time range.</li>
	<li>Look for correlations. For example, do some stocks tend to move together, not just because of overall market trends, indicating some sort of dependency?</li>
	<li>Analyze the dividends collections in some way.</li>
</ul>
</div>
<div class="slide">
<h1>Analysis of the <span class="caps">NYSE</span> Data (cont.)</h1>
<p>Extend the <span class="caps">NYSE</span> application:</p>
<ul>
	<li>Calculate moving averages on demand and graph the results along with the closing price.</li>
	<li>Graph daily volumes instead of price.</li>
	<li>Show price data graphs using <em>candle stick</em> charts, which can be used to show open, close, high, low, and even volume in one presentation. (A good way to learn the UI code base and data visualization.)</li>
</ul>
</div>
<div class="slide">
<h1>Analysis of the <span class="caps">NYSE</span> Data (cont.)</h1>
<p>Extend the <span class="caps">NYSE</span> application (cont.):</p>
<ul>
	<li>Allow more arbitrary queries, using a little Domain Specific Language (<span class="caps">DSL</span>). (Hard)</li>
	<li>Explore other kinds of graphical representations of data. (Also good if you are interested data visualization.)</li>
	<li>Replace MongoDB with another database, like Cassandra or Riak.</li>
</ul>
</div>
<div class="slide">
<h1>Map/Reduce</h1>
<p>If you are really interested in <em>Big Data</em>, then mastering MapReduce is an essential skill.</p>
<ul>
	<li>Develop an application, perhaps based on one of the previous suggestions, that uses Mongo&#8217;s MapReduce as the backend.</li>
	<li>Develop a simple Hadoop application.</li>
</ul>
</div>
<div class="slide">
<h1>System Operations Issues</h1>
<p>There are a lot of issues involved in taking an application idea and turning it into a scalable, robust, highly-available application. Not only does the application have to be designed for this goal, but deploying, monitoring, and managing the application is a challenge. If you&#8217;re interested in this latter challenge, which is often called <em>System Operations</em> or <em>SysOps</em>, you could pursue a small project to explore it.</p>
</div>
<div class="slide">
<h1>System Operations Issues (cont.)</h1>
<ul>
	<li>Add code to the Akka actors for gathering timing data and other statistics using <em>mixin</em> traits. You might start with <a href="http://williamlouth.wordpress.com/2010/09/08/async-call-path-profiling-via-metering/">this approach</a> aimed at Akka&#8217;s Java <span class="caps">API</span>, which uses AspectJ.</li>
	<li>Investigate some of the startup log messages, especially the errors and warnings and determine their causes and solutions.</li>
	<li>Extends the <span class="caps">NYSE</span> application to use distributed actors (across machines) for horizontal scalability.</li>
</ul>
</div>
<div class="slide">
<h1>Other Research</h1>
<p>Another option is to do more in-depth reading on a topic we covered in the class (or convince me that a topic is close enough), then prepare a brief (3-4 page writeup) on your findings. Here are some examples.</p>
<ul>
	<li>If you are interested in learning more about Hadoop, investigate the many supporting tools that have been developed to make it easier to use.</li>
	<li>Investigate other databases, like Cassandra, Neo4J, etc.</li>
	<li>Investigate other concurrency approaches, like data-flow concurrency.</li>
	<li>Investigate other parts of Akka.</li>
</ul>
</div>
<div class="slide">
<h1>Other Research (cont.)</h1>
<ul>
	<li>Investigate the differences between various agile software processes, Lean, Agile, Scrum, and others.</li>
	<li>Investigate particular Agile practices, like <span class="caps">TDD</span>, Continuous Integration, Pair Programming, User Stories.</div></li>
</ul>

  <!-- Syntax Highlighter -->
  <script language="javascript" type="text/javascript" src="../lib/scripts/shCore.js"></script>
  <script language="javascript" type="text/javascript" src="../lib/scripts/shBrushBash.js"></script>
  <script language="javascript" type="text/javascript" src="../lib/scripts/shBrushCpp.js"></script>
  <script language="javascript" type="text/javascript" src="../lib/scripts/shBrushCSharp.js"></script>
  <script language="javascript" type="text/javascript" src="../lib/scripts/shBrushCss.js"></script>
  <script language="javascript" type="text/javascript" src="../lib/scripts/shBrushDelphi.js"></script>
  <script language="javascript" type="text/javascript" src="../lib/scripts/shBrushJava.js"></script>
  <script language="javascript" type="text/javascript" src="../lib/scripts/shBrushJScript.js"></script>
  <script language="javascript" type="text/javascript" src="../lib/scripts/shBrushPhp.js"></script>
  <script language="javascript" type="text/javascript" src="../lib/scripts/shBrushPlain.js"></script>
  <script language="javascript" type="text/javascript" src="../lib/scripts/shBrushPython.js"></script>
  <script language="javascript" type="text/javascript" src="../lib/scripts/shBrushRuby.js"></script>
  <script language="javascript" type="text/javascript" src="../lib/scripts/shBrushScala.js"></script>
  <script language="javascript" type="text/javascript" src="../lib/scripts/shBrushSql.js"></script>
  <script language="javascript" type="text/javascript" src="../lib/scripts/shBrushVb.js"></script>
  <script language="javascript" type="text/javascript" src="../lib/scripts/shBrushXml.js"></script>
  <script language="javascript">
    SyntaxHighlighter.config.clipboardSwf = 'scripts/clipboard.swf';
    SyntaxHighlighter.all();
  </script>
</div>
</body>
</html>
