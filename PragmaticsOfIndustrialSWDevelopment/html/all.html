<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Pragmatics of Industrial Software Development</title>
<!-- metadata -->
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="generator" content="S5" />
<meta name="version" content="S5 1.1" />
<meta name="date" content="August 5, 2010" />
<meta name="author" content="Dean Wampler, Ph.D." />
<meta name="company" content="Department of Computer Science,<br/>Loyola University Chicago" />
<meta name="copyright" content="2010 Dean Wampler, All Rights Reserved" />
<!-- configuration parameters -->
<meta name="defaultView" content="slideshow" />
<meta name="controlVis" content="hidden" />
<!-- style sheet links -->
<link rel="stylesheet" href="../ui/default/slides.css" type="text/css" media="projection" id="slideProj" />
<link rel="stylesheet" href="../ui/default/outline.css" type="text/css" media="screen" id="outlineStyle" />
<link rel="stylesheet" href="../lib/stylesheets/print.css" type="text/css" media="print" id="slidePrint" />
<link rel="stylesheet" href="../ui/default/opera.css" type="text/css" media="projection" id="operaFix" />

<link rel="stylesheet" href="../lib/stylesheets/pressie.css" type="text/css" />

<!-- S5 JS -->
<script src="../ui/default/slides.js" type="text/javascript"></script>

<!-- Syntax Highlighter -->
<!-- <link rel="stylesheet"  href="../lib/stylesheets/SyntaxHighlighter.css"></link> -->
<link type="text/css" rel="stylesheet" href="../lib/stylesheets/shCore.css"/>
<link type="text/css" rel="stylesheet" href="../lib/stylesheets/shThemeDefault.css"/>


</head>
<body>

<div class="layout">
<div id="controls"><!-- DO NOT EDIT --></div>
<div id="currentSlide"><!-- DO NOT EDIT --></div>
<div id="header"></div>
<div id="footer">
<h2>Copyright &copy; 2010 Dean Wampler, All Rights Reserved</h2>
<h2>August 5, 2010</h2>
</div>

</div>


<div class="presentation">
<div class="slide">
<h1>Pragmatics of Industrial Software Development</h1>
<blockquote>
<p><span class="caps">COMP</span> 388-003, 488-007</p>
</blockquote>
<blockquote>
<p>Dean Wampler, Ph.D.<br />
<a href="mailto:kwampler@luc.edu">kwampler@luc.edu</a><br />
<a href="mailto:dean@deanwampler.com">dean@deanwampler.com</a><br />
<a href="http://twitter.com/@deanwampler">@deanwampler</a><br />
Department of Computer Science,<br/>Loyola University Chicago</p>
</blockquote>
</div>
<div class="slide">
<h1>Contents</h1>
<div style="font-size: 70%">
<ul>
	<li>Lecture 1: Course Introduction and Scaling Computation, Part I</li>
</ul>
<ul>
	<li>Lecture 2: Scaling Computation, Part II, and Course Project Rebooted</li>
</ul>
<ul>
	<li>Lecture 3: Scaling Systems, Part I</li>
</ul>
<ul>
	<li>Lecture 4: Scaling Data, Part I</li>
</ul>
<ul>
	<li>Lecture 5: Scaling Data, Part II</li>
</ul>
<ul>
	<li>Lecture 6: Scaling Data, Part <span class="caps">III</span></li>
</ul>
<ul>
	<li>Lecture 7: Midterm Break (No Class)</li>
</ul>
<ul>
	<li>Lecture 8: Midterm and Scaling Systems, Part II</li>
</ul>
<ul>
	<li>Lecture 9: Recent Advances in Object-Oriented Programming (<span class="caps">OOP</span>)</li>
</ul>
<ul>
	<li>Lecture 10: Functional Programming (FP): Into the Real World</li>
</ul>
<ul>
	<li>Lecture 11: Object-Oriented Programming vs. Functional Programming: a Critique of Pure Programming</li>
</ul>
<ul>
	<li>Lecture 12: Complexity vs. Simplicity Part I: Effective Software Development Processes</li>
</ul>
<ul>
	<li>Lecture 13: Complexity vs. Simplicity Part II: Scrum, XP, and Lean</li>
</ul>
<ul>
	<li>Lecture 14: Complexity vs. Simplicity Part <span class="caps">III</span>: Simple Systems</li>
</ul>
<ul>
	<li>Lecture 15: Student Presentations on the Code Project and Course Review</li>
</ul>
</div>
</div>
<div class="title slide">
<h1>Lecture 1: Course Introduction and Scaling Computation, Part I</h1>
</div>
<div class="slide">
<h1>Course Introduction</h1>
<p>You have learned about many aspects of software development in your studies. This course looks at how different ideas actually succeed or fail when applied in modern &#8220;industrial&#8221; (i.e., professional) settings.</p>
<p>It reflects my 20+ years of industry experience and my interest in the efficacy of academic Computer Science.</p>
</div>
<div class="slide">
<h1>Course Learning Objectives</h1>
<p>(See the course syllabus on <a href="http://blackboard.luc.edu/">Blackboard</a> for details.)</p>
<ol>
	<li>Understand why some ideas succeed, some fail, and others grow and decline in popularity as circumstances change.</li>
	<li>Recognize key traits of successful systems, methods, and tools.
	<ul>
		<li>For example, the importance of <em>simplicity</em>.</li>
	</ul></li>
	<li>Gain hands-on experience with trending technologies.</li>
</ol>
</div>
<div class="slide">
<h1>General Principles Covered</h1>
<ul>
	<li>Scaling through concurrency &#8211; effective approaches.</li>
	<li>Scaling data &#8211; new models of persistence and data analysis.</li>
	<li>Object-oriented and functional programming &#8211; an assessment.</li>
	<li>Simplicity in software design &#8211; why it’s important and how to achieve it.</li>
	<li>Software development processes &#8211; what works and why.</li>
</ul>
</div>
<div class="slide">
<h1>Topics that Apply these Principles</h1>
<ul>
	<li>Models of fine-grained, concurrent software for robust, horizontal scalability.</li>
	<li>Distributed systems for large-scale, course-grained scalability.</li>
	<li><span class="caps">SQL</span> and “NoSQL” databases &#8211; finding the right persistence model.</li>
	<li>Internet-scale data processing and analytics.</li>
	<li><em>Agile Methodologies</em> for software development.</li>
</ul>
</div>
<div class="slide">
<h1>Course <em>Administrivia</em></h1>
<table>
	<tr>
		<td> email: </td>
		<td> <a href="mailto:kwampler@luc.edu">kwampler@luc.edu</a>  <br/> <a href="dean@deanwampler.com">dean@deanwampler.com</a> </td>
	</tr>
	<tr>
		<td> twitter: </td>
		<td> <a href="http://twitter.com/deanwampler">@deanwampler</a> </td>
	</tr>
	<tr>
		<td> office hours: </td>
		<td> Tuesday, 6:45 &#8211; ? and by appointment </td>
	</tr>
</table>
</div>
<div class="slide">
<h1>Schedule</h1>
<table>
	<tr>
		<td>  8/31 </td>
		<td> Course Intro and Scaling Computation, Part I (Multithreaded Programming, Actor Concurrency) </td>
	</tr>
	<tr>
		<td>  9/07 </td>
		<td> Scaling Computation, Part II (Agents, Software Transactional Memory, Memory is the New Disk) </td>
	</tr>
	<tr>
		<td>  9/14 </td>
		<td> Scaling Systems, Part I (Vertical vs. Horizontal Scaling, Distributed Systems like <span class="caps">HTTP</span>, etc.) <em>Last day to withdraw without a W grade.</em> </td>
	</tr>
	<tr>
		<td>  9/21 </td>
		<td> Scaling Data, Part I (<span class="caps">SQL</span> vs. NoSQL databases) </td>
	</tr>
	<tr>
		<td>  9/28 </td>
		<td> Scaling Data, Part II (Example NoSQL databases) </td>
	</tr>
</table>
</div>
<div class="slide">
<h1>Schedule (cont.)</h1>
<table>
	<tr>
		<td> 10/05 </td>
		<td> Scaling Data, Part <span class="caps">III</span> (Example NoSQL databases) </td>
	</tr>
	<tr>
		<td> 10/12 </td>
		<td> Midterm break </td>
	</tr>
	<tr>
		<td> 10/19 </td>
		<td> Midterm, Scaling Systems, Part II (Map/Reduce and Their Kin) </td>
	</tr>
	<tr>
		<td> 10/26 </td>
		<td> Recent Advances in Object-Oriented Programming </td>
	</tr>
	<tr>
		<td> 11/02 </td>
		<td> Functional Programming: Into the Real World </td>
	</tr>
	<tr>
		<td> 11/09 </td>
		<td>Object-Oriented Programming vs. Functional Programming: a Critique of Pure Programming </td>
	</tr>
</table>
</div>
<div class="slide">
<h1>Schedule (cont.)</h1>
<table>
	<tr>
		<td> 11/16 </td>
		<td> Complexity vs. Simplicity Part I: Effective Software Development Processes </td>
	</tr>
	<tr>
		<td> 11/23 </td>
		<td> Complexity vs. Simplicity Part II: Scrum, XP, and Lean </td>
	</tr>
	<tr>
		<td> 11/30 </td>
		<td> Complexity vs. Simplicity Part <span class="caps">III</span>: Simple Systems </td>
	</tr>
	<tr>
		<td> 12/07 </td>
		<td> Student Presentations on the Code Project, Course Review </td>
	</tr>
	<tr>
		<td> 12/14 </td>
		<td> Final Example (regular class time) </td>
	</tr>
</table>
</div>
<div class="slide">
<h1>Readings</h1>
<p>Due to the broad scope and topical nature of this course, there is no assigned textbook. A list of books and papers will be recommended for further reference. Specific reading assignments of on-line or library materials will be given as homework.</p>
<p>See the <a href="references.html">References</a>.</p>
</div>
<div class="slide">
<h1>Course Components: Grading</h1>
<table>
  <tr><td colspan='2'>Midterm</td><td>30%</td></tr>
  <tr><td colspan='2'>Final Exam</td><td>30%</td></tr>
  <tr><td colspan='2'>Project</td><td>40%</td></tr>
  <tr><td>20%</td><td>Code quality, correctness</td><td>&nbsp;</td></tr>
  <tr><td>15%</td><td>Individual contributions</td><td>&nbsp;</td></tr>
  <tr><td>5%</td><td>Final oral presentation</td><td>&nbsp;</td></tr>
  <tr><td colspan='2'>&nbsp;</td><td>100%</td></tr>
</table>
</div>
<div class="slide">
<h1>Course Components: Readings and Lecture</h1>
<ul>
	<li><strong>Readings:</strong>  Expand on the current week&#8217;s topics and preview next week&#8217;s topics. Please read them before coming to class.</li>
	<li><strong>Lecture:</strong>  Summarize and expand upon the readings, discuss the current project assignment. There will also be group discussions. The lecture notes will be posted to blackboard and <a href="http://github.com/deanwampler/Presentations/tree/master/PragmaticsOfIndustrialSWDevelopment/">GitHub.com</a> before each class.</li>
</ul>
</div>
<div class="slide">
<h1>Course Components: Project Exercises</h1>
<ul>
	<li>Start with a &#8220;running&#8221; 3-tier Scala application</li>
	<li>Hosted on <a href="http://github.com">GitHub.com</a> at <a href="http://github.com/deanwampler/AkkaWebSampleExercise">github.com/deanwampler/AkkaWebSampleExercise</a>.</li>
	<li>Uses <em>actors</em> to scale computation over a <span class="caps">NYSE</span> data set.</li>
	<li>Add features during the semester.</li>
	<li><em>Refactor</em> the code to improve it and accommodate new features.</li>
</ul>
</div>
<div class="slide">
<h1>Course Components: Project Exercises (cont.)</h1>
<ul>
	<li><em>You are encouraged to work together.</em></li>
	<li>Like you would in an industrial setting&#8230;</li>
	<li>I expect the solutions to look &#8220;similar&#8221;.</li>
</ul>
</div>
<div class="slide">
<h1>Course Components: Project Exercises (cont.)</h1>
<p>&#8230; but</p>
<ul>
	<li>1/2 the grade differences will be based on GitHub checkin logs and the quality of those checkins.</li>
	<li><strong>If you <em>pair program</em>, include <em>both</em> names in the commit comments!</strong></li>
</ul>
h1. Course Components: Project Exercises (cont.)
<ul>
	<li>5% will be based on an <strong>oral presentation</strong> on 12/7.</li>
	<li>15 minutes or so, with time for questions and discussion.</li>
	<li>Topics to be worked out with me.</li>
</ul>
</div>
<div class="slide">
<h1>Midterm and Final Exam</h1>
<ul>
	<li>Will cover the reading, lecture material, and concepts learned in the exercises.</li>
	<li>Final exam content weighted:</li>
	<li>2/3 of the material since the midterm</li>
	<li>1/3 material before the midterm.</li>
	<li>Midterm: 10/19 (first half of that evening&#8217;s session).</li>
	<li>Final exam: 12/14 (usual class time).</li>
</ul>
</div>
<div class="slide">
<h1>Miscellaneous</h1>
<ul>
	<li>Academic Integrity Policy</li>
	<li>Students with Disabilities</li>
	<li>Attendance Policy</li>
	<li>Use of Blackboard</li>
	<li>Turning in Homework</li>
</ul>
</div>
<div class="slide">
<h1>Scaling Computation, Part I</h1>
<ul>
	<li>Two models of concurrency compared:</li>
	<li>Multithreaded Programming.</li>
	<li>The Actor Model of concurrency.</li>
</ul>
</div>
<div class="slide">
<h1>Multithreaded Programming</h1>
<ul>
	<li>Synchronized, shared access to <em>mutable</em> state.</li>
	<li><em>Lock-based Concurrency</em></li>
</ul>
</div>
<div class="slide">
<h1>Multithreaded Programming</h1>
<ul>
	<li><strong>Very</strong> hard to get write.</li>
	<li>Even experts stumble&#8230;</li>
</ul>
</div>
<div class="slide">
<h1>&#8220;Java Concurrency in Practice&#8221;</h1>
<p>Brian Goetz, et al.</p>
<p><img src="images/javaconcurrencyinpracticebook.jpg"><img></div>
<div class="slide">
<h1>Is This Safe?</h1>
<div class="code-normal">
<pre name="code" id="code" class="brush: scala;">@NotThreadSafe
public class UnsafeSequence {
  private int value;
  
  /** Returns a unique value. */
  public int getNext() {
    return value++;
  }
}</pre><p></div><div class="codeurl"><a href="txmt://open?url=file:///Users/dwampler/Documents/presentations/git-hub/presentations/PragmaticsOfIndustrialSWDevelopment/code/UnsafeSequence.java">code/UnsafeSequence.java</a></div></p>
<p>(credit: all Multithreading examples adapted from &#8220;Java Concurrency in Practice&#8221;)</p>
</div>
<div class="slide">
<h1>This Is Safe</h1>
<div class="code-normal">
<pre name="code" id="code" class="brush: scala;">@ThreadSafe
public class Sequence {
  @GuardedBy("this") private int value;
  
  /** Returns a unique value. */
  public synchronized int getNext() {
    return value++;
  }
}</pre><p></div><div class="codeurl"><a href="txmt://open?url=file:///Users/dwampler/Documents/presentations/git-hub/presentations/PragmaticsOfIndustrialSWDevelopment/code/SafeSequence.java">code/SafeSequence.java</a></div></p>
</div>
<div class="slide">
<h1>Things Can Go Wrong</h1>
<ul>
	<li><strong>Safety</strong> &#8211; Nothing Bad Should Happen</li>
	<li><strong>Liveness</strong> &#8211; Something Good Should Eventually Happen</li>
</ul>
</div>
<div class="slide">
<h1>Ways to Lose Liveness</h1>
<ul>
	<li><strong>Deadlock</strong></li>
</ul>
<p><em>You have a lock I want and I have a lock you want.</em></p>
</div>
<div class="slide">
<h1>Deadlock Example</h1>
<div class="code-normal">
<pre name="code" id="code" class="brush: scala;">@NotThreadSafe
public class LeftRightDeadlock {
  private final Object left  = new Object();
  private final Object right = new Object();
  
  public void leftRight() {
    synchronized (left) {
      synchronized (right) { doSomething(); }
  }
  public void rightLeft() {
    synchronized (right) {
      synchronized (left) { doSomethingElse(); }
  }
}</pre><p></div><div class="codeurl"><a href="txmt://open?url=file:///Users/dwampler/Documents/presentations/git-hub/presentations/PragmaticsOfIndustrialSWDevelopment/code/LeftRightDeadlock.java">code/LeftRightDeadlock.java</a></div></p>
</div>
<div class="slide">
<h1>Other Deadlock Hazards</h1>
<ul>
	<li>Don&#8217;t call an external resource from a synchronized method, as it might try to acquire a lock&#8230; Make only <em>open calls.</em></li>
	<li>Similarly, avoid resource acquisition during locks.</li>
	<li>Don&#8217;t lock on a mutable object from different locations. Localize the locking to one place, where it&#8217;s easier to manage the policy for that object.</li>
</ul>
</div>
<div class="slide">
<h1>Starvation</h1>
<p>One thread can never get the resources it needs because other threads, often with inverted priorities, get too much access.</p>
<ul>
	<li>Avoid setting thread priorities. Operating Systems are already very good at this.</li>
</ul>
</div>
<div class="slide">
<h1>Livelock</h1>
<p>A thread is not blocked, but it can&#8217;t complete work because of trying operations always fails.</p>
<ul>
	<li>A common example is repeated execution of a transaction that never succeeds.</li>
	<li>One scenario is two contenders with identical strategies for trying again, often colliding in the same way. If one is <em>greedy</em>, both may succeed.</li>
</ul>
</div>
<div class="slide">
<h1>The Importance of Immutability</h1>
<p>What about access to <em>immutable</em> state? All the synchronization issues go away. Immutable objects have these virtues:</p>
<ul>
	<li>No synchronized access is required.</li>
	<li>They are automatically thread safe.</li>
</ul>
</div>
<div class="slide">
<h1>The Actor Model of Concurrency</h1>
<p>Autonomous &#8220;actors&#8221; receive messages, performing <em>local</em> computations, and sending new messages.</p>
<ul>
	<li>Coordinates and localizes state transitions.</li>
	<li>A higher-level abstraction than lock-based concurrency.</li>
	<li>Successful practical implementations in Erlang, Scala, and other languages.</li>
	<li>Mathematical model of concurrency going back to 1973.</li>
</ul>
</div>
<div class="slide">
<h1>Actors in Scala (Akka)</h1>
<div class="code-normal">
<pre name="code" id="code" class="brush: scala;">package management
import se.scalablesolutions.akka.actor._

class Manager {
  private var managedActors: List[ActorRef] = Nil
  
  def receive = {
    case Register(actor: ActorRef) =&gt; 
      managedActors ::= actor
    case Unregister(actor: ActorRef) =&gt; 
      managedActors -= actor
    case Stop  =&gt; managedActors foreach (_ ! Stop)
    case Start =&gt; managedActors foreach (_ ! Start)
  }
}
</pre><p></div><div class="codeurl"><a href="txmt://open?url=file:///Users/dwampler/Documents/presentations/git-hub/presentations/PragmaticsOfIndustrialSWDevelopment/code/manager-actor.scala">code/manager-actor.scala</a></div></p>
</div>
<div class="slide">
<h1>Actors in Scala (Akka)</h1>
<ul>
	<li>This is an example using the Akka Framework (<a href="http://akkasource.org">akkasource.org</a>) (used in the project).</li>
	<li>Scala also comes with its own Actor library.</li>
</ul>
</div>
<div class="slide">
<h1>Actors in Scala (Akka)</h1>
<ul>
	<li>Our example was contrived; Akka has a rich <code>Supervisor</code> mechanism.</li>
	<li>Inspired by Erlang&#8217;s <span class="caps">OTP</span> (<em>Open Telecom Platform</em>).</li>
	<li>A supervisor manages the lifecycle of N actors.</li>
</ul>
</div>
<div class="slide">
<h1>Supervisors and Lifecycle Management</h1>
<p>The Supervisor can</p>
<ul>
	<li>restart a failed actor (<em>One for One</em>).</li>
	<li>restart a group of coordinated actors, if one fails (<em>All for One</em>).</li>
	<li>itself be supervised (hierarchy)</li>
</ul>
</div>
<div class="slide">
<h1>&#8220;Let It Crash&#8221;</h1>
<p>For many systems, which is better?</p>
<ul>
	<li>A few, large processes that attempt error recovery, or</li>
	<li>Many, small processes where if one has an error, it can just die and be restarted?</li>
</ul>
<p>Complex processes require complex error handling and recovery. The actor model makes <em>modules</em> simpler and more robust, so the system is more robust.</p>
</div>
<div class="slide">
<h1>Starting an Akka Actor</h1>
<div class="code-normal">
<pre name="code" id="code" class="brush: scala;">class Manager {
  private var managedActors: List[ActorRef] = Nil
  
  def receive = { ... }
  }
}

...
import se.scalablesolutions.akka.actor.Actor_
// Creating an actor (one way...) and starting
val manager = Actor.actorOf[Manager]
manager.start</pre><p></div><div class="codeurl"><a href="txmt://open?url=file:///Users/dwampler/Documents/presentations/git-hub/presentations/PragmaticsOfIndustrialSWDevelopment/code/manager-actor2.scala">code/manager-actor2.scala</a></div></p>
</div>
<div class="slide">
<h1>Actor vs. ActorRef</h1>
<p>The <code>ActorRef</code> returned by <code>actorOf</code> is a <em>handle</em> that separates clients from the actual Actor <em>body</em>.</p>
<p>This allows the supervisor to restart the <em>body</em> without disrupting client connections!</p>
</div>
<div class="slide">
<h1>Sending a Message to an Akka Actor</h1>
<p>First, define a <em>sealed</em> collection of messages.</p>
<div class="code-normal">
<pre name="code" id="code" class="brush: scala;">package management
import se.scalablesolutions.akka.actor._

sealed trait ManagementMessage

case class  Register(actor: ActorRef)
case class  Unregister(actor: ActorRef)
case object Stop
case object Start
</pre><p></div><div class="codeurl"><a href="txmt://open?url=file:///Users/dwampler/Documents/presentations/git-hub/presentations/PragmaticsOfIndustrialSWDevelopment/code/actor-messages.scala">code/actor-messages.scala</a></div></p>
</div>
<div class="slide">
<h1>An Asynchronous (Fire and Forget) Message</h1>
<div class="code-normal">
<pre name="code" id="code" class="brush: scala;">class Manager {
  ...  
  def receive = {
    ...
    case Stop  =&gt; managedActors foreach (_ ! Stop)
    case Start =&gt; managedActors foreach (_ ! Start)
  }
}
</pre><p></div><div class="codeurl"><a href="txmt://open?url=file:///Users/dwampler/Documents/presentations/git-hub/presentations/PragmaticsOfIndustrialSWDevelopment/code/actor-asynch-message.scala">code/actor-asynch-message.scala</a></div></p>
<p>If a response is required, the receiver can send a message to the sender.</p>
</div>
<div class="slide">
<h1>An Synchronous (Wait) Message</h1>
<div class="code-normal">
<pre name="code" id="code" class="brush: scala;">class Manager {
  ...  
  def receive = {
    ...
    case Stop  =&gt; managedActors foreach (_ ! Stop)
    case Start =&gt; managedActors foreach (_ ! Start)
    case Ping  =&gt; managedActors map { _ =&gt;
      (_ !! Ping).getOrElse(error(...))
    }
  }
}
</pre><p></div><div class="codeurl"><a href="txmt://open?url=file:///Users/dwampler/Documents/presentations/git-hub/presentations/PragmaticsOfIndustrialSWDevelopment/code/actor-synch-message.scala">code/actor-synch-message.scala</a></div></p>
</div>
<div class="slide">
<h1>An Synchronous (Wait) Message (cont)</h1>
<p>Has the disadvantage of blocking!</p>
</div>
<div class="slide">
<h1>An Asynchronous with a Future Message</h1>
<div class="code-normal">
<pre name="code" id="code" class="brush: scala;">def receive = {
  ...
  case Stop  =&gt; managedActors foreach (_ ! Stop)
  case Start =&gt; managedActors foreach (_ ! Start)
  case Ping =&gt; 
    val futures = managedActors map {actor =&gt;
      actor !!! Ping
    }
    Futures.awaitAll(futures)
    futures map { _.result match 
      case Some(x) =&gt; x
      case None =&gt; "Error!"
    }
}
</pre><p></div><div class="codeurl"><a href="txmt://open?url=file:///Users/dwampler/Documents/presentations/git-hub/presentations/PragmaticsOfIndustrialSWDevelopment/code/actor-future-message.scala">code/actor-future-message.scala</a></div></p>
</div>
<div class="slide">
<h1>An Asynchronous with a Future Message (cont)</h1>
<p>Actor can keep doing work (like firing off simultaneous pings).</p>
<p>Eventually, it waits for the <code>Futures</code> to complete and then proceeds. (It could also do work as each one finishes.)</p>
</div>
<div class="slide">
<h1>Another Way to Write the Last Example</h1>
<div class="code-normal">
<pre name="code" id="code" class="brush: scala;">def receive = {
  ...
  case Stop  =&gt; managedActors foreach (_ ! Stop)
  case Start =&gt; managedActors foreach (_ ! Start)
  case Ping =&gt; 
    val futures = for {     // alternative syntax
      actor &lt;- managedActors
    } yield(actor !!! Ping)
    Futures.awaitAll(futures)
    futures map { _.result match 
      case Some(x) =&gt; x
      case None =&gt; "Error!"
    }
}
</pre><p></div><div class="codeurl"><a href="txmt://open?url=file:///Users/dwampler/Documents/presentations/git-hub/presentations/PragmaticsOfIndustrialSWDevelopment/code/actor-future-message2.scala">code/actor-future-message2.scala</a></div></p>
</div>
<div class="slide">
<h1>Achieving Immutability</h1>
<ul>
	<li><em>Functional languages</em> emphasize immutability.</li>
	<li>Scala encourages immutability, but also allows mutability, when needed.</li>
	<li>Declare variables as constants when possible (<code>val</code> in Scala, <code>const</code> in C/C++/C#, <code>final</code> in Java, etc.)</li>
</ul>
</div>
<div class="slide">
<h1>Introduction to the semester project</h1>
<ul>
	<li>Installing, building, and running the project skeleton.</li>
	<li>Walkthrough of major components and features.</li>
</ul>
</div>
<div class="slide">
<h1>This Week&#8217;s Assignment: Reading</h1>
<ul>
	<li>Brian Goetz, et al., Chapters 1 and 10 in &#8220;Java Concurrency in Practice&#8221; (see references &#8211; available through <a href="http://proquestcombo.safaribooksonline.com.flagship.luc.edu/">Loyola&#8217;s access to Safari Online Books</a>).</li>
	<li><em>Actor Model</em> on Wikipedia <a href="http://en.wikipedia.org/wiki/Actor_model">wikipedia.org/wiki/Actor_model</a></li>
	<li>Browse the Scala resources listed in the <a href="references.html">References</a> to learn more about Scala.</li>
	<li>Browse the Akka framework documentation at <a href="http://docs.akkasource.org">docs.akkasource.org</a>, to learn more about Akka, which is the foundation for the project code.</li>
</ul>
</div>
<div class="slide">
<h1>This Week&#8217;s Assignment: Reading (cont)</h1>
<p>For Next Week&#8217;s Lecture:</p>
<ul>
	<li>Simon Peyton Jones, &#8220;Beautiful Concurrency&#8221;, Chapter 24 in <em>Beautiful Code</em>, pgs. 385-406. Online:  <a href="http://research.microsoft.com/en-us/um/people/simonpj/papers/stm/#beautiful">http://research.microsoft.com/en-us/um/people/simonpj/papers/stm/#beautiful</a></li>
	<li><em>Software Transactional Memory</em> (<span class="caps">STM</span>) on Wikipedia <a href="http://en.wikipedia.org/wiki/Software_transactional_memory">wikipedia.org/wiki/Software_transactional_memory</a>.</li>
</ul>
</div>
<div class="slide">
<h1>This Week&#8217;s Assignment: Project</h1>
<p>The main goal is to get the project code from GitHub, get it running, and begin to understand how it works. It&#8217;s not a trivial project to understand, especially if you&#8217;re new to Scala, but don&#8217;t be intimidated.</p>
<p>Although you won&#8217;t be asked to turn anything in next week, you should still go through the steps as far as you can, even if you don&#8217;t finish, as they will set the stage for subsequent work.</p>
</div>
<div class="slide">
<h1>Get the Project Code</h1>
<ul>
	<li>Create a personal <a href="http://github.com">GitHub</a> account, if you don&#8217;t already have one.</li>
	<li>&#8220;Fork&#8221; the project code at <a href="http://github.com/deanwampler/AkkaWebSampleExercise">github.com/deanwampler/AkkaWebSampleExercise</a></li>
	<li>Follow the instructions provided by GitHub to &#8220;clone&#8221; the code locally on your computer. For example, at your local terminal prompt, you might be asked to run the following command (in a suitable directory of your choosing):</li>
</ul>
<p><code>git clone git@github.com:myAwesomeUserName/AkkaWebSampleExercise.git</code></p>
</div>
<div class="slide">
<h1>Get the Project Code (cont)</h1>
<ul>
	<li>We will actually do our work on &#8220;branch&#8221; called <code>COMP-388-488</code>, not the <code>master</code> branch:</li>
</ul>
<p><code>git checkout COMP-388-488</code></p>
<ul>
	<li>Type the following command to confirm you are on the correct branch:</li>
</ul>
<p><code>git branch</code></p>
<ul>
	<li>It should show the following:</li>
</ul>
<pre>
* COMP-388-488
  master
</pre>
<ul>
	<li>The <code>*</code> shows the current branch.</li>
</ul>
</div>
<div class="slide">
<h1>(Update) These steps were added after Lecture 2</h1>
<ul>
	<li>Add the following 3 lines to the end of the project&#8217;s <code>.git/config</code> file.</li>
</ul>
<div class="code-tiny">
<pre name="code" id="code" class="brush: scala,;">

[branch "COMP-388-488"]
        remote = origin
        merge = refs/heads/COMP-388-488
</pre></div>
<ul>
	<li>Run this command</li>
</ul>
<p><code>git checkout origin COMP-388-488</code></p>
</div>
<div class="slide">
<h1>(Get the Lecture Notes!)</h1>
<p>I&#8217;m also keeping the lecture notes on GitHub. Unless you want to contribute patches ;) there&#8217;s no need to fork this project.</p>
<ul>
	<li>Clone <a href="http://github.com/deanwampler/Presentations">github.com/deanwampler/Presentations</a></li>
</ul>
<p><code>git clone http://github.com/deanwampler/Presentations</code></p>
<p>You&#8217;ll see two directories:</p>
<ul>
	<li><code>akka-intro</code>: an introduction to the Akka Framework, which you might find useful since we&#8217;re using Akka for the project.</li>
	<li><code>PragmaticsOfIndustrialSWDevelopment</code>: The class notes.</li>
</ul>
</div>
<div class="slide">
<h1>(Get the Lecture Notes! &#8211; cont)</h1>
<ul>
	<li>I will update the notes in the <code>PragmaticsOfIndustrialSWDevelopment</code> directory before each class, and also upload the latest version to blackboard.</li>
	<li>See the <code>README</code> for instructions on building the presentation, or just</li>
	<li>Open <code>html/all.html</code> in your browser.</li>
</ul>
</div>
<div class="slide">
<h1>Build the Project</h1>
<ul>
	<li>Open the <code>README.md</code> file.</li>
	<li>Follow its instructions for installing MongoDB and running the project tests.</li>
	<li>Browse the code base and try to recall our discussion of it in class.</li>
</ul>
</div>
<div class="slide">
<h1>Add New Functionality</h1>
<ul>
	<li>In an editor, open the file <code>test/scala/server/finance/InstrumentAnalysisServerTest.scala</code>.</li>
	<li>Find the two <code>TODO</code> comments, one each before a <code>test</code>.</li>
	<li>In the <em>first</em> of those tests, comment out the line <code>pending</code> (like Java, you can put a <code>//</code> before the word <code>pending</code>).</li>
</ul>
</div>
<div class="slide">
<h1>Add New Functionality (cont)</h1>
<ul>
	<li>Run the <code>test</code> action in sbt. The two tests should now fail. You should see the following near the end of the output.</li>
</ul>
<p><code>[error] Failed: : Total 96, Failed 1, Errors 0, Passed 91, Skipped 4</code></p>
<p>Try to understand the error messages:</p>
<ul>
	<li>Look for the stack trace.</li>
	<li>Ignore the verbose server messages (hint: most of those contain the words <code>akka</code> and <code>thread</code>), but notice the <code>org.scalatest.TestFailedException</code> messages.</li>
</ul>
</div>
<div class="slide">
<h1>Add New Functionality (cont)</h1>
<p>Looking at the stack trace:</p>
<ul>
	<li>On what line <em>in the test file</em> did the failure occur? (That is, not a line in the <em>ScalaTest</em> <span class="caps">API</span>.)</li>
	<li>What did the server return and what was the expected value in those two cases? (hint: it&#8217;s a <span class="caps">JSON</span> string&#8230;)</li>
</ul>
</div>
<div class="slide">
<h1>Add New Functionality (cont)</h1>
<ul>
	<li>In your editor, open the file <code>main/scala/server/finance/InstrumentAnalysisServer.scala</code> (the file being tested&#8230;)</li>
	<li>Find the <code>TODO</code> before the method named <code>fetchPrices</code>.</li>
	<li>This method already has the &#8220;instruments&#8221; (i.e., stocks) and statistics information.</li>
	<li>The line <code>Some(x) =&gt; filter(instruments, statistics, x)</code> takes the result from the <code>DataStorageServer</code> and passes it to a final <code>filter</code> method. Note that <code>filter</code> simply returns the <span class="caps">JSON</span> string that was passed in to it.</li>
</ul>
</div>
<div class="slide">
<h1>Add New Functionality (cont &#8211; sort of&#8230;)</h1>
<p>How could we modify <code>filter</code> to filter by instruments? (To make it easier, assume there is only one instrument in the list, as in the test.)</p>
<p>This is not easy, as we really need to parse the <span class="caps">JSON</span> into some representation, filter out the records (which are of the form <code>{"timestamp": 1283233404995, "symbol": "A", "price", "40.0"}</code>) using the <code>symbol</code>, then convert back to a string.</p>
<p>Can you figure out how to do this with the Lift <span class="caps">JSON</span> APIs used in the application and <span class="caps">JSON</span> helper types provided, or using other 3rd-party <span class="caps">JSON</span> libraries?</p>
<p>Actually, the right way to implement this feature is to support this filtering at the database level, which we will learn how to do with MongoDB.</p>
</div>
<div class="title slide">
<h1>Lecture 2: Scaling Computation, Part II, and Course Project Rebooted</h1>
</div>
<div class="slide">
<h1>Software Transactional Memory (<span class="caps">STM</span>)</h1>
<ul>
	<li>A concurrency model for safely mutating values.</li>
	<li>Safer alternative to lock-based concurrency.</li>
	<li>Can complement Actor concurrency.</li>
	<li>Brings database-like transactions to memory.</li>
</ul>
</div>
<div class="slide">
<h1>History: A Few Milestones</h1>
<table>
	<tr>
		<td> 1986 </td>
		<td> Tom Knight proposes hardware-based transactional memory. </td>
	</tr>
	<tr>
		<td> 1995 </td>
		<td> Nir Shavit and Dan Touitou first propose <span class="caps">STM</span>. </td>
	</tr>
	<tr>
		<td> mid-2000&#8217;s </td>
		<td> Added to Haskell. </td>
	</tr>
	<tr>
		<td> 2008 </td>
		<td> In the first release of Clojure. </td>
	</tr>
</table>
</div>
<div class="slide">
<h1>Some Notable Implementations</h1>
<table>
	<tr>
		<td> <strong>Language</strong> </td>
		<td> <strong>Name</strong> </td>
		<td> <strong>Notes</strong> </td>
	</tr>
	<tr>
		<td> Haskell </td>
		<td> <em>N.A.</em> </td>
		<td> Built into the language. Pioneering implementation copied by others. </td>
	</tr>
	<tr>
		<td> Clojure </td>
		<td> <em>N.A.</em> </td>
		<td> Built into the language. Really driving interest in <span class="caps">STM</span> and Clojure! </td>
	</tr>
	<tr>
		<td> Java and Scala</td>
		<td> Multiverse </td>
		<td> Used by Akka. </td>
	</tr>
</table>
<p>Many others listed on the <a href="http://en.wikipedia.org/wiki/Software_transactional_memory"><span class="caps">STM</span> Wikipedia page</a>.</p>
</div>
<div class="slide">
<h1><span class="caps">ACID</span></h1>
<p>Properties of <em>database</em> transactions:</p>
<ul>
	<li><strong>A</strong>: Atomicity</li>
	<li><strong>C</strong>: Consistency</li>
	<li><strong>I</strong>: Isolation</li>
	<li><strong>D</strong>: Durability</li>
</ul>
</div>
<div class="slide">
<h1>Atomicity</h1>
<p>A transaction behaves as if it happens in one, uninterruptible, &#8220;all or nothing&#8221; step.</p>
<ul>
	<li>If any <em>internal</em> step fails, the whole transaction is rolled back to the beginning state.</li>
	<li>Prevents inconsistent state changes from persisting.</li>
	<li>Transactions can fail for many reasons: bugs, resource exhaustion, process or hardware failure, etc.</li>
</ul>
</div>
<div class="slide">
<h1>Atomicity: Example</h1>
<p><strong>Scenario:</strong> A transaction T will transfer $100 from account #1, with starting balance $1100, to account #2, with starting balance $900. If successful, both accounts must have $1000.</p>
<ul>
	<li>T deducts $100 from account #1.</li>
	<li>T fails to add $100 to account #2, because it is already in another transaction.</li>
	<li>Rollback: T restores the balance of account #1 to $1100.</li>
</ul>
<p>If the transaction didn&#8217;t roll back, Account #1 would have $1000 and Account #2 would have $900.</p>
</div>
<div class="slide">
<h1>Consistency</h1>
<p>The state is always <em>consistent</em> and any transaction takes the database from one consistent state to another (as understood by the database).</p>
<p>Example consistency rules:</p>
<ul>
	<li>Types must be respected (e.g., no strings are allowed in an integer location).</li>
	<li>References to other entities must be valid. (<em>referential integrity</em>)</li>
</ul>
<p>Doesn&#8217;t cover things the database doesn&#8217;t know about, like business rules enshrined in Java&#8230;</p>
</div>
<div class="slide">
<h1>Consistency: Example</h1>
<p><strong>Scenario:</strong> A bank customer has two savings accounts, but decides to close one of them.</p>
<p>Suppose the customer records are in one database table and the account records are in a separate table. It&#8217;s common to use a third <em>join table</em> to map the relationships between M customers and N accounts.</p>
<p>So, in this scenario, the join table must be updated to remove mappings between the customer and the closed account.</p>
</div>
<div class="slide">
<h1>Side Note: Is Data Ever Deleted?</h1>
<p>In many real-world scenarios, you cannot delete data, just make it &#8220;obsolete&#8221;. The problem is that sometimes you need to undo past actions (e.g., the customer changes her mind and wants to reopen that savings account) and sometimes you need historical data for regulatory and other reasons.</p>
<p><strong>Scenario:</strong> The customer who closed one of her savings accounts wants to print out all the statements for the year, for tax purposes.</p>
<p>If you deleted the closed account, such records would be lost.</p>
</div>
<div class="slide">
<h1>Isolation</h1>
<p>Modified data in transaction A that hasn&#8217;t been committed is invisible to other transactions.</p>
<p>Necessary to preserve data integrity and consistency.</p>
</div>
<div class="slide">
<h1>Isolation: Example</h1>
<p><strong>Scenario:</strong> Two transactions want to add money to an account.</p>
<ul>
	<li>Transaction A is adding money to an account; it increases the balance, but it has not committed the change yet.</li>
	<li>Transaction B reads the balance inside transaction A and adds more money to the <em>value of transaction A&#8217;s</em> balance.</li>
	<li>A fails and roles back the balance. (So, A leaves the data in a consistent state.)</li>
	<li>B succeeds, committing its balance value, which is too high. (So, B leaves the data in an inconsistent state.)</li>
</ul>
</div>
<div class="slide">
<h1>Isolation (continued)</h1>
<p><strong>Exception:</strong> <em>Dirty Reads</em> are sometimes allowed by databases.</p>
<p>Transactions can read &#8220;in flight&#8221; data, but not modify it. Allowed in order to improve performance of concurrent transactions and to minimize potential deadlocks.</p>
</div>
<div class="slide">
<h1>Durability</h1>
<p>Committed transactions will survive system failure.</p>
<p>Often implemented with a transaction log that can be &#8220;replayed&#8221; if recovery is required.</p>
</div>
<div class="slide">
<h1>Durability: Example</h1>
<p><strong>Scenario:</strong> Money is deposited to an account, then the hard disk holding that database record crashes.</p>
<ul>
	<li>Replace the hard drive.</li>
	<li>Replay the transaction log for all transactions with data on that drive&#8230;</li>
</ul>
<p>(I&#8217;ve assumed we weren&#8217;t using <span class="caps">RAID</span> and other redundancy measures.)</p>
<p><strong>Note:</strong> The transaction is considered completed when the log entry is written!</p>
</div>
<div class="slide">
<h1>Implementing <span class="caps">ACID</span></h1>
<ul>
	<li>Locking</li>
	<li>Multiversion Concurrency Control (<span class="caps">MCC</span> or <span class="caps">MVCC</span>)</li>
</ul>
</div>
<div class="slide">
<h1>Locking</h1>
<ul>
	<li>Used when data modified <em>in place</em> (e.g., an existing row is updated).</li>
	<li>Locking of whole table or per row (typically)</li>
	<li>Must lock for reads and writes, to ensure consistency.</li>
</ul>
</div>
<div class="slide">
<h1>Multiversion Concurrency Control</h1>
<ul>
	<li>Rather than modifying existing data, make new copies.</li>
	<li>The old data is obsolete, but&#8230;</li>
	<li>&#8230; readers may wish to access the old data to get a snapshot of state at a point in time.</li>
</ul>
<ul>
	<li>So, read locks aren&#8217;t required, because all records are write-once/read-only.</li>
</ul>
</div>
<div class="slide">
<h1>Multiversion Concurrency Control (cont.)</h1>
<ul>
	<li>Note that the values are called <strong>persistent</strong>, because they don&#8217;t go away on their own (or change).</li>
	<li>Need to periodically remove old records, to save space!</li>
	<li>Copying data can be inefficient; we&#8217;ll return to this issue&#8230;</li>
</ul>
</div>
<div class="slide">
<h1>Multiversion Concurrency Control (cont.)</h1>
<p><strong>Optimistic Locking:</strong></p>
<ul>
	<li>Don&#8217;t lock to prevent others from starting transactions on the same data.</li>
	<li>When it&#8217;s time to commit, if another transaction has committed changes already (so you&#8217;re original copy is now <em>stale</em>), then fail the transaction (and usually start again).</li>
</ul>
<ul>
	<li>Each transaction has its own copy of the data.</li>
</ul>
</div>
<div class="slide">
<h1><span class="caps">MVCC</span> Failure Example</h1>
<ul>
	<li>Transaction 1 reads data values from record R.</li>
	<li>Transaction 1 begins modifications to those values.</li>
	<li>Transaction 2 reads data values from record R.</li>
	<li>Transaction 2 begins modifications to those values.</li>
	<li>Transaction 2 commits changes.</li>
	<li>Transaction 1 attempts to commit changes. Data is stale, so transaction rolls back.</li>
	<li>Repeat Transaction 1.</li>
</ul>
</div>
<div class="slide">
<h1>Costs vs. Benefits of <span class="caps">MVCC</span></h1>
<p>- Transaction failure and retry are costly, but in most systems, they&#8217;re infrequent.<br />
- Copies are costly to make; must be cleaned periodically.</p>
<p>+ No read locks.<br />
+ Optimistic locking for writes.<br />
+ Good concurrency, hence good scalability.<br />
+ Consistent state snapshots over time.</p>
</div>
<div class="slide">
<h1>Software Transactional Memory</h1>
<p>Brings the <span class="caps">ACI</span> (no D) to Memory.</p>
<ul>
	<li>No durability, by default</li>
	<li>&#8230; but some frameworks, like Akka, let you plug in durability using a database as a backing-store.</li>
	<li>Most implementations use <span class="caps">MVCC</span>.</li>
</ul>
</div>
<div class="slide">
<h1>Symantics (Using Akka Syntax)</h1>
<ul>
	<li>Separates <em>references</em> from <em>values</em>.</li>
	<li>The <em>values</em> should be immutable.</li>
	<li><strong>atomic:</strong> Marks a block controlled by <span class="caps">STM</span> where <em>refs</em> can be associated with new <em>values</em>.</li>
</ul>
<div class="code-normal">
<pre name="code" id="code" class="brush: scala;">import se.scalablesolutions.akka.stm.local._

val ref = Ref(0)        // initialize with 0
def counter = atomic {  // demarcate "atomic" block
  ref alter (_ + 1)     // change value using a function
}
 
counter  // -&gt; 1
counter  // -&gt; 2
ref.get  // -&gt; 2 (retrieve the value explicitly)</pre><p></div><div class="codeurl"><a href="txmt://open?url=file:///Users/dwampler/Documents/presentations/git-hub/presentations/PragmaticsOfIndustrialSWDevelopment/code/akka-stm-example1.scala">code/akka-stm-example1.scala</a></div></p>
</div>
<div class="slide">
<h1>Symantics (cont.)</h1>
<ul>
	<li>More syntax for working with references.</li>
</ul>
<div class="code-normal">
<pre name="code" id="code" class="brush: scala;">import se.scalablesolutions.akka.stm.local._

val ten = 10
val ref = Ref(1) // initialize with 1 
atomic {  
  ref set 10     // set new value
}                // (actually returns old value)
ref.get          // -&gt; 10</pre><p></div><div class="codeurl"><a href="txmt://open?url=file:///Users/dwampler/Documents/presentations/git-hub/presentations/PragmaticsOfIndustrialSWDevelopment/code/akka-stm-example2.scala">code/akka-stm-example2.scala</a></div></p>
</div>
<div class="slide">
<h1>Symantics: Blocking (&#8220;Retry&#8221;)</h1>
<ul>
	<li><strong>Retry</strong>: Block on a condition and try again when the condition is met.</li>
</ul>
<div class="code-normal">
<pre name="code" id="code" class="brush: scala;">// Inside a Transactor for bank transfers:
def receive = {
  case Transfer(from, to, amount) =&gt;
    atomic {
      if (from.get &lt; amount) {
        log.info("not enough money - retrying")
        retry  // &lt;= try again "later"
      }
      log.info("transferring")
      from alter (_ - amount)
      to alter (_ + amount)
    }
}
</pre><p></div><div class="codeurl"><a href="txmt://open?url=file:///Users/dwampler/Documents/presentations/git-hub/presentations/PragmaticsOfIndustrialSWDevelopment/code/akka-stm-example3.scala">code/akka-stm-example3.scala</a></div></p>
<p>(See <strong>Blocking Transactions</strong> on the <a href="http://doc.akkasource.org/stm-scala">Akka <span class="caps">STM</span> page</a> for the full example.)</p>
</div>
<div class="slide">
<h1>Symantics: Choice (&#8220;orElse&#8221;)</h1>
<ul>
	<li><strong>Choice:</strong> When we can block on two paths, proceed when one of them becomes unblocked.</li>
</ul>
<div class="code-small">
<pre name="code" id="code" class="brush: scala;">def receive = {
  case EitherOr(left, right, action) =&gt;
    atomic {
      either {
        if (left.ok == false)
          retry
        else
          action(left)
      } orElse {
        if (right.ok == false)
          retry
        else
          action(right)        
      }
    }
}
</pre><p></div><div class="codeurl"><a href="txmt://open?url=file:///Users/dwampler/Documents/presentations/git-hub/presentations/PragmaticsOfIndustrialSWDevelopment/code/akka-stm-example4.scala">code/akka-stm-example4.scala</a></div></p>
</div>
<div class="slide">
<h1>Composability and Modularity</h1>
<p>Recall in &#8220;Beautiful Concurrency&#8221;, Simon Peyton Jones described how <span class="caps">STM</span> transactions are <strong>modular</strong> in the sense that they are black boxes that can be <strong>composed</strong> to form larger transactions. <strong>Blocking</strong> and <strong>choice</strong> make this possible.</p>
</div>
<div class="slide">
<h1>Misc. Akka Syntax</h1>
<ul>
	<li>There are more features in the <span class="caps">API</span>, including configuration of implementation behavior.</li>
	<li><code>Transactors</code> are <code>Actors</code> with <span class="caps">STM</span> behavior.</li>
</ul>
</div>
<div class="slide">
<h1>Performance?</h1>
<ul>
	<li>Managing references to &#8220;snapshots&#8221; adds overhead (vs. unprotected reads and writes).</li>
	<li>Copies can be expensive&#8230;</li>
</ul>
</div>
<div class="slide">
<h1>Minimizing Copy Overhead &#8211; Trees</h1>
<p><strong>Hint:</strong> If you have a list of 200 items and you create a new version by inserting one item in the middle, the old and new versions can <em>share</em> the sublists on either side of the changed element! You can do this in a straightforward way with tree structures.</p>
<p>Here&#8217;s an example of how Clojure&#8217;s <code>PersistentVector</code> is implemented. Most STMs use similar approaches.</p>
</div>
<div class="slide">
<h1>A Value Before an Insert</h1>
<p><img src="images/persistentvector1.png"><img><br />
<br />
(credit: <a href="http://blog.higher-order.net/2009/02/01/understanding-clojures-persistentvector-implementation/">Understanding Clojures PersistentVector Implementation</a>)</div>
<div class="slide">
<h1>A Value After an Insert</h1>
<p><img src="images/persistentvector2.png"><img><br />
<br />
(credit: <a href="http://blog.higher-order.net/2009/02/01/understanding-clojures-persistentvector-implementation/">Understanding Clojures PersistentVector Implementation</a>)</div>
<div class="slide">
<h1><span class="caps">STM</span> Recap</h1>
<p>+ A very power mechanism for <em>principled</em> mutation of state.<br />
+ Cleanly separates <em>values</em> from <em>references</em> to them.<br />
+ Composable, modular transactional semantics.<br />
- Imposes some unavoidable overhead.</p>
</div>
<div class="slide">
<h1>&#8220;Memory is the New Disk&#8221;</h1>
<p><strong>1980&#8217;s &#8211; <em>Page Faulting</em>:</strong></p>
<p>When total program memory exceeded physical memory, blocks (&#8220;pages&#8221;) of memory would be swapped to disk and back again, using a least-recently used algorithm. But you wanted to avoid it because of the performance penalty. It was several orders of magnitude slower than memory access.</p>
</div>
<div class="slide">
<h1>&#8220;Memory is the New Disk&#8221; (cont.)</h1>
<p><strong>2000&#8217;s &#8211; <em>Cache Misses</em>:</strong></p>
<p>Memory, like CPUs, has also grown according to Moore&#8217;s Law, <em>but more slowly</em>. Also, bus speeds aren&#8217;t as fast as <span class="caps">CPU</span> clock speeds. So today, <strong>memory access</strong> is several orders of magnitude slower than on-chip <strong>cache</strong> access.</p>
<p>So, for optimal performance, we should <em>really</em> program to minimize cache misses.</p>
</div>
<div class="slide">
<h1>Akka Code Project Setup</h1>
<p>For the 2nd half of tonight&#8217;s class, follow the instructions in the notes for Lecture 1 to setup the project. We&#8217;ll actually work through them together in this lecture. Then I&#8217;ll describe the exercise I want you to do for next week (see notes below).</p>
</div>
<div class="slide">
<h1>This Week&#8217;s Assignment: Reading</h1>
<p>More on the underpinnings of <span class="caps">STM</span>,</p>
<ul>
	<li><a href="http://en.wikipedia.org/wiki/ACID"><span class="caps">ACID</span></a> (Wikipedia).</li>
	<li><a href="http://en.wikipedia.org/wiki/Multiversion_concurrency_control">Multiversion Concurrency Control</a> (Wikipedia).</li>
</ul>
<p>For a more detailed look at <span class="caps">STM</span>, see this <a href="http://java.ociweb.com/mark/stm/article.html">detailed paper</a> published by <span class="caps">OCI</span>. For information on Clojure&#8217;s persistent data structures, see for example <a href="http://blog.higher-order.net/2009/02/01/understanding-clojures-persistentvector-implementation/">Understanding Clojures PersistentVector Implementation</a></p>
</div>
<div class="slide">
<h1>This Week&#8217;s Assignment: Reading (cont.)</h1>
<p>If you need more information on Scala and Akka, see the following,</p>
<ul>
	<li>My <a href="http://polyglotprogramming.com/papers/SeductionsOfScala.pdf">Seductions of Scala</a> presentation. It should fill in a few Scala gaps. <strong><span class="caps">NOTE</span>:</strong> I am presenting this talk at the September 16th <a href="http://meetup.com/chicagoscala">Chicago Scala User&#8217;s Group</a> (<span class="caps">RSVP</span> required).</li>
	<li><a href="http://www.naildrivin5.com/scalatour/wiki_pages/MainPage">Another Tour of Scala</a>.</li>
	<li>This presentation on Akka: <a href="http://www.slideshare.net/jboner/akka-scala-summit-oscon-2010">slideshare.net/jboner/akka-scala-summit-oscon-2010</a>, which is also shown on the home page for the Akka Documentation: <a href="http://doc.akkasource.org">doc.akkasource.org</a>. See in particular the discussion of how actors, agents, and <span class="caps">STM</span> work in Akka.</li>
</ul>
<p>For more on Scala and Akka, see the Scala and Akka sections in the <a href="references.html">References</a>.</p>
</div>
<div class="slide">
<h1>This Week&#8217;s Assignment: Reading (cont.)</h1>
<ul>
	<li><a href="http://en.wikipedia.org/wiki/Distributed_computing">Distributed Computing</a>. Focus on the Introduction, History, Applications, and Architectures sections.</li>
</ul>
</div>
<div class="slide">
<h1>This Week&#8217;s Assignment: Project</h1>
<p>Complete the setup instructions in Lecture 1 that we went through this evening.</p>
<ul>
	<li>The <code>sbt update</code> command should be successful with no errors.</li>
	<li>MongoDB should be installed and you should know how to start and stop it.</li>
	<li>The <code>sbt test</code> command should work with no test failures.</li>
</ul>
</div>
<div class="slide">
<h1>This Week&#8217;s Assignment: Project</h1>
<p>Work the suggested exercise from last week, but with the refinements I will describe now. I have repeated that section from the notes, with the changes I want you to do, in very specific detail (since I know most of you are new to Scala, as well as new to this code). Reminder: You are welcome to work on this assignment with your class mates.</p>
<p>However, this week, I would like you to commit your changes to your cloned git repository on GitHub. I&#8217;ll tell you how at the end of the instructions.</p>
</div>
<div class="slide">
<h1>Add New Functionality</h1>
<p>(Adapted from the Lecture 1 notes.)</p>
<ul>
	<li>In an editor, open the file <code>test/scala/server/finance/InstrumentAnalysisServerTest.scala</code>.</li>
	<li>Find the two <code>TODO</code> comments, one each before a <code>test</code>.</li>
	<li>In the <em>first</em> of those tests, comment out the line <code>pending</code> (like Java, you can put a <code>//</code> before the word <code>pending</code>).</li>
</ul>
</div>
<div class="slide">
<h1>Add New Functionality (cont)</h1>
<ul>
	<li>Run the <code>test</code> action in sbt. The two tests should now fail. You should see the following near the end of the output.</li>
</ul>
<p><code>[error] Failed: : Total 110, Failed 1, Errors 0, Passed 104, Skipped 5</code></p>
<p>Try to understand the error messages:</p>
<ul>
	<li>Look for the stack trace.</li>
	<li>Ignore the verbose server messages (hint: most of those contain the words <code>akka</code> and <code>thread</code>), but notice the <code>org.scalatest.TestFailedException</code> messages.</li>
</ul>
</div>
<div class="slide">
<h1>Add New Functionality (cont)</h1>
<p>When you find the stack trace, <em>above</em> it is this output:</p>
<div class="code-tiny">
<pre name="code" id="code" class="brush: scala;">[error] Test Failed: calculateStatistics returns a JSON string containing all data that matches the instrument criteria
org.scalatest.TestFailedException: JObject(List(JField(criteria,JObject(List(JField(instruments,JArray(List(JString(A)))), JField(statistics,JArray(List(JString(price[$])))), JField(start,JInt(0)), JField(end,JInt(1283824964864))))), JField(results,JArray(List(JObject(List(JField(timestamp,JInt(1283824954864)), JField(symbol,JString(A)), JField(price,JDouble(0.0)))), JObject(List(JField(timestamp,JInt(1283824955864)), JField(symbol,JString(C)), JField(price,JDouble(10.0)))), JObject(List(JField(timestamp,JInt(1283824956864)), JField(symbol,JString(A)), JField(price,JDouble(20.0)))), JObject(List(JField(timestamp,JInt(1283824957864)), JField(symbol,JString(B)), JField(price,JDouble(30.0)))), JObject(List(JField(timestamp,JInt(1283824958864)), JField(symbol,JString(A)), JField(price,JDouble(40.0))))))))) did not equal JObject(List(JField(criteria,JObject(List(JField(instruments,JArray(List(JString(A)))), JField(statistics,JArray(List(JString(price[$])))), JField(start,JInt(0)), JField(end,JInt(1283824964864))))), JField(results,JArray(List(JObject(List(JField(timestamp,JInt(1283824954864)), JField(symbol,JString(A)), JField(price,JDouble(0.0)))), JObject(List(JField(timestamp,JInt(1283824958864)), JField(symbol,JString(A)), JField(price,JDouble(40.0)))), JObject(List(JField(timestamp,JInt(1283824956864)), JField(symbol,JString(A)), JField(price,JDouble(20.0)))))))))
</pre><p></div><div class="codeurl"><a href="txmt://open?url=file:///Users/dwampler/Documents/presentations/git-hub/presentations/PragmaticsOfIndustrialSWDevelopment/code/exercise1-test-failure.scala">code/exercise1-test-failure.scala</a></div></p>
<p>(Yeah!)</p>
</div>
<div class="slide">
<h1>Add New Functionality (cont)</h1>
<p>This is <span class="caps">JSON</span> represented using the Scala <span class="caps">JSON</span> library that is part of the <a href="http://liftweb.net">Lift Web framework</a> (which the project uses). I find it easiest to copy and paste messy output like this to an editor where I can manipulate it&#8230;</p>
<p>But we don&#8217;t really need to do that now. Look for the words <code>did not equal</code>. The &#8220;<span class="caps">JSON</span>&#8221; before these words is much longer than the &#8220;<span class="caps">JSON</span>&#8221; after them. The before case is what was actually returned, while the after case is what we expected. Recall the purpose of the test, to confirm that the results are filtered for just the <code>A</code> stocks. Look for these strings: <code>JField(instruments,JArray(List(JString(A)))</code>. The <code>A</code> is the instrument (stock symbol). The expected string only has <code>A</code> &#8220;fields&#8221;, while the actual also has <code>B</code> and <code>C</code> fields, too.</p>
</div>
<div class="slide">
<h1>Add New Functionality (cont)</h1>
<p>Now look again at the stack trace:</p>
<ul>
	<li>On what line <em>in the test file</em> did the failure occur? (That is, not a top line, which occurred in the <em>ScalaTest</em> <span class="caps">API</span>.)</li>
</ul>
<p>That line is 112 (at the time of this writing&#8230;). That line in <code>test/scala/server/finance/InstrumentAnalysisServerTest.scala</code> is</p>
<div class="code-tiny">
<pre name="code" id="code" class="brush: scala,;">

analysisServer.calculateStatistics(criteria) should equal (expected)
</pre></div>
<p>Note how this <em>test assertion</em> reads like English? The result of &#8220;calling the <code>calculateStatistics</code> method should equal the <code>expected</code> value&#8221;.</p>
</div>
<div class="slide">
<h1>Add New Functionality (cont)</h1>
<ul>
	<li>Okay, to start adding new functionality, run this <code>sbt</code> command:</li>
</ul>
<p><code>~test-only org.chicagoscala.awse.server.finance.InstrumentAnalysisServerTest</code></p>
<ul>
	<li>Note that it will wait (no prompt is returned) and every time you save code changes, this test will run.</li>
	<li>Using the <code>~test-only</code> &#8220;action&#8221; saves time, running in a few seconds, while running all the tests takes longer.</li>
</ul>
</div>
<div class="slide">
<h1>Add New Functionality (cont)</h1>
<ul>
	<li>Now, in your editor of choice, open the file <code>main/scala/server/finance/InstrumentAnalysisServer.scala</code> (the file being tested&#8230;)</li>
	<li>Find the <code>TODO</code> before the method named <code>fetchPrices</code>.</li>
	<li>This method already has the &#8220;instruments&#8221; (i.e., stocks) and statistics information.</li>
</ul>
</div>
<div class="slide">
<h1>Add New Functionality (cont.)</h1>
<ul>
	<li>Find this line:</li>
</ul>
<div class="code-tiny">
<pre name="code" id="code" class="brush: scala,;">

formatPriceResults(filter(result), instruments, statistics, startMillis, endMillis)
</pre></div>
<ul>
	<li>Then find the <code>filter</code> method below it. Note that it takes a <code>(json: JValue)</code> (i.e., a variable named <code>json</code> of type <code>JValue</code>) and it simply returns the passed-in value unaltered.</li>
	<li>Your task is to add filtering by instruments.</li>
</ul>
</div>
<div class="slide">
<h1>Add New Functionality (cont.)</h1>
<ul>
	<li>Note the <code>instruments</code> argument passed to <code>fetchPrices</code>; add this argument to the <code>filter</code> method.</li>
	<li>Modify the call to <code>filter</code> to pass the <code>instruments</code>.</li>
	<li>Replace the body of <code>filter</code> (everything after the <code>=</code> sign) with this body:</li>
</ul>
<div class="code-tiny">
<pre name="code" id="code" class="brush: scala,;">

{  val names = Instrument.toSymbolNames(instruments)
  // log.error ("json: "+json.toString)
  // log.error ("json.values: "+json.values.toString)
  // log.error ("symbol: "+(json \\ "symbol").toString)
  json match {
    case JArray(list) =&gt; list filter { element =&gt; 
      (element \\ "symbol") match {
        case JField("symbol", x) if (names.exists(x == JString(_))) =&gt; true
        case _ =&gt; false
      }
    }
    case _ =&gt; true
  }
}
</pre></div>
</div>
<div class="slide">
<h1>Add New Functionality (cont.)</h1>
<ul>
	<li>Now the test should be passing (showing <code>[success] Successful</code>).</li>
	<li>Hit return to exit <code>~test-only</code> and run all the tests (<code>test</code>) and confirm that they all now pass.</li>
</ul>
</div>
<div class="slide">
<h1>Add New Functionality (cont.)</h1>
<p>You may not understand what this method is doing. It&#8217;s actually quite sophisticated and relies on very specific knowledge about the underlying format of the <code>json: JValue</code>. In fact, the correct way to implement this feature is to support this filtering at the database level, which we will learn how to do with MongoDB. This approach is both more efficient (we don&#8217;t waste time returning stuff we&#8217;ll throw away), more flexible, and more robust.</p>
<p>Note that I added some <code>log.error</code> statements in comments. Try running the <code>~test-only</code> command again and uncomment those lines. Try to find them in all the noisy output. Do they help you understand what&#8217;s going on? Look at the Lift <span class="caps">JSON</span> documentation to further understand this <span class="caps">API</span>. It is here: <a href="http://main.scala-tools.org/mvnsites/liftweb-2.0/framework/scaladocs/index.html">scala-tools.org/mvnsites/liftweb-2.0/framework/scaladocs/index.html</a> (Hint: click the <code>net.liftweb.json</code> link to focus in on the <span class="caps">JSON</span> part of the <span class="caps">API</span>.)</p>
</div>
<div class="slide">
<h1>Turning in the Assignment</h1>
<p>Before class next week, 6/14, commit your code changes to GitHub, using these commands.</p>
<p>First make sure you don&#8217;t have any changes that aren&#8217;t checked in.</p>
<ul>
	<li><code>git status</code></li>
</ul>
<p>If you added any new files to the project (unlikely) and you see them listed in the section labeled <code># Untracked files:</code>, then <em>add</em> those files to git (<strong>Note: ignore the <code>logs</code> and <code>data</code> directories!</strong>):</p>
<ul>
	<li><code>git add files_to_be_added</code></li>
</ul>
<p>Where <code>files_to_be_added</code> is the list of new files to add.</p>
</div>
<div class="slide">
<h1>Turning in the Assignment (cont.)</h1>
<p>In the status output, you might see files in the section labeled <code># Changed but not updated:</code>. These are files where you&#8217;ve made local changes, but not yet checked them in. If so, checkin those files to your <em>local</em> repository now.</p>
<ul>
	<li><code>git checkin -m 'appropriate comment' files</code></li>
</ul>
<p>You can either list the <code>files</code> or omit the list, in which case <em>all</em> the files with changes will be checked in.</p>
</div>
<div class="slide">
<h1>Turning in the Assignment (cont.)</h1>
<p>Finally, <em>push</em> your local repository changes to the copy on GitHub.</p>
<ul>
	<li><code>git push</code></li>
</ul>
<p>You&#8217;ll see some output, but no error messages.</p>
<p>When finished, send me email. Also, tell me your username on GitHub, so I&#8217;ll know who owns which <em>forks</em> of the project.</p>
<p>Again, if you have any problems with these steps, let me know. We can go over them next week in class, too, if necessary.</p>
</div>
<div class="title slide">
<h1>Lecture 3: Scaling Systems, Part I</h1>
</div>
<div class="title slide">
<h1>Lecture 4: Scaling Data, Part I</h1>
</div>
<div class="title slide">
<h1>Lecture 5: Scaling Data, Part II</h1>
</div>
<div class="title slide">
<h1>Lecture 6: Scaling Data, Part <span class="caps">III</span></h1>
</div>
<div class="title slide">
<h1>Lecture 7: Midterm Break (No Class)</h1>
<p>Have a good break!</p>
</div>
<div class="title slide">
<h1>Lecture 8: Midterm and Scaling Systems, Part II</h1>
</div>
<div class="title slide">
<h1>Lecture 9: Recent Advances in Object-Oriented Programming (<span class="caps">OOP</span>)</h1>
</div>
<div class="title slide">
<h1>Lecture 10: Functional Programming (FP): Into the Real World</h1>
</div>
<div class="title slide">
<h1>Lecture 11: Object-Oriented Programming vs. Functional Programming: a Critique of Pure Programming</h1>
</div>
<div class="title slide">
<h1>Lecture 12: Complexity vs. Simplicity Part I: Effective Software Development Processes</h1>
</div>
<div class="title slide">
<h1>Lecture 13: Complexity vs. Simplicity Part II: Scrum, XP, and Lean</h1>
</div>
<div class="title slide">
<h1>Lecture 14: Complexity vs. Simplicity Part <span class="caps">III</span>: Simple Systems</h1>
</div>
<div class="title slide">
<h1>Lecture 15: Student Presentations on the Code Project and Course Review</div></h1>

  <!-- Syntax Highlighter -->
  <script language="javascript" type="text/javascript" src="../lib/scripts/shCore.js"></script>
  <script language="javascript" type="text/javascript" src="../lib/scripts/shBrushCpp.js"></script>
  <script language="javascript" type="text/javascript" src="../lib/scripts/shBrushCSharp.js"></script>
  <script language="javascript" type="text/javascript" src="../lib/scripts/shBrushCss.js"></script>
  <script language="javascript" type="text/javascript" src="../lib/scripts/shBrushDelphi.js"></script>
  <script language="javascript" type="text/javascript" src="../lib/scripts/shBrushJava.js"></script>
  <script language="javascript" type="text/javascript" src="../lib/scripts/shBrushJScript.js"></script>
  <script language="javascript" type="text/javascript" src="../lib/scripts/shBrushPhp.js"></script>
  <script language="javascript" type="text/javascript" src="../lib/scripts/shBrushPython.js"></script>
  <script language="javascript" type="text/javascript" src="../lib/scripts/shBrushRuby.js"></script>
  <script language="javascript" type="text/javascript" src="../lib/scripts/shBrushScala.js"></script>
  <script language="javascript" type="text/javascript" src="../lib/scripts/shBrushSql.js"></script>
  <script language="javascript" type="text/javascript" src="../lib/scripts/shBrushVb.js"></script>
  <script language="javascript" type="text/javascript" src="../lib/scripts/shBrushXml.js"></script>
  <script language="javascript">
    SyntaxHighlighter.config.clipboardSwf = 'scripts/clipboard.swf';
    SyntaxHighlighter.all();
  </script>
</div>
</body>
</html>
